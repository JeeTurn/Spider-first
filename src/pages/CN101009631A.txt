<!DOCTYPE html><html><head><title>专利 CN101009631A - 一种QoS控制方法和系统 -  Google 专利</title><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){var d=void 0!=b?b:(new Date).getTime();this.t[a]=[d,c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(e){}};this.tick("start",null,a)}var a;window.performance&&(a=window.performance.timing);var f=a?new e(a.responseStart):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_",
"_wtsrt",d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();})();
</script><link rel="stylesheet" href="/patents/css/_50a6672b5f82ffbd39b7a9e87fd4594c/kl_intl_patents_bundle.css" type="text/css" /><script src="/books/javascript/atb_50a6672b5f82ffbd39b7a9e87fd4594c__zh_cn.js"></script><script>function googleTranslateElementInit() {new google.translate.TranslateElement({pageLanguage: "zh",gaTrack: true,gaId: "UA-27188110-1",multilanguagePage: true});}</script><script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script><meta name="DC.type" content="Patent"><meta name="DC.title" content="一种QoS控制方法和系统"><meta name="DC.contributor" content="胡华东" scheme="inventor"><meta name="DC.contributor" content="段小琴" scheme="inventor"><meta name="DC.contributor" content="张鹏" scheme="inventor"><meta name="DC.contributor" content="华为技术有限公司" scheme="assignee"><meta name="DC.date" content="2006-1-24" scheme="dateSubmitted"><meta name="DC.description" content="本发明提供一种QoS控制方法和系统，通过在IP承载经过的节点中为IP承载中的各业务数据流分别设置业务数据流标识信息与QoS控制参数的对应关系，使IP承载经过的节点能够针对IP承载中的各业务数据流提供相应的QoS控制，使网络具备业务数据流粒度级别上的QoS控制能力，从而细化了针对IP承载的QoS控制粒度；本发明可以根据实际网络情况灵活实现针对各业务数据流的QoS控制，避免了由于引入业务数据流粒度级别的QoS控制功能而给系统带来的巨大资源消耗的现象，使整个网络能够在一定程度上实现业务数据流粒度级别上的QoS控制能力；从而实现了提高网络的QoS控制能力，合理利用网络资源，提高网络资源利用效率的目的。"><meta name="DC.date" content="2007-8-1"><meta name="citation_patent_publication_number" content="CN:101009631:A"><meta name="citation_patent_application_number" content="CN:200610002225"><link rel="canonical" href="https://www.google.com/patents/CN101009631A?cl=zh"/><meta property="og:url" content="https://www.google.com/patents/CN101009631A?cl=zh"/><meta name="title" content="专利 CN101009631A - 一种QoS控制方法和系统"/><meta name="description" content="本发明提供一种QoS控制方法和系统，通过在IP承载经过的节点中为IP承载中的各业务数据流分别设置业务数据流标识信息与QoS控制参数的对应关系，使IP承载经过的节点能够针对IP承载中的各业务数据流提供相应的QoS控制，使网络具备业务数据流粒度级别上的QoS控制能力，从而细化了针对IP承载的QoS控制粒度；本发明可以根据实际网络情况灵活实现针对各业务数据流的QoS控制，避免了由于引入业务数据流粒度级别的QoS控制功能而给系统带来的巨大资源消耗的现象，使整个网络能够在一定程度上实现业务数据流粒度级别上的QoS控制能力；从而实现了提高网络的QoS控制能力，合理利用网络资源，提高网络资源利用效率的目的。"/><meta property="og:title" content="专利 CN101009631A - 一种QoS控制方法和系统"/><meta property="og:type" content="book"/><meta property="og:site_name" content="Google Books"/><meta property="og:image" content="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"/><link rel="image_src" href="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"/><script>if (window['_OC_timingAction']) {window['_OC_timingAction']('patents_refpage');}</script><style>#gbar,#guser{font-size:13px;padding-top:1px !important;}#gbar{height:22px}#guser{padding-bottom:7px !important;text-align:right}.gbh,.gbd{border-top:1px solid #c9d7f1;font-size:1px}.gbh{height:0;position:absolute;top:24px;width:100%}@media all{.gb1{height:22px;margin-right:.5em;vertical-align:top}#gbar{float:left}}a.gb1,a.gb4{text-decoration:underline !important}a.gb1,a.gb4{color:#00c !important}.gbi .gb4{color:#dd8e27 !important}.gbf .gb4{color:#900 !important}

#gbar { padding:.3em .6em !important;}</style></head><body ><div id=gbar><nobr><a class=gb1 href="https://www.google.com/search?cl=zh&hl=zh-CN&sa=N&tab=tw">搜索</a> <a class=gb1 href="https://www.google.com/search?cl=zh&hl=zh-CN&tbm=isch&source=og&sa=N&tab=ti">图片</a> <a class=gb1 href="https://maps.google.com/maps?cl=zh&hl=zh-CN&sa=N&tab=tl">地图</a> <a class=gb1 href="https://play.google.com/?cl=zh&hl=zh-CN&sa=N&tab=t8">Play</a> <a class=gb1 href="https://www.youtube.com/results?cl=zh&hl=zh-CN&sa=N&tab=t1">YouTube</a> <a class=gb1 href="https://news.google.com/nwshp?hl=zh-CN&tab=tn">新闻</a> <a class=gb1 href="https://mail.google.com/mail/?tab=tm">Gmail</a> <a class=gb1 href="https://drive.google.com/?tab=to">云端硬盘</a> <a class=gb1 style="text-decoration:none" href="https://www.google.com/intl/zh-CN/options/"><u>更多</u> &raquo;</a></nobr></div><div id=guser width=100%><nobr><span id=gbn class=gbi></span><span id=gbf class=gbf></span><span id=gbe></span><a target=_top id=gb_70 href="https://www.google.com/accounts/Login?service=&continue=https://www.google.com/patents%3Fcl%3Dzh%26hl%3Dzh-CN&hl=zh-CN" class=gb4>登录</a></nobr></div><div class=gbh style=left:0></div><div class=gbh style=right:0></div><div role="alert" style="position: absolute; left: 0; right: 0;"><a href="https://www.google.com/patents/CN101009631A?cl=zh&amp;hl=zh-CN&amp;output=html_text" title="屏幕阅读器用户请注意：点击此链接可进入无障碍模式。阅读器在无障碍模式下具有同样的基本功能，但可让用户获得更好的体验。"><img border="0" src="//www.google.com/images/cleardot.gif"alt="屏幕阅读器用户请注意：点击此链接可进入无障碍模式。阅读器在无障碍模式下具有同样的基本功能，但可让用户获得更好的体验。"></a></div><div class="kd-appbar"><h2 class="kd-appname"><a href="/patents?hl=zh-CN"> 专利</a></h2><div class="kd-buttonbar left" id="left-toolbar-buttons"><a id="appbar-write-review-link" href=""></a><a id="appbar-view-print-sample-link" href=""></a><a id="appbar-view-ebook-sample-link" href=""></a><a id="appbar-patents-prior-art-finder-link" href="https://www.google.com/patents/related/CN101009631A"></a><a id="appbar-patents-discuss-this-link" href="https://www.google.com/url?id=CxeHAAABERAJ&amp;q=http://patents.stackexchange.com/redirect/google-patents%3Fpublication%3DCN101009631A&amp;usg=AFQjCNEihTuqZ_TLYoctwij1YqhG2_OnuQ" data-is-grant="false"></a><a id="appbar-read-patent-link" href="//docs.google.com/viewer?url=patentimages.storage.googleapis.com/pdfs/34876af0cfcb09681660/CN101009631A.pdf"></a><a id="appbar-download-pdf-link" href="//patentimages.storage.googleapis.com/pdfs/34876af0cfcb09681660/CN101009631A.pdf"></a><a class="appbar-content-language-link" data-selected="true" data-label="中文" href="/patents/CN101009631A?cl=zh&amp;hl=zh-CN"></a><a class="appbar-content-language-link" data-label="英语" href="/patents/CN101009631A?cl=en&amp;hl=zh-CN"></a></div><div class="kd-buttonbar right" id="right-toolbar-buttons"></div></div><div id="books-microdata" itemscope=""itemtype="http://schema.org/Book"itemid="https://www.google.com/patents/CN101009631A?cl=zh" style="display:none"><span itemprop="description">本发明提供一种QoS控制方法和系统，通过在IP承载经过的节点中为IP承载中的各业务数据流分别设置业务数据流标识信息与QoS控制参数的对应关系，使IP承载经过的节点能够针对IP承载中的各业务数据流提供相应的QoS控制，使网络 ...</span><span itemprop="url">https://www.google.com/patents/CN101009631A?cl=zh&amp;utm_source=gb-gplus-share</span><span class="main-title" itemprop="name">专利 CN101009631A - 一种QoS控制方法和系统</span><img itemprop="image" src="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"alt="专利 CN101009631A - 一种QoS控制方法和系统" title="专利 CN101009631A - 一种QoS控制方法和系统"></div><div style="display: none"><ol id="ofe-gear-menu-contents" class="gbmcc"><li class="gbe gbmtc"><a class="gbmt goog-menuitem-content" id="" href="https://www.google.com/advanced_patent_search?hl=zh-CN"> 高级专利搜索</a></li></ol></div><div id="volume-main"><div id="volume-center"><div class=vertical_module_list_row><div id=intl_patents class=about_content><div id=intl_patents_v><table class="patent-bibdata patent-drawings-missing"><tr><td class="patent-bibdata-heading"> 公开号</td><td class="single-patent-bibdata">CN101009631 A</td></tr><tr><td class="patent-bibdata-heading">发布类型</td><td class="single-patent-bibdata">申请</td></tr><tr><td class="patent-bibdata-heading"> 专利申请号</td><td class="single-patent-bibdata">CN 200610002225</td></tr><tr><td class="patent-bibdata-heading">公开日</td><td class="single-patent-bibdata">2007年8月1日</td></tr><tr><td class="patent-bibdata-heading"> 申请日期</td><td class="single-patent-bibdata">2006年1月24日</td></tr><tr><td class="patent-bibdata-heading"> 优先权日<span class="patent-tooltip-anchor patent-question-icon"data-tooltip-text="优先日期属于假设性质，不具任何法律效力。Google 对于所列日期的正确性并没有进行法律分析，也不作任何陈述。"></span></td><td class="single-patent-bibdata">2006年1月24日</td></tr><tr class="patent-bibdata-list-row alternate-patent-number"><td class="patent-bibdata-heading"> 公开号</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value">200610002225.6, </span><span class="patent-bibdata-value">CN 101009631 A, </span><span class="patent-bibdata-value">CN 101009631A, </span><span class="patent-bibdata-value">CN 200610002225, </span><span class="patent-bibdata-value">CN-A-101009631, </span><span class="patent-bibdata-value">CN101009631 A, </span><span class="patent-bibdata-value">CN101009631A, </span><span class="patent-bibdata-value">CN200610002225, </span><span class="patent-bibdata-value">CN200610002225.6</span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading"> 发明者</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E8%83%A1%E5%8D%8E%E4%B8%9C%22">胡华东</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E6%AE%B5%E5%B0%8F%E7%90%B4%22">段小琴</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E5%BC%A0%E9%B9%8F%22">张鹏</a></span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading"> 申请人</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=inassignee:%22%E5%8D%8E%E4%B8%BA%E6%8A%80%E6%9C%AF%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8%22">华为技术有限公司</a></span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">导出引文</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="/patents/CN101009631A.bibtex?cl=zh">BiBTeX</a>, </span><span class="patent-bibdata-value"><a href="/patents/CN101009631A.enw?cl=zh">EndNote</a>, </span><span class="patent-bibdata-value"><a href="/patents/CN101009631A.ris?cl=zh">RefMan</a></span></span></td></tr><tr class="patent-internal-links"><td colspan=2><span class="patent-bibdata-value"><a href="#forward-citations"> 被以下专利引用</a> (33),</span> <span class="patent-bibdata-value"><a href="#classifications">分类</a> (2),</span> <span class="patent-bibdata-value"><a href="#legal-events">法律事件</a> (2)</span> </td></tr><tr><td colspan=2 class="patent-bibdata-external-link-spacer-top"></td></tr><tr class="patent-bibdata-external-link-spacer-bottom"></tr><tr><td colspan=2><span class="patent-bibdata-heading">外部链接:&nbsp;</span><span><span class="patent-bibdata-value"><a href="https://www.google.com/url?id=CxeHAAABERAJ&amp;q=http://211.157.104.87:8080/sipo/zljs/hyjs-yx-new.jsp%3Frecid%3D200610002225&amp;usg=AFQjCNHPcwkR-zbcI5QiRjTKReV6c38Hcw"> 中国国家知识产权局</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/url?id=CxeHAAABERAJ&amp;q=http://worldwide.espacenet.com/publicationDetails/biblio%3FCC%3DCN%26NR%3D101009631A%26KC%3DA%26FT%3DD&amp;usg=AFQjCNFY8VCkYfiDw5cL_0m9yiBczbZRig"> 欧洲专利数据库 (Espacenet)</a></span></span></td></tr><tr class="patent-bibdata-group-spacer"></tr></table><div class="number-and-title"><span class="patent-title"><invention-title mxw-id="PT121909161" lang="ZH" load-source="patent-office">一种QoS控制方法和系统</invention-title>
      </span><br><span class="patent-number">CN 101009631 A</span></div><div class="patent-section patent-abstract-section"><div class="patent-section-header"><span class="patent-section-title"> 摘要</span></div><div class="patent-text"><abstract mxw-id="PA108142864" lang="ZH" load-source="patent-office">
    <div class="abstract">本发明提供一种QoS控制方法和系统，通过在IP承载经过的节点中为IP承载中的各业务数据流分别设置业务数据流标识信息与QoS控制参数的对应关系，使IP承载经过的节点能够针对IP承载中的各业务数据流提供相应的QoS控制，使网络具备业务数据流粒度级别上的QoS控制能力，从而细化了针对IP承载的QoS控制粒度；本发明可以根据实际网络情况灵活实现针对各业务数据流的QoS控制，避免了由于引入业务数据流粒度级别的QoS控制功能而给系统带来的巨大资源消耗的现象，使整个网络能够在一定程度上实现业务数据流粒度级别上的QoS控制能力；从而实现了提高网络的QoS控制能力，合理利用网络资源，提高网络资源利用效率的目的。</div>
  </abstract>
  </div></div><div class="patent-section patent-claims-section"><div class="patent-section-header"><span class="patent-section-title">权利要求<span class="patent-section-count">(22)</span></span></div><div class="patent-text"><div mxw-id="PCLM50730350" lang="ZH" load-source="patent-office" class="claims">
    <div class="claim"> <div num="1" class="claim">
      <div class="claim-text">1.一种QoS控制方法，其特征在于，包括：a、在IP承载经过的节点中针对该IP承载中的业务数据流设置业务数据流的标识信息与QoS控制参数的对应关系；b、所述节点在确定业务数据流需要通过IP承载传输时，根据所述对应关系和业务数据流中携带的标识信息确定该业务数据流对应的QoS控制参数；c、所述节点根据业务数据流对应的QoS控制参数对业务数据流进行QoS控制。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="2" class="claim">
      <div class="claim-text">2.如权利要求1所述的一种QoS控制方法，其特征在于，所述IP承载为：GPRS中的分组数据协议PDP上下文、或互通无线局域网I-WLAN中的IP安全IPSec隧道、或其它IP接入系统中的IP通道，且所述IP承载包括：一个或多个业务数据流。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="3" class="claim">
      <div class="claim-text">3.如权利要求1所述的一种QoS控制方法，其特征在于，所述步骤a包括：通过静态配置方式或者通过动态协商方式在IP承载经过的节点中设置该IP承载中的业务数据流对应的QoS控制参数；设置业务数据流标识信息与QoS控制参数的对应关系。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="4" class="claim">
      <div class="claim-text">4.如权利要求3所述的一种QoS控制方法，其特征在于，所述动态协商方式为：GPRS&#160;QoS协商方式、或基于服务的本地策略SBLP协商方式、或策略控制与计费PCC中的QoS协商方式。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="5" class="claim">
      <div class="claim-text">5.如权利要求1所述的一种QoS控制方法，其特征在于，所述节点包括：起始节点、终止节点和中间节点。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="6" class="claim">
      <div class="claim-text">6.如权利要求5所述的一种QoS控制方法，其特征在于，所述中间节点包括：GPRS服务支持点SGSN、无线网络控制器RNC、WLAN接入网关WAG、EnodeB、演进网络架构/网络长期演进SAE/LTE中的移动性管理实体/用户平面实体MME/UPE。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="7" class="claim">
      <div class="claim-text">7.如权利要求5所述的一种QoS控制方法，其特征在于，所述起始节点/终止节点包括：用户终端UE和网关节点。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="8" class="claim">
      <div class="claim-text">8.如权利要求7所述的一种QoS控制方法，其特征在于，所述网关节点为：网关通用分组无线业务支持节点GGSN、或者分组数据网关PDG、或者SAE/LTE中的接入系统间锚点Inter-AS&#160;anchor。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="9" class="claim">
      <div class="claim-text">9.如权利要求1所述的一种QoS控制方法，其特征在于，所述步骤a中的对应关系包括：业务数据流的标识信息与每跳转发行为的对应关系。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="10" class="claim">
      <div class="claim-text">10.如权利要求1至9中任一权利要求所述的一种QoS控制方法，其特征在于，所述业务数据流的标识信息为：流量类型标记、和/或过滤规则；所述过滤规则包括：IP五元组、传输层协议号、应用层协议号中的部分或全部。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="11" class="claim">
      <div class="claim-text">11.如权利要求10所述的一种QoS控制方法，其特征在于，所述流量类型标记包括：DSCP。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="12" class="claim">
      <div class="claim-text">12.如权利要求10所述的一种QoS控制方法，其特征在于，所述流量类型标记承载于IPv4协议头的ToS字段，或IPv6协议头的Traffic&#160;Class字段，或PDCP/RLC/GTP-U协议头的相应扩展字段，或者承载于MPLS的Lable字段中。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="13" class="claim">
      <div class="claim-text">13.如权利要求10所述的一种QoS控制方法，其特征在于：所述IP承载的起始节点为用户终端时，所述步骤c包括：IP承载的起始节点根据该流量类型对业务数据流进行标记，并确定该标记对应的每跳转发行为；所述步骤b包括：IP承载的中间节点在确定其发送的业务数据流需要通过IP承载传输时，根据业务数据流中的标记信息确定该标记对应的每跳转发行为。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="14" class="claim">
      <div class="claim-text">14.如权利要求10所述的一种QoS控制方法，其特征在于，所述IP承载的节点为网关节点或中间节点时，所述步骤c包括：c1、所述节点对业务数据流中携带的流量类型标记信息进行重标记，并根据所述对应关系、业务数据流过滤规则和重标记信息确定该业务数据流对应的QoS控制参数。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="15" class="claim">
      <div class="claim-text">15.如权利要求14所述的一种QoS控制方法，其特征在于，所述步骤c1中对业务数据流中携带的流量类型标记信息进行重标记的步骤具体包括：所述节点根据其存储的QoS控制参数、和/或其所在网络域的QoS支持能力、和/或其所在网络域与外部网络的服务水平协议对业务数据流中携带的流量类型标记信息进行重标记。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="16" class="claim">
      <div class="claim-text">16.如权利要求1至9中任一权利要求所述的一种QoS控制方法，其特征在于，所述节点中设置的QoS控制参数包括：基于业务数据流的流量速率参数、和/或基于业务数据流的流量类型参数、和基于IP承载的流量速率参数；且所述步骤c中的QoS控制包括：基于业务数据流的流量速率控制、和/或基于业务数据流的流量类型控制、和基于IP承载的流量速率控制。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="17" class="claim">
      <div class="claim-text">17.如权利要求16所述的一种QoS控制方法，其特征在于，所述基于业务数据流的流量速率参数包括：最大位速率参数、和/或确保位速率参数。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="18" class="claim">
      <div class="claim-text">18.如权利要求16所述的一种QoS控制方法，其特征在于，所述基于业务数据流的流量类型控制包括：业务数据流的流量分类管理、根据业务数据流的流量分类进行的标记管理、根据业务数据流的流量分类进行的转发控制处理。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="19" class="claim">
      <div class="claim-text">19.如权利要求16所述的一种QoS控制方法，其特征在于，所述QoS控制包括：基于业务数据流的流量速率控制时，所述步骤c包括：c1、节点根据流量速率参数设置令牌桶或漏桶；c2、所述节点传输获得令牌的数据包。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="20" class="claim">
      <div class="claim-text">20.如权利要求19所述的一种QoS控制方法，其特征在于，所述步骤c还包括：所述节点丢弃未获得令牌的数据包；或者所述节点将未获得令牌的数据包缓存，并在获得令牌后继续转发缓存中的数据包；或者所述节点对未获得令牌的数据包进行重标记，并根据所述重标记对应的流量速率参数进行流量速率控制发送。</div>
    </div>
    </div> <div class="claim"> <div num="21" class="claim">
      <div class="claim-text">21.一种QoS控制系统，其特征在于，包括：IP承载经过的多个节点，且节点中设置有存储模块和QoS控制模块；存储模块中存储有IP承载中的业务数据流的标识信息与QoS控制参数的对应关系；QoS控制模块用于在确定业务数据流需要通过IP承载传输时，根据存储模块中存储的对应关系和业务数据流中携带的标识信息确定该业务数据流对应的QoS控制参数，并根据业务数据流对应的QoS控制参数对业务数据流进行QoS控制。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="22" class="claim">
      <div class="claim-text">22.如权利要求21所述的一种QoS控制系统，其特征在于，所述QoS控制模块包括：基于业务数据流的流量速率控制子模块和/或基于业务数据流的流量类型控制子模块、和基于IP承载的流量速率控制子模块；基于业务数据流的流量速率控制子模块：用于根据存储模块中存储的基于业务数据流的流量速率参数、业务数据流中携带的标识信息对业务数据流进行基于业务数据流的流量速率控制；基于业务数据流的流量类型控制子模块：用于根据存储模块中存储的基于业务数据流的流量速率参数、业务数据流中携带的标识信息对业务数据流进行基于业务数据流的流量类型控制；基于IP承载的流量速率控制子模块：用于根据存储模块中存储的基于IP承载的流量速率参数、业务数据流中携带的标识信息对业务数据流进行基于IP承载的流量速率控制。</div>
    </div>
  </div> </div>
  </div></div><div class="patent-section patent-description-section"><div class="patent-section-header"><span class="patent-section-title"> 说明</span></div><div class="patent-text"><div mxw-id="PDES57789689" lang="ZH" load-source="patent-office" class="description">
    <invention-title lang="ZH">一种QoS控制方法和系统</invention-title>
    <technical-field>
      <p>技术领域</p>
      <p>本发明涉及网络通讯技术领域，具体涉及一种QoS控制方法和系统。</p>
    </technical-field>
    <background-art>
      <p>背景技术</p>
      <p>在移动通信网络中，对业务进行QoS(Quality&#160;of&#160;Service，服务质量)保障是运营商必须实现的网络特性，是在网络中开展业务的前提。</p>
      <p>在UMTS(Universal&#160;Mobile&#160;Telecommunications&#160;System，通用移动通信系统)网络中，从不同的QoS需求出发，可以将不同的业务分为四类，这四类业务分别是会话类(conversational)业务、流类(streaming)业务、交互类(interactive)业务以及背景类(background)业务。其中，会话类业务和流类业务都属于实时类业务，而交互类业务和背景类业务属于非实时类业务。不同类的业务具有不同的QoS规格要求，因此，不同类的业务也就具备不同的QoS控制参数和参数取值。</p>
      <p>一些常用的UMTS&#160;QoS参数包括：流类型(traffic&#160;class)、传输延迟(transfer&#160;delay)、优先级、数据速率、信令标记(signalling&#160;indication)以及可靠性参数等；其中，流类型指的是业务流类型，业务流类型可以是上述四种类型业务中的一种；传输延迟描述了数据包在网络中传送所花费的时间状况；优先级包括traffic&#160;handling&#160;priority(流量处理优先级)和allocation/retention&#160;priority(分配/保持优先级)，优先级描述的是本业务流量在各种网络处理中有别于其它业务流量的重要程度，在网络资源不足时优先级参数的作用就会得到体现；数据速率包括guaranteed&#160;bitrate(确保位速率)和maximum&#160;bitrate(最大位速率)两个参数，其中，guaranteed&#160;bitrate描述网络必须确保的数据传送速率，按照该速率发送的业务流量在网络中能够得到确定的延迟和可靠性保障，非实时类业务不具有该参数，maximum&#160;bitrate可用来限制应用发往网络中数据流量的最大速率；信令标记用来指示该业务流量是否是信令数据；可靠性用来描述应用对于网络错误的敏感程度，该性能由SDU&#160;error&#160;ratio(SDU错误率)、residual&#160;bit&#160;error&#160;ratio(残留位错误率)、delivery&#160;of&#160;erroneous&#160;SDUs(错误SDU提交标识)等多个参数组合描述。</p>
      <p>在GPRS(General&#160;Packet&#160;Radio&#160;Service，通用分组无线业务)中，已经实现了基于PDP(Packet&#160;Data&#160;Protocol，分组数据协议)上下文的QoS控制方式，下面结合附图1、以UE(UserEquipment，用户设备)发起PDP上下文激活过程(PDP&#160;Context&#160;Activation&#160;procedure)为例，对QoS控制方式进行描述。</p>
      <p>图1中，在步骤1、UE向SGSN(Serving&#160;GPRS&#160;Support&#160;Node，GPRS服务支持点)发送一个PDP上下文激活请求(Activate&#160;PDP&#160;Context&#160;Request)消息，该消息中包含有网络层业务访问标识(NSAPI，Network&#160;Layer&#160;Service&#160;Access&#160;Point&#160;Identifier)、事务标识(TI，TransactionIdentifier)、PDP类型、接入点名称(APN，Access&#160;Point&#160;Name)以及QoS请求(QoS&#160;requested)等信息。</p>
      <p>上述消息中的QoS请求表示UE期望从网络中得到的QoS规格保障；NSAPI是SGSN和GGSN(Gateway&#160;GPRS&#160;Support&#160;Node，网关通用分组无线业务支持节点)之间的隧道标识(TEID，Tunnel&#160;Identifier)的组成部分，主要用于标识PDP&#160;Context；PDP类型包括：端对端协议(PPP，Peer-Peer&#160;Protocol)类型、网际协议(IP，Internet&#160;Protocol)类型等；APN可以由UE向SGSN提供，SGSN根据APN寻址到相应的GGSN(Gateway&#160;GPRS&#160;Support&#160;Node，GPRS网关支持点)，GGSN根据APN确定UE所要访问的外部网络，UE也可以不向SGSN提供APN，此时，由SGSN根据UE用户的签约信息选择缺省的APN；TI主要用于为UE标识一个PDP&#160;context。</p>
      <p>到步骤2、SGSN接收到Activate&#160;PDP&#160;Context&#160;Request后，与UE进行安全性检查和加密，安全性检查和加密的步骤为可选步骤。随后，SGSN根据APN解析GGSN地址信息，如果SGSN能够根据APN解析出GGSN的地址信息，则为PDP&#160;Context创建TEID，TEID用于在SGSN和GGSN之间唯一标识一个PDP&#160;Context。此外，SGSN还会根据自身能力、负载情况以及签约的QoS规格，对UE给出的QoS请求进行限定，从而形成协商的QoS(QoS&#160;negotiated)。</p>
      <p>到步骤3、SGSN向GGSN发送PDP&#160;Context创建请求(Create&#160;PDP&#160;Context&#160;Request)消息，该消息中携带有PDP类型、PDP地址、APN、协商的QoS参数、TEID等。其中，PDP地址为UE的IP地址，为可选参数，Create&#160;PDP&#160;Context&#160;Request消息中可以不携带PDP地址，这样，在后续的处理过程中，可以由GGSN为UE分配IP地址，也可以由最终与UE建立连接的分组数据网络(PDN，Packet&#160;Data&#160;Network)为UE分配IP地址。如果SGSN无法根据APN解析出GGSN的地址信息，则SGSN拒绝UE发起的PDP&#160;Context激活请求。</p>
      <p>到步骤4、GGSN接收到Create&#160;PDP&#160;Context&#160;Request消息后，根据APN确定外部PDN，然后，分配计费标识(Charging&#160;ID)、启动计费。此时，GGSN根据自身能力和负载情况对从SGSN接收到的协商QoS参数进行再次协商，得到新的协商QoS。</p>
      <p>到步骤5、GGSN向SGSN返回PDP&#160;Context创建响应(Create&#160;PDP&#160;Context&#160;Response)消息，该消息中携带有TEID、PDP地址、链路承载(Backbone&#160;Bearer)协议、再次协商的QoS参数、Charging&#160;ID等信息。</p>
      <p>到步骤6、SGSN收到Create&#160;PDP&#160;Context&#160;Response消息后，根据再次协商的QoS参数在RAN(无线接入网)侧发起RAB建立(RAB&#160;setup)流程。如果再次协商的QoS参数无法在该RAB建立流程中得到满足，SGSN会和RAN重新协商QoS参数，从而得到第三次的协商QoS参数。然后，到步骤7、SGSN将最后协商的QoS参数通过更新PDP上下文清求(Update&#160;PDPContext&#160;Request)消息通知GGSN，到步骤8、GGSN发送更新PDP上下文响应(Update&#160;PDPContext&#160;Response)消息给SGSN。</p>
      <p>在RAB建立之后，到步骤9、SGSN在PDP&#160;Context中插入NSAPI和GGSN地址信息，用于标识该PDP&#160;Context，并根据最终形成的协商QoS参数选择无线优先权，然后，SGSN向UE返回PDP&#160;Context激活接受(Activate&#160;PDP&#160;Context&#160;Accept)消息，该消息中携带有PDP类型、PDP地址、TI、最终协商的QoS参数、无线优先权等信息。同时，SGSN启动计费操作。</p>
      <p>UE接收到PDP&#160;Context激活接受消息后，查看最终协商的QoS参数，如果无法接受该参数，UE可以选择去激活该PDP上下文(Deactivate&#160;PDP&#160;Context)，并可能在随后再重新发起PDP上下文激活请求。或者，UE接受最终协商的QoS参数，于是建立起其与GGSN之间的路由。此时，UE与PDN建立了传输通道，可以进行实际数据传输。</p>
      <p>从上面流程可以看出，从UE发出的QoS请求需要经过多次如最多三次协商后，形成最后的协商QoS参数。对最终协商QoS取值产生影响的网络单元包括SGSN、GGSN和RAN。根据最后协商的QoS参数取值，网络为每个PDP上下文提供QoS支持，典型的QoS支持包括资源预留等。</p>
      <p>从rel5开始，网络中又引入了一个新的IMS(IP&#160;Multimedia&#160;Subsystem，IP多媒体子系统)域，IMS给网络带来了大量的新课题，其中包括QoS控制。为此，引入了SBLP(Service&#160;BasedLocal&#160;Policy，基于服务的本地策略)机制来实现对IMS会话的QoS授权控制。</p>
      <p>在SBLP机制中，引入了两个新的功能实体，即应用功能(AF，Application&#160;Function)和策略决策功能(PDF，Policy&#160;Decision&#160;Function)。其中，AF提供了某种会话应用，这些应用都需要对所使用的IP承载资源进行控制，这样的会话就成为AF会话；PDF对AF会话所使用的IP承载资源进行授权指示。</p>
      <p>SBLP体系框架如附图2所示。</p>
      <p>图2中，AF和PDF之间通过Gq接口、利用Diameter协议实现连接，Gq接口主要用来传送与AF会话相关的业务信息。在PDF和策略执行点(PEP，Policy&#160;Enforcement&#160;Point)之间通过Go接口、利用COPS(Common&#160;Open&#160;Policy&#160;Service&#160;protocol，公共开放策略服务协议)连接，Go接口主要用来对AF会话实际所使用的IP承载资源进行授权控制，以保证UE实际申请的IP承载的QoS资源与应用间协商的QoS相一致。</p>
      <p>AF的一个实例就是IMS中的P-CSCF功能实体，PEP是策略执行点，通常放在网关如GPRS中的GGSN中实现。PDF可以是一个独立的功能实体，也可以放在GGSN中实现。</p>
      <p>SBLP中，一个典型的承载建立过程如附图3所示。</p>
      <p>图3中，在步骤1、UE向SGSN发送一个PDP上下文激活请求消息，该消息中包含UE请求的UMTS&#160;QoS参数。</p>
      <p>到步骤2、SGSN接收到PDP上下文激活请求消息后，经过一定处理，SGSN向GGSN发送PDP上下文创建请求消息。</p>
      <p>到步骤3、GGSN向相应的PDF发送一个COPS&#160;REQ消息，以获得与该PDP上下文相关的、包括QoS授权在内的策略信息。</p>
      <p>PDF接收到COPS&#160;REQ消息后，判断是否需要从AF处获取相关的业务信息。如果需要，到步骤4、PDF向相应的AF发送一个请求消息。否则，到步骤6。</p>
      <p>AF接收到PDF传输来的请求消息后，到步骤5、AF将相应的业务信息通过请求应答消息发送给PDF，然后，到步骤6。</p>
      <p>在步骤6、如果PDF从AF处获取的业务信息所描述的内容与PDF定义的运营商策略规则一致，PDF就会给AF会话中的包含一定QoS规格的所有媒体成分进行授权。然后，PDF将与PDP上下文匹配的所有媒体成分的授权QoS组合起来作为该PDP上下文的授权QoS，并将这些授权信息存储在PDF内部的数据库中。具体的QoS组合策略是：整个bearer(承载)中的trafficclass按照该bearer中所有媒体成分中最高的traffic&#160;class来取值，而整个bearer中的bitrate(位速率)则是该bearer中所有媒体成分的bitrate之和。</p>
      <p>到步骤7、PDF给GGSN返回一个COPS&#160;DEC消息，该消息中包含有PDP上下文所请求的策略信息，策略信息中包含有授权QoS信息。</p>
      <p>到步骤8、GGSN接收到COPS&#160;DEC消息后，给PDF反馈一个COPS&#160;RPT消息。</p>
      <p>到步骤9、GGSN接收到PDF返回的包含策略信息的COPS&#160;DEC消息后，根据其接收到的PDP上下文创建请求，向SGSN发送PDP&#160;Context创建响应消息。</p>
      <p>到步骤10、SGSN在接收到PDP&#160;Context创建响应消息后，在RAN侧发起RAB创建过程。</p>
      <p>到步骤11、RAB创建成功后，SGSN向UE发送一个PDP&#160;Context激活接受消息，从而，完成整个QoS授权过程。</p>
      <p>从上述图3的流程中可以看出，SBLP机制的目的就在于通过PDF对AF会话进行资源授权，随后根据该授权对AF会话实际使用的IP承载进行资源约束，以此来达到对IMS这种新兴业务应用的资源控制效果。</p>
      <p>将上述图3中的流程与前述图1的在GPRS中的QoS控制过程相结合，就是一个完整的可用于IMS的QoS控制方案。但是，SBLP还只是一个特定于GPRS的QoS控制方案，随着更多的、以WLAN(无线局域网)为代表的新型接入方式的出现，需要将SBLP的QoS控制方式进一步通用化，使之能够适用于更多的接入方式。为此，在rel7中又提出了PCC(Policy&#160;Controland&#160;Charging，策略控制与计费)机制，该体系完整的实现了SBLP的策略控制功能，此外，PCC还要实现SBLP与rel6&#160;FBC计费体系的合并。</p>
      <p>PCC的体系框架如附图4所示。</p>
      <p>从图4中可以看出，SBLP机制中的AF、PDF和PEP功能实体在PCC体系中都得到保留，不同的是，PCC中还将与FBC计费相关的功能实体如OCS、OFCS、CRF以及TPF等都加入进来，而且，PDF和CRF、TPF和PEP分别融合成两个新的功能实体，即PCRF(Policy&#160;and&#160;ChargingRules&#160;Function，策略与计费规则功能)和PCEF(Policy&#160;and&#160;Charging&#160;Enforcement&#160;Function，策略与计费执行功能)。Gq接口和Go接口分别演进为Rx+接口和Gx+接口。从功能流程的角度来看，相对于SBLP，PCC的QoS授权流程引入了一个新的控制机制，即基于签约信息的策略和计费控制，其框架如附图5所示。</p>
      <p>图5中，为了引入基于签约信息的策略和计费控制，新引入了一个功能实体SPR，SPR用于存储和PCC相关的签约信息，该实体通过Sp接口与PCRF相连。引入SPR之后，在进行策略与计费控制时，PCRF除了需要考虑业务信息、网络信息以及承载信息之外，还需要把用户的签约信息作为主要决策依据之一。</p>
      <p>相对于SBLP，PCC还引入了一个新的概念，即业务数据流(SDF，Service&#160;Data&#160;Flow)。在PCC中，众多的操作都是基于SDF的粒度级别来进行的，如PCRF上的策略和计费规则决策。业务数据流可以是IP流的集合，而IP流可以是由IP五元组定义的IP分组集合，IP五元组即源、目的IP地址，源、目的端口，协议号。属于某个业务数据流的所有IP流都具有相同的QoS属性如QoS类型、流量速率等，属于某个业务数据流的所有IP流在网络中受到相同的对待，如相同的计费规则等。</p>
      <p>IP承载在GPRS中就是PDP上下文，一个IP承载既可以只包含一个业务数据流，也可以同时包含多个业务数据流。在一个IP承载包含多个业务数据流的情况下，这些业务数据流的QoS需求既可以相同，也可以不同。</p>
      <p>在引入SPR的PCC中，一个典型的承载建立或修改的流程如附图6所示。</p>
      <p>图6中，步骤1、在建立新的AF会话、或修改现有的AF会话时，AF向PCRF提供业务信息。</p>
      <p>到步骤2、PCRF将其接收到的业务信息存储起来，并向AF发送一个确认消息。</p>
      <p>GW接收到的承载建立请求、或承载修改请求，到步骤3、GW判断是否需要进行PCC控制，如果需要进行PCC控制，到步骤4、GW向PCRF发送策略和计费规则请求。</p>
      <p>步骤3中GW接收到的承载建立请求、或承载修改请求，对于GPRS来说，就是一个创建PDP上下文请求、或者是一个更新PDP上下文请求。</p>
      <p>到步骤5、PCRF根据AF和GW提供的绑定相关信息，将应用和承载绑定起来，以便进行授权和策略决策，到步骤8。</p>
      <p>如果PCRF上没有相关的签约信息，则到步骤6、PCRF向SPR请求这些信息。到步骤7，SPR将PCRF请求的签约信息返回给PCRF，PCRF将其接收到的签约信息存储起来，然后，到步骤8。</p>
      <p>在步骤8、PCRF进行授权和策略决策，这里的授权是对PDP上下文中的每一个业务数据流进行的操作；到步骤9、PCRF将决策信息发送给GW予以执行，这里的决策信息是组合后的决策信息，也就是将PDP上下文中各个业务数据流的授权QoS信息组合起来作为整个PDP上下文的授权QoS，这与SBLP的情况相一致。</p>
      <p>到步骤10、GW确认承载建立、或确认承载修改。对于GPRS来说，就是GW发送一个创建PDP上下文响应消息、或更新PDP上下文响应消息。</p>
      <p>从上述描述的各种实现QoS控制的技术方案中可以看出：在GPRS的QoS控制方案中，UE、RAN、SGSN和GGSN就PDP上下文所请求的QoS协商达成一致，形成最终的协商QoS，网络中各单元并根据该协商QoS完成资源预留。在整个QoS协商和资源预留过程中，各种操作处理的基本单元都是PDP上下文，网络并不会区分PDP上下文中所传递的具体内容，尽管这些内容可能会需要不同的QoS保障。在早期网络业务类型相对单一的情况下，这种QoS控制机制没有太大问题。但是，随着网络中业务种类的增加，这种只能提供基于IP承载粒度级别上的QoS控制方式，无法对承载中不同的业务数据流实施精确的QoS控制，从而，容易造成网络资源利用效率低下。</p>
      <p>在SBLP和当前的PCC体系中，策略决策功能已经可以区分出单个会话中不同媒体成分的不同QoS需求，并能够对其进行区分授权，也就是说，PDF或PCRF已经具备了区分业务的QoS授权能力，但是，与这种QoS授权能力不相匹配的是，网络中建立具体的IP承载时，还是以整个承载为单位来申请并获取相应的授权QoS，这就造成，IP承载中不管业务类型的所有流量在网络中还是只能获得相同的QoS保障，同样没有实现区分业务类型的QoS保障能力，使SBLP和当前的PCC体系只能在用户平面上提供基于IP承载粒度级别上的QoS控制，无法对承载中不同的业务数据流实施精确的QoS控制，如在前述SBLP的QoS组合方式中，并不是一个IP承载中所有的媒体成分都需要最高规格的traffic&#160;class对待，如果将一个IP承载中所有的媒体成分都以最高规格的traffic&#160;class对待，则很容易造成网络资源利用效率的低下。</p>
      <p>总的来看，无论是GPRS、SBLP，还是PCC，QoS控制的基本粒度都是单个的IP承载，在GPRS中就是PDP上下文，具体表现为：在GGSN请求授权的消息以及从PDF返回授权的消息中都是以IP承载为单位来组织的。这样，无论一个IP承载中包含有多少种媒体成分，该IP承载中的所有流量在网络中都会得到相同的QoS对待。在IP承载中的流量都属于某一种媒体成分的情况下，这种QoS授权机制是没有任何问题的。但是，当IP承载中包含多种不同的媒体成分，而这些不同的媒体成分又具有不同的QoS需求时，这种基于IP承载的QoS控制方式就会存在无法对承载中不同的业务数据流实施精确的QoS控制的问题，从而，使网络资源利用效率低下。</p>
    </background-art>
    <disclosure>
      <p>发明内容</p>
      <p>本发明的目的在于，提供一种基于IP承载的QoS控制方法，通过为IP承载中的各业务数据流分别设置QoS参数，使IP承载经过的节点能够针对各业务数据流提供QoS控制，从而使网络具备业务数据流粒度级别上的QoS控制能力。</p>
      <p>为达到上述目的，本发明提供的一种基于IP承载的QoS控制方法，包括：a、在IP承载经过的节点中针对该IP承载中的业务数据流设置业务数据流的标识信息与QoS控制参数的对应关系；b、所述节点在确定业务数据流需要通过IP承载传输时，根据所述对应关系和业务数据流中携带的标识信息确定该业务数据流对应的QoS控制参数；c、所述节点根据业务数据流对应的QoS控制参数对业务数据流进行QoS控制。</p>
      <p>所述IP承载为：GPRS中的分组数据协议PDP上下文、或I-WLAN(互通无线局域网)中的IPSec(IP安全)隧道、或其它IP接入系统中的IP通道，且所述IP承载包括：一个或多个业务数据流。</p>
      <p>所述步骤a包括：通过静态配置方式或者通过动态协商方式在IP承载经过的节点中设置该IP承载中的业务数据流对应的QoS控制参数；设置业务数据流标识信息与QoS控制参数的对应关系。</p>
      <p>所述动态协商方式为：GPRS&#160;QoS协商方式、或基于服务的本地策略SBLP协商方式、或策略控制与计费PCC中的QoS协商方式。</p>
      <p>所述节点包括：起始节点、终止节点和中间节点。</p>
      <p>所述中间节点包括：GPRS服务支持点SGSN、无线网络控制器RNC、WLAN接入网关WAG、EnodeB、演进网络架构/网络长期演进SAE/LTE中的移动性管理实体/用户平面实体MME/UPE。</p>
      <p>所述起始节点/终止节点包括：用户终端UE和网关节点。</p>
      <p>所述网关节点为：网关通用分组无线业务支持节点GGSN、或者分组数据网关PDG、或者SAE/LTE中的接入系统间锚点Inter-AS&#160;anchor。</p>
      <p>所述步骤a中的对应关系包括：业务数据流的标识信息与每跳转发行为的对应关系。</p>
      <p>所述业务数据流的标识信息为：流量类型标记、和/或过滤规则；所述过滤规则包括：IP五元组、传输层协议号、应用层协议号中的部分或全部。</p>
      <p>所述流量类型标记包括：DSCP。</p>
      <p>所述流量类型标记承载于IPv4协议头的ToS字段，或IPv6协议头的Traffic&#160;Class字段，或PDCP/RLC/GTP-U协议头的相应扩展字段，或者承载于MPLS的Lable字段中。</p>
      <p>所述IP承载的起始节点为用户终端时，所述步骤c包括：IP承载的起始节点根据该流量类型对业务数据流进行标记，并确定该标记对应的每跳转发行为；所述步骤b包括：IP承载的中间节点在确定其发送的业务数据流需要通过IP承载传输时，根据业务数据流中的标记信息确定该标记对应的每跳转发行为。</p>
      <p>所述IP承载的节点为网关节点或中间节点时，所述步骤c包括：c1、所述节点对业务数据流中携带的流量类型标记信息进行重标记，并根据所述对应关系、业务数据流过滤规则和重标记信息确定该业务数据流对应的QoS控制参数。</p>
      <p>所述步骤c1中对业务数据流中携带的流量类型标记信息进行重标记的步骤具体包括：所述节点根据其存储的QoS控制参数、和/或其所在网络域的QoS支持能力、和/或其所在网络域与外部网络的服务水平协议对业务数据流中携带的流量类型标记信息进行重标记。</p>
      <p>所述节点中设置的QoS控制参数包括：基于业务数据流的流量速率参数、和/或基于业务数据流的流量类型参数、和基于IP承载的流量速率参数；且所述步骤c中的QoS控制包括：基于业务数据流的流量速率控制、和/或基于业务数据流的流量类型控制、和基于IP承载的流量速率控制。</p>
      <p>所述基于业务数据流的流量速率参数包括：最大位速率参数、和/或确保位速率参数。</p>
      <p>所述基于业务数据流的流量类型控制包括：业务数据流的流量分类管理、根据业务数据流的流量分类进行的标记管理、根据业务数据流的流量分类进行的转发控制处理。</p>
      <p>所述QoS控制包括：基于业务数据流的流量速率控制时，所述步骤c包括：c1、节点根据流量速率参数设置令牌桶或漏桶；c2、所述节点传输获得令牌的数据包。</p>
      <p>所述步骤c还包括：所述节点丢弃未获得令牌的数据包；或者所述节点将未获得令牌的数据包缓存，并在获得令牌后继续转发缓存中的数据包；或者所述节点对未获得令牌的数据包进行重标记，并根据所述重标记对应的流量速率参数进行流量速率控制发送。</p>
      <p>本发明还提供一种QoS控制系统，包括：IP承载经过的多个节点，且节点中设置有存储模块和QoS控制模块；存储模块中存储有IP承载中的业务数据流的标识信息与QoS控制参数的对应关系；QoS控制模块用于在确定业务数据流需要通过IP承载传输时，根据存储模块中存储的对应关系和业务数据流中携带的标识信息确定该业务数据流对应的QoS控制参数，并根据业务数据流对应的QoS控制参数对业务数据流进行QoS控制。</p>
      <p>所述QoS控制模块包括：基于业务数据流的流量速率控制子模块和/或基于业务数据流的流量类型控制子模块、和基于IP承载的流量速率控制子模块；基于业务数据流的流量速率控制子模块：用于根据存储模块中存储的基于业务数据流的流量速率参数、业务数据流中携带的标识信息对业务数据流进行基于业务数据流的流量速率控制；基于业务数据流的流量类型控制子模块：用于根据存储模块中存储的基于业务数据流的流量速率参数、业务数据流中携带的标识信息对业务数据流进行基于业务数据流的流量类型控制；基于IP承载的流量速率控制子模块：用于根据存储模块中存储的基于IP承载的流量速率参数、业务数据流中携带的标识信息对业务数据流进行基于IP承载的流量速率控制。</p>
      <p>通过上述技术方案的描述可知，本发明通过在IP承载经过的节点中为IP承载中的各业务数据流分别设置业务数据流标识信息与QoS控制参数的对应关系，使IP承载经过的节点能够针对IP承载中的各业务数据流提供相应的QoS控制，从而细化了针对IP承载的QoS控制粒度；本发明可以根据实际网络情况灵活实现针对各业务数据流的QoS控制，如本发明可以使终端和网关节点支持完整的基于业务数据流的QoS控制能力，也就是使终端和网关节点同时具备基于业务数据流的流量速率管理能力、以及基于业务数据流的流量类型管理能力，使终端和网关之间的中间节点只需要具备基于业务数据流的流量类型管理能力即可，从而避免了由于引入业务数据流粒度级别的QoS控制功能而给系统带来的巨大资源消耗的现象，使整个网络能够在一定程度上实现业务数据流粒度级别上的QoS控制能力；再如本发明可以使终端、网关节点和中间节点均具备基于业务数据流的流量速率管理能力和基于业务数据流的流量类型速率管理能力，使整个网络能够完整地实现业务数据流粒度级别上的QoS控制能力；本发明可以采用静态配置或动态协商的方式在节点中设置各业务数据流的QoS参数，而且可以在不改变现有动态协商方式、仅增加协商内容的前提下，实现动态协商过程，使设置各业务数据流的QoS控制参数的过程易于实现；从而通过本发明提供的技术方案实现了提高网络的QoS控制能力，合理利用网络资源，提高网络资源利用效率的目的。</p>
    </disclosure>
    <description-of-drawings>
      <p>附图说明</p>
      <p>图1是现有技术的GPRS中基于PDP上下文的QoS控制方式示意图；图2是SBLP体系框架示意图；图3是现有技术的SBLP中承载建立过程示意图；图4是PCC的体系框架示意图；图5是基于签约信息的策略和计费控制的框架示意图；图6是现有技术的PCC中承载建立/修改过程示意图；图7是本发明实施例的网络中各节点的QoS控制能力示意图；图8是本发明实施例的基于GPRS&#160;QoS协商方式的业务数据流的流量速率协商过程流程图；图9是本发明实施例的基于SBLP&#160;QoS协商方式的业务数据流的流量速率协商过程流程图；图10是本发明实施例的基于PCC&#160;QoS协商方式的业务数据流的流量速率协商过程流程图；图11是本发明实施例的基于GPRS&#160;QoS协商方式的QoS协商流程图；图12是本发明实施例的基于SBLP&#160;QoS协商方式的QoS协商流程图；图13是本发明实施例的基于PCC&#160;QoS协商方式的QoS协商流程图；图14是本发明实施例的上行方向的PDP上下文承载实例示意图；</p>
      <p>图15是本发明实施例的下行方向的PDPi下文承载实例示意图。</p>
    </description-of-drawings>
    <mode-for-invention>
      <p>具体实施方式</p>
      <p>由于IP承载中的不同媒体成分可能具有不同的QoS需求，即IP承载中的不同业务数据流可能具有不同的QoS需求，如果能够对不同的业务数据流实施不同的QoS保障，则能有效提高网络的QoS控制能力，而且能够合理地利用网络资源，从而提高网络资源的利用效率。</p>
      <p>下面对本发明提供的QoS控制方法和QoS控制系统进行详细描述。</p>
      <p>本发明首先需要在IP承载经过的节点中为IP承载中的业务数据流设置业务数据流标识信息与QoS控制参数的对应关系，这个对应关系可以存储在节点的存储模块中。IP承载经过的节点可以为：起始节点、终止节点和中间节点。这里的中间节点既可以是GPRS系统中的SGSN、RNC，也可以是WLAN系统中的WAG，还可以是其它IP承载网络的相应网络单元如SAE中的EnodeB、MME/UPE等。这里的起始节点既可以是用户终端，也可以是网关节点，如GPRS系统中的UE、GGSN、WLAN系统中的PDG以及SAE中的ACGW、Inter-AS&#160;anchor等。同样，这里的终止节点可以是用户终端，也可以是网关节点，如GPRS系统中的UE、GGSN、WLAN系统中的PDG以及SAE中的ACGW、Inter-AS&#160;anchor等。</p>
      <p>这里的业务数据流标识信息包括：业务数据流的流量类型标记、和/或过滤规则；这里的过滤规则包括：IP五元组、传输层协议号、应用层协议号中的部分或全部。</p>
      <p>本发明的节点中的QoS控制模块对IP承载中的各业务数据流进行的QoS控制，这里的QoS控制主要为：基于IP承载的流量速率控制、基于业务数据流的流量类型控制、基于业务数据流的流量速率控制中的一项或多项，如IP承载中的各节点均可以对IP承载中的各业务数据流进行基于业务数据流的流量类型控制，再如IP承载中的各节点均可以对IP承载中的各业务数据流进行基于业务数据流的流量速率控制，还有IP承载中的起始节点和终止节点对IP承载中的各业务数据流进行基于业务数据流的流量类型控制和基于业务数据流的流量速率控制，IP承载中的中间节点对各业务数据仅进行基于业务数据流的流量流量类型控制；总之，IP承载中的各节点可以根据网络的实际情况灵活实现不同的QoS控制。不同的控制由不同的子模块来实现，即基于IP承载的流量速率控制子模块对节点发送的业务数据流进行基于IP承载的流量速率控制，基于业务数据流的流量类型控制子模块对节点发送的业务数据流进行基于业务数据流的流量类型控制，基于业务数据流的流量速率控制子模块对节点发送的业务数据流进行基于业务数据流的流量速率控制。</p>
      <p>相应的，本发明应根据IP承载中的节点能够实现的QoS控制为节点设置对应的QoS控制参数，如为IP承载中的节点设置基于业务数据流的流量速率参数、基于业务数据流的流量类型参数、基于IP承载的流量速率参数、基于IP承载的流量速率参数中的一个或多个。这里的QoS控制参数还包括通常意义上其他内容如延迟、位错误率等。在下面的实施例中仅对QoS控制参数中的主要参数如流量速率参数、流量类型参数等进行描述。</p>
      <p>本发明网络中IP承载经过的各节点的QoS控制能力可以如附图7所示。</p>
      <p>图7中，IP承载中的终端和网关对IP承载中的各业务数据流进行基于IP承载的流量速率控制、基于业务数据流的流量类型控制和基于业务数据流的流量速率控制，IP承载中的中间节点对各业务数据仅进行基于IP承载的流量速率控制和基于业务数据流的流量类型控制。此时，本发明中主要的QoS控制参数在网络各单元的分布情况如表1所示。</p>
      <p>表1</p>
      <p>
        <span class="patent-image-not-available"> </span>
      </p>
      <p>上述基于业务数据流的流量类型控制指的是对流量进行分类(classify)以及按照分类进行标记(mark)和其它转发处理如队列调度、拥塞控制等的控制管理能力。在UMTS中，业务数据流可分为四大类，分别是会话类、流类、交互类和背景类。</p>
      <p>本发明的QoS控制方法是一种与具体的接入方式无关的QoS控制机制，该QoS控制方法既可以应用在GPRS接入系统中，也可以应用在I-WLAN(互通无线局域网)接入以及其它的接入系统如SAE的接入系统中。在GPRS接入系统中，PDP上下文就是所述的IP承载，在I-WLAN接入系统中，终端和PDG网关之间的IPSec隧道就是所述的IP承载，在SAE接入系统中，终端和Inter-AS&#160;anchor(或ACGW)之间可管理的IP通道就是所述的IP承载。</p>
      <p>本发明中的业务数据流是某些IP流的集合，属于某个业务数据流的所有IP流都具有相同的QoS属性，如具有相同的QoS类型、流量速率等QoS控制参数。这里的IP流可以是由IP五元组即源、目的IP地址，源、目的端口，协议号定义的IP分组集合。</p>
      <p>本发明中的IP承载指的是一条具有确定的QoS性能如流量速率、延迟和位错误率等QoS控制参数的IP传输通道。IP承载通常位于终端和网关之间，IP承载既可以是GPRS中的PDP上下文，也可以是I-WLAN中的IPSec隧道，还可以是其它系统中的IP通道如SAE中的IP通道等。</p>
      <p>本发明中的IP承载既可以只包含一个业务数据流，也可以同时包含多个业务数据流。在包含多个业务数据流的情况下，不同业务数据流的QoS需求可以相同，也可以不同。</p>
      <p>本发明可以通过静态配置的方式在节点中设置IP承载中的各业务数据流的QoS控制参数，然后，设置业务数据流的标识信息与QoS控制参数的对应关系；本发明也可以通过动态协商QoS的方式在节点中设置IP承载中的各业务数据流的QoS控制参数，然后，设置业务数据流的标识信息与QoS控制参数的对应关系。静态配置的QoS控制参数可以是终端用户和网络运营商之间以及运营商之间签订的服务水平协议(SLA，Service&#160;Level&#160;Agreement)，也可以是网络中一种粗粒度如APN级别的QoS配置。通过这些静态或者动态协商配置的QoS控制参数，IP承载经过的节点可以获得其需要的基于IP承载和\或基于业务数据流的QoS控制参数，如运营商通常都会把流量类型标记和每跳转发行为之间的对应关系静态配置在各个节点上。</p>
      <p>上述动态协商QoS控制参数指的是终端与网络之间协商达成的关于IP承载和\或业务数据流的QoS性能的具体参数描述，根据协商结果可以确定业务数据流的标识信息与QoS控制参数的对应关系。这些QoS控制参数包括但不限于：该IP承载的流量速率、该IP承载中各个业务数据流的流量速率以及该IP承载中各个业务数据流的流量类型等参数。在采用动态协商QoS时，业务数据流的流量速率参数、IP承载的流量速率参数、流量类型参数等均可以采用单独协商的方式来实现，也可以采用一起协商的方式来实现，如动态协商后相关节点中保存各业务数据流的IP五元组、和/或传输层协议号、和/或应用层协议号与流量速率参数和/或流量类型参数的对应关系。</p>
      <p>QoS协商的具体方式既可以是具体于接入方式的协商方式如现有的GPRS&#160;QoS协商方式、SBLP协商方式等，也可以是与接入方式无关的协商方式如PCC中的QoS协商方式等，当然，也可以采用其它协商方式。QoS协商方式的选择与具体的应用以及运营商的运营策略有关，具体的应用如不同的APN可能采用不同的协商方式等。为了实现本发明的QoS控制方法，上述现有的QoS协商方式都需要进行相应的改进，主要的改进点在于：各节点在进行QoS协商过程时，加入了针对业务数据流的QoS控制参数协商过程。</p>
      <p>当IP承载经过的节点对IP承载中的各业务数据流进行流量类型控制时，起始节点需要根据业务数据流中承载的信息对各业务数据流的流量类型进行标记，这样，中间节点可以根据业务数据流中的流量类型标记确定该业务数据流对应的QoS控制参数。对业务数据流进行流量类型的标记方法和网络中具体使用的QoS模型密切相关。以DiffServ为例，对业务数据流进行流量类型分类的结果可以用区分服务编码点DSCP来标记，在网络的节点中维护一个DSCP到PHB(每跳转发行为)的映射表，这样，节点可以根据DSCP映射到的PHB对相应的IP数据包执行相应的队列调度和拥塞控制等转发操作。</p>
      <p>在UMTS中，系统支持4种QoS类型，这4种QoS类型分别是会话类、流类、交互类和背景类。为了在DiffServ中实现这四种QoS类型，需要将相应的UMTS&#160;QoS类型映射为标准的DSCP值，进而找到对应的PHB，并按照PHB进行相应的转发行为处理。一种可行的UMTSQoS类型与DiffServ&#160;PHB(Per&#160;Hop&#160;Behaviour，每跳转发行为)的映射方法如表2所示。</p>
      <p>表2</p>
      <p>
        <span class="patent-image-not-available"> </span>
      </p>
      <p>这里的DSCP既可以包含在IPv4协议包头的ToS(Type&#160;of&#160;Service)字段中，也可以包含在IPv6协议包头的Traffic&#160;Class字段中，还可以包含在其它的协议字段如PDCP/RLC/GTP-U协议头的相应扩展字段，或者是MPLS的Label字段之中。</p>
      <p>上述流量类型标记操作除了可以在终端进行外，还可以在网络边界或网关节点处进行。对于终端已标记的业务流数据包，网络边界或网关节点如RNC、SGSN以及GGSN节点等可以对其进行重标记(remark)，重标记的依据可以是协商QoS参数、或者静态配置的QoS参数，如网络边界节点或网关根据IP五元组来进行数据包的标记。</p>
      <p>对于从外部网络PDN输入的已标记或未标记的业务流数据包，网关需要对其进行重标记或标记，重标记或标记的依据可以是本UMTS域的QoS支持能力、协商QoS、与PDN的SLA或者这些因素的组合。</p>
      <p>本发明中的流量速率包括但不限于最大位速率(Maximum&#160;Bit&#160;Rate)、确保位速率(Guaranteed&#160;Bit&#160;Rate)等速率参数。根据网络中的具体应用情况，有些应用可能只包含最大位速率参数，有些应用可能同时包含最大位速率参数和确保位速率参数。在UMTS中，交互类业务和背景类业务就属于前一种情形，而会话类业务和流类业务就属于后一种情形。</p>
      <p>节点进行的流量速率管理就是节点根据其保存的流量速率参数对IP承载中的各业务数据流流入或流出某个节点的流量速率进行限制，使其符合相应的流量速率参数规定。节点可以采用令牌桶或漏桶算法来实现流量速率限制，令牌桶或漏桶算法所需的参数由动态协商或静态配置的流量速率参数决定。</p>
      <p>在采用令牌桶或漏桶算法时，流量速率管理的结果可能是：一部分数据包获得令牌，而另一部分数据包未获得令牌。未获得令牌的原因可能是流量速率超过协商的流量速率参数的规定。根据网管规则，未获得令牌的数据包可能被丢弃，也可能被暂时缓存以等待新的令牌出现，还可能被标记为流量类型级别更低的流量继续传送。</p>
      <p>本发明的QoS控制方法中的QoS协商可以采用多种方式，下面对几种具体的实现QoS协商的过程进行详细描述。</p>
      <p>首先对几种具体的业务数据流的流量速率协商过程进行描述。在下面描述的例1到例3的协商过程中，所有节点都只进行基于业务数据流的流量速率协商过程。但是，利用下述协商过程也可以同时进行基于业务数据流的流量类型的协商。</p>
      <p>例1、基于GPRS&#160;QoS协商方式的流量速率协商过程如附图8所示。</p>
      <p>图8中，在步骤1、UE根据自身应用的需要，向网络中的SGSN发送一个激活PDP上下文请求消息，该请求消息中包含有PDP上下文中各业务数据流的流量标识信息及其相应的流量速率需求，流量标识信息如IP五元组、传输层协议号、应用层协议号等；除此以外，该请求消息中还可以包含其它QoS控制参数，例如QoS类型也就是流量类型、优先级以及时延等。</p>
      <p>到步骤2、SGSN接收到UE的激活PDP上下文请求消息后，根据自身能力、负载情况以及签约信息对该激活PDP上下文请求消息中的各个流量速率需求进行独立判断，得到各个业务数据流的协商流量速率。随后，SGSN保存PDP上下文中各个业务数据流的流量标识信息及其协商流量速率参数。</p>
      <p>到步骤3、SGSN将这些流量标识信息和协商流量速率参数通过创建PDP上下文请求消息发送到GGSN。</p>
      <p>到步骤4、GGSN接收到来自SGSN的创建PDP上下文请求消息后，根据自身能力和负载情况对该请求消息中的各个协商流量速率参数进行独立判断，得到各个业务数据流的新的协商流量速率。GGSN保存各个业务数据流的流量标识信息及其新的协商流量速率参数。</p>
      <p>到步骤5、GGSN将上述流量标识信息和新的协商流量速率参数的创建PDP上下义响应消息发送回SGSN。</p>
      <p>到步骤6、SGSN接收到GGSN传输来的创建PDP上下文响应消息后，更新其已保存的协商流量速率参数，同时在RAN中发起RAB建立过程。根据RAN的资源使用情况，可能会再次得到新的协商流量速率。如果没有得到新的协商流量速率，直接到步骤9；如果得到新的协商流量速率，SGSN更新已保存的相应参数，到步骤7、SGSN将更新后的参数通过更新PDP上下文请求消息发送给GGSN，以通知GGSN更新已保存的协商流量速率参数。到步骤8、GGSN在接收到SGSN传输来的更新PDP上下文请求消息后，更新其已保存的协商流量速率参数，并向SGSN返回更新PDP上下文响应消息，然后，到步骤9。</p>
      <p>在步骤9、SGSN将最终的协商参数通过PDP上下文激活响应消息，发送回UE。</p>
      <p>UE从PDP上下文激活响应消息中获知最终协商流量速率参数，如果最终协商流量速率参数与其请求的流量速率一致，就接受该协商结果，于是，整个流量速率协商过程结束，PDP上下文建立起来，UE可以进行实际的数据传送过程；如果最终协商流量速率参数与其请求的流量速率不一致，UE根据自身策略决定是否接受该协商结果，如果接受，PDP上下文建立起来，UE可以进行实际的数据传送过程，如果不接受，UE可以选择终止承载建立，也可以选择重新发起流量速率协商过程。</p>
      <p>例2、基于SBLP&#160;QoS协商方式的流量速率协商过程如附图9所示。</p>
      <p>图9中，在步骤1、会话发起终端UE与对端终端或应用服务器通过应用层信令SIP/SDP进行包含各媒体成分的QoS需求的会话媒体参数协商，AF获知协商结果，AF获知的协商结果主要是和QoS相关的业务信息如各媒体成分的带宽协商结果等。AF可以选择是在此时将这些业务信息发送给PDF，还是在以后由PDF请求业务信息时，将这些业务信息发送给PDF。如果AF选择在此时向PDF发送业务信息，PDF接收到业务信息后，对各媒体成分进行授权，授权的结果以IP&#160;QoS的形式保存在PDF上，IP&#160;QoS可以包括但不限于流量速率和流量类型。</p>
      <p>到步骤2、会话发起终端UE获知会话协商结果，向网络中的SGSN发送激活PDP上下文请求消息，该请求消息中包含有PDP上下文中各业务数据流的流量标识信息及其相应的流量速率需求，除此以外，该请求消息中还可以包含其它QoS控制参数，例如QoS类型也就是流量类型、优先级以及时延等。</p>
      <p>到步骤3、SGSN接收到UE传输来的激活PDP上下文请求消息后，根据自身能力、负载情况以及签约信息对该请求消息中的各个流量速率需求进行独立判断，得到各个业务数据流的协商流量速率。随后，SGSN保存PDP上下文中各个业务数据流的流量标识信息及其协商流量速率参数。</p>
      <p>到步骤4、SGSN将上述获得的流量标识信息和协商流量速率参数通过创建PDP上下文请求消息发送到GGSN。</p>
      <p>到步骤5、GGSN接收到创建PDP上下文请求消息后，向相应的PDF发送IP承载授权请求消息，以请求基于SDF的授权QoS信息，该IP承载授权请求消息中包含有PDP上下文中各业务数据流的流量标识信息。</p>
      <p>PDF接收到IP承载授权请求消息后，根据其中的业务数据流的流量标识信息，查询是否存在相应的媒体业务信息，如果不存在，到步骤6、PDF向相应的AF请求这些媒体业务信息，到步骤7、AF根据PDF的请求将相应的媒体业务信息返回给PDF，到步骤8、PDF根据AF传输来的媒体业务信息进行基于业务数据流的流量速率授权，然后，到步骤9；如果PDF中已经存在相应的媒体业务信息，则PDF能够直接获得基于业务数据流的已授权流量速率信息，并确定流量标识信息所匹配到的各业务数据流的流量速率授权信息。到步骤9。</p>
      <p>在步骤9、PDF将各业务数据流的流量速率授权信息通过IP承载授权响应消息中发送回GGSN。</p>
      <p>到步骤10、GGSN接收到各业务数据流的流量速率授权信息后，根据转换后的流量速率授权信息、自身能力以及负载情况进行QoS判断，以确定协商的流量速率参数。GGSN保存各业务数据流的流量标识信息和相应的协商流量速率参数。</p>
      <p>到步骤11、GGSN将上述保存的协商流量速率参数通过创建PDP上下文响应消息发送回SGSN。</p>
      <p>到步骤12、SGSN接收到GGSN传输来的创建PDP上下文响应消息后，更新其已保存的协商流量速率参数，同时在RAN中发起RAB建立过程，根据RAN的资源使用情况，可能会再次得到新的协商流量速率。如果在该步骤中得到新的协商流量速率，到步骤13、SGSN更新已保存的相应参数，并将更新后的参数通过更新PDP上下文请求消息发送给GGSN，以通知GGSN更新已保存的协商流量速率参数。到步骤14、GGSN根据其接收到的更新PDP上下文请求消息更新其保存的相应参数，并向SGSN返回更新PDP上下文响应消息，然后，到步骤1&#160;5。如果在该步骤中没有得到新的协商流量速率，则直接到步骤15。</p>
      <p>在步骤15、SGSN将最终的协商流量速率参数通过激活PDP上下文响应消息发送回UE。</p>
      <p>UE获知最终的协商流量速率参数后，如果最终的协商流量速率参数与其请求的流量速率一致，就接受该协商结果，于是，整个流量速率协商过程结束，PDP上下文建立起来，UE可以进行实际的数据传送过程；如果最终的协商流量速率参数与其清求的流量速率不一致，UE根据自身策略决定是否接受该最终的协商结果，如果接受，PDP上下文建立起来，UE可以开始进行数据传送过程，如果不接受，UE可以选择终止承载建立，也可以选择重新发起流量速率协商。</p>
      <p>例3、基于PCC&#160;QoS协商方式的流量速率协商过程如附图10所示。</p>
      <p>在本实施例中，承载环境选择GPRS，因此，基本的IP承载单元是PDP上下文。此外，本实施例并不包含AF功能实体，也就是说，在流量速率协商之前PCRF并不能获得任何和上层业务相关的信息。</p>
      <p>图10中，在步骤1、UE向网络中的SGSN发送激活PDP上下文请求消息，该请求消息中包含有PDP上下文中各个业务数据流的流量标识信息及其相应的流量速率需求，除此以外，该请求消息中还可以包含其它QoS控制参数，例如QoS类型也就是流量类型、优先级以及时延等。</p>
      <p>到步骤2、SGSN接收到终端传输来的激活PDP上下文请求消息后，根据自身能力、负载情况以及签约信息对该请求消息中各个业务数据流的流量速率需求进行判断，得到一个协商流量速率。随后，SGSN保存PDP上下文中各个业务数据流的流量标识信息及其协商流量速率参数。</p>
      <p>到步骤3、SGSN将上述流量标识信息和协商流量速率参数通过创建PDP上下文请求消息发送到GGSN。</p>
      <p>到步骤4、GGSN接收到创建PDP上下文请求消息后，向相应的PCRF发送IP承载授权请求消息，以请求授权QoS信息，该请求消息中包含了PDP上下文中各业务数据流的流量标识信息及其相应的由SGSN给出的协商流量速率参数以及用户标识IMSI等。</p>
      <p>PCRF接收到IP承载授权请求消息后，如果确定此前没有保存相关的用户签约信息，到步骤5、PCRF就会向相应的SPR发送请求消息，以索取其需要的签约信息，到步骤6、SPR接收到PCRF传输来的请求消息后，将用户签约信息返回至PCRF，用户签约信息如允许使用的业务相关信息、和用户的QoS与计费相关的策略信息等，然后，到步骤7。如果PCRF确定此前保存了相关的用户签约信息，直接到步骤7。</p>
      <p>在步骤7、PCRF基于本地管理策略、从GGSN获得的相关信息以及从SPR获得的签约信息等进行流量速率决策，得到PDP上下文中各业务数据流的授权流量速率。</p>
      <p>到步骤8、PCRF将PDP上下文中各业务数据流的流量速率授权信息通过IP承载授权响应消息返回给GGSN。</p>
      <p>到步骤9、GGSN接收到各业务数据流的授权流量速率参数后，根据转换后的授权流量速率、自身能力以及负载情况进行判断，决定协商流量速率参数。GGSN保存各业务数据流的流量标识信息和相应的协商流量速率参数。</p>
      <p>到步骤10、GGSN将上述协商流量速率参数通过创建PDP上下文响应消息发送回SGSN。</p>
      <p>到步骤11、SGSN接收到GGSN传输来的创建PDP上下文响应消息后，更新其已保存的协商流量速率参数，同时在RAN中发起RAB建立过程，根据RAN的资源使用情况，可能会再次得到新的协商流量速率。在该步骤中，如果得到新的协商流量速率，SGSN更新其已保存的相应参数，到步骤12、SGSN将更新后的参数通过更新PDP上下文请求消息发送给GGSN，以通知GGSN更新其已保存的协商流量速率参数。GGSN在接收到更新PDP上下文请求消息后，更新其已保存的协商流量速率参数，到步骤13、GGSN将更新PDP上下文响应消息发送回SGSN。然后，到步骤14。如果在步骤11中没有得到新的协商流量速率，直接到步骤14。</p>
      <p>在步骤14、SGSN将最终的协商参数通过激活PDP上下文响应消息发送回UE。</p>
      <p>UE从其接收的激活PDP上下文响应消息中获知最终协商流量速率参数，如果最终协商流量速率参数与其请求的流量速率一致，就接受该协商结果，于是，整个流量速率协商过程结束，PDP上下文建立起来，UE可以进行实际的数据传送过程；如果最终协商流量速率参数与其请求的流量速率不一致，UE根据自身策略决定是否接受该最终协商结果，如果接受，PDP上下文建立起来，UE可以开始数据传送过程，如果不接受，UE可以选择终止承载建立过程，也可以选择重新发起流量速率协商过程。</p>
      <p>下面描述的例4到例6的QoS协商过程中，中间节点只是对基于业务数据流的流量类型参数以及基于PDP上下文的流量速率参数进行协商，而其它节点则同时进行基于PDP上下文的流量速率协商和基于业务数据流的流量类型/流量速率参数协商。但是，利用下述协商过程，中间节点也可以同时进行基于业务数据流的流量速率的协商。</p>
      <p>例4、基于GPRS&#160;QoS协商方式的流量速率、流量类型协商过程如附图11所示。</p>
      <p>图11中，在步骤1、UE根据自身应用的需要，向网络中的SGSN发送一个PDP上下文激活请求消息，该消息中包含了PDP上下文QoS需求以及PDP上下文中各个业务数据流的QoS需求。其中，PDP上下文QoS需求包括但不限于流量速率、可靠性等，对于PDP上下文中各个业务数据流的QoS需求包括但不限于流量速率、流量类型、优先级、可靠性、延迟等。在这里，PDP上下文的流量速率需求应等于其中各个业务数据流的流量速率需求之和。</p>
      <p>到步骤2、SGSN接收到UE的激活请求消息后，根据自身能力、负载情况以及签约信息对该激活请求消息进行QoS判断，得到一个协商QoS，这里SGSN所进行的QoS判断操作主要是针对PDP上下文QoS需求的操作，对PDP上下文中业务数据流的QoS需求并不进行任何判断操作，PDP上下文中业务数据流的QoS需求被简单地透明传输到下一个节点，也就是说，SGSN可以仅对基于PDP上下文的流量速率需求进行限定，形成基于PDP上下文的协商速率。</p>
      <p>到步骤3、SGSN保存该PDP上下文粒度上的协商QoS，并将该协商QoS作为请求消息中PDP上下文的QoS需求，且保持请求消息中各业务流的QoS需求不变，然后，将请求消息发送到网关GGSN。</p>
      <p>到步骤4、GGSN接收到来自SGSN的请求消息后，根据请求消息中的PDP上下文的QoS需求、自身能力和负载情况进行QoS判断，得到一个新的协商QoS。这里GGSN所进行的QoS判断是对请求消息PDP上下文中各业务数据流的QoS需求进行QoS判断，得到各业务数据流的协商QoS以及整个PDP上下文的协商QoS，PDP上下文的协商QoS中的流量速率是各业务数据流流量速率之和。这样，新的协商QoS中不仅包含有对PDP上下文QoS需求的协商结果，还包含有对PDP上下文中各业务数据流QoS需求的协商结果。也就是说，GGSN根据自身能力和负载情况对基于PDP上下文的协商速率以及基于SDF的流量速率/流量类型需求进行限定，形成基于PDP上下文的协商速率以及基于SDF的协商流量速率/协商流量类型。</p>
      <p>到步骤5、GGSN保存上述新的协商QoS，同时，GGSN将一个包含有上述新的协商QoS的PDP上下文响应消息发送给SGSN。这里的响应消息中包含有基于PDP上下文的协商速率以及基于SDF的流量速率/流量类型。</p>
      <p>到步骤6、SGSN接收到GGSN传输来的PDP上下文响应消息后，保存PDP上下文的协商QoS，同时，在RAN侧中发起RAB建立过程，在此过程中可能会再次得到新的协商QoS。这里的新的协商QoS是PDP上下文粒度级别的协商QoS。如果得到新的PDP上下文协商QoS，到步骤7、SGSN更新已保存的相应协商QoS，同时将更新后的协商QoS通过更新PDP上下文请求消息发送给GGSN。</p>
      <p>到步骤8、GGSN接收到SGSN传输来的更新PDP上下文请求消息后，根据更新后的PDP上下文协商QoS重新协商其中各业务数据流的协商QoS参数，重新协商的原则是保持各业务数据流的流量速率之和与整个PDP上下文的流量速率相一致。GGSN存储更新的PDP上下文协商QoS以及各业务数据流的协商QoS。</p>
      <p>到步骤9、GGSN将更新后的协商QoS通过更新PDP上下文响应消息传输至SGSN。</p>
      <p>到步骤10、SGSN接收到GGSN传输来的更新PDP上下文响应消息后，保存最终的PDP上下文协商QoS、以及各业务数据流的协商QoS，并将其通过PDP上下文激活响应消息发送给UE。</p>
      <p>UE从其接收到的激活PDP上下文响应消息中，获知最终的协商QoS，如果最终的协商QoS与其请求的QoS一致，就接受最终的协商QoS，于是，整个QoS协商过程结束，PDP上下文建立起来，可以进行实际的数据传送；如果最终的协商QoS与其请求的QoS不一致，UE根据自身策略决定是否接受该最终的协商QoS，如果决定接受，PDP上下文建立起来，可以进行时间的数据传送，如果决定不接受，UE可以终止承载建立，也可以重新发起QoS协商。</p>
      <p>例5、基于SBLP&#160;QoS协商方式的流量速率、流量类型协商过程如附图12所示。</p>
      <p>图12中，步骤1、会话发起终端UE与对端UE或应用服务器通过应用层信令SIP/SDP进行包含各媒体成分的QoS需求的会话媒体参数协商，AF获知会话协商结果中和QoS相关的业务信息后，可以选择是在此时将业务信息发送给PDF，还是在以后由PDF请求时将这些业务信息发送给PDF。如果AF在此时发送业务信息，则PDF在接收到业务信息后，对各媒体成分进行授权，授权的结果以IP&#160;QoS的形式保存在PDF上。</p>
      <p>会话发起终端获知会话协商结果后，到步骤2、会话发起终端向网络中的SGSN发送PDP上下文激活请求消息，该请求消息中包含有PDP上下文的QoS需求以及PDP上下文中各个业务数据流的QoS需求。其中，对于PDP上下文的QoS需求包括但不限于流量速率、可靠性等，对于业务数据流的QoS需求包括但不限于流量速率、流量类型、优先级、可靠性、延迟等。这些QoS需求可以以UMTS&#160;QoS的形式表述。在这里，PDP上下文的流量速率需求应等于其中各个业务数据流的流量速率需求之和。</p>
      <p>到步骤3、SGSN接收到会话发起终端的激活请求消息后，根据自身能力、负载情况以及签约信息对该激活请求消息进行QoS判断，得到一个协商QoS。这里SGSN所进行的QoS判断上要是针对PDP上下文QoS需求的操作，SGSN对PDP上下文中业务数据流的QoS需求并不进行任何QoS判断操作，SGSN只需要将PDP上下文中业务数据流的QoS需求简单、透明的传输到下一个节点即可。SGSN保存该PDP上下文粒度上的协商QoS。</p>
      <p>到步骤4、SGSN将PDP上下文的QoS需求以及上述协商QoS包含在创建PDP上下文请求消息中发送到网关GGSN。</p>
      <p>到步骤5、GGSN接收到创建PDP上下文请求消息后，向相应的PDF发送IP承载授权请求，该IP承载授权请求中包含有PDP上下文中各业务数据流的标识。</p>
      <p>PDF接收到IP承载授权请求消息后，根据消息中的业务数据流标识，查询是否存在相应的业务信息，如果不存在，到步骤6、PDF就向相应的AF请求业务信息，到步骤7、AF将相应的业务信息传输至PDF，然后，到步骤8，PDF根据业务信息进行基于业务数据流的QoS授权，QoS授权的结果可以以基于IP&#160;QoS的形式表现。到步骤9。</p>
      <p>在步骤5、如果已经存在相应的业务信息，PDF就能够直接获得基于业务数据流的已授权QoS信息，到步骤9。</p>
      <p>在步骤9、PDF将基于业务数据流的QoS授权信息包含在IP承载授权响应消息中发送回GGSN。在这里，并不将各业务数据流的授权数据组合到一起作为整个PDP上下文的授权QoS发送。</p>
      <p>到步骤10、GGSN接收到IP&#160;QoS的形式的各业务流的授权QoS后，将这些授权QoS组合起来就获得了整个PDP上下文的授权QoS，这里的授权QoS组合主要是流量速率的组合。GGSN将这些授权QoS由IP&#160;QoS的形式转换为UMTS的形式，并根据转换后的授权QoS、自身能力、SGSN针对针对PDP上行文的协商QoS以及负载情况进行QoS判断，以决定协商QoS。这里GGSN进行的QoS判断主要是对PDP上下文中各业务数据流的QoS需求进行判断，得到各业务数据流的协商QoS以及整个PDP上下文的协商QoS，PDP上下文的流量速率是各业务数据流流量速率之和。这样，新的协商QoS中包含了对PDP上下文QoS需求的协商结果以及对其中各业务数据流QoS需求的协商结果。GGSN保存上述新的协商QoS。</p>
      <p>到步骤11、GGSN将上述新的协商QoS通过创建PDP上下文响应消息，发送给SGSN。</p>
      <p>到步骤12、SGSN接收到GGSN传输来的创建PDP上下文响应消息后，保存PDP上下文的协商QoS，同时，在RAN侧发起RAB建立过程，在RAB建立过程中可能会再次得到新的协商QoS。这里的新的协商QoS是最终协商QoS，而且，最终协商QoS仅仅是PDP上下文粒度级别的协商QoS。如果本步骤中没有得到新的协商QoS，直接到步骤16；如果本步骤中得到了新的协商QoS，则SGSN更新已保存的协商QoS，同时，到步骤13、SGSN将更新后的协商QoS通过PDP上下文更新请求消息发送给GGSN。到步骤14、GGSN根据其接收的更新后的PDP上下文协商QoS重新协商各业务数据流的协商QoS参数，重新协商的原则是保持各业务数据流的流量速率之和与整个PDP上下文的流量速率相一致。随后，GGSN保存更新的PDP上下文以及各业务数据流的协商QoS。到步骤15、GGSN将更新后的协商QoS参数通过更新PDP上下文响应消息反馈回SGSN。然后，到步骤16。</p>
      <p>在步骤16、SGSN将最终的协商QoS通过PDP上下文激活响应消息，发送给会话发起终端。</p>
      <p>会话发起终端从其接收的PDP上下文激活响应消息中获取最终协商QoS，如果最终协商QoS与其请求的QoS一致，就接受该协商QoS，于是，整个QoS协商过程结束，PDP上下文建立起来，会话发起终端可以进行实际的数据传送。如果最终协商QoS与其请求的QoS不一致，会话发起终端根据自身策略决定是否接受最终协商QoS，如果接受，PDP上下文建立起来，会话发起终端可以开始进行时间的数据传送；如果不接受，会话发起终端可以终止承载建立过程，也可以重新发起QoS协商。</p>
      <p>例6、基于PCC&#160;QoS协商方式的流量速率、流量类型协商过程如附图13所示。</p>
      <p>图13中，承载环境选择GPRS，因此，基本的IP承载单元是PDP上下文。此外，本实施例并不包含AF功能实体，也就是说，在QoS协商之前PCRF并不能获得任何和上层业务相关的信息。</p>
      <p>步骤1、UE向网络中的SGSN发送激活PDP上下文请求消息，该请求消息中包含有PDP上下文的QoS需求以及PDP上下文中各个业务数据流的QoS需求。其中，对于PDP上下文的QoS需求包括但不限于流量速率、可靠性等，对于业务数据流的QoS需求包括但不限于流量速率、流量类型、优先级、可靠性、延迟等。这些QoS需求可以以UMTS&#160;QoS的形式表述，而且，PDP上下文的流量速率需求应等于其中各个业务数据流的流量速率需求之和。</p>
      <p>到步骤2、SGSN接收到UE传输来的激活PDP上下文请求消息，根据自身能力、负载情况以及签约信息对该请求消息进行QoS判断，得到一个协商QoS。这里SGSN进行的QoS判断操作主要是针对PDP上下文QoS需求的操作，对PDP上下文中业务数据流的QoS需求并不进行任何QoS判断操作，SGSN可以将PDP上下文中业务数据流的QoS需求简单、透明地传输到下一个节点。SGSN保存该PDP上下文粒度上的协商QoS。</p>
      <p>到步骤3、SGSN将PDP上下文粒度上的协商QoS包含在创建PDP上下文请求消息中发送到GGSN。</p>
      <p>到步骤4、GGSN接收到创建PDP上下文请求消息后，向相应的PCRF发送IP承载授权请求消息，向PCRF请求授权QoS信息。IP承载授权请求消息中包含有PDP上下文及其各业务数据流的相关信息，如PDP上下文的协商QoS以及各业务数据流的QoS请求、网络信息、用户标识IMSI等。</p>
      <p>PCRF接收到IP承载授权请求消息后，如果确定此前保存有相关的签约信息，直接到步骤7；如果确定此前没有保存相关的签约信息，则到步骤5、PCRF向相应的SPR发送签约信息请求消息，以索取其需要的签约信息。到步骤6、SPR在接收到签约信息请求消息后，将相应的签约信息返回给PCRF。签约信息如允许使用的业务相关信息、和用户的QoS与计费相关的策略信息等。到步骤7。</p>
      <p>在步骤7、PCRF根据本地管理策略、从GGSN获得的相关信息以及签约信息进行QoS策略决策，QoS策略决策的结果是PDP上下文的授权QoS信息及其各业务数据流的授权QoS信息，这些授权QoS信息以IP&#160;QoS的形式存储在PCRF上。根据PCRF的能力，在将这些授权QoS信息发送给GGSN之前，PCRF可以将其转换成UMTS的QoS形式。</p>
      <p>到步骤8、PCRF将PDP上下文的QoS授权信息及其业务数据流的QoS授权信息返回给GGSN。PCRF返回的QoS授权信息可以是IP&#160;QoS形式的QoS授权信息，也可以是UMTS&#160;QoS形式的QoS授权信息。</p>
      <p>到步骤9、GGSN接收到PCRF传输来的授权QoS信息后，如果授权QoS信息是IP&#160;QoS形式，GGSN就会将其转换为UMTS的QoS形式。随后，GGSN根据授权QoS信息、自身能力以及负载情况进行QoS判断，以决定PDP上下文的协商QoS及其各业务数据流的协商QoS，如对基于PDP上下文的协商速率以及基于SDF的流量速率、流量类型需求进行限定，形成基于PDP上下文的协商速率以及基于SDF的协商流量速率、协商流量类型。</p>
      <p>GGSN保存上述协商QoS信息，然后，到步骤10、GGSN将承载有上述协商QoS信息的创建PDP上下文响应消息发送给SGSN。</p>
      <p>到步骤11、SGSN接收到GGSN传输来的创建PDP上下文响应消息后，保存PDP上下文的协商QoS，同时，在RAN侧发起RAB建立过程，在RAB建立过程中，可能会再次得到新的协商QoS。这里得到的新的协商QoS也只是PDP上下文粒度级别的协商QoS。如果在此步骤中没有得到新的PDP上下文的协商QoS，直接到步骤15；如果在此步骤中得到新的PDP上下文的协商QoS，到步骤12、SGSN更新已保存的相应协商QoS，同时，将更新后的协商QoS通过更新PDP上下文请求消息发送给GGSN。到步骤13、GGSN接收到更新PDP上下文请求消息后，根据更新后的PDP上下文协商QoS来重新协商其中各业务数据流的协商QoS参数，重新协商的原则是保持各业务数据流的流量速率之和与整个PDP上下文的流量速率相一致。随后，GGSN保存更新的PDP上下文的协商QoS以及各业务数据流的协商QoS，到步骤14、GGSN将更新后的协商QoS参数通过更新PDP上下文响应消息反馈回SGSN。同时，GGSN也可以将更新后的协商QoS参数通知PCRF。到步骤15。</p>
      <p>步骤15、SGSN接收到GGSN传输来的更新PDP上下文响应消息后，保存最终的PDP上下文的协商QoS以及各业务数据流的协商QoS，并将这些协商QoS通过激活PDP上下文响应消息发送给UE。</p>
      <p>UE获知协商QoS后，判断协商QoS与其请求的QoS是否一致，如果一致，UE就接受该协商QoS，于是，整个QoS协商过程结束，PDP上下文建立起来，UE可以进行实际的数据传送过程；如果协商QoS与其请求的QoS不一致，UE根据自身策略决定是否接受该协商QoS，如果接受，PDP上下文建立起来，UE可以开始进行实际的数据传送过程，如果不接受，UE可以终止承载建立，也可以重新发起QoS协商。</p>
      <p>按照上述例1、例2或例3的协商方式，完成流量速率协商后，相应的PDP上下文已经在UE和GGSN之间建立起来，各业务数据流的流量标识信息与相应协商流量速率参数之间的对应关系也都已经存储在UE、RAN、SGSN、GGSN等网络单元之中。UE可以利用建立的IP承载进行实际的数据传输，并且网络中的QoS模型为DiffServ模型。实际的数据传输包括上行方向和下行方向，在整个IP承载路径上，对上行方向的PDP上下文承载实例的描述如下：UE根据协商流量速率参数，对PDP上下文中不同业务数据流发出的流量速率进行限制，使其与协商流量速率一致。</p>
      <p>PDP上下文中各业务数据流的数据包在RAN中由相应的RAB承载，根据协商的流量速率参数，RAN能够确保各个RAB得到应有的带宽保障，这种保障也包括根据协商流量速率参数对各业务数据流进行限制，不符合限制的流量可能被重新标记为新的流量类型标记或者新的流量处理优先级。随后，各业务流的数据包经过RAN的转发到达SGSN。</p>
      <p>本发明可以在RAN处为每个业务数据流维护一个令牌桶，令牌桶中令牌的生成速率可以设置为与协商的确保速率或协商的最大速率相一致。对于超过协商速率限制而未获得令牌的数据包，可以将其标记为新的QoS类型或新的优先级，如对于超过协商速率限制而未能获得令牌的会话类数据包，可以将其UMTS&#160;QoS类型降低为流类，再如对于超过协商速率限制的优先级为1的交互类数据包，可以将其优先级降低如降低为2。</p>
      <p>PDP上下文中各业务数据流的数据包到达SGSN后，SGSN会根据存储的业务数据流的流量标识信息及其协商流量速率参数对各个业务数据流进行流量速率限制，其限制方式与RAN中的流量速率限制方式一致。</p>
      <p>PDP上下文中各业务数据流的数据包通过GTP隧道到达GGSN后，GGSN会根据其存储的业务数据流的流量标识信息及其协商流量速率参数对IP承载中各业务数据流的流量速率进行限制，其限制方式与RAN中的流量速率限制方式一致。</p>
      <p>按照上述例1、例2或例3的协商方式，完成流量速率协商后，在整个IP承载路径上，对下行方向的PDP上下文承载实例的描述如下：GGSN接收到下行数据包，首先，GGSN确定该数据包所属的PDP上下文以及相应的业务数据流。确定数据包归属的PDP上下文以及相应的业务数据流的方法可以是：将数据包的IP地址和端口号等信息与各个PDP上下文的地址以及各个业务数据流的流量标识信息进行匹配，匹配成功的记录即为数据包归属的PDP上下文以及相应的业务数据流。</p>
      <p>在确定数据包的业务数据流归属后，GGSN根据数据包所属业务数据流的协商流量速率参数，对PDP上下文中各业务数据流流入的流量速率进行限制。根据限制的结果以及相关的流量类型规定，GGSN对所有流入数据包进行标记，如果数据包在外网已经标记了，则需要进行重标记。在这里，可以为每个业务数据流维护一个令牌桶，令牌桶中令牌的生成速率可以设置为与协商的确保速率或者最大速率相一致。对于超过协商速率限制而未获得令牌的数据包，将其标记为新的QoS类型或新的优先级。最后，GGSN可以根据各数据包的流量类型标记进行相应的PHB转发处理。</p>
      <p>PDP上下文中各业务数据流的数据包通过隧道到达SGSN后，SGSN根据存储的业务数据流的流量标识信息及其协商流量速率参数，对各个业务数据流流入该节点的流量速率进行限制，不符合流量速率限制的数据包可能被重新标记为新的流量类型标记如重新标记DSCP值或者重新标记新的流量处理优先级，SGSN对各个业务数据流流入该节点的流量速率进行限制的方式与GGSN中的限制方式一致。</p>
      <p>PDP上下文中各业务数据流的数据包在RAN中由相应的RAB承载，根据协商的流量速率，RAN能够确保各个RAB得到应有的带宽保障，这种保障也包括根据协商速率对流量速率进行限制，不符合限制的流量可能被重新标记为新的流量类型标记如重新标记DSCP值或者重新标记新的流量处理优先级，RAN对各个业务数据流流入该节点的流量速率进行限制的方式与GGSN中的限制方式一致。</p>
      <p>各业务流的数据包经过RAN的转发到达目的UE，UE接收到PDP上下文中各业务数据流的数据包后，完成相关的接收处理。</p>
      <p>按照上述例4、例5、例6的协商方式，完成QoS协商后，UE就可以利用建立的IP承载进行实际的数据传输，网络中的QoS模型采用DiffServ模型。实际的数据传输包括上行方向和下行方向，在整个IP承载路径上，一个上行方向的PDP上下文承载实例如附图14所示。</p>
      <p>图14中，QoS协商已经完成，相应的PDP上下文已经在UE和GGSN之间建立起来，最终的协商QoS参数也都已经存储在UE、RAN、SGSN、GGSN等网络单元之中。具体的，就是UE和GGSN中同时保存了基于PDP上下文的流量速率参数和基于业务数据流的流量类型和流量速率参数，而RAN和SGSN等中间节点中则只是保存了基于PDP上下文的流量速率参数和基于业务数据流的流量类型参数。</p>
      <p>在图14的步骤1、UE根据协商QoS，对PDP上下文中不同业务数据流发出的流量速率进行限制。同时，UE还根据各业务数据流的协商流量类型对数据包进行相应的标记，并根据标记进行相应的转发处理。</p>
      <p>根据业务数据流的QoS类型以及PHB映射方法，UE将不同业务数据流的数据包打上不同的DSCP标记，随后根据对应的PHB进行相应的转发处理，例如，不同的PHB对应不同的队列和拥塞控制，所有的队列按照某种队列调度算法如WFQ(加权公平队列)算法共享输出带宽。</p>
      <p>到步骤2、PDP上下文中各业务数据流的数据包从UE转发至RAN。</p>
      <p>到步骤3、PDP上下文中各业务数据流的数据包在RAN中由相应的RAB(Radio&#160;AccessBearer，无线接入承载)承载，根据协商的QoS情况，RAN能够确保各个RAB得到应有的QoS保障，这种保障也包括根据协商QoS对流量速率进行限制，不符合协商QoS的流量可能被重新标记为新的流量类型标记，也就是被重新标记为新的DSCP值、或者新的流量处理优先级。随后，各业务流的数据包从RAN通过GTP(通用隧道协议)隧道等转发到SGSN。</p>
      <p>在这里，可以为整个PDP上下文对应的RAB维护一个令牌桶，令牌桶中令牌的生成速率可以设置为与协商QoS中相应的确保速率或最大速率相一致。对于超过协商速率限制而未获得令牌的数据包，将其标记为新的流量类型标记或者新的流量处理优先级，如对于超过协商速率限制而未能获得令牌的、PHB为EF会话类的数据包，可以将其PHB值由EF降低为AF41，再如对于超过协商速率限制的、优先级为1、PHB为AF31的交互类数据包，可以降低其优先级，如将其优先级降低为2，相应的PHB为AF21。</p>
      <p>到步骤4、PDP上下文中各业务数据流的数据包通过GTP隧道到达SGSN。</p>
      <p>到步骤5、SGSN根据其存储的协商QoS参数对整个PDP上下文进行流量速率限制，并进行相应的DSCP重标记和PHB转发处理。在这里，需要更换隧道头，因此，需要注意的是，在更换隧道头时必须将相应的DSCP标记予以保留。</p>
      <p>到步骤6、PDP上下文中各业务数据流的数据包通过GTP隧道到达GGSN。</p>
      <p>到步骤7、GGSN根据其存储的协商QoS参数，GGSN对IP承载中各业务数据流流入的流量速率进行限制，不符合协商QoS限制的数据包被重新标记。随后，到步骤8、GGSN根据各数据包的标记进行相应的转发处理。</p>
      <p>在这里，GGSN为每一个业务数据流维护一个令牌桶，令牌桶中令牌的生成速率可以设置为与协商QoS中各业务数据流的确保速率或最大速率相一致。对于超过协商速率限制而未获得令牌的数据包，GGSN将其标记为新的QoS类型或新的优先级。</p>
      <p>针对上述上行方向实例的描述，一个下行方向的PDP上下文承载实例如附图15所示。</p>
      <p>图15中，在步骤1、GGSN接收到一个外来的下行数据包。</p>
      <p>到步骤2、GGSN确定该数据包归属的PDP上下文以及相应的业务数据流。确定数据包归属的方法可以为：将数据包的IP地址和端口号等信息与各个PDP上下文及其业务数据流中的packet&#160;filter进行匹配，与其相匹配的PDP上下文及业务数据流即为该数据包归属的PDP上下文以及相应的业务数据流。</p>
      <p>确定数据包的业务数据流归属后，GGSN根据所属业务数据流的协商QoS，对PDP上下文中各业务数据流流入的流量速率进行限制。根据限制的结果以及协商QoS的规定，GGSN对所有流入数据包进行标记，在外网已经标记的情况下需要进行重标记。最后，GGSN根据各数据包的标记进行相应的PHB转发处理。</p>
      <p>到步骤3、PDP上下文中各业务数据流的数据包通过隧道到达SGSN。</p>
      <p>到步骤4、SGSN根据其存储的协商QoS参数，对整个PDP上下文流入该节点的流量速率进行限制，不符合协商QoS的数据包可能被重新标记为新的流量类型标记，也就是被重新标记为新的DSCP值或者新的流量处理优先级。随后，SGSN将各数据包的DSCP值映射到相应的PHB值，并进行相应的转发处理。在这里，由于需要更换隧道头，因此，需要注意的是，在更换隧道头时必须将相应的DSCP标记予以保留。</p>
      <p>到步骤5、PDP上下文中各业务数据流的数据包通过隧道到达RAN。</p>
      <p>到步骤6、PDP上下文中各业务数据流的数据包在RAN中由相应的RAB承载，RAN根据协商的QoS情况，能够确保各个RAB得到应有的QoS保障，这种保障也包括根据协商QoS对流量速率进行限制，不符合协商QoS的流量可能被重新标记为新的流量类型标记，也就是被重新标记为新的DSCP值或者新的流量处理优先级。</p>
      <p>到步骤7、各业务流的数据包经过RAN的转发达到目的UE。</p>
      <p>到步骤8、UE接收到PDP上下文中各业务数据流的数据包后，完成相关接收处理。</p>
      <p>从上述技术方案的描述可以看出，本发明提供了一种新的QoS控制机制，该QoS控制机制是一种灵活的QoS控制方案，可以在网络中实现基于业务数据流的QoS控制能力。</p>
      <p>本发明可以使终端和网关节点支持完整的基于业务数据流的QoS控制能力，也就是说，本发明可以使终端和网关节点同时具备基于业务数据流的流量速率管理能力以及基于业务数据流的流量类型管理能力，与此相对应，终端和网关之间的中间节点可以只需要具备基于业务数据流的流量类型管理能力即可，从而使整个网络能够在一定程度上实现业务数据流粒度级别上的QoS控制能力。由于中间节点可以不具备基于业务数据流的流量速率管理能力，因此，也就不需要中间节点来保存业务数据流的流量速率的相关信息，从而，避免了由于引入业务数据流粒度级别的QoS控制功能而给系统带来的巨大资源消耗。由于业务数据流粒度上的QoS参数协商和保存只是发生在终端和网关之上，中间节点只是根据数据包中的标记进行相应的转发处理，中间节点不需要保存各个业务数据流的状态信息，从而在细化QoS控制粒度的同时，保证了系统的可扩展性。</p>
      <p>当然，终端、网关节点和中间节点也可以同时具备基于业务数据流的流量速率管理能力和基于业务数据流的流量类型管理能力，这样，网络就能够实现完整的基于业务数据流的QoS控制机制。这里的流量速率管理能力包括基于业务数据流的全网流量速率协商能力和基于业务数据流的全网流量速率控制能力，从而能够实现资源预留、区分业务数据流的整形(shaping)、调度和拥塞控制等QoS控制，对网络业务进行更精确的QoS控制。</p>
      <p>终端、网关节点和中间节点还可以均仅仅具备基于业务数据流的流量类型管理能力即可，同样在一定程度上实现了业务数据流粒度级别上的QoS控制能力。</p>
      <p>本发明中的QoS控制粒度细化到业务数据流的级别，这种细粒度的QoS控制方式有利于更有效地利用通信网络资源，提高运营商的单位投资收益率，延缓投资周期。此外，这种细粒度的QoS控制机制还有利于网络中更多新业务的开展。目前，网络中已经实现了基于业务流的计费机制，本发明的业务数据流粒度级别上的QoS控制机制可以很好地与之配合，逐步形成基于业务数据流的网络控制体系。</p>
      <p>当网络中实施完整的基于业务数据流的QoS控制方案时，需要网络中所有网络单元都具备这种支持能力，因此，需要进行全面的软、硬件升级。一种合理可行的过渡方法是：第一步，实施本发明的QoS控制方案，在网络中部分功能单元如终端和网关节点实现支持完整业务数据流粒度级别的QoS控制能力；第二步，在网络剩余部分功能单元实现支持完整的业务数据流粒度级别上的QoS控制能力。该过渡方案的特点在于，不需要一次性进行大量的软、硬件升级和资金投入，通过分步实施，达到网络平滑演进的效果。</p>
      <p>总而言之，本发明的QoS控制机制能够在网络中实现业务数据流粒度级别上的QoS控制能力，同时，又能够减少网络的一次性投资、有利于网络的逐步演进。</p>
      <p>虽然通过实施例描绘了本发明，本领域普通技术人员知道，本发明有许多变形和变化而不脱离本发明的精神，本发明的申请文件的权利要求包括这些变形和变化。</p>
    </mode-for-invention>
  </div>
  </div></div><div class="patent-section patent-tabular-section"><a id="forward-citations"></a><div class="patent-section-header"><span class="patent-section-title"> 被以下专利引用</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th">引用专利</th><th class="patent-data-table-th"> 申请日期</th><th class="patent-data-table-th">公开日</th><th class="patent-data-table-th"> 申请人</th><th class="patent-data-table-th">专利名</th></tr></thead><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN101222501B?cl=zh">CN101222501B</a></td><td class="patent-data-table-td patent-date-value">2008年1月31日</td><td class="patent-data-table-td patent-date-value">2012年11月28日</td><td class="patent-data-table-td ">中兴通讯股份有限公司</td><td class="patent-data-table-td ">下一代网络中实现多粒度资源控制的方法及装置</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN101567851B?cl=zh">CN101567851B</a></td><td class="patent-data-table-td patent-date-value">2009年4月22日</td><td class="patent-data-table-td patent-date-value">2014年4月9日</td><td class="patent-data-table-td ">特拉博斯股份有限公司</td><td class="patent-data-table-td ">用于调整数据业务流的传输速度的方法和设备</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN101959236B?cl=zh">CN101959236B</a></td><td class="patent-data-table-td patent-date-value">2009年7月13日</td><td class="patent-data-table-td patent-date-value">2013年6月26日</td><td class="patent-data-table-td ">大唐移动通信设备有限公司</td><td class="patent-data-table-td ">一种流量控制的方法和装置</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102104915B?cl=zh">CN102104915B</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2009年12月22日</td><td class="patent-data-table-td patent-date-value">2016年1月27日</td><td class="patent-data-table-td ">中国移动通信集团公司</td><td class="patent-data-table-td ">一种基于PMIP的QoS控制方法和系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102158977A?cl=zh">CN102158977A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年4月7日</td><td class="patent-data-table-td patent-date-value">2011年8月17日</td><td class="patent-data-table-td ">大唐移动通信设备有限公司</td><td class="patent-data-table-td ">一种指示业务类型的方法、装置及系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102256313A?cl=zh">CN102256313A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2010年5月21日</td><td class="patent-data-table-td patent-date-value">2011年11月23日</td><td class="patent-data-table-td ">鼎桥通信技术有限公司</td><td class="patent-data-table-td ">一种数据域服务速率的调控方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102256313B?cl=zh">CN102256313B</a></td><td class="patent-data-table-td patent-date-value">2010年5月21日</td><td class="patent-data-table-td patent-date-value">2014年4月16日</td><td class="patent-data-table-td ">鼎桥通信技术有限公司</td><td class="patent-data-table-td ">一种数据域服务速率的调控方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102377602A?cl=zh">CN102377602A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年10月26日</td><td class="patent-data-table-td patent-date-value">2012年3月14日</td><td class="patent-data-table-td ">国家广播电影电视总局广播科学研究院</td><td class="patent-data-table-td ">数据流处理方法及系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102484820A?cl=zh">CN102484820A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2010年7月20日</td><td class="patent-data-table-td patent-date-value">2012年5月30日</td><td class="patent-data-table-td ">阿尔卡特朗讯公司</td><td class="patent-data-table-td ">用于控制在尽力而为通信链路中提供服务的应用的参数的系统和方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102484820B?cl=zh">CN102484820B</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2010年7月20日</td><td class="patent-data-table-td patent-date-value">2015年12月16日</td><td class="patent-data-table-td ">阿尔卡特朗讯公司</td><td class="patent-data-table-td ">用于控制在尽力而为通信链路中提供服务的应用的参数的系统和方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102625377A?cl=zh">CN102625377A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年1月31日</td><td class="patent-data-table-td patent-date-value">2012年8月1日</td><td class="patent-data-table-td ">电信科学技术研究院</td><td class="patent-data-table-td ">一种无线承载的建立方法、接入点设备、用户设备及系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102625377B?cl=zh">CN102625377B</a></td><td class="patent-data-table-td patent-date-value">2011年1月31日</td><td class="patent-data-table-td patent-date-value">2014年6月18日</td><td class="patent-data-table-td ">电信科学技术研究院</td><td class="patent-data-table-td ">一种无线承载的建立方法、接入点设备、用户设备及系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102625490A?cl=zh">CN102625490A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年1月31日</td><td class="patent-data-table-td patent-date-value">2012年8月1日</td><td class="patent-data-table-td ">电信科学技术研究院</td><td class="patent-data-table-td ">长期演进局域网lte-lan系统及网关设备gw</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102625490B?cl=zh">CN102625490B</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年1月31日</td><td class="patent-data-table-td patent-date-value">2015年12月2日</td><td class="patent-data-table-td ">电信科学技术研究院</td><td class="patent-data-table-td ">长期演进局域网lte-lan系统及网关设备gw</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102742321A?cl=zh">CN102742321A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2012年1月20日</td><td class="patent-data-table-td patent-date-value">2012年10月17日</td><td class="patent-data-table-td ">华为技术有限公司</td><td class="patent-data-table-td ">一种服务质量控制的方法、设备和系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102742321B?cl=zh">CN102742321B</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2012年1月20日</td><td class="patent-data-table-td patent-date-value">2015年11月25日</td><td class="patent-data-table-td ">华为技术有限公司</td><td class="patent-data-table-td ">一种服务质量控制的方法、设备和系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102790755A?cl=zh">CN102790755A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年5月20日</td><td class="patent-data-table-td patent-date-value">2012年11月21日</td><td class="patent-data-table-td ">中兴通讯股份有限公司</td><td class="patent-data-table-td ">动态业务流的处理方法及装置</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102884828A?cl=zh">CN102884828A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年1月24日</td><td class="patent-data-table-td patent-date-value">2013年1月16日</td><td class="patent-data-table-td ">华为技术有限公司</td><td class="patent-data-table-td ">一种提供业务特定资源使用信息的方法和设备</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN103036779A?cl=zh">CN103036779A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年9月28日</td><td class="patent-data-table-td patent-date-value">2013年4月10日</td><td class="patent-data-table-td ">华为技术有限公司</td><td class="patent-data-table-td ">一种数据发送的方法和装置</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN103179047A?cl=zh">CN103179047A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年12月26日</td><td class="patent-data-table-td patent-date-value">2013年6月26日</td><td class="patent-data-table-td ">中国移动通信集团广东有限公司</td><td class="patent-data-table-td ">业务的资源调度方法、装置及系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN104270526A?cl=zh">CN104270526A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2014年9月29日</td><td class="patent-data-table-td patent-date-value">2015年1月7日</td><td class="patent-data-table-td ">广东欧珀移动通信有限公司</td><td class="patent-data-table-td ">移动终端的数据流量控制方法和系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8468267">US8468267</a></td><td class="patent-data-table-td patent-date-value">2007年12月1日</td><td class="patent-data-table-td patent-date-value">2013年6月18日</td><td class="patent-data-table-td ">Alcatel Lucent</td><td class="patent-data-table-td ">IMS diameter router with load balancing</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2011127839A1?cl=zh">WO2011127839A1</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年4月15日</td><td class="patent-data-table-td patent-date-value">2011年10月20日</td><td class="patent-data-table-td ">Huawei Technologies Co., Ltd.</td><td class="patent-data-table-td ">流量控制方法、设备及系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2012042376A1?cl=zh">WO2012042376A1</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年9月14日</td><td class="patent-data-table-td patent-date-value">2012年4月5日</td><td class="patent-data-table-td ">Alcatel Lucent</td><td class="patent-data-table-td ">Method and relay node for executing multiple media access control protocol data unit deliveries in a backhaul link</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2012092888A2?cl=zh">WO2012092888A2</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2012年1月20日</td><td class="patent-data-table-td patent-date-value">2012年7月12日</td><td class="patent-data-table-td ">Huawei Technologies Co., Ltd.</td><td class="patent-data-table-td ">一种服务质量控制的方法、设备和系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2012092888A3?cl=zh">WO2012092888A3</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2012年1月20日</td><td class="patent-data-table-td patent-date-value">2012年12月27日</td><td class="patent-data-table-td ">Huawei Technologies Co., Ltd.</td><td class="patent-data-table-td ">一种服务质量控制的方法、设备和系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2012100404A1?cl=zh">WO2012100404A1</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年1月24日</td><td class="patent-data-table-td patent-date-value">2012年8月2日</td><td class="patent-data-table-td ">Huawei Technologies Co.,Ltd.</td><td class="patent-data-table-td ">A method and apparatus for providing service specific resource usage information</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2012103779A1?cl=zh">WO2012103779A1</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2012年1月11日</td><td class="patent-data-table-td patent-date-value">2012年8月9日</td><td class="patent-data-table-td ">China Academy Of Telecommunications Technology</td><td class="patent-data-table-td ">一种无线承载的建立方法、接入点设备、用户设备及系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2012159321A1?cl=zh">WO2012159321A1</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年7月7日</td><td class="patent-data-table-td patent-date-value">2012年11月29日</td><td class="patent-data-table-td ">Huawei Technologies Co., Ltd.</td><td class="patent-data-table-td ">服务质量控制方法和设备</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2013044711A1?cl=zh">WO2013044711A1</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2012年8月29日</td><td class="patent-data-table-td patent-date-value">2013年4月4日</td><td class="patent-data-table-td ">Huawei Technologies Co., Ltd.</td><td class="patent-data-table-td ">一种数据发送的方法和装置</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2014040252A1?cl=zh">WO2014040252A1</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2012年9月13日</td><td class="patent-data-table-td patent-date-value">2014年3月20日</td><td class="patent-data-table-td ">Hewlett-Packard Development Company, L. P.</td><td class="patent-data-table-td ">Policy decision point management</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2014101505A1?cl=zh">WO2014101505A1</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2013年9月26日</td><td class="patent-data-table-td patent-date-value">2014年7月3日</td><td class="patent-data-table-td ">Zte Corporation</td><td class="patent-data-table-td ">一种WLAN和分组核心网之间的QoS对齐的方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2015085531A1?cl=zh">WO2015085531A1</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2013年12月12日</td><td class="patent-data-table-td patent-date-value">2015年6月18日</td><td class="patent-data-table-td ">华为技术有限公司</td><td class="patent-data-table-td ">Qos提升方法、装置及系统</td></tr></table><div class="patent-section-footer">* 由审查员引用</div></div><div class="patent-section patent-tabular-section"><a id="classifications"></a><div class="patent-section-header"><span class="patent-section-title">分类</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th"> </th><th class="patent-data-table-th"> </th></tr></thead><tr><td class="patent-data-table-td ">国际分类号</td><td class="patent-data-table-td "><span class="nested-value"><a href="https://www.google.com/url?id=CxeHAAABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=H04L0012851000">H04L12/851</a></span>, <span class="nested-value"><a href="https://www.google.com/url?id=CxeHAAABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=H04L0029060000">H04L29/06</a></span></td></tr></table><div class="patent-section-footer"></div></div><div class="patent-section patent-tabular-section"><a id="legal-events"></a><div class="patent-section-header"><span class="patent-section-title">法律事件</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th"> 日期</th><th class="patent-data-table-th">代码</th><th class="patent-data-table-th">事件</th><th class="patent-data-table-th">说明</th></tr></thead><tr><td class="patent-data-table-td patent-date-value">2007年8月1日</td><td class="patent-data-table-td ">C06</td><td class="patent-data-table-td ">Publication</td><td class="patent-data-table-td "></td></tr><tr><td class="patent-data-table-td patent-date-value">2009年9月30日</td><td class="patent-data-table-td ">C02</td><td class="patent-data-table-td ">Deemed withdrawal of patent application after publication (patent law 2001)</td><td class="patent-data-table-td "></td></tr></table><div class="patent-section-footer"></div></div><div class="modal-dialog" id="patent-images-lightbox"><div class="patent-lightbox-controls"><div class="patent-lightbox-rotate-controls"><div class="patent-lightbox-rotation-text">旋转</div><div class="rotate-icon rotate-ccw-icon"></div><div class="rotate-icon rotate-cw-icon"></div></div><div class="patent-lightbox-index-counter"></div><a class="patent-lightbox-fullsize-link" target="_blank">原始图片</a><div class="patent-drawings-control patent-drawings-next"><img class="patent-drawings-button-img"src="/googlebooks/images/kennedy/page_right.png" alt="Next page"width="21" height="21" /></div><div class="patent-drawings-control patent-drawings-prev"><img class="patent-drawings-button-img"src="/googlebooks/images/kennedy/page_left.png" alt="Previous page"width="21" height="21" /></div></div><div class="modal-dialog-content"><div class="patent-lightbox-image-holder"><div class="patent-lightbox-placeholder"></div></div></div></div><script>_OC_initPatentsAtb({image_not_available_html: " 未提供图片。\x3ca href\x3d//docs.google.com/viewer?url\x3dpatentimages.storage.googleapis.com/pdfs/34876af0cfcb09681660/CN101009631A.pdf\x3e查看 PDF\x3c/a\x3e"});</script></div></div></div></div></div><script>(function() {var href = window.location.href;if (href.indexOf('?') !== -1) {var parameters = href.split('?')[1].split('&');for (var i = 0; i < parameters.length; i++) {var param = parameters[i].split('=');if (param[0] == 'focus') {var elem = document.getElementById(param[1]);if (elem) {elem.focus();}}}}})();</script><script>_OC_addFlags({LockSrc:"/books/javascript/lock_50a6672b5f82ffbd39b7a9e87fd4594c.js", Host:"https://www.google.com/", IsBooksRentalEnabled:1, IsBrowsingHistoryEnabled:1, IsWebReaderSvgEnabled:0, IsImageModeNotesEnabled:1, IsOfflineBubbleEnabled:1, IsFutureOnSaleVolumesEnabled:1, IsBooksUnifiedLeftNavEnabled:1, IsMobileRequest:0, IsZipitFolderCollectionEnabled:1, IsAdsDisabled:0, IsEmbeddedMediaEnabled:1, IsImageModeAnnotationsEnabled:1, IsMyLibraryGooglePlusEnabled:1, IsImagePageProviderEnabled:1, IsBookcardListPriceSmall:0, IsInternalUser:0, IsBooksShareButtonEnabled:0, IsDisabledRandomBookshelves:0});_OC_Run({"enable_p13n":false,"is_cobrand":false,"sign_in_url":"https://www.google.com/accounts/Login?service=\u0026continue=https://www.google.com/patents%3Fcl%3Dzh%26hl%3Dzh-CN\u0026hl=zh-CN"}, {"volume_id":"","is_ebook":true,"volumeresult":{"has_flowing_text":false,"has_scanned_text":true,"can_download_pdf":false,"can_download_epub":false,"is_pdf_drm_enabled":false,"is_epub_drm_enabled":false,"download_pdf_url":"https://www.google.com/patents/download/%E4%B8%80%E7%A7%8DQoS%E6%8E%A7%E5%88%B6%E6%96%B9%E6%B3%95%E5%92%8C%E7%B3%BB%E7%BB%9F.pdf?id=CxeHAAABERAJ\u0026hl=zh-CN\u0026output=pdf\u0026sig=ACfU3U1e8vrHy0iquX28IM_K6NX7n8SlSw"},"sample_url":"https://www.google.com/patents/reader?id=CxeHAAABERAJ\u0026hl=zh-CN\u0026printsec=frontcover\u0026output=reader\u0026source=gbs_atb_hover","is_browsable":true,"is_public_domain":true}, {});</script><div id="footer_table" style="font-size:83%;text-align:center;position:relative;top:20px;height:4.5em;margin-top:2em"><div style="margin-bottom:8px"><a href="https://www.google.com/search?hl=zh-CN"><nobr>Google&nbsp;首页</nobr></a> - <a href="//www.google.com/patents/sitemap/"><nobr>站点地图</nobr></a> - <a href="http://www.google.com/googlebooks/uspto.html"><nobr>美国专利商标局 (USPTO) 专利信息批量下载</nobr></a> - <a href="/intl/zh-CN/privacy/"><nobr>隐私权政策</nobr></a> - <a href="/intl/zh-CN/policies/terms/"><nobr>服务条款</nobr></a> - <a href="https://support.google.com/faqs/answer/2539193?hl=zh-CN"><nobr> 关于 Google 专利</nobr></a> - <a href="//www.google.com/tools/feedback/intl/zh-CN/error.html" onclick="try{_OC_startFeedback({productId: '72792',locale: 'zh-CN'});return false;}catch(e){}"><nobr>发送反馈</nobr></a></div></div> <script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">var pageTracker = _gat._getTracker("UA-27188110-1");pageTracker._setCookiePath("/patents/");pageTracker._trackPageview();</script> </body></html>