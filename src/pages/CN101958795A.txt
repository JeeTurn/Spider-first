<!DOCTYPE html><html><head><title>专利 CN101958795A - 密钥存储设备及管理方法与生物认证设备、系统及方法 -  Google 专利</title><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){var d=void 0!=b?b:(new Date).getTime();this.t[a]=[d,c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(e){}};this.tick("start",null,a)}var a;window.performance&&(a=window.performance.timing);var f=a?new e(a.responseStart):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_",
"_wtsrt",d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();})();
</script><link rel="stylesheet" href="/patents/css/_5115ea495017d9115e613207d3810e5a/kl_intl_patents_bundle.css" type="text/css" /><script src="/books/javascript/atb_5115ea495017d9115e613207d3810e5a__zh_cn.js"></script><script>function googleTranslateElementInit() {new google.translate.TranslateElement({pageLanguage: "zh",gaTrack: true,gaId: "UA-27188110-1",multilanguagePage: true});}</script><script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script><meta name="DC.type" content="Patent"><meta name="DC.title" content="密钥存储设备及管理方法与生物认证设备、系统及方法"><meta name="DC.contributor" content="阿部博" scheme="inventor"><meta name="DC.contributor" content="索尼公司" scheme="assignee"><meta name="DC.date" content="2010-7-8" scheme="dateSubmitted"><meta name="DC.description" content="本发明涉及一种密钥存储设备及管理方法与生物认证设备、系统及方法。该密钥存储设备包括：接收单元，用于接收包数据，该包数据包括用于对已加密模板解密的模板密钥和用于执行与使用模板密钥的终端的认证的认证密钥，并且包数据具有仅允许密钥存储设备复原的数据格式；密钥信息存储单元，用于复原模板密钥和认证密钥，以及用于将模板密钥和认证密钥存储在防篡改非易失性存储器中；认证单元，用于在从终端接收到模板密钥的使用请求的情况中，通过使用基于认证密钥的认证信息来执行与终端的认证；以及密钥状态管理单元，用于在认证成功的情况中，将模板密钥置于终端可用的状态。本发明还涉及一种程序。"><meta name="DC.date" content="2011-1-26"><meta name="DC.relation" content="CN:101132277:A" scheme="references"><meta name="DC.relation" content="CN:101330386:A" scheme="references"><meta name="DC.relation" content="JP:2008102780" scheme="references"><meta name="DC.relation" content="US:20090080710:A1" scheme="references"><meta name="citation_reference" content="A. MENEZES，P. VAN，ETC.: &quot;《Handbook of Applied Cryptography》&quot;, 16 October 1996, article &quot;chapter 13&quot;"><meta name="citation_patent_publication_number" content="CN:101958795:A"><meta name="citation_patent_application_number" content="CN:201010228135"><link rel="canonical" href="https://www.google.com/patents/CN101958795A?cl=zh"/><meta property="og:url" content="https://www.google.com/patents/CN101958795A?cl=zh"/><meta name="title" content="专利 CN101958795A - 密钥存储设备及管理方法与生物认证设备、系统及方法"/><meta name="description" content="本发明涉及一种密钥存储设备及管理方法与生物认证设备、系统及方法。该密钥存储设备包括：接收单元，用于接收包数据，该包数据包括用于对已加密模板解密的模板密钥和用于执行与使用模板密钥的终端的认证的认证密钥，并且包数据具有仅允许密钥存储设备复原的数据格式；密钥信息存储单元，用于复原模板密钥和认证密钥，以及用于将模板密钥和认证密钥存储在防篡改非易失性存储器中；认证单元，用于在从终端接收到模板密钥的使用请求的情况中，通过使用基于认证密钥的认证信息来执行与终端的认证；以及密钥状态管理单元，用于在认证成功的情况中，将模板密钥置于终端可用的状态。本发明还涉及一种程序。"/><meta property="og:title" content="专利 CN101958795A - 密钥存储设备及管理方法与生物认证设备、系统及方法"/><meta property="og:type" content="book"/><meta property="og:site_name" content="Google Books"/><meta property="og:image" content="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"/><link rel="image_src" href="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"/><script>if (window['_OC_timingAction']) {window['_OC_timingAction']('patents_refpage');}</script><style>#gbar,#guser{font-size:13px;padding-top:1px !important;}#gbar{height:22px}#guser{padding-bottom:7px !important;text-align:right}.gbh,.gbd{border-top:1px solid #c9d7f1;font-size:1px}.gbh{height:0;position:absolute;top:24px;width:100%}@media all{.gb1{height:22px;margin-right:.5em;vertical-align:top}#gbar{float:left}}a.gb1,a.gb4{text-decoration:underline !important}a.gb1,a.gb4{color:#00c !important}.gbi .gb4{color:#dd8e27 !important}.gbf .gb4{color:#900 !important}

#gbar { padding:.3em .6em !important;}</style></head><body ><div id=gbar><nobr><a class=gb1 href="https://www.google.com/search?cl=zh&hl=zh-CN&sa=N&tab=tw">搜索</a> <a class=gb1 href="https://www.google.com/search?cl=zh&hl=zh-CN&tbm=isch&source=og&sa=N&tab=ti">图片</a> <a class=gb1 href="https://maps.google.com/maps?cl=zh&hl=zh-CN&sa=N&tab=tl">地图</a> <a class=gb1 href="https://play.google.com/?cl=zh&hl=zh-CN&sa=N&tab=t8">Play</a> <a class=gb1 href="https://www.youtube.com/results?cl=zh&hl=zh-CN&sa=N&tab=t1">YouTube</a> <a class=gb1 href="https://news.google.com/nwshp?hl=zh-CN&tab=tn">新闻</a> <a class=gb1 href="https://mail.google.com/mail/?tab=tm">Gmail</a> <a class=gb1 href="https://drive.google.com/?tab=to">云端硬盘</a> <a class=gb1 style="text-decoration:none" href="https://www.google.com/intl/zh-CN/options/"><u>更多</u> &raquo;</a></nobr></div><div id=guser width=100%><nobr><span id=gbn class=gbi></span><span id=gbf class=gbf></span><span id=gbe></span><a target=_top id=gb_70 href="https://www.google.com/accounts/Login?service=&continue=https://www.google.com/patents%3Fcl%3Dzh%26hl%3Dzh-CN&hl=zh-CN" class=gb4>登录</a></nobr></div><div class=gbh style=left:0></div><div class=gbh style=right:0></div><div role="alert" style="position: absolute; left: 0; right: 0;"><a href="https://www.google.com/patents/CN101958795A?cl=zh&amp;hl=zh-CN&amp;output=html_text" title="屏幕阅读器用户请注意：点击此链接可进入无障碍模式。阅读器在无障碍模式下具有同样的基本功能，但可让用户获得更好的体验。"><img border="0" src="//www.google.com/images/cleardot.gif"alt="屏幕阅读器用户请注意：点击此链接可进入无障碍模式。阅读器在无障碍模式下具有同样的基本功能，但可让用户获得更好的体验。"></a></div><div class="kd-appbar"><h2 class="kd-appname"><a href="/patents?hl=zh-CN"> 专利</a></h2><div class="kd-buttonbar left" id="left-toolbar-buttons"><a id="appbar-write-review-link" href=""></a><a id="appbar-view-print-sample-link" href=""></a><a id="appbar-view-ebook-sample-link" href=""></a><a id="appbar-patents-prior-art-finder-link" href="https://www.google.com/patents/related/CN101958795A"></a><a id="appbar-patents-discuss-this-link" href="https://www.google.com/url?id=EuqNBwABERAJ&amp;q=http://patents.stackexchange.com/redirect/google-patents%3Fpublication%3DCN101958795A&amp;usg=AFQjCNEnEd4SJhFaeazqJWE89anPq_e9pQ" data-is-grant="false"></a><a id="appbar-read-patent-link" href="//docs.google.com/viewer?url=patentimages.storage.googleapis.com/pdfs/012196077d0e95ea2699/CN101958795A.pdf"></a><a id="appbar-download-pdf-link" href="//patentimages.storage.googleapis.com/pdfs/012196077d0e95ea2699/CN101958795A.pdf"></a><a class="appbar-content-language-link" data-selected="true" data-label="中文" href="/patents/CN101958795A?cl=zh&amp;hl=zh-CN"></a><a class="appbar-content-language-link" data-label="英语" href="/patents/CN101958795A?cl=en&amp;hl=zh-CN"></a><a class="appbar-application-grant-link" data-selected="true" data-label="申请" href="/patents/CN101958795A?hl=zh-CN&amp;cl=zh"></a><a class="appbar-application-grant-link" data-label="授权" href="/patents/CN101958795B?hl=zh-CN&amp;cl=zh"></a></div><div class="kd-buttonbar right" id="right-toolbar-buttons"></div></div><div id="books-microdata" itemscope=""itemtype="http://schema.org/Book"itemid="https://www.google.com/patents/CN101958795A?cl=zh" style="display:none"><span itemprop="description">本发明涉及一种密钥存储设备及管理方法与生物认证设备、系统及方法。该密钥存储设备包括：接收单元，用于接收包数据，该包数据包括用于对已加密模板解密的模板密钥和用于执行与使用模板密钥的终端的认证的认证密钥，...</span><span itemprop="url">https://www.google.com/patents/CN101958795A?cl=zh&amp;utm_source=gb-gplus-share</span><span class="main-title" itemprop="name">专利 CN101958795A - 密钥存储设备及管理方法与生物认证设备、系统及方法</span><img itemprop="image" src="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"alt="专利 CN101958795A - 密钥存储设备及管理方法与生物认证设备、系统及方法" title="专利 CN101958795A - 密钥存储设备及管理方法与生物认证设备、系统及方法"></div><div style="display: none"><ol id="ofe-gear-menu-contents" class="gbmcc"><li class="gbe gbmtc"><a class="gbmt goog-menuitem-content" id="" href="https://www.google.com/advanced_patent_search?hl=zh-CN"> 高级专利搜索</a></li></ol></div><div id="volume-main"><div id="volume-center"><div class=vertical_module_list_row><div id=intl_patents class=about_content><div id=intl_patents_v><table class="patent-bibdata patent-drawings-missing"><tr><td class="patent-bibdata-heading"> 公开号</td><td class="single-patent-bibdata">CN101958795 A</td></tr><tr><td class="patent-bibdata-heading">发布类型</td><td class="single-patent-bibdata">申请</td></tr><tr><td class="patent-bibdata-heading"> 专利申请号</td><td class="single-patent-bibdata">CN 201010228135</td></tr><tr><td class="patent-bibdata-heading">公开日</td><td class="single-patent-bibdata">2011年1月26日</td></tr><tr><td class="patent-bibdata-heading"> 申请日期</td><td class="single-patent-bibdata">2010年7月8日</td></tr><tr><td class="patent-bibdata-heading"> 优先权日<span class="patent-tooltip-anchor patent-question-icon"data-tooltip-text="优先日期属于假设性质，不具任何法律效力。Google 对于所列日期的正确性并没有进行法律分析，也不作任何陈述。"></span></td><td class="single-patent-bibdata">2009年7月15日</td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">公告号</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="/patents/CN101958795B?hl=zh-CN&amp;cl=zh">CN101958795B</a>, </span><span class="patent-bibdata-value"><a href="/patents/US20110016317?hl=zh-CN&amp;cl=zh">US20110016317</a></span></span></td></tr><tr class="patent-bibdata-list-row alternate-patent-number"><td class="patent-bibdata-heading"> 公开号</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value">201010228135.5, </span><span class="patent-bibdata-value">CN 101958795 A, </span><span class="patent-bibdata-value">CN 101958795A, </span><span class="patent-bibdata-value">CN 201010228135, </span><span class="patent-bibdata-value">CN-A-101958795, </span><span class="patent-bibdata-value">CN101958795 A, </span><span class="patent-bibdata-value">CN101958795A, </span><span class="patent-bibdata-value">CN201010228135, </span><span class="patent-bibdata-value">CN201010228135.5</span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading"> 发明者</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E9%98%BF%E9%83%A8%E5%8D%9A%22">阿部博</a></span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading"> 申请人</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=inassignee:%22%E7%B4%A2%E5%B0%BC%E5%85%AC%E5%8F%B8%22">索尼公司</a></span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">导出引文</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="/patents/CN101958795A.bibtex?cl=zh">BiBTeX</a>, </span><span class="patent-bibdata-value"><a href="/patents/CN101958795A.enw?cl=zh">EndNote</a>, </span><span class="patent-bibdata-value"><a href="/patents/CN101958795A.ris?cl=zh">RefMan</a></span></span></td></tr><tr class="patent-internal-links"><td colspan=2><span class="patent-bibdata-value"><a href="#backward-citations">专利引用</a> (4),</span> <span class="patent-bibdata-value"><a href="#npl-citations">非专利引用</a> (1),</span> <span class="patent-bibdata-value"><a href="#classifications">分类</a> (9),</span> <span class="patent-bibdata-value"><a href="#legal-events">法律事件</a> (6)</span> </td></tr><tr><td colspan=2 class="patent-bibdata-external-link-spacer-top"></td></tr><tr class="patent-bibdata-external-link-spacer-bottom"></tr><tr><td colspan=2><span class="patent-bibdata-heading">外部链接:&nbsp;</span><span><span class="patent-bibdata-value"><a href="https://www.google.com/url?id=EuqNBwABERAJ&amp;q=http://211.157.104.87:8080/sipo/zljs/hyjs-yx-new.jsp%3Frecid%3D201010228135&amp;usg=AFQjCNFMXbqSTSxSxJqIz8Z8Q3iCr4Of2A"> 中国国家知识产权局</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/url?id=EuqNBwABERAJ&amp;q=http://worldwide.espacenet.com/publicationDetails/biblio%3FCC%3DCN%26NR%3D101958795A%26KC%3DA%26FT%3DD&amp;usg=AFQjCNFdUE2ionBzO6-uxQd2uhIjDS330g"> 欧洲专利数据库 (Espacenet)</a></span></span></td></tr><tr class="patent-bibdata-group-spacer"></tr></table><div class="number-and-title"><span class="patent-title"><invention-title mxw-id="PT100729036" lang="ZH" load-source="patent-office">密钥存储设备及管理方法与生物认证设备、系统及方法</invention-title>
      </span><br><span class="patent-number">CN 101958795 A</span></div><div class="patent-section patent-abstract-section"><div class="patent-section-header"><span class="patent-section-title"> 摘要</span></div><div class="patent-text"><abstract mxw-id="PA83015735" lang="ZH" load-source="patent-office">
    <div class="abstract">本发明涉及一种密钥存储设备及管理方法与生物认证设备、系统及方法。该密钥存储设备包括：接收单元，用于接收包数据，该包数据包括用于对已加密模板解密的模板密钥和用于执行与使用模板密钥的终端的认证的认证密钥，并且包数据具有仅允许密钥存储设备复原的数据格式；密钥信息存储单元，用于复原模板密钥和认证密钥，以及用于将模板密钥和认证密钥存储在防篡改非易失性存储器中；认证单元，用于在从终端接收到模板密钥的使用请求的情况中，通过使用基于认证密钥的认证信息来执行与终端的认证；以及密钥状态管理单元，用于在认证成功的情况中，将模板密钥置于终端可用的状态。本发明还涉及一种程序。</div>
  </abstract>
  </div></div><div class="patent-section patent-claims-section"><div class="patent-section-header"><span class="patent-section-title">权利要求<span class="patent-section-count">(14)</span></span></div><div class="patent-text"><ol mxw-id="PCLM34826747" lang="ZH" load-source="patent-office" class="claims">
    <li class="claim"> <div num="1" class="claim">
      <div class="claim-text">一种密钥存储设备，包括：接收单元，用于接收包数据，所述包数据包括用于对已加密的用于生物认证的模板进行解密的模板加密密钥和用于所执行的与使用该模板加密密钥的终端之间的相互认证的认证密钥，所述相互认证是在将该模板加密密钥置于可用状态时执行的，以及所述包数据具有仅允许由其中存储所述模板加密密钥的密钥存储设备复原的数据格式；密钥信息存储单元，用于从所述接收单元接收到的包数据中复原所述模板加密密钥和所述认证密钥，以及用于将所述模板加密密钥和所述认证密钥存储在防篡改非易失性存储器中；相互认证单元，用于在从所述终端接收到模板加密密钥的使用请求的情况中，通过使用基于所述非易失性存储器中存储的认证密钥的认证信息来执行与所述终端的相互认证；以及密钥状态管理单元，用于在所述相互认证单元进行的相互认证成功的情况中，将所述非易失性存储器中存储的模板加密密钥置于所述终端可用的状态。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="2" class="claim">
      <div class="claim-text">2.如权利要求1所述的密钥存储设备，其中，在所述模板加密密钥和所述认证密钥由所述密钥信息存储单元存储时用于执行 与所述终端之间的相互认证的系统认证密钥被预先存储在所述非易失性存储器中，其中，所述密钥存储设备进一步包括：系统相互认证单元，用于通过使用预先存储在所 述非易失性存储器中的系统认证密钥来执行与所述终端的相互认证，以及其中，在所述系统相互认证单元执行的相互认证成功的情况中，所述密钥信息存储单 元从所述包数据中复原所述模板加密密钥和所述认证密钥并且将所述模板加密密钥和所 述认证密钥存储在所述非易失性存储器中。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="3" class="claim">
      <div class="claim-text">3.如权利要求2所述的密钥存储设备，进一步包括：系统退化密钥生成单元，用于通过使用特定的系统退化密钥生成函数从所述系统认证 密钥生成系统退化密钥，其中，所述系统相互认证单元通过使用所述系统退化密钥生成单元所生成的系统退化 密钥来执行与所述终端的相互认证。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="4" class="claim">
      <div class="claim-text">4.如权利要求3所述的密钥存储设备，进一步包括：退化密钥生成单元，用于通过使用特定的退化密钥生成函数从所述认证密钥生成退化 密钥，其中，所述相互认证单元通过使用所述退化密钥生成单元所生成的退化密钥来执行与 所述终端的相互认证。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="5" class="claim">
      <div class="claim-text">5.如权利要求4所述的密钥存储设备，其中，当在如下状态下从终端接收到多个模板加密密钥的使用请求的情况中：存在多 个服务，针对每个服务设定了所述模板加密密钥，并且对应于多个服务的所述模板加密密 钥和认证密钥被存储在所述非易失性存储器中，所述退化密钥生成单元通过使用与已接收到所述使用请求的多个服务相对应的认证 密钥来生成一个退化密钥，所述相互认证单元通过使用所述退化密钥生成单元所生成的一个退化密钥来执行与 所述终端的相互认证，以及在所述相互认证单元执行的相互认证成功的情况中，所述密钥状态管理单元把与已接 收到所述使用请求的所述多个服务相对应并且被存储在所述非易失性存储器中的多个模 板加密密钥置于所述终端可用的状态。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="6" class="claim">
      <div class="claim-text">6.如权利要求1所述的密钥存储设备，其中，在所述相互认证单元执行的相互认证成 功的情况中，所述密钥状态管理单元把存储在所述非易失性存储器中的模板加密密钥复制 在易失性存储器中，并且在建立与所述终端之间的会话期间将所述易失性存储器中的模板 加密密钥置于所述终端可用的状态。</div>
    </div>
    </li> <li class="claim"> <div num="7" class="claim">
      <div class="claim-text">7.	一种生物认证设备，包括：生物信息获取单元，用于拍摄生物图案的图像，以及用于获取用于生物认证的生物信息；已加密模板获取单元，用于获取已加密的用于生物认证的模板；相互认证单元，用于获取在执行与密钥存储设备的相互认证时使用的认证信息，以及 用于通过使用该认证信息来执行与该密钥存储设备的相互认证，所述密钥存储设备把用于 对所述已加密的用于生物认证的模板进行解密的模板加密密钥存储在防篡改非易失性存 储器中并且管理所述模板加密密钥；模板解密单元，用于在所述相互认证单元执行的相互认证成功并且所述模板加密密钥 通过所述密钥存储设备被置于可用状态的情况中，通过使用该模板加密密钥对所述已加密 的用于生物认证的模板进行解密；以及生物认证单元，用于通过彼此对比地检查所述模板解密单元所解密的用于生物认证的 模板和所述生物信息获取单元所获取的生物信息来执行生物认证处理。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="8" class="claim">
      <div class="claim-text">8.如权利要求7所述的生物认证设备，进一步包括：系统相互认证单元，用于获取要用于相互认证的系统认证信息，所述相互认证是在把 所述模板加密密钥存储在所述密钥存储设备的非易失性存储器中时执行的，以及用于通过 使用该系统认证信息来执行与所述密钥存储设备的相互认证；以及包数据提供单元，在所述系统相互认证单元执行的相互认证成功的情况中，用于获取 包数据以及用于把所述包数据提供给所述密钥存储设备，所述包数据包括所述模板加密密 钥以及用于在所述密钥存储设备把该模板加密密钥置于可用状态时执行的相互认证的认 证密钥并且具有仅允许所述密钥存储设备复原的数据格式。</div>
    </div>
    </li> <li class="claim"> <div num="9" class="claim">
      <div class="claim-text">9.	一种生物认证系统，包括：密钥存储设备，包括：接收单元，用于接收包数据，所述包数据包括用于对已加密的用于生物认证的模板进 行解密的模板加密密钥和用于所执行的与使用该模板加密密钥的生物认证设备之间的相 互认证的认证密钥，所述相互认证是在把该模板加密密钥置于可用状态时执行的，以及包 数据具有仅允许由其中存储所述模板加密密钥的密钥存储设备复原的数据格式，密钥信息存储单元，用于从所述接收单元接收到的包数据中复原所述模板加密密钥和 所述认证密钥，以及用于将所述模板加密密钥和所述认证密钥存储在防篡改非易失性存储 器中，第一相互认证单元，用于在从所述生物认证设备接收到模板加密密钥的使用请求的情 况中，通过使用基于所述非易失性存储器中存储的认证密钥的认证信息来执行与所述生物认证设备的相互认证，以及密钥状态管理单元，用于在所述第一相互认证单元执行的相互认证成功的情况中，将 所述非易失性存储器中存储的模板加密密钥置于所述生物认证设备可用的状态；以及 生物认证设备，包括：生物信息获取单元，用于拍摄生物图案的图像，以及用于获取用于生物认证的生物信息&#938;已加密模板获取单元，用于获取已加密的用于生物认证的模板， 第二相互认证单元，用于获取在执行与所述密钥存储设备的相互认证时使用的认证 息，以及用于通过使用该认证信息执行与该密钥存储设备的相互认证，模板解密单元，用于在所述第二相互认证单元执行的相互认证成功并且所述模板加密 密钥通过所述密钥存储设备被置于可用状态的情况中，通过使用该模板加密密钥对所述已 加密的用于生物认证的模板进行解密，以及生物认证单元，用于通过彼此对比地检查所述模板解密单元所解密的用于生物认证的 模板和所述生物信息获取单元所获取的生物信息来执行生物认证处理。</div>
    </div>
    </li> <li class="claim"> <div num="10" class="claim">
      <div class="claim-text">10.	一种密钥管理方法，包括步骤：接收包数据，所述包数据包括用于对已加密的用于生物认证的模板进行解密的模板加 密密钥和用于所执行的与使用该模板加密密钥的终端之间的相互认证的认证密钥，所述相 互认证是在把该模板加密密钥置于可用状态时执行的，以及所述包数据具有仅允许由其中 存储所述模板加密密钥的密钥存储设备复原的数据格式；从所述接收的步骤中接收到的包数据中复原所述模板加密密钥和所述认证密钥，以及 将所述模板加密密钥和所述认证密钥存储在防篡改非易失性存储器中；在从所述终端接收到模板加密密钥的使用请求的情况中，通过使用基于所述非易失性 存储器中存储的所述认证密钥的认证信息来执行与所述终端的相互认证；以及在所述执行相互认证的步骤中的相互认证成功的情况中，将所述非易失性存储器中存 储的模板加密密钥置于所述终端可用的状态。</div>
    </div>
    </li> <li class="claim"> <div num="11" class="claim">
      <div class="claim-text">11.	一种生物认证方法，包括步骤：拍摄生物图案的图像，以及获取用于生物认证的生物信息； 获取已加密的用于生物认证的模板；获取在执行与密钥存储设备的相互认证时使用的认证信息，以及通过使用该认证信息 来执行与该密钥存储设备的相互认证，所述密钥存储设备把用于对所述已加密的用于生物 认证的模板进行解密的模板加密密钥存储在防篡改非易失性存储器中并且管理所述模板 加密密钥；在所述执行相互认证的步骤中的相互认证成功并且所述模板加密密钥通过所述密钥 存储设备被置于可用状态的情况中，通过使用该模板加密密钥对所述已加密的用于生物认 证的模板进行解密；以及通过彼此对比地检查所述解密的步骤中解密的用于生物认证的模板和所述获取生物 信息的步骤中获取的生物信息来执行生物认证处理。</div>
    </div>
    </li> <li class="claim"> <div num="12" class="claim">
      <div class="claim-text">12.	&#8212;种生物认证方法，包括步骤：由配备有其中存储模板加密密钥的防篡改非易失性存储器的密钥存储设备接收包数据，所述包数据包括用于对已加密的用于生物认证的模板进行解密的模板加密密钥和用于 所执行的与使用该模板加密密钥的生物认证设备之间的相互认证的认证密钥，所述相互认 证是在把该模板加密密钥置于可用状态时执行的，以及所述包数据具有仅允许由所述密钥 存储设备复原的数据格式；由所述密钥存储设备从所述接收的步骤中接收到的包数据中复原所述模板加密密钥 和所述认证密钥，以及由所述密钥存储设备将所述模板加密密钥和所述认证密钥存储在防 篡改非易失性存储器中；在从所述生物认证设备接收到模板加密密钥的使用请求的情况中，由所述密钥存储设 备通过使用基于所述非易失性存储器中存储的认证密钥的认证信息来执行与所述生物认 证设备的相互认证；在所述执行与所述生物认证设备的相互认证的步骤中的相互认证成功的情况中，由所 述密钥存储设备将所述非易失性存储器中存储的模板加密密钥置于所述生物认证设备可 用的状态；由所述生物认证设备拍摄生物图案的图像，以及由所述生物认证设备获取用于生物认 证的生物信息；由所述生物认证设备获取所述已加密的用于生物认证的模板； 由所述生物认证设备获取在执行与所述密钥存储设备的相互认证时使用的认证信息， 以及由所述生物认证设备通过使用该认证信息来执行与该密钥存储设备的相互认证；在所述执行与所述密钥存储设备的相互认证的步骤中的相互认证成功并且所述模板 加密密钥通过所述密钥存储设备被置于可用状态的情况中，由所述生物认证设备通过使用 该模板加密密钥对所述已加密的用于生物认证的模板进行解密；以及由所述生物认证设备通过彼此对比地检查在所述解密的步骤中解密的用于生物认证 的模板和在所述获取生物信息的步骤中获取的生物信息来执行生物认证处理。</div>
    </div>
    </li> <li class="claim"> <div num="13" class="claim">
      <div class="claim-text">13.	一种用于使计算机实现如下功能的程序：接收包数据的接收功能，所述包数据包括用于对已加密的用于生物认证的模板进行解 密的模板加密密钥和用于所执行的与使用该模板加密密钥的终端之间的相互认证的认证 密钥，所述相互认证是在把该模板加密密钥置于可用状态时执行的，以及所述包数据具有 仅允许由其中存储所述模板加密密钥的密钥存储设备复原的数据格式；密钥信息存储功能，从通过所述接收功能接收到的包数据中复原模板加密密钥和认证 密钥，以及把模板加密密钥和认证密钥存储在防篡改非易失性存储器中；相互认证功能，在从所述终端接收到所述模板加密密钥的使用请求的情况中，通过使 用基于所述非易失性存储器中存储的所述认证密钥的认证信息来执行与所述终端的相互 认证；以及密钥状态管理功能，在所述相互认证功能执行的相互认证成功的情况中，把所述非易 失性存储器中存储的模板加密密钥置于所述终端可用的状态。</div>
    </div>
    </li> <li class="claim"> <div num="14" class="claim">
      <div class="claim-text">14.	一种用于使计算机实现如下功能的程序：生物信息获取功能，拍摄生物图案的图像，以及获取用于生物认证的生物信息； 已加密模板获取功能，获取已加密的用于生物认证的模板；相互认证功能，获取在执行与密钥存储设备的相互认证时使用的认证信息，以及通过使用该认证信息来执行与该密钥存储设备的相互认证，所述密钥存储设备把用于对所述已 加密的用于生物认证的模板进行解密的模板加密密钥存储在防篡改非易失性存储器中并 且管理所述模板加密密钥；模板解密功能，在所述相互认证功能执行的相互认证成功并且所述模板加密密钥通过 所述密钥存储设备被置于可用状态的情况中，通过使用该模板加密密钥对所述已加密的用 于生物认证的模板进行解密；以及生物认证功能，用于通过彼此对比地检查通过所述模板解密功能解密的用于生物认证 的模板和通过所述生物信息获取功能获取的生物信息来执行生物认证处理。</div>
    </div>
  </li> </ol>
  </div></div><div class="patent-section patent-description-section"><div class="patent-section-header"><span class="patent-section-title"> 说明</span></div><div class="patent-text"><div mxw-id="PDES40688375" lang="ZH" load-source="patent-office" class="description">
    <p>密钥存储设备及管理方法与生物认证设备、系统及方法</p>
    <p>技术领域</p>
    <p>[0001]	本发明涉及一种密钥存储设备、一种生物认证设备、一种生物认证系统、一种密钥 管理方法、一种生物认证方法以及一种程序。</p>
    <p>背景技术</p>
    <p>[0002]	近年来，个人保持的信息的价值和重要性随着信息社会的发展而迅速增加。在这 些环境下，生物认证技术（生物技术）作为实现安全信息管理的方法而引起注意。生物认证 是使用人体（活体）的特征部分（在下文中被称为身体部位）的对本人或其他人的识别。 例如，对于不同的活体，指纹是不同的，并且因此指纹可以用于生物认证。与指纹相似，对于 不同的活体，人的声纹、面部形状、手的形状、虹膜图案、静脉图案等也具有不同的特征。因 此，通过使用这些特征用于生物认证，可以识别个人或者执行认证处理、搜索处理等。</p>
    <p>[0003]	如所描述的，为了使用生物认证来识别个人或者执行认证处理、搜索处理等，有必 要比较从身体部位获得的特征。因此，以可能进行比较的数据（例如，图像数据、音频数据、 三维坐标数据、虹膜代码等）的形式获得身体部位的特征（例如，指纹、声纹、静脉图案等）。 随后，通过某种方法比较预先以如此形式登记的“模板”和认证操作时输入的“输入数据”， 并且测量相似性。随后，基于作为比较结果而获得的相似性来执行个人识别或者认证处理寸。</p>
    <p>[0004]	对于生物认证，JP-A-2008-102780公开了一种用于在执行人的认证之前基于生 物图案来区别生物认证传感器检测到的身体图案属于活体还是非活体的技术。具体地， 该专利文献公开了一种用于通过掌握在活体图案中看到的独特统计趋势来区别活体和 非活体的技术。例如，活体的血管图案倾向于沿某个方向对准。对于该趋势，该专利文 献提出了一种如下方法：对于形成血管图案的每个部分，基于角度分布的分散、角度分布 的强度等，区别活体图案和非活体图案，以及根据区别结果排除假的血管图案等。再者， JP-A-2009-75950公开了一种有效地管理用于生物认证的诸如模板的信息的方法。</p>
    <p>发明内容</p>
    <p>[0005]	事实上，使用JP-A-2008-102780中描述的生物认证方法使得能够以较高的精度 执行生物认证。再者，使用JP-A-2009-75950中描述的管理方法使得能够有效地管理用于 生物认证的诸如模板的信息。然而，根据JP-A-2009-75950中描述的生物认证系统，模板被 存储在执行生物认证时使用的生物认证设备中（例如，参照图1)。据此，当存在多个生物 认证设备时，使用者必须将生物信息登记在每个生物认证设备中。当存在诸如金融服务、进 入/退出管理服务等各种服务并且针对每种服务安装生物认证设备时，使用者必须将生物 信息登记在用于各种服务的生物认证设备中。</p>
    <p>[0006]	将来，预见具有安全性高和认证精度高的特征的生物认证被广泛地用于各种服 务。除了已提到的金融服务和进入/退出管理服务之外，其还可以用于使用作为服务在办 公室中提供的影印机或自动贩卖机的使用者认证。然而，如果使用者要将生物信息登记在每个生物认证设备中，则使用者登记的负担将是过重的，并且实际上，利用将是非常困难 的。作为解决该问题的方法，可以设想一种构造如下系统的方法，其中对模板加密并且将其 存储在外部服务器等中，并且每当使用者要接受服务时，各生物认证设备就访问服务器等。</p>
    <p>[0007]	在应用该系统的情况中，自然需要一种安全地管理用于对模板进行解密的模板加 密密钥的方法。例如，对于其中模板加密密钥由所有服务共享的系统配置，如果模板加密密 钥通过一项服务的生物认证设备被暴露，则所有服务将被欺骗性地使用。如此，需要一种技 术，用于在其中生物认证技术用于各种服务的情形中，在为使用者提供高度便利的同时，安 全地管理用于生物认证的模板。</p>
    <p>[0008]	考虑到前文，所期望的是提供一种密钥存储设备、一种生物认证设备、一种生物认 证系统、一种密钥管理方法、一种生物认证方法以及一种程序，它们是新的和改进的，并且 通过使用由使用者持有的防篡改设备并且适当地管理用于每种服务的模板加密密钥，能够 在维持在生物认证设备外部保持的已加密模板的安全性的同时改进使用者的便利。</p>
    <p>[0009]	根据本发明的实施例，提供了一种密钥存储设备，其包括：接收单元，用于接收包 数据，该包数据包括用于对已加密的用于生物认证的模板进行解密的模板加密密钥和用于 所执行的与使用模板加密密钥的终端之间的相互认证的认证密钥，相互认证是在将模板加 密密钥置于可用状态时执行的并且包数据具有仅允许由其中存储模板加密密钥的密钥存 储设备复原的数据格式；密钥信息存储单元，用于从接收单元接收到的包数据中复原模板 加密密钥和认证密钥，以及用于将模板加密密钥和认证密钥存储在防篡改非易失性存储器 中；相互认证单元，用于在从终端接收到模板加密密钥的使用请求的情况中，通过使用基于 非易失性存储器中存储的认证密钥的认证信息来执行与终端的相互认证；以及密钥状态管 理单元，用于在相互认证单元执行的相互认证成功的情况中，将非易失性存储器中存储的 模板加密密钥置于终端可用的状态。</p>
    <p>[0010]	在模板加密密钥和认证密钥由密钥信息存储单元存储时用于执行与终端的相互 认证的系统认证密钥可以预先存储在非易失性存储器中。该密钥存储设备可以进一步包 括：系统相互认证单元，用于通过使用预先存储在非易失性存储器中的系统认证密钥来执 行与终端的相互认证。在系统相互认证单元执行的相互认证成功的情况中，密钥信息存储 单元可以从包数据中复原模板加密密钥和认证密钥并且将模板加密密钥和认证密钥存储 在非易失性存储器中。</p>
    <p>[0011]	该密钥存储设备可以进一步包括：系统退化密钥生成单元，用于通过使用特定的 系统退化密钥生成函数从系统认证密钥生成系统退化密钥。系统相互认证单元可以通过使 用系统退化密钥生成单元生成的系统退化密钥来执行与终端的相互认证。</p>
    <p>[0012]	该密钥存储设备可以进一步包括：退化密钥生成单元，用于通过使用特定的退化 密钥生成函数从认证密钥生成退化密钥。相互认证单元可以通过使用退化密钥生成单元生 成的退化密钥来执行与终端的相互认证。</p>
    <p>[0013]	在以下状态中从终端接收到多个模板加密密钥的使用请求的情况中：其中存在多 个服务，其中针对每个服务设定了模板加密密钥，并且其中对应于多个服务的模板加密密 钥和认证密钥被存储在非易失性存储器中，退化密钥生成单元可以通过使用与已接收到使 用请求的多个服务相对应的认证密钥来生成一个退化密钥，相互认证单元可以通过使用退 化密钥生成单元生成的一个退化密钥来执行与终端的相互认证，并且在相互认证单元执行的相互认证成功的情况中，密钥状态管理单元可以将对应于已接收到使用请求的多个服务 并且被存储在非易失性存储器中的多个模板加密密钥置于终端可用的状态。</p>
    <p>[0014]	在相互认证单元执行的相互认证成功的情况中，密钥状态管理单元可以在易失性 存储器中复制存储在非易失性存储器中的模板加密密钥，并且在建立与终端的会话的同时 将易失性存储器中的模板加密密钥置于终端可用的状态。</p>
    <p>[0015]	根据本发明的另一实施例，提供了一种生物认证设备，其包括：生物信息获取单 元，用于拍摄生物图案的图像，以及用于获取用于生物认证的生物信息；已加密模板获取单 元，用于获取已加密的用于生物认证的模板；相互认证单元，用于获取在执行与密钥存储设 备的相互认证时使用的认证信息，该密钥存储设备将用于对已加密的用于生物认证的模板 进行解密的模板加密密钥存储在防篡改非易失性存储器中并且管理模板加密密钥，以及用 于通过使用认证信息来执行与密钥存储设备的相互认证；模板解密单元，用于在相互认证 单元执行的相互认证成功并且模板加密密钥通过密钥存储设备被置于可用状态的情况中， 通过使用模板加密密钥对已加密的用于生物认证的模板进行解密；以及生物认证单元，用 于通过彼此对比地检查模板解密单元解密的用于生物认证的模板和生物信息获取单元获 取的生物信息来执行生物认证处理。</p>
    <p>[0016]	生物认证设备可以进一步包括：系统相互认证单元，用于获取要用于相互认证的 系统认证信息，该相互认证是在将模板加密密钥存储在密钥存储设备的非易失性存储器中 时执行的，以及用于通过使用系统认证信息来执行与密钥存储设备的相互认证；以及包数 据提供单元，用于在系统相互认证单元的相互认证成功的情况中获取包数据以及用于将包 数据提供给密钥存储设备，该包数据包括模板加密密钥以及用于在密钥存储设备将模板加 密密钥置于可用状态时执行的相互认证的认证密钥并且具有仅允许密钥存储设备复原的 数据格式。</p>
    <p>[0017]	根据本发明的另一实施例，提供了一种生物认证系统，其包括密钥存储设备和生 物认证设备。该密钥存储设备包括：接收单元，用于接收包数据，该包数据包括用于对已加 密的用于生物认证的模板进行解密的模板加密密钥和用于所执行的与使用模板加密密钥 的生物认证设备的相互认证的认证密钥，相互认证是在将模板加密密钥置于可用状态时执 行的并且包数据具有仅允许由其中存储模板加密密钥的密钥存储设备复原的数据格式；密 钥信息存储单元，用于从接收单元接收到的包数据中复原模板加密密钥和认证密钥，以及 用于将模板加密密钥和认证密钥存储在防篡改非易失性存储器中；第一相互认证单元，用 于在从生物认证设备接收到模板加密密钥的使用请求的情况中，通过使用基于非易失性存 储器中存储的认证密钥的认证信息来执行与生物认证设备的相互认证；以及密钥状态管理 单元，用于在第一相互认证单元执行的相互认证成功的情况中，将非易失性存储器中存储 的模板加密密钥置于生物认证设备可用的状态。该生物认证设备包括：生物信息获取单元， 用于拍摄生物图案的图像，以及用于获取用于生物认证的生物信息；已加密模板获取单元， 用于获取已加密的用于生物认证的模板；第二相互认证单元，用于获取在执行与密钥存储 设备的相互认证时使用的认证信息，以及用于通过使用认证信息执行与密钥存储设备的相 互认证；模板解密单元，用于在第二相互认证单元执行的相互认证成功并且模板加密密钥 通过密钥存储设备被置于可用状态的情况中，通过使用模板加密密钥对已加密的用于生物 认证的模板进行解密；以及生物认证单元，用于通过彼此对比地检查模板解密单元解密的</p>
    <p>9用于生物认证的模板和生物信息获取单元获取的生物信息来执行生物认证处理。</p>
    <p>[0018]	根据本发明的另一实施例，提供了一种密钥管理方法，其包括步骤：接收包数据， 该包数据包括用于对已加密的用于生物认证的模板进行解密的模板加密密钥和用于所执 行的与使用模板加密密钥的终端的相互认证的认证密钥，相互认证是在将模板加密密钥置 于可用状态时执行的并且包数据具有仅允许由其中存储模板加密密钥的密钥存储设备复 原的数据格式；从接收步骤中接收到的包数据中复原模板加密密钥和认证密钥，以及将模 板加密密钥和认证密钥存储在防篡改非易失性存储器中；在从终端接收到模板加密密钥的 使用请求的情况中，通过使用基于非易失性存储器中存储的认证密钥的认证信息来执行与 终端的相互认证；以及在执行相互认证的步骤中的相互认证成功的情况中，将非易失性存 储器中存储的模板加密密钥置于终端可用的状态。</p>
    <p>[0019]	根据本发明的另一实施例，提供了一种生物认证方法，其包括步骤：拍摄生物图案 的图像，以及获取用于生物认证的生物信息；获取已加密的用于生物认证的模板；获取在 执行与密钥存储设备的相互认证时使用的认证信息，该密钥存储设备将用于对已加密的用 于生物认证的模板进行解密的模板加密密钥存储在防篡改非易失性存储器中并且管理模 板加密密钥，以及通过使用认证信息来执行与密钥存储设备的相互认证；在执行相互认证 的步骤中的相互认证成功并且模板加密密钥通过密钥存储设备被置于可用状态的情况中， 通过使用模板加密密钥对已加密的用于生物认证的模板进行解密；以及通过彼此对比地检 查解密步骤中解密的用于生物认证的模板和获取生物信息的步骤中获取的生物信息来执 行生物认证处理。</p>
    <p>[0020]	根据本发明的另一实施例，提供了一种生物认证方法，其包括步骤：由配备有其中 存储模板加密密钥的防篡改非易失性存储器的密钥存储设备接收包数据，该包数据包括用 于对已加密的用于生物认证的模板进行解密的模板加密密钥和用于所执行的与使用模板 加密密钥的生物认证设备的相互认证的认证密钥，相互认证是在将模板加密密钥置于可用 状态时执行的并且包数据具有仅允许由密钥存储设备复原的数据格式；由密钥存储设备从 接收步骤中接收到的包数据中复原模板加密密钥和认证密钥，以及由密钥存储设备将模板 加密密钥和认证密钥存储在防篡改非易失性存储器中；在从生物认证设备接收到模板加密 密钥的使用请求的情况中，由密钥存储设备通过使用基于非易失性存储器中存储的认证密 钥的认证信息来执行与生物认证设备的相互认证；在执行与生物认证设备的相互认证的步 骤中的相互认证成功的情况中，由密钥存储设备将非易失性存储器中存储的模板加密密钥 置于生物认证设备可用的状态；由生物认证设备拍摄生物图案的图像，以及由生物认证设 备获取用于生物认证的生物信息；由生物认证设备获取已加密的用于生物认证的模板；由 生物认证设备获取在执行与密钥存储设备的相互认证时使用的认证信息，以及由生物认证 设备通过使用认证信息来执行与密钥存储设备的相互认证；在执行与密钥存储设备的相互 认证的步骤中的相互认证成功并且模板加密密钥通过密钥存储设备被置于可用状态的情 况中，由生物认证设备通过使用模板加密密钥对已加密的用于生物认证的模板进行解密； 以及由生物认证设备通过彼此对比地检查解密步骤中解密的用于生物认证的模板和获取 生物信息的步骤中获取的生物信息来执行生物认证处理。</p>
    <p>[0021]	根据本发明的另一实施例，提供了一种用于使计算机实现如下功能的程序：接收 功能，接收包数据，该包数据包括用于对已加密的用于生物认证的模板进行解密的模板加密密钥和用于所执行的与使用模板加密密钥的终端的相互认证的认证密钥，相互认证是在 将模板加密密钥置于可用状态时执行的并且包数据具有仅允许由其中存储模板加密密钥 的密钥存储设备复原的数据格式；密钥信息存储功能，从通过接收功能接收到的包数据中 复原模板加密密钥和认证密钥，以及将模板加密密钥和认证密钥存储在防篡改非易失性存 储器中；相互认证功能，在从终端接收到模板加密密钥的使用请求的情况中，通过使用基于 非易失性存储器中存储的认证密钥的认证信息来执行与终端的相互认证；以及密钥状态管 理功能，在相互认证功能执行的相互认证成功的情况中，将非易失性存储器中存储的模板 加密密钥置于终端可用的状态。</p>
    <p>[0022]	根据本发明的另一实施例，提供了一种用于使计算机实现如下功能的程序：生物 信息获取功能，拍摄生物图案的图像，以及获取用于生物认证的生物信息；已加密模板获取 功能，获取已加密的用于生物认证的模板；相互认证功能，获取在执行与密钥存储设备的相 互认证时使用的认证信息，该密钥存储设备将用于对已加密的用于生物认证的模板进行解 密的模板加密密钥存储在防篡改非易失性存储器中并且管理模板加密密钥，以及通过使用 认证信息来执行与密钥存储设备的相互认证；模板解密功能，在相互认证功能执行的相互 认证成功并且模板加密密钥通过密钥存储设备被置于可用状态的情况中，通过使用模板加 密密钥对已加密的用于生物认证的模板进行解密；以及生物认证功能，用于通过彼此对比 地检查通过模板解密功能解密的用于生物认证的模板和通过生物信息获取功能获取的生 物信息来执行生物认证处理。</p>
    <p>[0023]	根据本发明的另一实施例，提供了一种其中记录程序的记录介质，该记录介质能 够由计算机读取。</p>
    <p>[0024]	根据以上描述的本发明的实施例，通过使用由使用者持有的防篡改设备并且适当 地管理用于每个服务的模板加密密钥，能够维持在生物认证设备外部保持的已加密模板的 安全性，并且同时，能够改进使用者的便利。</p>
    <p>附图说明</p>
    <p>[0025]	图1是示出一般的生物认证设备的配置示例的说明性示图；</p>
    <p>[0026]	图2是示出根据本发明的实施例的生物认证系统的整体系统配置的示例的说明 性示图；</p>
    <p>[0027]	图3是示出根据本实施例的修改示例的生物认证系统的整体系统配置的示例的 说明性示图；</p>
    <p>[0028]	图4是示意性示出根据本实施例的存储在安全芯片上的非易失性存储器中的服 务数据的配置的说明性示图；</p>
    <p>[0029]	图5是示意性示出根据本实施例的存储在安全芯片上的非易失性存储器中的服 务数据的数据配置的说明性示图；</p>
    <p>[0030]	图6是示出根据本实施例的PC(服务登记终端、生物认证设备）的功能配置的示 例的说明性示图；</p>
    <p>[0031]	图7是示出根据本实施例的安全设备的功能配置的示例的说明性示图；</p>
    <p>[0032]	图8是示出根据本实施例的服务数据管理系统的功能配置的示例的说明性示图；</p>
    <p>[0033]	图9是示出根据本实施例的服务登记处理的流程的说明性示图；</p>
    <p>11[0034]	图10是示出根据实施例的系统服务的激活处理的流程的说明性示图；</p>
    <p>[0035]	图11是示出根据本实施例的系统服务的激活处理的具体内容的说明性示图；</p>
    <p>[0036]	图12是以表格格式示出根据本实施例的系统服务的激活处理的具体内容，该处 理中使用的认证密钥的类型和关于执行该处理时使用的参数的信息的说明性示图；</p>
    <p>[0037]	图13是以表格格式示出根据本实施例的用于系统服务的激活处理的信号处理函 数的具体配置的说明性示图；</p>
    <p>[0038]	图14是示出根据本实施例的一般服务的激活处理的流程的说明性示图；</p>
    <p>[0039]	图15是示出根据本实施例的一般服务的激活处理的具体内容的说明性示图；</p>
    <p>[0040]	图16是示出根据本实施例的多个服务的同时激活处理的流程的说明性示图；</p>
    <p>[0041]	图17是示出根据本实施例的多个服务的同时激活处理的流程的具体内容的说明 性示图；</p>
    <p>[0042]	图18是示出根据本实施例的同时激活多个版本的服务的处理的具体内容的说明 性示图；</p>
    <p>[0043]	图19是以表格格式示出根据本实施例的一般服务的激活处理的具体内容、该处 理中使用的认证密钥的类型和关于执行该处理时使用的参数的信息的说明性示图；</p>
    <p>[0044]	图20是以表格格式示出根据本实施例的用于一般服务的激活处理的信号处理功 能的具体配置的说明性示图；</p>
    <p>[0045]	图21是示出根据本实施例的生物认证设备的功能配置的示例的说明性示图；</p>
    <p>[0046]	图22是示出根据本实施例的模板管理系统的功能配置的示例的说明性示图；</p>
    <p>[0047]	图23是示出根据本实施例的生物认证处理的整体流程的说明性示图；</p>
    <p>[0048]	图24是示出根据本实施例的服务改变处理的具体内容的说明性示图；</p>
    <p>[0049]	图25是示出根据本实施例的服务改变处理的流程的说明性示图；</p>
    <p>[0050]	图26是示出根据本实施例的服务删除处理的流程的说明性示图；</p>
    <p>[0051]	图27是示出根据本实施例的模板登记终端的功能配置的示例的说明性示图；</p>
    <p>[0052]	图28是示出根据本实施例的模板登记处理的流程的说明性示图；</p>
    <p>[0053]	图29是示出根据本实施例的模板加密密钥交换处理的流程的说明性示图；以及</p>
    <p>[0054]	图30是示出能够实现根据本实施例的各设备和系统的功能的信息处理装置的硬 件配置的示例的说明性示图。</p>
    <p>具体实施方式</p>
    <p>[0055]	在下文中，将参照附图详细描述本发明的优选实施例。应当注意，在本说明书和附 图中，具有基本上相同的功能和结构的结构元件被标注有相同的附图标记，并且这些结构 元件的重复说明被省略。</p>
    <p>[0056]	&lt;描述流程&gt;</p>
    <p>[0057]	这里将简要叙述以下描述的本发明的实施例的描述流程。首先，将参照图1描述 一般的生物认证设备的配置。随后，将比较图1中示出的生物认证设备的配置，参照图2描 述根据本实施例的生物认证系统的整体系统配置。此外，将参照图3描述根据本实施例的 修改示例的生物认证系统的整体系统配置。</p>
    <p>[0058]	随后，将参照图4和5描述根据本实施例的生物认证系统中包括的安全设备的配置。其中，将参照图4给出关于用于从已加密模板解密原始模板的模板加密密钥的管理方 法的说明。此外，将参照图5给出关于在安全设备中提供的非易失性存储器中存储的服务 数据的内容以及服务数据的数据结构的说明。</p>
    <p>[0059]	接着，将参照图6描述用作本实施例的生物认证系统中的服务登记终端并且还用 作生物认证设备的PC的功能配置。然而，这里将仅详细描述用于提供服务登记终端的功能 的主要结构元件。随后，将参照图7描述在本实施例的生物认证系统中包括的安全设备的 功能配置。然而，这里将仅详细描述用于提供在服务登记时使用的功能的主要结构元件。接 着，将参照图8描述在本实施例的生物认证系统中包括的服务数据管理系统的功能配置。 然而，这里将仅详细描述用于提供在服务登记时使用的功能的主要结构元件。接着，将参照 图9至13描述根据本实施例的服务登记处理的流程。</p>
    <p>[0060]	随后，再次参照图6，将描述与在本实施例的生物认证系统中包括的PC的功能配 置相关的用于提供服务激活功能的主要结构元件的功能。接着，再次参照图7，将描述与在 本实施例的生物认证系统中包括的安全设备的功能配置相关的用于提供服务激活功能的 主要结构元件的功能。接着，再次参照图8，将描述与在本实施例的生物认证系统中包括的 服务数据管理系统相关的用于提供服务激活功能的主要结构元件的功能。接着，将参照图 14、15、19和20描述根据本实施例的服务激活处理的流程。接着，将参照图16至20描述根 据本实施例的多个服务的同时激活处理（组合激活）的流程。</p>
    <p>[0061]	接着，再次参照图6，将描述与在本实施例的生物认证系统中包括的PC的功能配 置相关的用于提供生物认证设备的功能的主要结构元件的功能。接着，将参照图21描述在 本实施例的生物认证系统中包括的生物认证设备的功能配置。随后，将参照图22描述在本 实施例的生物认证系统中包括的模板管理系统的功能配置。随后，将参照图23描述根据本 实施例的生物认证处理的流程。随后，将参照图24和25描述根据本实施例的服务改变处 理的流程。随后，将参照图26描述根据本实施例的服务删除处理的流程。</p>
    <p>[0062]	随后，将参照图27描述在本实施例的生物认证系统中包括的模板登记终端的功 能配置。随后，将参照图28描述根据本实施例的模板登记处理的流程。随后，将参照图29 描述根据本实施例的模板加密密钥交换处理的流程。随后，将参照图30描述能够实现在根 据本实施例的生物认证系统中包括的各个设备和该系统的功能的信息处理装置的硬件配 置的示例。</p>
    <p>[0063](描述项目)</p>
    <p>[0064]	1 ：生物认证系统的整体系统配置</p>
    <p>[0065]	1-1 ：系统配置示例1 (用于将模板存储在服务器中的配置)</p>
    <p>[0066]	1-2 ：系统配置示例2 (用于将模板存储在PC中的配置）</p>
    <p>[0067]	2 ：安全设备的配置</p>
    <p>[0068]	2-1 ：非易失性存储器内的数据结构</p>
    <p>[0069]	3 ：服务登记</p>
    <p>[0070]	3-1 =PC的功能配置（服务登记功能部分)</p>
    <p>[0071]	3-2 ：安全设备的功能配置（服务登记功能部分）</p>
    <p>[0072]	3-3 ：服务数据管理系统的功能配置（服务登记功能部分）</p>
    <p>[0073]	3-4 ：服务登记处理的流程</p>
    <p>13[0074]	3-4-1 ：整体处理流程</p>
    <p>[0075]	3-4-2 ：系统服务激活处理的流程</p>
    <p>[0076]	4 ：服务激活</p>
    <p>[0077]	4-1 =PC的功能配置（服务激活功能部分）</p>
    <p>[0078]	4-2 ：安全设备的功能配置（服务激活功能部分）</p>
    <p>[0079]	4-3 ：服务数据管理系统的功能配置（服务激活功能部分）</p>
    <p>[0080]	4-4 ：服务激活处理的流程</p>
    <p>[0081]	4-5 ：多个服务的同时激活</p>
    <p>[0082]	4-5-1 ：不同服务的同时激活</p>
    <p>[0083]	4-5-2 ：不同版本的同时激活</p>
    <p>[0084]	5 ：生物认证</p>
    <p>[0085]	5-1 =PC的功能配置（生物认证功能部分）</p>
    <p>[0086]	5-2 ：生物认证设备的功能配置</p>
    <p>[0087]	5-3 ：模板管理系统的功能配置（生物认证功能部分）</p>
    <p>[0088]	5-4 ：生物认证处理的流程</p>
    <p>[0089]	6:服务的改变/删除</p>
    <p>[0090]	6-1 ：服务改变处理的流程</p>
    <p>[0091]	6-2 ：服务删除处理的流程</p>
    <p>[0092]	7 ：模板登记</p>
    <p>[0093]	7-1 ：模板登记终端的功能配置</p>
    <p>[0094]	7-2 ：模板登记处理的流程</p>
    <p>[0095]	8 ：模板加密密钥的交换</p>
    <p>[0096]	9 ：硬件配置</p>
    <p>[0097]	&lt;实施例&gt;</p>
    <p>[0098]	将描述本发明的实施例。本实施例提出了一种生物认证系统的配置，其通过管理 在为各个服务提供的生物认证设备外部的用于生物认证的模板，在使用者不必将模板登记 在每个生物认证设备中的情况下，允许使用者接受所期望的服务。</p>
    <p>[0099]	为了更详细的描述，本实施例提供了一种生物认证系统，其以如下方式考虑安全 性：即使服务的模板加密密钥变为暴露的，通过为每个服务准备模板加密密钥，将不会影响 其他服务。特别地，其涉及一种如下技术：将可用的服务登记在个人使用者持有的安全设备 中，以及通过使用所登记的信息执行控制以便于允许用于提供所期望服务的生物认证设备 使用模板加密密钥。下面将使用具体示例给出更详细的说明。</p>
    <p>[0100]	&lt;1 ：生物认证系统的整体系统配置&gt;</p>
    <p>[0101]	首先，将描述根据本实施例的生物认证系统的整体系统配置。这里将示出作为具 体示例的两种类型的系统配置示例。然而，应当注意，根据本实施例的技术的适用范围不限 于这两种类型的系统配置示例。</p>
    <p>[0102]	&lt;1-1 ：系统配置示例1(用于将模板存储在服务器中的配置）&gt;</p>
    <p>[0103]	作为第一示例，图2中示出了被设计用于把模板存储在生物认证设备外部提供的 服务器（模板管理系统26)中的生物认证系统10的系统配置。图2是示出根据本实施例的生物认证系统10的系统配置的示例的说明性示图。</p>
    <p>[0104]	如图2中所示，生物认证系统10主要包括PC 12、安全设备14、影印机16、进入/ 退出管理设备18、自动贩卖机20、服务数据管理系统24、模板管理系统26和模板登记终端 28。</p>
    <p>[0105]	此外，PC 12、影印机16、进入/退出管理设备18和自动贩卖机20是提供生物认 证服务的设备的示例，并且配备有生物认证设备的功能。再者，假设除了生物认证设备的功 能之外，PC 12还配备有服务登记终端的功能。此外，在下面的说明中，PC 12、影印机16、进 入/退出管理设备18和自动贩卖机20可以被表述为生物认证设备。再者，PC 12可以被 表述为服务登记终端。服务登记终端的功能将在后面描述。</p>
    <p>[0106]	假设PC 12、影印机16、进入/退出管理设备18、自动贩卖机20、服务数据管理系 统24和模板管理系统26经由网络30连接。还假设PC 12配备有用于与安全设备14无线 通信的读取器/写入器（R/W)。因此，PC 12可以经由读取器/写入器将数据写入安全设备 14或者从安全设备14读出数据。此外，安全设备14是存储模板加密密钥的密钥存储设备 的示例。模板加密密钥和密钥存储设备的配置将在后面描述。</p>
    <p>[0107]	在图2中示出的生物认证系统10中，由模板管理系统26管理用于生物认证的模 板。通过使用模板登记终端28创建模板，并且模板被存储在模板管理系统26中。此时，利 用特定的模板加密密钥对模板进行加密。在下面的说明中，已被加密的模板将被称为已加 密模板。此外，在根据本实施例的生物认证系统10中，为每个服务创建已加密模板。</p>
    <p>[0108]	图2的示例假设由PC 12提供的万维网（Web)服务、由影印机16提供的影印服 务、由进入/退出管理设备18提供的进入/退出管理服务、和由自动贩卖机20提供的自动 贩卖服务。据此，用于万维网服务的已加密模板、用于影印服务的已加密模板、用于进入/ 退出管理服务的已加密模板和用于自动贩卖服务的已加密模板被存储在模板管理系统26 中。例如，通过利用对于每个服务是不同的模板加密密钥对从模板登记终端28输入的模板 进行加密，创建了各个已加密模板。</p>
    <p>[0109]	用于各个服务的模板加密密钥由服务数据管理系统24管理。因此，模板加密密钥 不是保存在PC 12、影印机16、进入/退出管理设备18和自动贩卖机20中，以便于总是能 够使用。就是说，利用生物认证系统10，在生物认证设备外部提供的系统中管理已加密模板 和模板加密密钥。</p>
    <p>[0110]	这里，将参照图1。如图1中所示，利用已被广泛使用的一般的生物认证设备，在生 物认证设备内的安全设备中管理已加密模板和模板加密密钥。因此，使用者必须去往其中 安装用于各个服务的生物认证设备的场所并登记生物图案，并且存在如下问题：随着服务 类型的增加，使用者的负担增加。</p>
    <p>[0111]	考虑到该问题，提出了一种如下方法：利用生物认证系统10管理服务数据管理系 统24中的模板加密密钥并且管理模板管理系统26中的已加密模板（外部提供模板管理）。 当使用该方法时，使用者不必去往对应于各个服务的生物认证设备的安装位置以登记模 板。然而，为了使生物认证系统10有效地发挥作用，需要一种在维持使用者便利的同时适 当地控制对已加密模板和模板加密密钥的访问的机制。</p>
    <p>[0112]	根据本实施例，使用一种如下方法：利用安全设备14中存储的对应于所期望服务 的模板加密密钥，通过使用各个生物认证设备和安全设备14之间的相互认证来控制对用于每个服务的模板加密密钥的访问。在下文中，将详细地描述该方法，但是首先，将介绍生 物认证系统10的修改示例。</p>
    <p>[0113]	&lt;1-2 ：系统配置示例2 (用于将模板存储在PC中的配置）&gt;</p>
    <p>[0114]	根据上文描述的生物认证系统10，由模板管理系统26管理已加密模板。然而，本 实施例涉及一种如下技术：利用安全设备14中存储的对应于所期望服务的模板加密密钥， 通过使用各生物认证设备和安全设备14之间的相互认证来控制对用于每个服务的模板加 密密钥的访问。</p>
    <p>[0115]	因此，如图3中所示，系统配置修改也是可能的，根据该修改，在PC 52中管理已加 密模板和模板加密密钥并且允许适当地从另一生物认证设备访问PC 52。就是说，在图2中 所示的生物认证系统10中，PC 12的功能、模板管理系统26的功能和模板登记终端28的 功能可以合并在PC 52中。该配置允许使用者通过使用由作为使用者的个人财产的PC 52 管理的已加密模板，通过例如影印机16、进入/退出管理设备18、自动贩卖机20等接受生 物认证服务。</p>
    <p>[0116]	如所描述的，可以适当地修改系统配置，只要它处于本实施例的技术思想内。例 如，还可以使用配备有PC 12和安全设备14的功能的移动电话、移动信息终端等代替PC 12。在下文中，将详细地描述根据本实施例的关于模板加密密钥的管理方法。此外，为了说 明，将对所设想的图2中所示的生物认证系统10的系统配置进行说明。</p>
    <p>[0117]	&lt;2:安全设备的配置〉</p>
    <p>[0118]	这里，将描述安全设备14的配置。如上文所述，本实施例的特征在于通过使用PC 12和安全设备14之间的相互认证来控制对安全设备14中存储的模板加密密钥的访问的方 法。因此，将详细地描述存储在安全设备14中的模板加密密钥的配置和要用于控制对模板 加密密钥的访问的访问认证密钥信息的配置。</p>
    <p>[0119]	&lt;2-1 ：非易失性存储器内的数据结构&gt;</p>
    <p>[0120]	首先，将参照图4和5描述存储在安全设备14中的模板加密密钥的配置和要用于 控制对模板加密密钥的访问的访问认证密钥的配置。这里还将描述根据本实施例的关于模 板加密密钥的管理方法。图4是示出存储在安全设备14中的模板加密密钥的配置示例的 说明性示图。图5是示出安全设备14中存储的服务数据的数据结构的说明性示图。此外， 后面将描述服务数据。</p>
    <p>[0121]	首先，将参照图4。如图4中所示，针对各个服务设定的模板加密密钥被存储在安 全设备14中。在如本实施例中假设使用多个服务的情况中，多个模板加密密钥将被存储在</p>
    <p>安全设备14中。例如，系统服务（服务1)、进入/退出管理服务（服务2).....万维网服</p>
    <p>务（服务N)等被存储在安全设备14的非易失性存储器中。此外，其中存储模板加密密钥 的非易失性存储器是防篡改的。再者，系统服务是在发货时预先设定的特别服务。另一方</p>
    <p>面，进入/退出管理服务.....万维网服务是使用者适当地登记在安全设备14中的一般服务。</p>
    <p>[0122]	接着，将参照图5。图5示出了存储在安全设备14的非易失性存储器中的服务数据 的数据结构。此外，服务数据是由用于识别每个服务的服务代码（sc)、用于控制对模板加密 密钥的访问的访问认证密钥信息（Iaut:)、包括模板加密密钥的模板加密密钥信息（ItemlT) 和复合许可标志（f。。mpsc;)形成的数据。此外，这些数据片段被彼此链接地管理。[0123]	服务代码（sc)是用于识别服务之间的差异和版本之间的差异的代码。服务代码 由服务ID(SCid)和版本信息（SCvct)形成。服务ID是用于识别服务的身份信息。版本信息 是用于识别版本的信息。访问认证密钥信息（IautlT)是为了访问对应于各服务的模板加密 密钥而进行的相互认证所使用的用于认证的数据。访问认证密钥信息由加密方案（taut广) 和服务认证密钥（Kaut广）形成。</p>
    <p>[0124]	模板加密密钥信息（I一sc;)是用于对为每个服务创建的加密模板进行解密的加密 密钥数据。模板加密密钥信息由加密方案（t一sc;)和模板加密密钥（Ktail:)形成。复合许 可标志（f。。mpsc;)是指示访问认证是否可以与关于对应于其他服务的模板加密密钥的其他访 问认证同时执行的许可信息。在复合许可标志被设定为有效的情况中，可以通过单次相互 认证一起建立关于对应于其他服务的模板加密密钥的访问认证。</p>
    <p>[0125]	如上文所述，为每个服务设定的服务数据被存储在安全设备14中。再者，将篡改 检测代码添加到各段服务数据。通过添加篡改检测代码，在服务数据出于某种原因而被破 坏的情况中，可以检测破坏。此外，系统服务的服务数据和一般服务的服务数据基本上具有 相同的数据结构。然而，存在如下差异，在系统服务的情况中，例如，对服务代码和复合许可 标志设置了限制。再者，系统服务的服务代码的预期用途和一般服务的服务代码的预期用 途是不同的。这些差异将在后面描述。</p>
    <p>[0126]	&lt;3:服务登记〉</p>
    <p>[0127]	如上文所述，服务数据被存储在安全设备14中。系统服务的服务数据预先在发货 等时被存储在安全设备14的非易失性存储器中。另一方面，必须使用PC 12(服务登记终 端）登记一般服务的服务数据。这里将描述用于将一般服务的服务数据存储在安全设备14 的非易失性存储器中的服务登记方法。</p>
    <p>[0128]	&lt;3-1 =PC的功能配置（服务登记功能部分）&gt;</p>
    <p>[0129]	首先，将参照图6描述PC 12的功能配置中的用于提供服务登记功能的结构元件。 图6是示出PC 12的功能配置的示例的说明性示图。</p>
    <p>[0130]	如图6中所示，PC 12包括用于安全设备的通信单元102、系统服务退化密钥获取 单元104、用于网络的通信单元106、系统服务状态控制单元108、以及包服务数据传输单元 110，作为用于提供服务登记功能的主要结构元件。此外，用于安全设备的通信单元102和 包服务数据传输单元110是包数据提供单元的示例。再者，用于安全设备的通信单元102、 系统服务退化密钥获取单元104和系统服务状态控制单元108是系统相互认证单元的示 例。</p>
    <p>[0131]	用于安全设备的通信单元102是用于与安全设备14通信的部件。系统服务退化 密钥获取单元104是用于从服务数据管理系统24获取系统服务认证退化密钥的部件，该系 统服务认证退化密钥将用于在一般服务的服务数据的登记时执行的与安全设备14的相互 认证。系统服务认证退化密钥是基于在系统服务的服务数据中包括的服务认证密钥而生成 的（在下文中，服务认证密钥和服务数据被分别称为“系统服务认证密钥”和“系统服务数 据”）。</p>
    <p>[0132]	这里，系统服务认证退化密钥由管理服务提供权威的服务管理权威（服务数据管 理系统24)生成或者由服务管理权威批准许可的安全设备14生成。例如，基于系统服务认 证密钥（KautlTsys)和系统服务认证退化密钥函数Cltl，通过下面示出的式（1)来生成对应于系统服务的服务ID(SCsys)的系统服务认证退化密钥（Kdegesc;sys)。系统服务认证退化密钥函数 d0是在服务管理权威批准许可之后提供的。</p>
    <p>[0133][等式	1]</p>
    <p>[0134]	Kdeg= d0(Kauthscs-) ... (1)</p>
    <p>[0135]	系统服务退化密钥获取单元104经由用于网络的通信单元106获取上文描述的系 统服务认证退化密钥。用于网络的通信单元106是用于向/从服务数据管理系统24、模板 管理系统26和连接到网络30的其他生物认证设备传送/接收数据的部件。系统服务退化 密钥获取单元104获取的系统服务认证退化密钥被输入到系统服务状态控制单元108。系 统服务状态控制单元108是用于经由用于安全设备的通信单元102与安全设备14通信以 及用于执行相互认证和会话建立的部件。</p>
    <p>[0136]	当系统服务认证退化密钥被输入时，系统服务状态控制单元108尝试经由用于安 全设备的通信单元102进行与安全设备14的相互认证。当相互认证成功时，系统服务状态 控制单元108建立会话，并且将指示相互认证成功的通知信息（在下文中将被称为认证完 成通知）输入到包服务数据传输单元110。其中系统服务认证退化密钥的相互认证已成功 并且会话被建立的这种状态将被称为其中系统服务被激活的状态。</p>
    <p>[0137]	使用者期望登记的服务信息被输入到包服务数据传输单元110。当认证完成通知 被输入时，包服务数据传输单元110经由用于网络的通信单元106访问服务数据管理系统 24，并且获取使用者所期望的服务的服务数据。这里，将由包服务数据传输单元110获取的 服务数据被打包为如下格式：仅可能在安全设备14处解密。该打包处理仅由服务管理权威 执行或者由服务管理权威批准许可的实体执行。这里，假设服务管理权威（服务数据管理 系统24)执行该处理。</p>
    <p>[0138]	此外，打包处理是基于服务打包函数P1执行的。例如，使用者期望登记的一般服 务的服务代码被取为Sc。再者，在将对应于服务代码SC的访问认证密钥信息取为Iauths%将 模板加密密钥信息取为Itemps%并且将复合许可标志取为f。。：时，如下式⑵和⑶获得打 包的服务数据（在下文中将被称为服务包数据）Ps。。</p>
    <p>[0139][等式	2]</p>
    <p>[0140]	Ssc 一 [SC，Iauth ，Itemp ，fCOmp ] &#183; &#183; &#183; (2)</p>
    <p>[0141]	Psc = P1 (Ssc)	…⑶</p>
    <p>[0142]	上文所述的服务包数据是由包服务数据传输单元110从服务数据管理系统24获 取的，并且经由用于安全设备的通信单元102提供给安全设备14。</p>
    <p>[0143]	如所描述的，PC 12通过使用系统服务认证退化密钥来执行与安全设备14的相互 认证并且建立会话，并且向安全设备14提供服务包数据。此时，由于服务数据被打包为PC 12不能够解密的格式，因此服务数据的内容对于PC 12将是未知的。据此，可以防止在服务 数据的登记时通过PC12泄漏服务数据的内容。再者，通过PC 12和安全设备14之间执行 的相互认证，可以防止恶意第三方将未授权的服务数据存储在有效数据存储位置。</p>
    <p>[0144]	&lt;3-2 ：安全设备的功能配置（服务登记功能部分）&gt;</p>
    <p>[0145]	接着，将参照图7描述安全设备14的功能配置中的用于提供服务登记功能的结构 元件。图7是示出安全设备14的功能配置的示例的说明性示图。</p>
    <p>[0146]	如图7中所示，安全设备14包括通信单元202、非易失性存储器204、系统服务退化密钥生成单元206、系统服务状态控制单元208和服务包数据解密单元210，作为用于提 供服务登记功能的主要结构元件。此外，通信单元202是接收单元的示例。再者，服务包数 据解密单元210是密钥信息存储单元的示例。再者，系统服务退化密钥生成单元206和系 统服务状态控制单元208是系统相互认证单元的示例。再者，系统服务退化密钥生成单元 206是系统退化密钥生成单元的示例。</p>
    <p>[0147]	通信单元202是用于与PC 12通信的部件。非易失性存储器204是防篡改的存储 部件。此外，系统服务数据被预先存储在非易失性存储器204中。当一般服务的登记处理 开始时，系统服务退化密钥生成单元206从非易失性存储器204获取系统服务数据中包括 的系统服务认证密钥。随后，系统服务退化密钥生成单元206从系统服务认证密钥生成系 统服务认证退化密钥。系统服务认证退化密钥是基于上文描述的式（1)生成的。这里，假 设服务管理权威已经提供了系统服务认证退化密钥函数d0。</p>
    <p>[0148]	系统服务退化密钥生成单元206生成的系统服务认证退化密钥被输入到系统服 务状态控制单元208。系统服务状态控制单元208是用于在一般服务的登记时执行与PC 12的相互认证以及用于建立会话的部件。当系统服务认证退化密钥被输入时，系统服务状 态控制单元208通过使用所输入的系统服务认证退化密钥来执行与PC 12的相互认证，并 且在认证已成功的情况中，经由通信单元202建立会话。当以这种方式激活系统服务时，从 PC 12提供包服务数据。</p>
    <p>[0149]	安全设备14通过使用通信单元202获取PC 12提供的包服务数据。通过通信单 元202获取的包服务数据被输入到服务包数据解密单元210。服务包数据解密单元210从 已输入的包服务数据解密原始服务数据。随后，服务包数据解密单元210将已被解密的服 务数据存储在非易失性存储器204中。一般服务的服务数据以这种方式存储在非易失性存 储器204中，并且构造如图5中所示的数据结构。</p>
    <p>[0150]	通过这种方式，安全设备14通过使用系统服务认证退化密钥来执行与PC 12的相 互认证，建立会话，并且从PC 12获取服务包数据。此时，由于服务数据被打包为PC 12不 能够解密的格式，因此服务数据的内容对于PC 12将是未知的。因此，可以防止在服务数据 的登记时通过PC 12泄漏服务数据的内容。再者，通过PC 12和安全设备14之间执行的相 互认证，可以防止恶意第三方将未授权的服务数据存储在有效数据存储位置。</p>
    <p>[0151]	&lt;3-3 ：服务数据管理系统的功能配置（服务登记功能部分）&gt;</p>
    <p>[0152]	接着，将参照图8描述服务数据管理系统24的功能配置中的用于提供服务登记功 能的结构元件。图8是示出服务数据管理系统24的功能配置的示例的说明性示图。</p>
    <p>[0153]	如图8中所示，服务数据管理系统24包括通信单元302、存储单元304、模板加密 密钥管理单元306、包服务数据生成单元308和系统服务退化密钥生成单元310，作为用于 提供服务登记功能的主要结构元件。系统服务和一般服务的服务数据被存储在存储单元 304中。此外，模板加密密钥管理单元306是用于管理模板加密密钥的部件，该部件提供模 板管理系统26处的模板加密时的模板加密密钥或者向包服务数据生成单元308适当地输 入模板加密密钥。</p>
    <p>[0154]	当一般服务的登记处理开始时，系统服务退化密钥生成单元310从存储单元304 中存储的系统服务数据获取系统服务认证密钥，并且基于上文描述的式（1)生成系统服务 认证退化密钥。随后，经由通信单元302将系统服务退化密钥生成单元310生成的系统服务认证退化密钥提供给PC12。再者，当PC 12提供关于使用者所期望的服务的信息时，包服 务数据生成单元308从存储单元304中存储的服务数据片段获取相应的服务数据。随后， 包服务数据生成单元308基于上文描述的式（2)和（3)对所获取的服务数据进行打包，并 且生成包服务数据。随后，经由通信单元302将包服务数据生成单元308生成的包服务数 据提供给PC 12。</p>
    <p>[0155]	如所描述的，所提供的服务数据被打包为PC 12不能够解密的格式。因此，在一般 服务的登记时，服务数据的内容对于PC 12将是未知的。结果，可以防止在服务数据的登记 时通过PC 12泄漏服务数据的内容。</p>
    <p>[0156]	&lt;3-4 ：服务登记处理的流程&gt;</p>
    <p>[0157]	接着，将参照图9和10描述生物认证系统10的服务登记处理的流程。图9是示 出生物认证系统10的服务登记处理的整体流程的说明性示图。图10是详细示出生物认证 系统10的服务登记处理中的系统服务激活处理的流程的说明性示图。此外，在图9和10 中，PC 12被表述为服务登记终端。</p>
    <p>[0158]	C3-4-1 ：整体处理流程）</p>
    <p>[0159]	首先，将参照图9描述服务登记处理的整体流程。如图9中所示，使用者开始一般 服务的登记处理，并且在PC 12上选择所期望的服务（S102)。然而，也可以由PC 12自动 地选择特定服务（S102)。当选择要被登记的服务（在下文中将被称为所选择的服务）时， PC 12获取对应于所选择的服务的服务包数据（S104)。随后，PC 12和安全设备14执行系 统服务的激活处理（S106)。系统服务的激活处理将在后面描述。</p>
    <p>[0160]	接着，判定系统服务的激活处理是否已成功（S108)。在系统服务的激活已成 功的情况中，PC 12基于添加到包服务数据的篡改检测代码来评估包服务数据的有效性 (SllO)，并且判定包服务数据的有效性（S112)。在包数据有效的情况中，PC 12前往步骤 S114的处理。另一方面，在包数据是已被篡改的数据的情况中，PC 12输出错误并且结束与 服务登记相关的系列处理。在前往步骤S114的处理的情况中，PC 12向安全设备14输入 服务包数据（Si 14)。</p>
    <p>[0161]	随后，安全设备14从PC 12输入的服务包数据解密原始服务数据（S116)。随后， 安全设备14将已被解密的服务数据存储在非易失性存储器204中（S118)。随后，PC 12和 安全设备14使系统服务失活（S120)，并且结束与服务登记相关的系列处理。此外，其中建 立PC 12和安全设备14之间的会话的状态被维持，直至系统服务失活，并且因此可以选择 另一一般服务并且继续将其登记在安全设备14中。</p>
    <p>[0162]	(3-4-2 ：系统服务激活处理的流程)</p>
    <p>[0163]	这里，将参照图10描述系统服务的激活处理的流程。图10是示出系统服务的激 活处理的流程的说明性示图。</p>
    <p>[0164]	如图10中所示，当系统服务的激活处理开始时，PC 12获取对应于系统服务的系 统服务认证退化密钥（S122)。随后，安全设备14搜索非易失性存储器204以寻找对应于系 统服务的服务数据，并且获取系统服务认证密钥（S124)。随后，安全设备14基于上文描述 的式（1)从所获取的系统服务认证密钥生成系统服务认证退化密钥（S126 ；参照图13)。</p>
    <p>[0165]	随后，PC 12和安全设备14通过使用各自已准备好的系统服务认证退化密钥（参 照图12)执行相互认证（S128、S130)。在相互认证成功的情况中，它们前往步骤S132的处</p>
    <p>20理，建立PC 12和安全设备14之间的会话（S132)，并且激活系统服务。另一方面，在相互认 证失败的情况中，输出错误并且结束与系统服务激活相关的系列处理。通过这种方式执行 系统服务的激活处理。</p>
    <p>[0166]	图10中示出的系统服务的激活处理可以被总结为图11中示出的简单的示意图。 图11是示意性地示出存储在安全设备14的非易失性存储器204中的服务数据的内容的说 明性示图。如图11中所示，包括系统服务数据的多个服务数据片段被存储在非易失性存储 器204中。当系统服务的激活处理开始时，安全设备14利用系统服务的服务代码Scsys作 为搜索密钥来搜索系统服务数据。当检测到服务代码Scsys的服务数据时，安全设备14提 取服务数据中包括的访问认证密钥信息Iaut广sys。</p>
    <p>[0167]	访问认证密钥信息Iauthsc;sys中包括系统服务认证密钥Usys和加密方案tauthsc;sys。 安全设备14首先通过使用系统服务认证密钥Kauthsc^来生成系统服务认证退化密钥 KdegescsysO系统服务认证退化密钥Kdeg广sys的生成方法如上文描述的式（1)中所示。当系统 服务认证退化密钥Kdeg广sys被生成时，安全设备14通过使用所生成的系统服务认证退化密 钥Kdeg^sys并且根据加密方案taut广sys执行与PC 12的相互认证。随后，当相互认证被建立 时，可以建立PC 12和安全设备14之间的会话（可以激活系统服务）。</p>
    <p>[0168]	当系统服务以这种方式被激活时，可以通过执行图9中示出的服务登记处理来将 一般服务登记在安全设备14中。此外，当一般服务的登记处理完成时，使系统服务失活，并 且取消PC 12和安全设备14之间的会话。在系统服务处于激活状态时，可以登记两个或更 多个一般服务。另一方面，当系统服务失活时，不能登记一般服务，并且在登记一般服务时 必须再次执行图10中示出的系统服务的激活处理。</p>
    <p>[0169](补充描述）</p>
    <p>[0170]	这里将补充系统服务的描述。如已描述的，系统服务是在安全设备14的在发货时 预先登记的特别服务。如上文所述，系统服务是在一般服务的登记时被激活的，并且承担防 止未授权的服务登记终端将未授权的数据写入安全设备14的非易失性存储器204或者防 止非易失性存储器204的内容被非有意地读取的任务。据此，不存在将由使用者执行的系 统服务的登记处理（参照图12)。</p>
    <p>[0171]	此外，系统服务的服务ID被固定到特定值（例如，0)。再者，多个不同版本的服务 数据片段将不会存储在非易失性存储器204中。此外，不能删除系统服务（参照图12)。然 而，系统服务可以改变（版本更新）。然而，多个系统服务不出现在非易失性存储器204中， 并且因此改变之前的系统服务将被擦除。改变系统服务的方法与改变一般服务的方法有如 此之多的相同点，并且因此在描述改变一般服务的方法时将进行详细描述。</p>
    <p>[0172]	到此为止，已描述了生物认证系统10的服务登记方法。如上文所述，通过生物认 证系统10，在登记一般服务时，系统服务的激活变得有必要。因此，可以防止恶意第三方将 未授权的数据登记在安全设备14中。再者，在向安全设备14提供一般服务的服务数据时， 服务数据被打包为服务登记终端和生物认证设备不能够解密的格式。因此，可以防止服务 数据内容被泄漏到其他服务提供商和恶意第三方。</p>
    <p>[0173]	&lt;4:服务激活〉</p>
    <p>[0174]	接着，将描述一般服务的激活处理。如上文所述，在登记一般服务时执行系统服务 的激活处理。另一方面，执行一般服务的激活处理以将一般服务置于可用状态。就是说，下面将描述的一般服务的激活处理是在例如激活生物认证服务时执行的，该生物认证服务是 在接受一般服务时执行的。然而，应当注意，在改变或删除一般服务时也执行一般服务的激 活处理。这将在后面描述。</p>
    <p>[0175]	&lt;4-1 =PC的功能配置（服务激活功能部分）&gt;</p>
    <p>[0176]	首先，将参照图6描述PC 12的功能配置中的用于提供服务激活功能的结构元件。 图6是示出PC 12的功能配置的示例的说明性示图。</p>
    <p>[0177]	如图6中所示，PC 12包括用于安全设备的通信单元102、用于网络的通信单元 106、一般服务退化密钥获取单元112和一般服务状态控制单元114，作为用于提供服务激 活功能的主要结构元件。此外，用于安全设备的通信单元102、一般服务退化密钥获取单元 112和一般服务状态控制单元114是相互认证单元的示例。</p>
    <p>[0178]	一般服务退化密钥获取单元112是用于从服务数据管理系统24获取用于在激活 一般服务时执行与安全设备14的相互认证的一般服务认证退化密钥的部件。一般服务认 证退化密钥是基于一般服务的服务数据中包括的服务认证密钥而生成的（在下文中，服务 认证密钥和服务数据被分别称为“一般服务认证密钥”和“一般服务数据”)。</p>
    <p>[0179]	这里，一般服务认证退化密钥由管理服务提供权威的服务管理权威（服务数据管 理系统24)生成或者由服务管理权威批准许可的安全设备14生成。例如，基于一般服务认 证密钥（Kaut广）和一般服务认证退化密钥函数屯，通过下面示出的式（4)来生成对应于一般 服务的服务ID(Sc)的一般服务认证退化密钥（Kdeg广）。一般服务认证退化密钥函数Cl1是 在服务管理权威批准许可之后提供的。</p>
    <p>[0180][等式	3]</p>
    <p>[0181]	Kdegesc = Cl1 (Kaut广）...(4)</p>
    <p>[0182]	一般服务退化密钥获取单元112经由用于网络的通信单元106获取上文描述的一 般服务认证退化密钥。一般服务退化密钥获取单元112获取的一般服务认证退化密钥被输 入到一般服务状态控制单元114。一般服务状态控制单元114是用于经由用于安全设备的 通信单元102与安全设备14通信以及用于执行相互认证和会话建立的部件。</p>
    <p>[0183]	当一般服务认证退化密钥被输入时，一般服务状态控制单元114尝试经由用于安 全设备的通信单元102进行与安全设备14的相互认证。当相互认证成功时，一般服务状态 控制单元114建立会话，并且将指示相互认证成功的通知信息（在下文中将被称为认证完 成通知）输入到已加密模板获取单元116。其中一般服务认证退化密钥的相互认证已成功 并且会话被建立的这种状态将被称为其中一般服务被激活的状态。</p>
    <p>[0184]	此外，当一般服务被激活时，一般服务状态控制单元114从安全设备14获取对应 于一般服务的模板加密密钥。随后，一般服务状态控制单元114获取的模板加密密钥被输 入到模板解密单元118。在使用一般服务时使用该模板加密密钥并且提供生物认证服务。 然而，在一般服务改变处理或者一般服务删除处理时执行的一般服务的激活处理中，认证 完成通知不被输入到已加密模板获取单元116，也不获取模板加密密钥。</p>
    <p>[0185]	PC 12以这种方式通过使用一般服务认证退化密钥来执行与安全设备14的相互 认证并且建立会话，并且获取模板加密密钥或者访问安全设备14的非易失性存储器204。 通过以这种方式执行PC 12和安全设备14之间的相互认证，可以防止恶意第三方对模板加 密密钥的未授权的获取或者对非易失性存储器204的未授权的访问。[0186]	&lt;4-2 ：安全设备的功能配置（服务激活功能部分）&gt;</p>
    <p>[0187]	接着，将参照图7描述安全设备14的功能配置中的用于提供服务激活功能的结构 元件。图7是示出安全设备14的功能配置的示例的说明性示图。</p>
    <p>[0188]	如图7中所示，安全设备14包括作为用于提供服务激活功能的主要结构元件的通 信单元202、非易失性存储器204、一般服务退化密钥生成单元212、和一般服务状态控制单 元214。此外，一般服务退化密钥生成单元212和一般服务状态控制单元214是相互认证单 元的示例。再者，一般服务退化密钥生成单元212是退化密钥生成单元的示例。此外，一般 服务数据被假设存储在非易失性存储器204中。</p>
    <p>[0189]	当一般服务的激活处理开始时，要被激活的一般服务的服务代码被从PC 12输入 到安全设备14。该服务代码经由通信单元202被输入到一般服务退化密钥生成单元212。 一般服务退化密钥生成单元212基于输入的服务代码从非易失性存储器204获取一般服务 数据中包括的一般服务认证密钥。随后，一般服务退化密钥生成单元212从一般服务认证 密钥生成一般服务认证退化密钥。一般服务认证退化密钥是基于上文提及的式（4)生成 的。这里假设服务管理权威已经提供了一般服务认证退化密钥函数屯。</p>
    <p>[0190]	一般服务退化密钥生成单元212生成的一般服务认证退化密钥被输入到一般服 务状态控制单元214。一般服务状态控制单元214是用于执行与PC 12的相互认证以激活 一般服务以及用于建立会话的部件。当一般服务认证退化密钥被输入时，一般服务状态控 制单元214通过使用所输入的一般服务认证退化密钥来执行与PC 12的相互认证，并且在 认证成功的情况中，经由通信单元202建立会话。</p>
    <p>[0191]	在使用一般服务时执行激活处理的情况中，一般服务状态控制单元214从非易失 性存储器204获取模板加密密钥，并且将其存储在可以由PC12读取的易失性存储器216 中。随后，在从PC 12接收到对模板加密密钥的获取请求的情况中，存储在易失性存储器 216中的模板加密密钥被读出并且经由通信单元202被提供给PC 12。另一方面，在改变或 删除一般服务时执行激活处理的情况中，一般服务状态控制单元214不执行将模板加密密 钥存储在易失性存储器216中的处理。</p>
    <p>[0192]	通过这种方式，安全设备14通过使用一般服务认证退化密钥执行与PC 12的相互 认证并且建立会话，并且随后提供模板加密密钥或者接受对非易失性存储器204的访问。 通过以这种方式执行PC 12和安全设备14之间的相互认证，可以防止恶意第三方对模板加 密密钥的未授权的获取或者对非易失性存储器204的未授权的访问。</p>
    <p>[0193]	&lt;4-3 ：服务数据管理系统的功能配置（服务激活功能部分）&gt;</p>
    <p>[0194]	接着，将参照图8描述服务数据管理系统24的功能配置中的用于提供服务激活功 能的结构元件。图8是示出服务数据管理系统24的功能配置的示例的说明性示图。</p>
    <p>[0195]	如图8中所示，服务数据管理系统24包括作为用于提供服务激活功能的主要结构 元件的通信单元302、存储单元304、和一般服务退化密钥生成单元312。系统服务和一般服 务的服务数据被存储在存储单元304中。</p>
    <p>[0196]	当一般服务的激活处理开始时，从PC 12输入一般服务的服务代码。经由通信单 元302将该服务代码输入到一般服务退化密钥生成单元312。一般服务退化密钥生成单元 312基于所输入的服务代码从存储单元304中存储的一般服务数据获取一般服务认证密 钥，并且基于上文提及的式（4)生成一般服务认证退化密钥。随后，经由通信单元302将一般服务退化密钥生成单元312生成的一般服务认证退化密钥提供给PC 12。</p>
    <p>[0197]	&lt;4-4 ：服务激活处理的流程&gt;</p>
    <p>[0198]	接着，将参照图14描述一般服务的激活处理的流程。图14是示出一般服务的激 活处理的流程的说明性示图。另外，在图14中，PC 12被称为服务登记终端。</p>
    <p>[0199]	如图14中所示，当一般服务的激活处理开始时，选择所期望的服务，并且PC 12获 取对应于所选择的一般服务的一般服务认证退化密钥（S142)。随后，PC 12向安全设备14 提供所选择的服务的服务代码（S144)。随后，安全设备14搜索非易失性存储器204以寻找 对应于所提供的服务代码的一般服务的服务数据，并且获取一般服务认证密钥（S146)。随 后，安全设备14基于上文提及的式（4)从所获取的一般服务认证密钥生成一般服务认证退 化密钥(S148 ；参照图20)。</p>
    <p>[0200]	接着，PC 12和安全设备14通过使用各自已准备好的一般服务认证退化密钥（参 照图19)执行相互认证（S150、S152)。在相互认证成功的情况中，它们前往步骤S154的处 理，建立PC 12和安全设备14之间的会话（S154)，并且激活一般服务。另一方面，在相互认 证失败的情况中，输出错误并且结束与一般服务激活相关的系列处理。通过这种方式执行 一般服务的激活处理。</p>
    <p>[0201]	图14中示出的一般服务的激活处理可以被总结为图15中示出的简单的示意图。 图15是示意性地示出存储在安全设备14的非易失性存储器204中的服务数据的内容的说 明性示图。如图15中所示，包括系统服务数据的多个服务数据片段被存储在非易失性存储 器204中。当一般服务的激活处理开始时，安全设备14利用所输入的服务代码，例如Sc2作 为搜索密钥来搜索一般服务数据。当检测到服务代码Sc2的服务数据时，安全设备14提取 服务数据中包括的访问认证密钥信息Iaut广2。</p>
    <p>[0202]	访问认证密钥信息Iauthse2中包括一般服务认证密钥Kaut广2和加密方案taut广2。安 全设备14首先通过使用一般服务认证密钥Kaut:2来生成一般服务认证退化密钥Kdeg广2。一 般服务认证退化密钥Kdeg广2的生成方法如上文提及的式（4)中所示。当一般服务认证退化 密钥Kdeg广2被生成时，安全设备14通过使用所生成的一般服务认证退化密钥Kdeg广2并且根 据加密方案tauthse2执行与PC 12的相互认证。随后，当相互认证成立时，可以建立PC 12和 安全设备14之间的会话（可以激活一般服务）。</p>
    <p>[0203]	如此，通过图14和15中示出的方法可以激活一般服务。这里，根据图14和15中 示出的激活处理，通过一个处理激活了一个服务。然而，当使大量的服务可用时，针对每个 服务执行图14和15中示出的处理是过于麻烦的。因此，期望一种同时激活多个服务的方 法。还期望在存在多个不同版本的服务的情况中同时激活服务。因此，还将给出关于同时 激活多个服务（在下文中将被称为组合激活）的方法的说明。</p>
    <p>[0204]	&lt;4-5 ：多个服务的同时激活&gt;</p>
    <p>[0205]	这里将描述同时激活多个服务的方法。此外，在组合激活时，改变一般服务认证退 化密钥的生成方法。因此，改变安全设备14的一般服务退化密钥生成单元212和服务数据 管理系统24的一般服务退化密钥生成单元312的功能。首先，将描述改变的细节。</p>
    <p>[0206]	基于上文提及的式（4)，通过向一般服务认证退化密钥函数Cl1输入一般服务认证 密钥，获得了与单个服务相关的一般服务认证退化密钥。然而，在同时激活多个服务的情况 中，使用下式（5)和（6)中示出的用于服务合成的退化密钥函数(12和复合服务认证退化密钥函数d3(参照图20)。同样，通过下式（6)获得的复合服务认证退化密钥用于PC 12和安 全设备14之间执行的相互认证。</p>
    <p>[0207]	例如，将考虑从对应于服务代码Sc1和Sc2的一般服务认证密钥Kaut广1和Kaut广2生 成复合服务认证退化密钥Kdeg广i’sc2的方法。这里，假设存在对应于服务代码Sc1和Sc2的 服务之间的主次关系，并且具有服务代码scl的服务是主要的，而具有服务代码Sc2的服务 是次要的。</p>
    <p>[0208]	首先，对应于主要服务的一般服务认证密钥Kaut广1被输入到服务认证退化密钥函 数Cl1,并且如上文提及的式（4)中所示生成服务认证退化密钥Kdeg广\随后，对应于次要服 务的一般服务认证密钥Kaut广2被输入到用于服务合成的退化密钥函数d2，并且如下式（5) 中所示生成用于服务合成的退化密钥K。。：2。随后，将对应于主要服务的服务认证退化密钥 Kdegescl和对应于次要服务的用于服务合成的退化密钥K。。mpsc;2输入到复合服务认证退化密钥 函数d3，并且如下式（6)中所示生成复合服务认证退化密钥Kdeg广i’sc;2。</p>
    <p>[0209][等式	4]</p>
    <div class="patent-image small-patent-image"> <a href="//patentimages.storage.googleapis.com/CN101958795A/CN101958795AD00251.png"> <img id="idf0001" file="CN101958795AD00251.tif" img-content="drawing" img-format="tif" src="//patentimages.storage.googleapis.com/CN101958795A/CN101958795AD00251.png" class="patent-full-image" alt="Figure CN101958795AD00251"> </a> </div>
    <p>[0212]	这里，用于服务合成的退化密钥和复合服务认证退化密钥由管理服务提供权限的 服务管理权威（服务数据管理系统24)生成或者由服务管理权威批准许可的安全设备14 生成。此外，系统被配置为，使得提供次要服务的提供商承担生成用于服务合成的退化密钥 的任务，而提供主要服务的提供商承担生成复合服务认证退化密钥的任务。</p>
    <p>[0213]	此时，次要服务的提供商仅向主要服务的提供商提供用于服务合成的退化密钥， 不提供关于与次要服务相关的一般服务认证密钥的信息。该机制使得能够在其中服务提供 商彼此不了解服务认证密钥的状态中生成复合服务认证密钥。然而，作为前提，将提供如下 机制，根据该机制，不能从用于服务合成的退化密钥反向计算原始一般服务认证密钥。</p>
    <p>[0214]	到此为止，已描述了用于组合激活处理的复合服务认证退化密钥的生成方法。在 提供组合激活的功能的情况中，基于上文提及的式（5)和（6)生成复合服务认证退化密钥 的功能被添加到安全设备14的一般服务退化密钥生成单元212和服务数据管理系统24的 一般服务退化密钥生成单元312。</p>
    <p>[0215]	(4-5-1 ：不同服务的同时激活）</p>
    <p>[0216]	接着，将参照图16描述通过使用上文描述的复合服务认证退化密钥执行组合激 活时的处理的流程。图16是示出组合激活处理的流程的说明性示图。此外，在图16中，PC 12被称为服务登记终端。</p>
    <p>[0217]	如图16中所示，当一般服务的组合激活处理开始时，在PC 12处选择要被激活 的多个服务（S162)。随后，PC 12获取关于所选择的一般服务的复合服务认证退化密钥 (S164)。随后，PC 12向安全设备14提供所选择的服务的服务代码（S166)。随后，安全设 备14在非易失性存储器204内搜索对应于已提供的服务代码的一般服务的服务数据片段， 并且获取一般服务认证密钥（S168)。随后，安全设备14基于上文提及的式（4)和（5)从所 获取的一般服务认证密钥生成一般服务认证退化密钥和用于服务合成的退化密钥（S170 ； 参照图20)。</p>
    <p>[0218]	随后，安全设备14基于上文提及的式（6)，通过使用一般服务认证退化密钥和用</p>
    <p>25于服务合成的退化密钥生成复合服务认证退化密钥（S172)。随后，PC 12和安全设备14通 过使用各自已准备好的复合服务认证退化密钥（参照图19)执行相互认证（S174、S176)。 在相互认证成功的情况中，它们前往步骤S178的处理，建立PC 12和安全设备14之间的会 话（S178)，并且同时激活所选择的多个一般服务。另一方面，在相互认证失败的情况中，输 出错误并且结束与服务的组合激活相关的系列处理。通过这种方式执行服务的组合激活处 理。</p>
    <p>[0219]	图16中示出的服务的组合激活处理可以被总结为图17中示出的简单的示意图。 图17是示意性地示出存储在安全设备14的非易失性存储器204中的服务数据的内容的说 明性示图。如图17中所示，包括系统服务数据的多个服务数据片段被存储在非易失性存储 器204中。当服务的组合激活处理开始时，安全设备14利用例如已输入的服务代码scl和 sc2作为搜索密钥来搜索一般服务数据。</p>
    <p>[0220]	这里，假设具有服务代码SC1的服务是主要的，而具有服务代码SC2的服务是次要 的。当检测到服务代码SC1和SC2的服务数据时，安全设备14提取服务数据中包括的访问 认证密钥信息IautlT1和iauths。2。访问认证密钥信息U1中包括一般服务认证密钥U1 和加密方案taut广1O访问认证密钥信息Iaut:2中包括一般服务认证密钥Kaut广2和加密方案</p>
    <p>, sc2 ^auth °</p>
    <p>[0221 ] 首先，安全设备14通过使用一般服务认证密钥Kaut广1生成一般服务认证退化密钥 KdegesclO 一般服务认证退化密钥Kde:1的生成方法如上文提及的式（4)中所示。接着，安全 设备14通过使用一般服务认证密钥Kaut:2生成用于服务合成的退化密钥K。。mpsc;2。用于服 务合成的退化密钥K。。mpsc;2的生成方法如上文提及的式（5)中所示。当一般服务认证退化密 钥Kdeg广1和用于服务合成的退化密钥K。。mpsc;2被生成时，安全设备14基于上文提及的式（6) 生成复合服务认证退化密钥Kdeg广i’se2。</p>
    <p>[0222]	随后，通过使用已生成的复合服务认证退化密钥Kdeg广i’sc2,安全设备14根据主要 服务的加密方案taut广1来执行与PC 12的相互认证。随后，当相互认证成立时，可以建立PC 12和安全设备14之间的会话（服务的组合激活）。此时，对应于服务代码Sc1和Sc2的两 个一般服务被同时激活，并且因此这两个一般服务被置于可用状态。例如，服务代码SC1的 模板加密密钥和服务代码SC2的模板加密密钥被同时置于可用状态。此外，尽管这里描述 了两个服务的组合激活方法，但是通过同一方式，三个或更多个服务的组合激活也是可能 的（参照图19和20)。</p>
    <p>[0223]	(4-5-2 ：不同版本的同时激活）</p>
    <p>[0224]	已描述了同时激活多个服务的组合激活方法。该方法还可以用作同时激活具有同 一服务ID但是具有不同版本的多个服务的方法。这里将参照图18描述关于多个版本的同 时激活方法。</p>
    <p>[0225]	如上文已描述的，服务代码由服务ID和版本信息形成。据此，可以存在具有同一 服务ID但是具有不同版本信息的服务数据片段。例如，假设对于服务代码Sc1，服务ID是 Id1并且版本信息是V1,而对于服务代码sc2，服务ID是Id1并且版本信息是v2。并且考虑 其中服务代码SC1和SC2将被同时激活的情况。在该情况中，由于服务的内容是相同的，因 此不存在服务数据片段之间的主次关系。据此，根据特定的规则，一个被设定为主要的而另 一个被设定为次要的，并且按照与上文描述的组合激活方法相同的方式生成复合服务认证退化密钥。</p>
    <p>[0226]	例如，具有服务代码SC1的服务（版本信息=V1)被设定为主要的，而具有服务代 码SC2的服务（版本信息=V2)被设定为次要的。在该情况中，基于上文提及的式（4)从一 般服务认证密钥Kaut广1生成一般服务认证退化密钥Kdeg广S并且基于上文提及的式（5)从 一般服务认证密钥Kaut广2生成用于服务合成的退化密钥K。。mpsc;2。随后，从一般服务认证密 钥Kaut广1和用于服务合成的退化密钥K。。：2生成复合服务认证退化密钥Kde:1' %2。随后， 根据服务代码Sc1的加密方案taut广1来执行相互认证。</p>
    <p>[0227]	如所描述的，可以同时激活具有同一服务ID和不同版本的多个服务。此外，这里 已描述了同时激活两个具有不同版本的服务的方法，但是通过同一方式，也可以同时激活 三个或更多个具有不同版本的服务（参照图19和20)。</p>
    <p>[0228]	&lt;5.生物认证〉</p>
    <p>[0229]	到此为止，已描述了在使用一般服务时使用的一般服务数据的登记方法以及一般 服务的激活方法。再者，其中已描述了系统服务的激活方法和系统服务的任务。在下文中， 描述在其中一般服务被激活的状态中执行的生物认证服务提供方法。</p>
    <p>[0230]	&lt;5-1 =PC的功能配置（生物认证功能部分）&gt;</p>
    <p>[0231]	首先，将参照图6描述PC 12的功能配置中的与生物认证服务提供功能相关的结 构元件。图6是示出PC 12的功能配置的示例的说明性示图。</p>
    <p>[0232]	如图6中所示，PC 12包括作为与生物认证服务提供功能相关的主要结构元件的 用于安全设备的通信单元102、用于网络的通信单元106、一般服务退化密钥获取单元112、 一般服务状态控制单元114、已加密模板获取单元116、模板解密单元118、模板检查单元 120和生物图案获取单元122。再者，PC 12进一步包括服务提供单元124，用于在生物认证 成功的情况中提供特定服务。服务提供单元124用于提供例如万维网服务等。此外，生物 图案获取单元122是生物信息获取单元的示例。再者，模板检查单元120是生物认证单元 的示例。</p>
    <p>[0233]	在生物认证系统10中，提供用于每个服务的已加密模板。据此，使用者必须通过 使用生物认证来选择将使其可用的一般服务。首先，PC 12经由用于安全设备的通信单元 102向使用者呈现关于登记在安全设备14中的一般服务的信息。使用者通过参照所呈现的 关于一般服务的信息来选择所期望的服务。然而，如果PC 12可以激活的服务是固定的，则 自动选择服务。当服务被选择时，PC 12激活该服务。一般服务的激活方法如上文所述。</p>
    <p>[0234]	当一般服务的激活处理完成时，将认证完成通知从一般服务状态控制单元114输 入到已加密模板获取单元116。当认证完成通知被输入时，已加密模板获取单元116经由用 于网络的通信单元106向连接到网络30的模板管理系统26传送服务代码，并且获取对应 于该服务代码的已加密模板。已加密模板获取单元116获取的已加密模板被输入到模板解 密单元118。</p>
    <p>[0235]	此外，经由用于安全设备的通信单元102从安全设备14获取模板加密密钥，并且 将其输入到一般服务状态控制单元114。随后，输入到一般服务状态控制单元114的模板加 密密钥被输入到模板解密单元118。模板解密单元118通过使用从一般服务状态控制单元 114输入的模板加密密钥从已加密模板获取单元116输入的已加密模板解密原始模板。随 后，已由模板解密单元118解密的模板被输入到模板检查单元120。[0236]	此外，要对比模板进行检查的使用者的生物图案信息被从生物图案获取单元122 输入到模板检查单元120。生物图案获取单元122主要包括成像单元和图像处理单元。生 物图案获取单元122通过使用成像单元拍摄特定身体部位的图像并且使用图像处理单元 对所拍摄的图像数据执行特定的图像处理，生成可以与模板比较的生物图案信息。例如，使 用者的手指的静脉图案由生物图案获取单元122拍摄并且对所摄取的数据执行二值化和 特定的转换处理，并且生成生物图案信息。此外，还可以在图像处理单元处执行特定的压缩 编码处理。</p>
    <p>[0237]	当已解密模板和生物图案信息被输入时，模板检查单元120彼此对比地检查模板 和生物图案信息，并且判定它们是否彼此匹配达到某个水平或更高。在它们的匹配程度在 某个水平以上的情况中，模板检查单元120判定生物认证成功，并且向服务提供单元124输 入指示生物认证成功的生物认证结果。当生物认证结果被输入时，服务提供单元124开始 提供使用者所期望的服务。另一方面，在它们的匹配程度低于某个水平的情况中，模板检查 单元120在已判定生物认证失败的情况下输出错误。</p>
    <p>[0238]	如上文所述，在生物认证系统10中，针对每个服务管理已加密模板。并且除非使 用者希望使用的服务被激活，否则不能使用该服务。再者，为了激活服务，必须建立与安全 设备14的相互认证。根据该配置，即使某个服务的模板加密密钥被暴露，仍不会影响其他 服务。此外，利用适当管理的模板加密密钥，不需要在防篡改设备中管理已加密模板本身， 使得例如可以将已加密模板存储在网络上的服务器中或者由个人持有的电子设备中。</p>
    <p>[0239]	&lt;5-2 ：生物认证设备的功能配置&gt;</p>
    <p>[0240]	现在，上述PC 12是包括服务登记终端的功能和生物认证设备的功能的设备。然 而，并非所有生物认证设备必须配备有服务登记终端的功能。例如，图2中所示的影印机 16、进入/退出管理设备18、自动贩卖机20等可以仅配备有提供生物认证服务的功能。在 该情况中，影印机16、进入/退出管理设备18、自动贩卖机20等中装备的生物认证设备的 功能配置如图21中所示。在下文中，将参照图21描述影印机16、进入/退出管理设备18、 自动贩卖机20等中装备的生物认证设备的功能配置。</p>
    <p>[0241]	如图21中所示，根据本实施例的生物认证设备主要包括用于安全设备的通信单 元402、一般服务状态控制单元404、一般服务退化密钥获取单元406、用于网络的通信单元 408、已加密模板获取单元410、模板解密单元412、模板检查单元414、生物图案获取单元 416和服务提供单元418。服务提供单元418用于提供影印服务、进入/退出管理服务、自 动贩卖服务等。此外，生物图案获取单元416是生物信息获取单元的示例。再者，模板检查 单元414是生物认证单元的示例。</p>
    <p>[0242]	当生物认证服务开始时，一般服务退化密钥获取单元406首先经由用于网络的通 信单元408从服务数据管理系统24获取一般服务认证退化密钥。随后，一般服务退化密钥 获取单元406获取的一般服务认证退化密钥被输入到一般服务状态控制单元404。此外，当 通过生物认证设备可以使用的服务的数目被设定为1时，服务的服务代码被自动地从用于 网络的通信单元408传送到服务数据管理系统24，并且对应于该服务代码的一般服务认证 退化密钥被获取。此外，服务代码还经由用于安全设备的通信单元402被输入到安全设备 14。</p>
    <p>[0243]	当一般服务认证退化密钥被输入时，一般服务状态控制单元404尝试通过使用已输入的一般服务认证退化密钥进行与安全设备14的相互认证。当相互认证失败时，一般服 务状态控制单元404输出错误。例如，在生物认证设备提供给安全设备14的服务的服务数 据未被登记或者未授权的情况中，相互认证失败。另一方面，当相互认证成功时，一般服务 状态控制单元404经由用于安全设备的通信单元402建立与安全设备14的会话。进一步， 由于对应于服务的模板加密密钥在安全设备14处变得可用，因此一般服务状态控制单元 404从安全设备14获取模板加密密钥。</p>
    <p>[0244]	随后，一般服务状态控制单元404向已加密模板获取单元410输入指示相互认证 的成立的认证完成通知，并且还向模板解密单元412输入从安全设备14获取的模板加密密 钥。当认证完成通知被输入时，已加密模板获取单元410经由用于网络的通信单元408从 模板管理系统26获取已加密模板。随后，已加密模板获取单元410获取的已加密模板被输 入到模板解密单元412。当模板加密密钥和已加密模板被输入时，模板解密单元412使用所 输入的模板加密密钥，并且从所输入的已加密模板解密原始模板。</p>
    <p>[0245]	已由模板解密单元412解密的模板被输入到模板检查单元414。另一方面，在生物 图案获取单元416处从使用者的特定身体部位获取生物图案信息。生物图案获取单元416 获取的生物图案信息被输入到模板检查单元414。当以这种方式输入模板和生物图案信息 时，模板检查单元414彼此对比地检查所输入的模板和生物图案信息，并且判定它们是否 彼此匹配达到某个水平或更高。</p>
    <p>[0246]	在它们的匹配程度在某个水平以上的情况中，模板检查单元414判定生物认证成 功，并且向服务提供单元418输入指示生物认证成功的生物认证结果。当生物认证结果被 输入时，服务提供单元418开始提供特定的服务。另一方面，在它们的匹配程度落在某个水 平以下的情况中，模板检查单元414输出错误，生物认证已被判定为失败。如描述的，不同 于上文描述的PC 12，生物认证设备是仅提供生物认证服务的设备。然而，生物认证服务提 供功能与PC 12的生物认证服务提供功能相同。</p>
    <p>[0247]	&lt;5-3 ：模板管理系统的功能配置（生物认证功能部分)&gt;</p>
    <p>[0248]	这里，将参照图22描述模板管理系统26的功能配置。图22是示出模板管理系统 26的主要功能配置的说明性示图。模板管理系统26是用于管理已加密模板的部件。出于 该目的，如图22中所示，模板管理系统26主要包括通信单元502、模板加密单元504和已加 密模板存储单元506。</p>
    <p>[0249]	通信单元502是用于经由网络30通信的部件。在生物认证系统10中，通信单元 502主要用于向每个生物认证设备提供已加密模板。模板加密单元504是用于对已通过使 用模板登记终端28登记的模板进行加密的部件。在模板加密单元504处使用的模板加密 密钥由服务数据管理系统24(参照图2)提供。此时，用于每个服务的模板加密密钥被提供 给模板加密单元504。</p>
    <p>[0250]	当从模板登记终端28输入模板时，例如，模板加密单元504利用用于每个服务的 模板加密密钥对输入模板进行加密，并且创建对应于每个服务的已加密模板。当然，还可以 对用于每个服务的登记模板进行加密，但是随着服务数目的增加，该操作会增加使用者登 记模板的负担。因此，更高效的是，如上文所述通过使用一次输入的模板来创建用于每个服 务的加密模板。以这种方式由模板加密单元504创建的已加密模板被存储在已加密模板存 储单元506中。</p>
    <p>29[0251]	此外，已加密模板存储单元506不必是防篡改的。如所描述的，在生物认证系统10 中，除非单独的服务被激活，否则不能使用模板加密密钥。因此，即使包服务数据或已加密 模板暴露于恶意第三方，仍不能从已加密模板解密原始模板。因此，不同于如图1中示出的 一般的生物认证设备，利用根据本实施例的生物认证系统10，已加密模板不必存储在防篡 改存储器中。</p>
    <p>[0252]	现在，在提供生物认证服务时，经由通信单元502将存储在已加密模板存储单元 506中的已加密模板提供给生物认证设备。如已描述的，通过使用用于每个服务的模板加密 密钥已被加密的已加密模板被保存在模板管理系统26中。再者，在提供生物认证服务时， 模板管理系统26将其中保存的已加密模板提供给生物认证设备。通过该配置，免去了使用 者去往为各个服务提供的生物认证设备的安装位置以登记模板的麻烦。</p>
    <p>[0253]	&lt;5-4 ：生物认证处理的流程&gt;</p>
    <p>[0254]	这里，将参照图23描述生物认证系统10的生物认证处理的流程。图23是示出生 物认证系统10的生物认证处理的流程的说明性示图。</p>
    <p>[0255]	如图23中所示，当开始提供生物认证服务时，尝试生物认证设备和安全设备14之 间的服务的激活处理（S182、S184)。当服务的激活处理成功时，它们前往步骤S186的处理， 执行已加密模板的解密（S186)。此时，生物认证设备从模板管理系统26获取已加密模板， 并且还从安全设备14获取模板加密密钥，并且随后从已加密模板解密原始模板。当模板被 解密并且从使用者的身体部位获取了生物图案信息时，由生物认证设备彼此对比地检查模 板和生物图案信息（S188、S190)。</p>
    <p>[0256]	在生物认证成功的情况中，它们前往步骤S192的处理，由生物认证设备执行服务 失活处理（S192)，并且结束生物认证系列处理。另一方面，在生物认证失败的情况中，生物 认证设备输出错误并且结束生物认证系列处理。此外，当执行服务失活处理时，取消生物认 证设备和安全设备14之间的会话，再者，禁止对应于服务的已加密模板的解密。例如，擦除 存储在安全设备14的易失性存储器216中的模板加密密钥。此外，在安全设备14的供电 停止的情况中也使服务失活。</p>
    <p>[0257]	到此为止，已描述了与提供生物认证服务相关的系列处理的流程。</p>
    <p>[0258]	&lt;6:服务的改变/删除〉</p>
    <p>[0259]	接着，将描述存储在安全设备14的非易失性存储器204中的一般服务的改变处理 和删除处理。</p>
    <p>[0260]	&lt;6-1 ：服务改变处理的流程&gt;</p>
    <p>[0261]	首先，将参照图24和25描述一般服务改变处理。图24是示出与一般服务的改变 相关的处理的概要的说明性示图。再者，图25是示出与一般服务的改变相关的处理的流程 的说明性示图。</p>
    <p>[0262]	一般服务改变处理包括获取新的服务数据的步骤和将新的服务数据写入非易失 性存储器204中的步骤。首先，由服务数据管理系统24准备新的服务数据（Ss。n&#8482;)。如同 上文描述的服务数据登记处理，新的服务数据由服务数据管理系统24打包，并且以包服务 数据（Ps。n&#8482;)的形式被提供给安全设备14。此时，用于服务改变的打包函数（p2 ；参照图20) 用于对新的服务数据进行打包。</p>
    <p>[0263]	当包服务数据被提供时，在安全设备14处从包服务数据解密新的服务数据Ss。n&#8482;。随后，提取已被解密的新的服务数据中包括的服务ID，并且在非易失性存储器204内搜索 具有与上述服务ID相同的服务ID的服务数据。当在非易失性存储器204内检测到具有同 一服务ID的旧的服务数据时，安全设备14比较新的服务数据的版本信息和旧的服务数据 的版本信息。当作为比较结果确认新的服务数据的版本较新时，安全设备14将新的服务数 据存储在非易失性存储器204中。</p>
    <p>[0264]	新的服务数据以这种方式被存储在安全设备14的非易失性存储器204中。然而， 如同服务数据登记处理，在获取包服务数据时执行服务激活处理。再者，在将新的服务数据 存储在非易失性存储器204中之后，使服务失活。接着，将描述包括该服务激活/失活处理 的服务数据改变处理的流程。</p>
    <p>[0265]	将参照图25。首先，当服务改变处理开始时，执行服务激活处理（S202、S204)。这 里，类似登记服务的时候，通过图14中所示的方法激活服务。在服务激活失败的情况中，PC 12输出错误并且结束服务改变处理。在服务激活成功的情况中，它们前往步骤S206的处 理，新的包服务数据由PC 12获取并且被提供给安全设备14(S206)。接着，安全设备14从 新获取的包服务数据解密新的服务数据（S208)。</p>
    <p>[0266]	随后，安全设备14参照已被解密的新的服务数据的服务ID，在非易失性存储器 204内搜索具有同一服务ID的服务数据，并且检查旧的服务数据的存在（S210、S212)。在 不存在旧的服务数据的情况中，不执行服务数据的更新。然而，替代被更新，服务数据可以 是新登记的，并且系列处理可以被组织以便结束于将所获取的服务数据写入非易失性存 储器204。另一方面，在存在旧的服务数据的情况中，安全设备14将新的服务数据的版本 (Vernew)与旧的服务数据的版本(Verold)比较（S214、S216)。</p>
    <p>[0267]	在Vernew &gt; Verold的情况中，安全设备14前往步骤S218的处理，将新的服务数据 写入到非易失性存储器204中（S218)。另一方面，在Vermw &lt;Ver。ld的情况中，安全设备 14不将新的服务数据写入到非易失性存储器204中，并且结束服务数据更新处理。当步骤 S218的处理完成时，PC 12和安全设备14之间的会话被取消，并且使服务失活（S220)。随 后，结束与服务改变相关的系列处理。</p>
    <p>[0268]	到此为止，已描述了一般服务的改变处理。</p>
    <p>[0269](系统服务的改变)</p>
    <p>[0270]	对于系统服务的改变处理，执行基本上相同的处理。一般服务和系统服务之间的 最大差异在于系统服务不允许多个版本的存在。因此，在更新系统服务的情况中，在写入新 的系统服务数据之后擦除旧的系统服务数据。如果在新的系统数据已被写入但是旧的系 统服务数据仍未被擦除的情形中出现关机等，则可以临时出现其中存在多个系统服务的情 形。因此，在其中在复原系统时在非易失性存储器204内存在多个系统服务数据片段的情 况中，执行如下处理：在保持最新版本的系统服务数据的同时立刻擦除旧的服务数据。此 外，在改变系统服务时使用的用于系统服务改变的打包函数（Po;参照图13)用于打包时使 用的打包函数。</p>
    <p>[0271]	&lt;6-2 ：服务删除处理的流程&gt;</p>
    <p>[0272]	接着，将参照图26描述服务数据删除处理。图26是示出与服务数据的删除相关 的处理的流程的说明性示图。</p>
    <p>[0273]	如图26中所示，当服务数据删除处理开始时，激活作为删除目标的服务（S222、S224)。当服务激活失败时，输出错误并且结束与服务数据的删除相关的系列处理。另一方 面，当服务激活成功时，处理前往步骤S226，安全设备14删除存储在非易失性存储器204中 的删除目标服务数据（S226)。当服务数据删除处理完成时，使在步骤S222中已激活的服务 失活（S228)，并且结束与服务删除相关的系列处理。</p>
    <p>[0274]	到此为止，已描述了一般服务数据删除处理。此外，不允许删除系统服务数据。</p>
    <p>[0275]	&lt;7 ：模板登记&gt;</p>
    <p>[0276]	到此为止，已经针对已加密模板被登记在模板管理系统26中的假设进行了描述。 这里，将简要地描述模板登记处理。</p>
    <p>[0277]	&lt;7-1 ：模板登记终端的功能配置&gt;</p>
    <p>[0278]	首先，将参照图27描述模板登记终端28的功能配置。图27是示出模板登记终端 28的功能配置的示例的说明性示图。</p>
    <p>[0279]	如图27中所示，模板登记终端28主要包括生物图案获取单元602和通信单元 604。此外，生物图案获取单元602包括成像单元612和图像处理单元614。</p>
    <p>[0280]	生物图案获取单元602是用于从使用者的身体部位获取生物图案以及用于创建 模板的部件。再者，成像单元612是用于拍摄特定身体部位的图像以及用于获取生物图案 的图像数据的部件。例如，成像单元612在特定身体部位上照射近红外光，并且接收已在身 体内反射的照射光的反射光。此外，成像单元612对其内提供的图像传感器所接收到的反 射光进行光电转换，并且生成所拍摄的图像的模拟信号。随后，成像单元612将该模拟信号 转换为数字信号，并且输出生物图案的图像数据。如该示例描述的，通过使用近红外光，可 以检测身体内的静脉图案，并且成像单元612可以获得静脉图案的图像数据。</p>
    <p>[0281]	从成像单元612输出的生物图案的图像数据被输入到图像处理单元614。在图像 处理单元614处对图像数据执行特定的图像处理。例如，在输入具有色调或色阶的图像数 据的情况中，对图像数据执行二值化处理。此外，对通过二值化处理获得的二值化图像数据 执行诸如空间变换的处理，从而使图像数据具有允许容易地与模板比较的形式。例如，在静 脉图案被用作生物图案的情况中，二值化图像数据被转换为投影到哈夫（Hough)空间中的 模板数据。例如，由于静脉图案是各向异性的，因此通过使用投影到Hough空间中的数据可 以改进图案的匹配精度。</p>
    <p>[0282]	如所描述的，根据所使用的生物图案的类型执行适当的转换处理，并且输出图像 数据作为模板数据。从图像处理单元614输出的模板数据经由通信单元604被输入到模板 管理系统26。存储被输入到模板管理系统26的模板数据，如上文所述针对每个服务对其进 行了加密。据此，一旦执行利用模板管理系统26的登记，使用者能够在不必去往每个生物 认证设备的安装位置以及不必登记模板的情况下接受所期望的生物认证。</p>
    <p>[0283]	&lt;7-2 ：模板登记处理的流程&gt;</p>
    <p>[0284]	根据上文描述的模板登记方法，在服务器（服务数据管理系统24、模板管理系统 26)处创建用于每个服务的已加密模板。该配置的优点在于使用者不必知道服务。就是说， 由于用于每个服务的已加密模板是针对服务数据管理系统24所管理的服务自动创建的， 因此使用者此时不必考虑未来将使用的服务。</p>
    <p>[0285]	然而，如图28中所示，如下配置也是可能的，根据该配置，可以仅登记用于安全设 备14中已登记的服务的已加密模板。因此，将参照图28描述关于如下情况的模板登记方法，其中仅允许登记用于安全设备14中已登记的服务的已加密模板。然而，为了执行该方 法，需要可以通过其执行服务激活/失活处理的终端。例如，使用配备有PC 12的部分功能 的模板登记终端28，该部分功能被提供用于执行服务激活/失活处理。</p>
    <p>[0286]	如图28中所示，当开始模板登记处理时，使用者首先激活对应于将被登记的模板 的服务（S232、S234)。服务的激活由图14中示出的方法执行。在服务激活失败的情况中，输 出错误并且结束模板登记处理。另一方面，在服务激活成功的情况中，处理前往步骤S236， 创建模板（T) (S236)。接着，通过服务数据中包括的模板加密密钥信息对步骤S236中创建 的模板进行加密，并且创建已加密模板（Tene) (S238)。接着，在输出已加密模板Tene(S240) 之后，使服务失活（S242)，并且结束与模板登记相关的系列处理。以这种方式可以登记已加 密模板。此外，在图3中图示的生物认证系统50中，模板登记终端的功能是在PC 52中提 供的，并且因此图28中示出的模板登记方法是适当的。</p>
    <p>[0287]	&lt;8 ：模板加密密钥的交换&gt;</p>
    <p>[0288]	接着，将参照图29描述模板加密密钥的交换处理。在执行服务更新处理的情况 中，对应于服务的模板加密密钥有时也可能被更新。在该情况中，如果旧版本的服务仍然存 在，则利用旧版本的模板加密密钥解密的模板可以被解密，但是如果旧版本的服务不再存 在，则解密是不可能的。因此，将参照图29具体描述当更新模板加密密钥时执行的模板加 密密钥的重锁（relocking)处理（交换处理）。</p>
    <p>[0289]	如图29中所示，首先，旧的服务sc。ld和新的服务Scnew均被激活（S252、S254)。在 两个服务的激活均失败的情况中，输出错误并且结束与模板加密密钥的交换相关的系列处 理。另一方面，在两个服务的激活均成功的情况中，处理前往步骤S256。在步骤S256中，基 于旧的服务数据中包括的模板加密密钥信息对模板（T)进行解密（S256)。随后，通过使用 新的服务数据中包括的模板加密密钥信息对已被解密的模板T进行加密（S258)。随后，输 出利用新的模板加密密钥信息进行加密的模板（S260)。随后，使服务失活（S262)，并且结 束与模板加密密钥的交换相关的系列处理。由于已加密模板交换为新的已加密模板，因此 可以删除旧的模板加密密钥信息。</p>
    <p>[0290]	此外，上述处理可以在保存多个已加密模板的模板管理系统26 (和服务数据管理 系统24)处被批量处理。此外，在使用已加密模板执行生物认证时，利用旧的服务的模板加 密密钥进行加密的模板可以可选地在生物认证成功时被重新加密并且输出。</p>
    <p>[0291]	到此为止，已详细描述了根据本实施例的已加密模板和模板加密密钥的管理方 法。通过使用这些方法，在生物认证设备外部管理模板，并且提供了安全的和高度便利的生 物认证服务。最后，将描述用于实现生物认证系统10和50中包括的各个设备的功能以及 系统的功能的硬件配置的示例。</p>
    <p>[0292]	&lt;9 ：硬件配置&gt;</p>
    <p>[0293]	例如通过使用图30中示出的信息处理装置的硬件配置，可以实现上述生物认证 系统10和50中包括的每个设备的功能以及系统的功能。就是说，通过使用计算机程序控 制图30中示出的硬件来实现功能。该硬件的模式是任意的，并且可以是个人计算机，诸如 移动电话、PHS或PDA的移动信息终端，游戏机，或者各种类型的信息电器。而且，PHS是个 人手持式电话系统的缩写。再者，PDA是个人数字助理的缩写。</p>
    <p>[0294]	如图30中所示，该硬件主要包括CPU 902、ROM 904、RAM 906、主机总线908和桥</p>
    <p>33接器910。此外，该硬件包括外部总线912、接口 914、输入单元916、输出单元918、存储单元 920、驱动器922、连接端口 924和通信单元926。而且，CPU是中央处理单元的缩写。再者， ROM是只读存储器的缩写。此外，RAM是随机存取存储器的缩写。</p>
    <p>[0295]	CPU 902用作例如算术处理单元或控制单元，并且基于ROM 904、RAM 906、存储单 元920或可拆卸记录介质928上记录的各种程序来控制每个结构元件的整体操作或部分操 作。ROM 904是用于存储例如，要加载在CPU 902上的程序或者算术运算中使用的数据等的 部件。RAM 906临时地或永久地存储例如，要加载在CPU 902上的程序或者在程序执行时任 意改变的各种参数等。</p>
    <p>[0296]	这些结构元件通过例如，能够执行高速数据传送的主机总线908彼此连接。一方 面，例如，主机总线908通过桥接器910连接到数据传送速度相对低的外部总线912。此外， 输入单元916是例如，鼠标、键盘、触摸板、按钮、开关或控制杆。再者，输入单元916可以是 遥控器，其可以通过使用红外线或其他无线电波来传送控制信号。</p>
    <p>[0297]	输出单元918是例如，诸如CRT、IXD、PDP或ELD的显示设备，诸如扬声器或耳机的 音频输出设备，打印机，移动电话或传真机，它们可以视觉地或听觉地向使用者通知所获取 的信息。而且，CRT是阴极射线管的缩写。IXD是液晶显示器的缩写。PDP是等离子体显示 板的缩写。再者，ELD是电致发光显示器的缩写。</p>
    <p>[0298]	存储单元920是用于存储各种数据的设备。存储单元920是例如，诸如硬盘驱动 器（HDD)的磁存储设备、半导体存储设备、光存储设备或者磁_光存储设备。HDD是硬盘驱 动器的缩写。</p>
    <p>[0299]	驱动器922是读取记录在诸如磁盘、光盘、磁-光盘或半导体存储器的可拆卸记录 介质928上的信息，或者将信息写入可拆卸记录介质928的设备。可拆卸记录介质928是 例如，DVD介质、蓝光（Blu-ray)介质、HD-DVD介质、各种类型的半导体存储介质等。当然， 可拆卸记录介质928可以是例如，其上安装有非接触IC芯片的IC卡或者电子设备。IC是 集成电路的缩写。</p>
    <p>[0300]	连接端口 924是诸如USB端口、IEEE1394端口、SCSI、RS-232C端口的端口或者用 于连接诸如光音频终端的外部连接设备930的端口。外部连接设备930是例如，打印机、移 动音乐播放器、数字相机、数字视频相机或者IC记录器。而且，USB是通用串行总线的缩写。 再者，SCSI是小型计算机系统接口的缩写。</p>
    <p>[0301]	通信单元926是要连接到网络932的通信设备，并且是例如，用于有线或无线LAN 的通信卡、蓝牙（注册商标）或WUSB、光通信路由器、ADSL路由器、或者各种通信调制解调 器。连接到通信单元926的网络932由有线连接的或无线连接的网络配置，并且是例如，互 联网、家用LAN、红外通信、可见光通信、广播或卫星通信。而且，LAN是局域网的缩写。再 者，WUSB是无线USB的缩写。此外，ADSL是非对称数字订户线路的缩写。</p>
    <p>[0302]	本领域的技术人员应当理解，在所附权利要求或其等同物的范围内，依赖于设计 需要和其他因素，可以进行各种修改、组合、子组合和变更。</p>
    <p>[0303]	本申请包含与在2009年7月15日提交日本专利局的日本在先专利申请JP 2009-167041中公开的主题内容相关的主题内容，该申请的全部内容通过引用并入此处。</p>
  </div>
  </div></div><div class="patent-section patent-tabular-section"><a id="backward-citations"></a><div class="patent-section-header"><span class="patent-section-title">专利引用</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th">引用的专利</th><th class="patent-data-table-th"> 申请日期</th><th class="patent-data-table-th">公开日</th><th class="patent-data-table-th"> 申请人</th><th class="patent-data-table-th">专利名</th></tr></thead><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN101132277A?cl=zh">CN101132277A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2006年8月26日</td><td class="patent-data-table-td patent-date-value">2008年2月27日</td><td class="patent-data-table-td ">华为技术有限公司</td><td class="patent-data-table-td ">一种生物认证方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN101330386A?cl=zh">CN101330386A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2008年5月19日</td><td class="patent-data-table-td patent-date-value">2008年12月24日</td><td class="patent-data-table-td ">刘洪利</td><td class="patent-data-table-td ">基于生物特征的认证系统及其身份认证方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="https://www.google.com/url?id=EuqNBwABERAJ&amp;q=http://worldwide.espacenet.com/publicationDetails/biblio%3FCC%3DJP%26NR%3D2008102780A%26KC%3DA%26FT%3DD&amp;usg=AFQjCNExUj_1znBry8T5774JAdADvO_O9w">JP2008102780A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value"></td><td class="patent-data-table-td patent-date-value"></td><td class="patent-data-table-td "> </td><td class="patent-data-table-td citation-no-title">没有名称</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US20090080710">US20090080710</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2008年9月16日</td><td class="patent-data-table-td patent-date-value">2009年3月26日</td><td class="patent-data-table-td ">Hiroshi Abe</td><td class="patent-data-table-td ">Biological Information Storing Apparatus, Biological Authentication Apparatus, Data Structure for Biological Authentication, and Biological Authentication Method</td></tr></table><div class="patent-section-footer">* 由审查员引用</div></div><div class="patent-section patent-tabular-section"><a id="npl-citations"></a><div class="patent-section-header"><span class="patent-section-title">非专利引用</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th colspan="3"class="patent-data-table-th">参考文献</th></tr></thead><tr><td class="patent-data-table-td ">1</td><td class="patent-data-table-td "><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td ">A. MENEZES，P. VAN，ETC.: "<a href='http://scholar.google.com/scholar?q="%E3%80%8AHandbook+of+Applied+Cryptography%E3%80%8B%22%2C+16+October+1996%2C+article+%22chapter+13"'>《Handbook of Applied Cryptography》", 16 October 1996, article "chapter 13</a>"</td></tr></table><div class="patent-section-footer">* 由审查员引用</div></div><div class="patent-section patent-tabular-section"><a id="classifications"></a><div class="patent-section-header"><span class="patent-section-title">分类</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th"> </th><th class="patent-data-table-th"> </th></tr></thead><tr><td class="patent-data-table-td ">国际分类号</td><td class="patent-data-table-td "><span class="nested-value"><a href="https://www.google.com/url?id=EuqNBwABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=H04L0009080000">H04L9/08</a></span>, <span class="nested-value"><a href="https://www.google.com/url?id=EuqNBwABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=H04L0009320000">H04L9/32</a></span>, <span class="nested-value"><a href="https://www.google.com/url?id=EuqNBwABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=G06K0009000000">G06K9/00</a></span></td></tr><tr><td class="patent-data-table-td "> 合作分类</td><td class="patent-data-table-td "><span class="nested-value"><a href="https://www.google.com/url?id=EuqNBwABERAJ&amp;q=http://worldwide.espacenet.com/classification&amp;usg=AFQjCNGs5WqSrPE3A4ZP63zGuM6PRNfEFA#!/CPC=H04L9/3273">H04L9/3273</a></span>, <span class="nested-value"><a href="https://www.google.com/url?id=EuqNBwABERAJ&amp;q=http://worldwide.espacenet.com/classification&amp;usg=AFQjCNGs5WqSrPE3A4ZP63zGuM6PRNfEFA#!/CPC=H04L9/0897">H04L9/0897</a></span>, <span class="nested-value"><a href="https://www.google.com/url?id=EuqNBwABERAJ&amp;q=http://worldwide.espacenet.com/classification&amp;usg=AFQjCNGs5WqSrPE3A4ZP63zGuM6PRNfEFA#!/CPC=H04L2209/805">H04L2209/805</a></span>, <span class="nested-value"><a href="https://www.google.com/url?id=EuqNBwABERAJ&amp;q=http://worldwide.espacenet.com/classification&amp;usg=AFQjCNGs5WqSrPE3A4ZP63zGuM6PRNfEFA#!/CPC=H04L9/3231">H04L9/3231</a></span></td></tr><tr><td class="patent-data-table-td "> 欧洲专利分类号</td><td class="patent-data-table-td "><span class="nested-value">H04L9/08</span>, <span class="nested-value">H04L9/32</span></td></tr></table><div class="patent-section-footer"></div></div><div class="patent-section patent-tabular-section"><a id="legal-events"></a><div class="patent-section-header"><span class="patent-section-title">法律事件</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th"> 日期</th><th class="patent-data-table-th">代码</th><th class="patent-data-table-th">事件</th><th class="patent-data-table-th">说明</th></tr></thead><tr><td class="patent-data-table-td patent-date-value">2011年1月26日</td><td class="patent-data-table-td ">C06</td><td class="patent-data-table-td ">Publication</td><td class="patent-data-table-td "></td></tr><tr><td class="patent-data-table-td patent-date-value">2011年3月23日</td><td class="patent-data-table-td ">C10</td><td class="patent-data-table-td ">Entry into substantive examination</td><td class="patent-data-table-td "></td></tr><tr><td class="patent-data-table-td patent-date-value">2013年6月5日</td><td class="patent-data-table-td ">C14</td><td class="patent-data-table-td ">Grant of patent or utility model</td><td class="patent-data-table-td "></td></tr><tr><td class="patent-data-table-td patent-date-value">2013年12月18日</td><td class="patent-data-table-td ">C41</td><td class="patent-data-table-td ">Transfer of patent application or patent right or utility model</td><td class="patent-data-table-td "></td></tr><tr><td class="patent-data-table-td patent-date-value">2013年12月18日</td><td class="patent-data-table-td ">ASS</td><td class="patent-data-table-td ">Succession or assignment of patent right</td><td class="patent-data-table-td "><div class="nested-key-value"><span class="nested-key">Owner name: </span><span class="nested-value">MOFEILIYA CO., LTD.</span></div><div class="nested-key-value"><span class="nested-key">Free format text: </span><span class="nested-value">FORMER OWNER: SONY CORP</span></div><div class="nested-key-value"><span class="nested-key">Effective date: </span><span class="nested-value">20131128</span></div></td></tr><tr><td class="patent-data-table-td patent-date-value">2014年2月12日</td><td class="patent-data-table-td ">C56</td><td class="patent-data-table-td ">Change in the name or address of the patentee</td><td class="patent-data-table-td "></td></tr></table><div class="patent-section-footer"></div></div><div class="modal-dialog" id="patent-images-lightbox"><div class="patent-lightbox-controls"><div class="patent-lightbox-rotate-controls"><div class="patent-lightbox-rotation-text">旋转</div><div class="rotate-icon rotate-ccw-icon"></div><div class="rotate-icon rotate-cw-icon"></div></div><div class="patent-lightbox-index-counter"></div><a class="patent-lightbox-fullsize-link" target="_blank">原始图片</a><div class="patent-drawings-control patent-drawings-next"><img class="patent-drawings-button-img"src="/googlebooks/images/kennedy/page_right.png" alt="Next page"width="21" height="21" /></div><div class="patent-drawings-control patent-drawings-prev"><img class="patent-drawings-button-img"src="/googlebooks/images/kennedy/page_left.png" alt="Previous page"width="21" height="21" /></div></div><div class="modal-dialog-content"><div class="patent-lightbox-image-holder"><div class="patent-lightbox-placeholder"></div></div></div></div><script>_OC_initPatentsAtb({image_not_available_html: " 未提供图片。\x3ca href\x3d//docs.google.com/viewer?url\x3dpatentimages.storage.googleapis.com/pdfs/012196077d0e95ea2699/CN101958795A.pdf\x3e查看 PDF\x3c/a\x3e"});</script></div></div></div></div></div><script>(function() {var href = window.location.href;if (href.indexOf('?') !== -1) {var parameters = href.split('?')[1].split('&');for (var i = 0; i < parameters.length; i++) {var param = parameters[i].split('=');if (param[0] == 'focus') {var elem = document.getElementById(param[1]);if (elem) {elem.focus();}}}}})();</script><script>_OC_addFlags({LockSrc:"/books/javascript/lock_5115ea495017d9115e613207d3810e5a.js", Host:"https://www.google.com/", IsBooksRentalEnabled:1, IsBrowsingHistoryEnabled:1, IsWebReaderSvgEnabled:0, IsImageModeNotesEnabled:1, IsOfflineBubbleEnabled:1, IsFutureOnSaleVolumesEnabled:1, IsBooksUnifiedLeftNavEnabled:1, IsMobileRequest:0, IsZipitFolderCollectionEnabled:1, IsAdsDisabled:0, IsEmbeddedMediaEnabled:1, IsImageModeAnnotationsEnabled:1, IsMyLibraryGooglePlusEnabled:1, IsImagePageProviderEnabled:1, IsBookcardListPriceSmall:0, IsInternalUser:0, IsBooksShareButtonEnabled:0, IsDisabledRandomBookshelves:0});_OC_Run({"enable_p13n":false,"is_cobrand":false,"sign_in_url":"https://www.google.com/accounts/Login?service=\u0026continue=https://www.google.com/patents%3Fcl%3Dzh%26hl%3Dzh-CN\u0026hl=zh-CN"}, {"volume_id":"","is_ebook":true,"volumeresult":{"has_flowing_text":false,"has_scanned_text":true,"can_download_pdf":false,"can_download_epub":false,"is_pdf_drm_enabled":false,"is_epub_drm_enabled":false,"download_pdf_url":"https://www.google.com/patents/download/%E5%AF%86%E9%92%A5%E5%AD%98%E5%82%A8%E8%AE%BE%E5%A4%87%E5%8F%8A%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95%E4%B8%8E%E7%94%9F.pdf?id=EuqNBwABERAJ\u0026hl=zh-CN\u0026output=pdf\u0026sig=ACfU3U053LjBv-HGJUBGAImSl7RM7NnTIg"},"sample_url":"https://www.google.com/patents/reader?id=EuqNBwABERAJ\u0026hl=zh-CN\u0026printsec=frontcover\u0026output=reader\u0026source=gbs_atb_hover","is_browsable":true,"is_public_domain":true}, {});</script><div id="footer_table" style="font-size:83%;text-align:center;position:relative;top:20px;height:4.5em;margin-top:2em"><div style="margin-bottom:8px"><a href="https://www.google.com/search?hl=zh-CN"><nobr>Google&nbsp;首页</nobr></a> - <a href="//www.google.com/patents/sitemap/"><nobr>站点地图</nobr></a> - <a href="http://www.google.com/googlebooks/uspto.html"><nobr>美国专利商标局 (USPTO) 专利信息批量下载</nobr></a> - <a href="/intl/zh-CN/privacy/"><nobr>隐私权政策</nobr></a> - <a href="/intl/zh-CN/policies/terms/"><nobr>服务条款</nobr></a> - <a href="https://support.google.com/faqs/answer/2539193?hl=zh-CN"><nobr> 关于 Google 专利</nobr></a> - <a href="//www.google.com/tools/feedback/intl/zh-CN/error.html" onclick="try{_OC_startFeedback({productId: '72792',locale: 'zh-CN'});return false;}catch(e){}"><nobr>发送反馈</nobr></a></div></div> <script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">var pageTracker = _gat._getTracker("UA-27188110-1");pageTracker._setCookiePath("/patents/");pageTracker._trackPageview();</script> </body></html>