<!DOCTYPE html><html><head><title>专利 CN101236673A - 实现电子钱包离线充值的方法、复合功能卡和授权载体 -  Google 专利</title><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){var d=void 0!=b?b:(new Date).getTime();this.t[a]=[d,c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(e){}};this.tick("start",null,a)}var a;window.performance&&(a=window.performance.timing);var f=a?new e(a.responseStart):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_",
"_wtsrt",d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();})();
</script><link rel="stylesheet" href="/patents/css/_6e802a6b2b28d51711baddc2f3bec198/kl_intl_patents_bundle.css" type="text/css" /><script src="/books/javascript/atb_6e802a6b2b28d51711baddc2f3bec198__zh_cn.js"></script><script>function googleTranslateElementInit() {new google.translate.TranslateElement({pageLanguage: "zh",gaTrack: true,gaId: "UA-27188110-1",multilanguagePage: true});}</script><script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script><meta name="DC.type" content="Patent"><meta name="DC.title" content="实现电子钱包离线充值的方法、复合功能卡和授权载体"><meta name="DC.contributor" content="军 王" scheme="inventor"><meta name="DC.contributor" content="王国荣" scheme="inventor"><meta name="DC.contributor" content="翔 高" scheme="inventor"><meta name="DC.contributor" content="北京握奇数据系统有限公司" scheme="assignee"><meta name="DC.date" content="2008-3-7" scheme="dateSubmitted"><meta name="DC.description" content="本发明公开了一种实现电子钱包离线充值的方法，涉及通信领域或计算机领域，以方便用户在离线情况下对电子钱包进行充值。本发明所述的方法包括：通过终端设备，获取到根据授权载体的特征数据确定的交易数据；根据所述交易数据，对电子钱包进行充值。本发明实施例能够使用户在离线情况下对电子钱包进行充值，而不局限于到授权中心指定的机构在联机状态下对电子钱包进行充值，从而能够支持电子钱包的安全灵活充值模式，在保证安全性的前提下，达到增加运营商的应用选择、方便用户使用的目的。本发明还公开一种复合功能卡、授权载体和终端设备。"><meta name="DC.date" content="2008-8-6"><meta name="citation_patent_publication_number" content="CN:101236673:A"><meta name="citation_patent_application_number" content="CN:200810101590"><link rel="canonical" href="https://www.google.com/patents/CN101236673A?cl=zh"/><meta property="og:url" content="https://www.google.com/patents/CN101236673A?cl=zh"/><meta name="title" content="专利 CN101236673A - 实现电子钱包离线充值的方法、复合功能卡和授权载体"/><meta name="description" content="本发明公开了一种实现电子钱包离线充值的方法，涉及通信领域或计算机领域，以方便用户在离线情况下对电子钱包进行充值。本发明所述的方法包括：通过终端设备，获取到根据授权载体的特征数据确定的交易数据；根据所述交易数据，对电子钱包进行充值。本发明实施例能够使用户在离线情况下对电子钱包进行充值，而不局限于到授权中心指定的机构在联机状态下对电子钱包进行充值，从而能够支持电子钱包的安全灵活充值模式，在保证安全性的前提下，达到增加运营商的应用选择、方便用户使用的目的。本发明还公开一种复合功能卡、授权载体和终端设备。"/><meta property="og:title" content="专利 CN101236673A - 实现电子钱包离线充值的方法、复合功能卡和授权载体"/><meta property="og:type" content="book"/><meta property="og:site_name" content="Google Books"/><meta property="og:image" content="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"/><link rel="image_src" href="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"/><script>if (window['_OC_timingAction']) {window['_OC_timingAction']('patents_refpage');}</script><style>#gbar,#guser{font-size:13px;padding-top:1px !important;}#gbar{height:22px}#guser{padding-bottom:7px !important;text-align:right}.gbh,.gbd{border-top:1px solid #c9d7f1;font-size:1px}.gbh{height:0;position:absolute;top:24px;width:100%}@media all{.gb1{height:22px;margin-right:.5em;vertical-align:top}#gbar{float:left}}a.gb1,a.gb4{text-decoration:underline !important}a.gb1,a.gb4{color:#00c !important}.gbi .gb4{color:#dd8e27 !important}.gbf .gb4{color:#900 !important}

#gbar { padding:.3em .6em !important;}</style></head><body ><div id=gbar><nobr><a class=gb1 href="https://www.google.com/search?cl=zh&hl=zh-CN&sa=N&tab=tw">搜索</a> <a class=gb1 href="https://www.google.com/search?cl=zh&hl=zh-CN&tbm=isch&source=og&sa=N&tab=ti">图片</a> <a class=gb1 href="https://maps.google.com/maps?cl=zh&hl=zh-CN&sa=N&tab=tl">地图</a> <a class=gb1 href="https://play.google.com/?cl=zh&hl=zh-CN&sa=N&tab=t8">Play</a> <a class=gb1 href="https://www.youtube.com/results?cl=zh&hl=zh-CN&sa=N&tab=t1">YouTube</a> <a class=gb1 href="https://news.google.com/nwshp?hl=zh-CN&tab=tn">新闻</a> <a class=gb1 href="https://mail.google.com/mail/?tab=tm">Gmail</a> <a class=gb1 href="https://drive.google.com/?tab=to">云端硬盘</a> <a class=gb1 style="text-decoration:none" href="https://www.google.com/intl/zh-CN/options/"><u>更多</u> &raquo;</a></nobr></div><div id=guser width=100%><nobr><span id=gbn class=gbi></span><span id=gbf class=gbf></span><span id=gbe></span><a target=_top id=gb_70 href="https://www.google.com/accounts/Login?service=&continue=https://www.google.com/patents%3Fcl%3Dzh%26hl%3Dzh-CN&hl=zh-CN" class=gb4>登录</a></nobr></div><div class=gbh style=left:0></div><div class=gbh style=right:0></div><div role="alert" style="position: absolute; left: 0; right: 0;"><a href="https://www.google.com/patents/CN101236673A?cl=zh&amp;hl=zh-CN&amp;output=html_text" title="屏幕阅读器用户请注意：点击此链接可进入无障碍模式。阅读器在无障碍模式下具有同样的基本功能，但可让用户获得更好的体验。"><img border="0" src="//www.google.com/images/cleardot.gif"alt="屏幕阅读器用户请注意：点击此链接可进入无障碍模式。阅读器在无障碍模式下具有同样的基本功能，但可让用户获得更好的体验。"></a></div><div class="kd-appbar"><h2 class="kd-appname"><a href="/patents?hl=zh-CN"> 专利</a></h2><div class="kd-buttonbar left" id="left-toolbar-buttons"><a id="appbar-write-review-link" href=""></a><a id="appbar-view-print-sample-link" href=""></a><a id="appbar-view-ebook-sample-link" href=""></a><a id="appbar-patents-prior-art-finder-link" href="https://www.google.com/patents/related/CN101236673A"></a><a id="appbar-patents-discuss-this-link" href="https://www.google.com/url?id=kL1eBwABERAJ&amp;q=http://patents.stackexchange.com/redirect/google-patents%3Fpublication%3DCN101236673A&amp;usg=AFQjCNE4et4etipD0k28_7XRfi_J6VtweA" data-is-grant="false"></a><a id="appbar-read-patent-link" href="//docs.google.com/viewer?url=patentimages.storage.googleapis.com/pdfs/7c066f8929a003eb285f/CN101236673A.pdf"></a><a id="appbar-download-pdf-link" href="//patentimages.storage.googleapis.com/pdfs/7c066f8929a003eb285f/CN101236673A.pdf"></a><a class="appbar-content-language-link" data-selected="true" data-label="中文" href="/patents/CN101236673A?cl=zh&amp;hl=zh-CN"></a><a class="appbar-content-language-link" data-label="英语" href="/patents/CN101236673A?cl=en&amp;hl=zh-CN"></a><a class="appbar-application-grant-link" data-selected="true" data-label="申请" href="/patents/CN101236673A?hl=zh-CN&amp;cl=zh"></a><a class="appbar-application-grant-link" data-label="授权" href="/patents/CN101236673B?hl=zh-CN&amp;cl=zh"></a></div><div class="kd-buttonbar right" id="right-toolbar-buttons"></div></div><div id="books-microdata" itemscope=""itemtype="http://schema.org/Book"itemid="https://www.google.com/patents/CN101236673A?cl=zh" style="display:none"><span itemprop="description">本发明公开了一种实现电子钱包离线充值的方法，涉及通信领域或计算机领域，以方便用户在离线情况下对电子钱包进行充值。本发明所述的方法包括：通过终端设备，获取到根据授权载体的特征数据确定的交易数据；根据所述...</span><span itemprop="url">https://www.google.com/patents/CN101236673A?cl=zh&amp;utm_source=gb-gplus-share</span><span class="main-title" itemprop="name">专利 CN101236673A - 实现电子钱包离线充值的方法、复合功能卡和授权载体</span><img itemprop="image" src="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"alt="专利 CN101236673A - 实现电子钱包离线充值的方法、复合功能卡和授权载体" title="专利 CN101236673A - 实现电子钱包离线充值的方法、复合功能卡和授权载体"></div><div style="display: none"><ol id="ofe-gear-menu-contents" class="gbmcc"><li class="gbe gbmtc"><a class="gbmt goog-menuitem-content" id="" href="https://www.google.com/advanced_patent_search?hl=zh-CN"> 高级专利搜索</a></li></ol></div><div id="volume-main"><div id="volume-center"><div class=vertical_module_list_row><div id=intl_patents class=about_content><div id=intl_patents_v><table class="patent-bibdata patent-drawings-missing"><tr><td class="patent-bibdata-heading"> 公开号</td><td class="single-patent-bibdata">CN101236673 A</td></tr><tr><td class="patent-bibdata-heading">发布类型</td><td class="single-patent-bibdata">申请</td></tr><tr><td class="patent-bibdata-heading"> 专利申请号</td><td class="single-patent-bibdata">CN 200810101590</td></tr><tr><td class="patent-bibdata-heading">公开日</td><td class="single-patent-bibdata">2008年8月6日</td></tr><tr><td class="patent-bibdata-heading"> 申请日期</td><td class="single-patent-bibdata">2008年3月7日</td></tr><tr><td class="patent-bibdata-heading"> 优先权日<span class="patent-tooltip-anchor patent-question-icon"data-tooltip-text="优先日期属于假设性质，不具任何法律效力。Google 对于所列日期的正确性并没有进行法律分析，也不作任何陈述。"></span></td><td class="single-patent-bibdata">2008年3月7日</td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">公告号</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="/patents/CN101236673B?hl=zh-CN&amp;cl=zh">CN101236673B</a></span></span></td></tr><tr class="patent-bibdata-list-row alternate-patent-number"><td class="patent-bibdata-heading"> 公开号</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value">200810101590.1, </span><span class="patent-bibdata-value">CN 101236673 A, </span><span class="patent-bibdata-value">CN 101236673A, </span><span class="patent-bibdata-value">CN 200810101590, </span><span class="patent-bibdata-value">CN-A-101236673, </span><span class="patent-bibdata-value">CN101236673 A, </span><span class="patent-bibdata-value">CN101236673A, </span><span class="patent-bibdata-value">CN200810101590, </span><span class="patent-bibdata-value">CN200810101590.1</span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading"> 发明者</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E5%86%9B+%E7%8E%8B%22">军 王</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E7%8E%8B%E5%9B%BD%E8%8D%A3%22">王国荣</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E7%BF%94+%E9%AB%98%22">翔 高</a></span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading"> 申请人</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=inassignee:%22%E5%8C%97%E4%BA%AC%E6%8F%A1%E5%A5%87%E6%95%B0%E6%8D%AE%E7%B3%BB%E7%BB%9F%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8%22">北京握奇数据系统有限公司</a></span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">导出引文</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="/patents/CN101236673A.bibtex?cl=zh">BiBTeX</a>, </span><span class="patent-bibdata-value"><a href="/patents/CN101236673A.enw?cl=zh">EndNote</a>, </span><span class="patent-bibdata-value"><a href="/patents/CN101236673A.ris?cl=zh">RefMan</a></span></span></td></tr><tr class="patent-internal-links"><td colspan=2><span class="patent-bibdata-value"><a href="#forward-citations"> 被以下专利引用</a> (2),</span> <span class="patent-bibdata-value"><a href="#classifications">分类</a> (3),</span> <span class="patent-bibdata-value"><a href="#legal-events">法律事件</a> (3)</span> </td></tr><tr><td colspan=2 class="patent-bibdata-external-link-spacer-top"></td></tr><tr class="patent-bibdata-external-link-spacer-bottom"></tr><tr><td colspan=2><span class="patent-bibdata-heading">外部链接:&nbsp;</span><span><span class="patent-bibdata-value"><a href="https://www.google.com/url?id=kL1eBwABERAJ&amp;q=http://211.157.104.87:8080/sipo/zljs/hyjs-yx-new.jsp%3Frecid%3D200810101590&amp;usg=AFQjCNEyzaY77IBgtx8LF_01k4HGH9_ywQ"> 中国国家知识产权局</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/url?id=kL1eBwABERAJ&amp;q=http://worldwide.espacenet.com/publicationDetails/biblio%3FCC%3DCN%26NR%3D101236673A%26KC%3DA%26FT%3DD&amp;usg=AFQjCNGSjXcNyUmVMKs8TsrggBhJ_cjPEQ"> 欧洲专利数据库 (Espacenet)</a></span></span></td></tr><tr class="patent-bibdata-group-spacer"></tr></table><div class="number-and-title"><span class="patent-title"><invention-title mxw-id="PT70776647" lang="ZH" load-source="patent-office">实现电子钱包离线充值的方法、复合功能卡和授权载体</invention-title>
    </span><br><span class="patent-number">CN 101236673 A</span></div><div class="patent-section patent-abstract-section"><div class="patent-section-header"><span class="patent-section-title"> 摘要</span></div><div class="patent-text"><abstract mxw-id="PA38546335" lang="ZH" load-source="patent-office">
    <div class="abstract">本发明公开了一种实现电子钱包离线充值的方法，涉及通信领域或计算机领域，以方便用户在离线情况下对电子钱包进行充值。本发明所述的方法包括：通过终端设备，获取到根据授权载体的特征数据确定的交易数据；根据所述交易数据，对电子钱包进行充值。本发明实施例能够使用户在离线情况下对电子钱包进行充值，而不局限于到授权中心指定的机构在联机状态下对电子钱包进行充值，从而能够支持电子钱包的安全灵活充值模式，在保证安全性的前提下，达到增加运营商的应用选择、方便用户使用的目的。本发明还公开一种复合功能卡、授权载体和终端设备。</div>
  </abstract>
  </div></div><div class="patent-section patent-claims-section"><div class="patent-section-header"><span class="patent-section-title">权利要求<span class="patent-section-count">(17)</span></span></div><div class="patent-text"><div mxw-id="PCLM5966586" lang="ZH" load-source="patent-office" class="claims">
    <div class="claim"> <div num="1" class="claim">
      <div class="claim-text">1、一种实现电子钱包离线充值的方法，其特征在于，该方法包括：    通过终端设备，获取到根据授权载体的特征数据确定的交易数据；    根据所述交易数据，对电子钱包进行充值。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="2" class="claim">
      <div class="claim-text">2、 如权利要求l所述的方法，其特征在于，该方法还包括： 对所述交易数据进行合法性验证，并确认合法性验证通过。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="3" class="claim">
      <div class="claim-text">3、 如权利要求1或2所述的方法，其特征在于，所述通过终端设备，获 取到根据授权载体的特征数据确定的交易数据，包括：通过终端设备，获取到用户输入的交易数据，所述交易数据由授权中心根 据用户上报的授权载体特征数据确定并由所述授权中心通知给用户； 或者，通过终端设备，获取到授权中心发送给的交易数据，所述交易数据由授权 中心根据用户上报的授权载体特征数据确定，并由所述授权中心发送给所述终 端设备；所述终端设备由所述授权中心根据所述用户的标识信息或所述用户上 报的终端设备标识信息确定出；或者，通过终端设备，获取到用户输入的交易数据，所述交易数据由授权中心根 据用户上报的授权载体交易过程数据确定并由所述授权中心通知给用户，所述 交易过程数据由授权载体根据本地的特征数据确定；或者，通过终端设备，获取到授权中心通知给的交易数据，所述交易数据由授权 中心根据用户上报的授权载体交易过程数据确定并由所述授权中心发送给所 述终端设备；所述交易过程数据由授权载体根据本地的特征数据确定；所述终 端设备由所述授权中心根据所述用户的标识信息或所述用户上报的终端设备 标识信息确定出；或者，通过终端设备，从授权载体中，获取到授权载体根据本地的特征数据确定 的交易数据。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="4" class="claim">
      <div class="claim-text">4、 如权利要求3所述的方法，其特征在于，所述通过终端设备，从授权 载体中，获取到授权载体根据本地的特征数据确定的交易数据，包括：通过终端设备向授权载体发送应用请求，并根据授权载体的响应，获得授 权栽体根据本地的特征数据确定的交易数据。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="5" class="claim">
      <div class="claim-text">5、 如权利要求3所述的方法，其特征在于，该方法还包括：授权中心成功使用授权载体的特征数据确定交易数据后，将所述交易数据 对应的特征数据无效掉； 或者，授权载体成功使用本地的特征数据确定交易数据后，将所述交易数据对应 的特征数据无效掉。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="6" class="claim">
      <div class="claim-text">6、 如权利要求3所述的方法，其特征在于，该方法还包括：授权中心将所述交易数据成功通知用户或终端设备后，将所述交易数据扣除；或者，授权载体将所确定的交易数据成功传送给终端设备后，将所述交易数据扣除。</div>
    </div>
    </div> <div class="claim"> <div num="7" class="claim">
      <div class="claim-text">7、 一种复合功能卡，其特征在于，包括：获取单元，用于获取到根据授权载体的特征数据确定的交易数据； 充值单元，用于根据所述交易数据，对电子钱包进行充值。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="8" class="claim">
      <div class="claim-text">8、 如权利要求7所述的复合功能卡，其特征在于，该复合功能卡还包括： 认证单元，用于对所述交易数据进行合法性验证，并确认合法性验证通过后，触发充值单元工作。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="9" class="claim">
      <div class="claim-text">9、 如权利要求8所述的复合功能卡，其特征在于，该复合功能卡还包括： 更新单元，用于当认证单元确定合法性验证未通过时，根据本次验证未通过更新错误次数；判断单元，用于判断错误次数是否达到设置阔值；锁定单元，用于当所述判断单元判断错误次数达到设置阈值时，将电子钱 包锁死。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="10" class="claim">
      <div class="claim-text">10、如权利要求7、 8或9所述的复合功能卡，其特征在于，所述获取单 元包4舌：第一获取子单元，用于通过终端设备，获取到用户输入的交易数据，所述 交易数据由授权中心根据用户上报的授权载体特征数据确定并由所述授权中 心通知给所述用户；或者，第二获取子单元，用于通过终端设备，获取到授权中心发送给的交易数据， 所述交易数据由授权中心根据用户上报的授权载体特征数据确定，并由所述授 权中心发送给所述终端设备；所述终端设备由所述授权中心根据所述用户的标 识信息或所述用户上"R的终端设备标识信息确定出；或者，第三获取子单元，用于通过终端设备，获取到用户输入的交易数据，所述 交易数据由授权中心根据用户上报的授权载体交易过程数据确定并由所述授 权中心通知给用户，所述交易过程数据由授权载体根据本地的特征数据确定；或者，第四获取子单元，用于通过终端设备，获取到授权中心发送给的交易数据， 所述交易数据由授权中心根据用户上报的授权载体交易过程数据确定并由所 述授权中心发送给所述终端设备；所述交易过程数据由授权载体根据本地的特 征数据确定；所述终端设备由所述授权中心根据所述用户的标识信息或所述用 户上报的终端设备标识信息确定出；或者，第五获取子单元，用于通过终端设备，从授权载体中，获取到授权载体根据本地的特征数据确定的交易数据。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="11" class="claim">
      <div class="claim-text">11、 如权利要求10所述的复合功能卡，其特征在于，该复合功能卡还包括：通知单元，用于完成对电子钱包的充值后，发送完成充值操作通知给终端 设备。</div>
    </div>
    </div> <div class="claim"> <div num="12" class="claim">
      <div class="claim-text">12、 一种授权载体，其特征在于，该授权载体包括： 交易数据确定单元，用于根据本地的特征数据确定交易数据； 传输单元，用于通过终端设备，将所述交易数据传输给电子钱包用来充值。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="13" class="claim">
      <div class="claim-text">13、 如权利要求12所述的授权载体，其特征在于，该授权载体还包括： 应用请求处理单元，用于接收终端设备发送的应用请求，并根据该应用请求触发所述交易数据确定单元启动。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="14" class="claim">
      <div class="claim-text">14、 如权利要求12或13所述的授权载体，其特征在于，该授权载体还包括：数据处理单元，用于当成功使用授权载体的特征数据确定交易数据后，将 所述交易数据对应的特征数据无效掉。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="15" class="claim">
      <div class="claim-text">15、 如权利要求14所述的授权载体，其特征在于，该授权载体还包括： 扣除单元，用于将所确定的交易数据成功传送给终端设备后，将所述交易数据扣除。</div>
    </div>
    </div> <div class="claim"> <div num="16" class="claim">
      <div class="claim-text">16、 一种终端设备，其特征在于，该终端设备包括： 获取单元，用于获取根据授权载体的特征数据所确定的交易数据； 传输单元，用于将所述获取单元所获得的交易数据，传输给复合功能卡用来对电子钱包充值。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="17" class="claim">
      <div class="claim-text">17、 如权利要求16所述的终端设备，其特征在于，所述获取单元包括： 第一获取子单元，用于获取到用户输入的交易数据，所述交易数据由授权中心根据用户上报的授权载体特征数据确定并由所述授权中心通知给所述用 户；或者，第二获取子单元，用于获取到授权中心发送给的交易数据，所述交易数据由授权中心根据用户上报的授权载体特征数据确定； 或者，第三获取子单元，用于获取到用户输入的交易数据，所述交易数据由授权 中心根据用户上报的授权载体交易过程数据确定并通知给所述用户；所述交易 过程数据由授权载体根据本地的特征数据确定；或者，第四获取子单元，用于获取到授权中心发送给的交易数据，所述交易数据 由授权中心根据用户上报的授权载体交易过程数据确定；所述交易过程数据由 授权载体根据本地的特征数据确定；或者，第五获取子单元，用于从授权载体中，获取到授权载体根据本地的特征数 据确定的交易数据。</div>
    </div>
  </div> </div>
  </div></div><div class="patent-section patent-description-section"><div class="patent-section-header"><span class="patent-section-title"> 说明</span></div><div class="patent-text"><div mxw-id="PDES10674839" lang="ZH" load-source="patent-office" class="description">
    <p>实现电子钱包离线充值的方法、复合功能卡和授权载体 技术领域本发明涉及通信领域或计算机领域，尤其涉及一种实现对电子钱包进行充 值的技术。背景技术近年来，移动通讯网络和技术的发展带来了移动增值服务产业的繁荣，也 丰富了手持终端设备的功能，如移动手机电视。随之，由于增值服务用户的广 泛性，增值服务运营商向其用户收取服务费的问题也日益突出。随着《中国金融集成电路（Integrated Circuit, IC )卡规范》和《建设事业 集成电路（IC )卡应用技术》的颁布和推广，带有电子钱包功能的集成电路卡， 广泛地用于解决运营商收取费用和用户付费的问题。但根据已有的标准，集成 电路卡的电子钱包只支持联机充值方式。所谓的联机充值方式是指充值设备在 对电子钱包进行每笔充值交易时，都需要与授权中心进行联机操作。操作过程充值设备向授权中心发送充值交易请求，以请求对用户的电子钱包进行充 值交易，该请求中携带电子钱包用户的相关信息和交易地址信息；授权中心检 查该用户帐户的有效性，记录交易地址，并返回完成充值交易所需的信息；充 值设备根据该授权中心返回的信息，完成充值交易。上述联机操作，要求用户必须到拥有能够与授权中心联网的充值设备的指 定机构，才能对电子钱包进行充值，这给用户带来不便。发明内容本发明提供一种实现电子钱包离线充值的方法、复合功能卡、授权载体和终端设备，以使用户在离线情况下能够对电子钱包进行充值，从而能够方便用 户。本发明实施例通过如下技术方案实现：本发明实施例提供一种实现电子钱包离线充值的方法，该方法包括： 通过终端设备，获取到根据授权载体的特征数据确定的交易数据； 根据所述交易数据，对电子钱包进行充值。 本发明实施例还提供一种复合功能卡，该复合功能卡包括： 获取单元，用于获取到根据授权载体的特征数据确定的交易数据； 充值单元，用于根据所述交易数据，对电子钱包进行充值。 本发明实施例还提供一种授权载体，该授权载体包括： 交易数据确定单元，用于根据本地的特征数据确定交易数据； 传输单元，用于通过终端设备，将所述交易数据传输给电子钱包用来充值。 本发明实施例还提供一种终端设备，该终端设备包括： 获取单元，用于获取根据授权载体的特征数据所确定的交易数据； 传输单元，用于将所述获取单元所获得的交易数据，传输给复合功能卡用来对电子钱包充值。由上述本发明实施例提供的实现电子钱包离线充值的方法的技术方案可以看出，通过终端设备，获取到根据授权载体的特征数据确定的交易数据；根据所述交易数据，对电子钱包进行充值。可见本发明实施例能够使用户在离线情况下对电子钱包进行充值，从而方便用户使用。附图说明图1为本发明第一实施例的流程图； 图2为本发明第一实施例的第一种应用的流程图； 图3为本发明第一实施例的第二种应用的流程图； 图4为本发明第二实施例的结构原理图；图S为本发明第三实施例的结构原理图； 图6为本发明第四实施例的结构原理图。具体实施方式本发明实施例中，用户通过终端设备（如：移动通讯手机，个人媒体播放 器，PDA，车载/船载/机载终端，笔记本电脑等）接收运营商所提供的服务时， 用户可通过终端设备（如移动电视手机）与带有电子钱包的复合功能卡进行交 互，向运营商支付服务费。当复合功能卡中电子钱包余额不足时，用户可以到 授权载体代销机构购买所需面值的授权载体（如充值卡，由授权中心（如银行） 根据运营商收费需要发行到合法的代销机构）。然后，根据授权载体中记录的 特征数据确定交易数据，利用所述交易数据对复合功能卡中的电子钱包进行充 值。下面结合附图描述本发明的具体实施例的实现过程。本发明第一实施例提供一种实现电子钱包离线充值的方法，其具体实现过 程，如图l所示，包括如下内容：步骤IOI，通过终端设备，获取到根据授权载体的特征数据所确定的交易 数据。步骤101中，可以通过终端设备获取到交易数据。用户可以通过该终端设备或其他终端设备打电话（或其他联系方式）到授 权中心，将他所持有的授权载体特征数据告知授权中心，授权中心根据该授权 载体特征数据确定出交易数据，并通知给用户；用户得到交易数据后，再将交 易数据输入到终端设备中，终端设备再将交易数据转发给电子钱包，这样电子 钱包会获取到终端设备传送的交易数据。用户也可以通过该终端设备或其他终端设备打电话（或其他联系方式）到 授权中心，将他通过终端设备获知的授权载体上报的交易过程数据（该交易过 程数据是授权载体根据本地的特征数据所确定出的）通知给授权中心；授权中 心根据该交易过程数据确定出交易数据，并将该交易数据通知给用户；用户得到交易数据后，再将交易数据输入到终端设备中，终端设备再将交易数据转发 给电子钱包，这样电子钱包会获取到终端设备传送的交易数据。用户还可以通过该终端设备或其他终端设备打电话（或其他联系方式）到 授权中心，将他所持有的授权载体特征数据告知授权中心，授权中心根据该授 权载体特征数据确定出交易数据；授权中心也可以根据用户ID号（或用户终端的ID号），确定出对应的电子钱包应用序列号（Electronic Purse ID, EPID ), 并根据EPID确定出安装有对应电子钱包的终端设备，授权中心可以直接将所 生成的交易数据发送给所确定出的终端设备，终端设备再将交易数据转发给电 子钱包，这样电子钱包会获取到终端设备传送的交易数据。步骤101中，也可以通过终端设备，从授权载体中，获取到授权载体根据 本地的特征数据确定的交易数据。例如，通过终端设备向授权载体发送应用请 求，并根据授权载体的响应，获得授权载体根据本地的特征数据确定的交易数 据。上述特征数据可以是交易金额，也可以是交易金额和授权载体自行生成的 随机数；也可以^U叉是卡序列号。 生成的交易数据包括交易金额。为了保证充值交易的安全性，可以通过终端设备与复合功能卡进行交互， 实现对复合功能卡合法性的验证。可以在授权载体根据本地的特征数据确定交 易数据之前，通过授权载体对复合功能卡的合法性进行验证；也可以在授权载 体上报特征数据或交易过程数据之后，由授权中心对复合功能卡进行合法性的 验证。通过授权载体对复合功能卡合法性进行验证的过程，具体如下： 复合功能卡通过终端设备，从授权载体中获取授权载体自行生成的随机数 (即授权载体随机数）、充值交易序号、密钥版本号、算法标识、授权载体应 用序列号；复合功能卡按照算法标识对应的算法，根据所述密钥版本号选择相 应的主密钥；使用所述主密钥对授权载体应用序列号进行分散处理，得到对应于此授权载体的子密钥；复合功能卡按照算法标识对应的算法，利用复合功能卡自行生成的随机数（即复合功能卡随机数）和授权载体随机数，对所述子密钥进行计算，产生过程密钥；并利用所述过程密钥对复合功能卡的内部数据进 行计算，得到复合功能卡身份验证码。复合功能卡将所述复合功能卡身份验证 码以及生成所述复合功能卡身份验证码所使用的复合功能卡随机数和复合功 能卡脱机交易序列号，通过终端设备发送给授权载体。授权载体通过终端设备，获得复合功能卡生成的复合功能卡身份验证码以 及生成所述复合功能卡身份验证码所使用的复合功能卡随机数和复合功能卡 脱机交易序列号。授权载体利用从授权载体中取出的授权载体随机数和所述复 合功能卡随机数，对授权载体中指定子密钥进行计算，生成过程密钥，并利用 所述过程密钥对所述复合功能卡身份验证码进行合法性验证。由授权中心验证复合功能卡的合法性，验证方法与上述类似，这里不再详 细描述。为了保证充值交易的安全性，需要对交易数据进行合法性验证。即执行步 骤102，对所述交易数据进行合法性验证。确认合法性验证通过后，执行步骤 103，即根据所述交易数据，对电子钱包进行充值。确定合法性验证未通过后， 执行步骤104，即根据本次验证未通过更新错误次数，并判断错误次数是否达 到设置阔值，并当确认达到时，则将电子钱包锁死。步骤102可以根据授权载体生成的交易验证码，对复合功能卡获得的交易 数据进行验证，也可以根据授权中心生成的交易验证码，对复合功能卡获得的 交易数据进行验证。其中，根据授权载体生成的交易验证码，对复合功能卡获得的交易数据进 行验证的具体实现过程如下：授权载体按照算法标识对应的算法，利用复合功能卡随机数和授权载体随 机数，对指定子密钥进行计算，产生过程密钥，并利用所述过程密钥对交易数 据进行计算，得到所述交易数据的交易验证码。复合功能卡在对电子钱包进行充值之前，通过终端设备，获得根据授权载体的特征数据生成的交易数据，以及所述交易数据的交易验证码；利用所述授权载体随机数和复合功能卡随机数，对指定密钥进行计算，生成过程密钥，并利用所述过程密钥对所述交易数 据的交易验证码进行合法性验证，以实现对交易数据的合法性验证。其中根据授权中心生成的交易验证码，对复合功能卡获得的交易数据进行验证的过程，如下：授权中心按照算法标识对应的算法，利用复合功能卡ID 号和授权中心自行生成的随机数，对指定子密钥进行计算，产生过程密钥，并 利用所述过程密钥对交易数据进行计算，得到所述交易数据的交易验证码。复 合功能卡在对电子钱包进行充值之前，通过终端设备，获得根据授权载体的特 征数据生成的交易数据，以及所述交易数据的交易验证码；利用所述授权中心 随机数和复合功能卡ID号，对指定密钥进行计算，生成过程密钥，并利用所 述过程密钥对所述交易数据的交易验证码进行合法性马全证，以实现对交易数据 的合法性验证。为了进一步保证充值交易的安全性，还可以进一步通过复合功能卡对授权 载体的合法性进行验证，或者，通过授权中心对授权载体的合法性进行验证。通过复合功能卡对授权载体的合法性进行验证的过程，具体如下：复合功能卡通过终端设备，获得授权载体生成的授权载体身份验证码（授 权载体利用复合功能卡随机数和授权载体随机数，对指定密钥进行计算，产生 过程密钥，并利用所述过程密钥对授权载体的内部信息进行计算得到授权载体 身份验证码。），以及生成所述授权载体身份验证码所使用的授权载体随机数和 授权载体的内部信息（充值卡交易序号、密钥版本号、算法标识）；利用复合 功能卡随机数和所述授权载体随机数，生成过程密钥，并利用所述过程密钥对 所述授权载体身份验证码进行合法性验证。通过授权中心对授权载体的合法性进行验证的过程，与上述类似，这里不 再详细4笛述。通过上述步骤完成对电子钱包的充值后，复合功能卡可以发送完成充值操作通知给终端设备，也可以不通知终端设备。在授权中心成功使用授权载体的特征数据确定交易数据通知用户或所确定的终端设备后，授权中心则将该交易数据对应的特征数据无效掉；或者，在 授权载体成功使用本地的特征数据确定交易数据后，授权载体则将所述交易数 据对应的特征数据无效掉。授权中心将根据用户上报的授权载体特征数据（或授权载体交易过程数 据）所确定的交易数据通知用户或所确定的终端设备后，则将该交易数据扣除； 或者，授权载体将其根据本地的特征数据所确定的交易数据传送给终端设备 后，则将所述交易数据扣除。下面以授权载体为充值卡为例，给出了本发明第一实施例的一种具体应 用，如图2所示，包括如下内容：终端设备向复合功能卡发送复合功能卡应用选择请求。复合功能卡根据该应用选择请求，启动相应的应用，并送出EPID。终端设备接收复合功能卡发送的EPID，并将其保存下来。同样，终端设备向充值卡发送充值卡应用选择请求。充值卡根据该应用选择请求，启动相应的应用，并送出充值卡应用序列号 (ID)。终端设备接收充值卡应用序列号，并将其保存下来。 终端向充值卡发送读取钱包余额请求。充值卡对该读取钱包余额请求进行响应，并返回充值卡的钱包余额。 终端设备接收充值卡返回的钱包余额，并临时将该钱包余额保存下来。 终端设备向复合功能卡发送随机数获取请求；复合功能卡对该随机数获取请求进行响应，返回4字节的随机数（记为RAND1 )，并将该随机数进行保存。 终端设备接收复合功能卡发送的随机数，并临时将该随机数保存下来。 终端设备将收到的充值卡内钱包余额、从复合功能卡上取得的随机数（记为RAND1 )和EPID，作为命令数据域，终端设备发送取款初始化（Initialize ForUnload)命令给充值卡，其中携带该命令数据域。充值卡接收到取款初始化命令后，判断交易金额是否小于或等于原余额， 若不满足条件，则送出出错信息；若满足条件，则从充值卡上取4字节随机数 (记为RAND2),与RAND1&#8212;起构成分散因子，并利用该分散因子对指定取 款子密钥进行计算，产生过程密钥（SecretKey, SK),然后再用SK按消息验 证码（Message Authentication Code, MAC)计算方法，对表1中的相应数据进 行计算，生成MACl。表l数据项	长度（字节）	说明交易金额	4	充值卡面值交易类型标识	1	参照《中国金融集成电路卡规范》中交易类型标 识的定义，将该交易类型标识定义为0x03。充值卡交易序号	2	充值卡固定值充值卡ID	8	充值卡将充值卡余额、所采用的算法标识、充值卡4字节随机数(RAND2 )、 MAC1、该充值卡对应的充值卡交易序号（后台发行充值卡时会携带此信息） 和密钥版本号（后台发行充值卡时会携带此信息）等有关数据送出。终端设备将收到的有关数据以及充值卡应用序列号，作为命令的数据域， 发送充值初始化（Initialize for Load)命令给复合功能卡，该充值初始化命令携 带所述有关数据以及充值卡应用序列号。复合功能卡接收到充值初始化命令后，根据有关数据中的算法标识，选择 与充值卡片相同的计算算法；并利用所述计算算法进行如下计算：根据其中携带的有关数据中的密钥版本号，选择指定的充值主密钥；并根 据充值主密钥的当前状态标识，判断所指定的充值主密钥是否有效，若有效， 则使用相应的充值主密钥，对充值卡应用序列号进行分散处理，得到对应所述 充值卡的充值子密钥；利用有关数据中的充值卡上的4字节随机数RAND2, 与RAND1 &#8212;起构成分散因子，并利用该分散因子对充值子密钥进行计算产生 相同的过程密钥SK;利用该过程密钥SK对MAC1的合法性进行验证，如果验证不通过，则送出出错信息；如果验证通过，则利用该过程密钥SK对如表 2所示的相应数据计算，产生MAC2。若所指定的充值主密钥无效，则该复合 功能卡送出出错信息。表2&lt;table&gt;table see original document page 15&lt;/column&gt;&lt;/row&gt;
&lt;table&gt;复合功能卡将其离线充值交易序号和所产生的MAC2送给终端设备。 终端设备将收到的复合功能卡的离线充值交易序号和MAC2数据，作为命令的数据域，发送取款（Debit For Unload)命令给充值卡，其中该取款命令中携带该数据域。充值卡接收到该取款命令后，使用过程密钥SK验证MAC2的正确性。如 果验证通过，则对钱包余额进行清零，也就是说使充值卡的特征数据无效；更 新交易明细记录，对如表3所示的交易明细记录进行更新。表3&lt;table&gt;table see original document page 15&lt;/column&gt;&lt;/row&gt;
&lt;table&gt;充值卡使用过程密钥SK对如表4所示的相应数据进行计算，得到4字节 的MAC3;用内部密钥（后台发行充值卡时会携带此信息）左右8字节异或运 算的结果，对如表5所示的相应数据进行计算，得到4字节的交易验证码 (Transaction Authentication Code, TAC )。表4&lt;table&gt;table see original document page 15&lt;/column&gt;&lt;/row&gt;
&lt;table&gt;&lt;table&gt;table see original document page 16&lt;/column&gt;&lt;/row&gt;
&lt;table&gt;</p>
    <p>表5&lt;table&gt;table see original document page 16&lt;/column&gt;&lt;/row&gt;
&lt;table&gt;</p>
    <p>充值卡将MAC3和TAC码送出卡外。终端设备将收到的MAC3和TAC码数据作为命令的数据域，发送充值命 令（Credit For Load)给复合功能卡，其中携带该数据域。复合功能卡接收到该充值命令后，使用过程密钥SK对MAC3进行验证， 如果MAC3校验成功，则将交易金额加到关联电子钱包余额上，对如表6所示 的交易明细记录进行更新，将离线充值交易序号加1，并发送确认信息给终端， 否则，复合功能卡将应用错误计数器的计数值减1，并当计数器的计数值为0 时，将该复合功能卡锁死。复合功能卡临时保存TAC码，并在后续提供给后台，以便后台对本次交 易进行验证。表6&lt;table&gt;table see original document page 16&lt;/column&gt;&lt;/row&gt;
&lt;table&gt;</p>
    <p>终端设备接收确认信息。下面以授权载体为充值卡为例给出了本发明第 一 实施例的第二种具体应用，如图3所示，包括如下内容：终端设备向复合功能卡发送复合功能卡应用选择请求。复合功能卡根据该应用选择请求，启动相应的应用，并送出电子钱包应用 序列号，即EPID。终端设备接收复合功能卡发送的EPID，并将其保存下来。同样，终端设备向充值卡发送充值卡应用选择请求。充值卡根据该应用选择请求，启动相应的应用，并送出充值卡应用序列号， 即充值卡应用ID。终端设备接收充值卡应用序列号，并将其保存下来。终端设备向充值卡发送读取钱包余额请求。充值卡对该读取钱包余额请求进行响应，并返回充值卡内的钱包余额以及 充值卡内部信息，包括算法标识、充值卡对应的充值卡交易序号（后台发行充 值卡时会携带此信息）和密钥版本号（后台发行充值卡时会携带此信息）。终端设备接收充值卡返回的钱包余额和所述充值卡内部信息，并临时将该 钱包余额和所述充值卡内部信息保存下来。终端设备向充值卡发送随机数获取请求；充值卡对该随机数获取请求进行响应，返回4字节的随机数（记为 RAND1 ),并将该随一几数进行保存。终端设备接收充值卡发送的随机数，并临时将该随机数保存下来。终端设备将收到的有关数据（包括：充值卡余额、算法标识、充值卡4字 节随机数（即RAND1 )、充值卡对应的充值卡交易序号和密钥版本号）以及充 值卡应用序列号（即充值卡应用ID),作为命令的数据域，发送充值初始化命 令给复合功能卡，该充值初始化命令携带所述有关数据以及充值卡应用序列号 (即充值卡应用ID)。复合功能卡接收到充值初始化命令后，保存有关数据中的数据项；根据有关数据中的算法标识，选择与充值卡片相同的计算算法；并利用该计算算法进行如下计算：根据其中携带的有关数据中的密钥版本号，选择指定的充值主密钥；并根 据充值主密钥的当前状态标识，判断所指定的充值主密钥是否有效，若有效， 则使用相应的充值主密钥，对充值卡应用序列号进行分散处理，得到对应所述 充值卡的充值子密钥；取复合功能卡上的4字节随机数（记为RAND2)，与 RAND1 &#8212;起构成分散因子，并利用该分散因子对充值子密钥进行计算，产生 过程密钥SK,然后再用SK对如表2所示的相应数据进行MAC计算，产生 MAC1。若所指定的充值主密钥无效，则该复合功能卡送出出错信息。复合功能卡将其离线充值交易序号、复合功能卡上的4字节随机数（即 RAND2 )和所产生的MAC1送给终端设备。终端设备将收到的复合功能卡离线充值交易序号、复合功能卡上的4字节 随机数（即RAND2)和MAC1数据，作为命令的数据域，发送取款命令给充 值卡，其中该取款命令中携带该数据域。充值卡接收到该取款命令后，判断交易金额是否小于或等于原余额，若不 满足条件，则送出出错信息；若满足条件，则利用复合功能卡的4字节随机数 RAND2，与RAND1 &#8212;起构成分散因子，并利用该分散因子对指定的取款子密 钥进行计算产生相同的过程密钥SK，并使用该过程密钥SK-睑证MAC1的正 确性。如果验证通过，则对钱包余额进行清零，也就是说使充值卡的特征数据 无效；更新交易明细记录，对如表3所示的交易明细记录进行更新。充值卡使用过程密钥SK对如表4所示的相应数据进行计算，得到4字节 的MAC2;用内部密钥（后台发行充值卡时会携带此信息）左右8字节异或运 算的结果，对如表5所示的相应数据进行计算，得到4字节的TAC码。充值卡将MAC2和TAC码送出卡外。终端设备将收到的MAC2和TAC码数据作为命令的数据域，发送充值命 令给复合功能卡，其中携带该数据域。复合功能卡接收到该充值命令后，使用过程密钥SK对MAC2进行验证， 如果MAC2校验成功，则将交易金额加到关联电子钱包余额上，对如表6所示 的交易明细记录（包括交易金额、交易类型标识、充值卡交易序号、充值卡应 用ID、离线充值交易序号和TAC码。）进行更新，将其离线充值交易序号加1, 并发送确认信息给终端，否则，复合功能卡将应用错误计数器的计数值减1， 并当计数器的计数值为0时，将该复合功能卡锁死。复合功能卡临时保存TAC码，并在后续提供给后台，以便后台对本次交 易进行验证。终端设备接收确认信息。下面给出了本发明第 一 实施例的第三种具体应用，包括如下内容：第 一步，用户到充值卡代销机构购买所需面值的充值卡。第二步，用户连接（如打电话或发短信）到授权中心，将充值卡上记录的特征数据，如充值卡上记录的卡序列号，以及用户ID号（或用户终端的ID号） (对应着复合功能卡电子钱包应用序列号EPID),提供给授权中心。第三步，授权中心验证所述特征数据和ID的正确性，如正确，则根据所 述特征数据确定出对应的交易金额，并针对ID、交易金额、交易类型、算法标 识、密钥版本、交易日期（当前日期，用于判断复合功能卡内密钥是否有效）、 随机数，生成交易数据和交易验证码。授权中心也可以根据用户ID号（或用户终端的ID号），确定出对应的 EPID,并根据EPID确定出安装有对应电子钱包的终端设备。第四步，授权中心将所述交易数据和交易验证码回送给用户；用户接收到 交易数据和交易验证码后，则通过输入设备（如键盘）将所得到的交易数据和 交易验证码输入到终端设备中，终端设备将其再转发给复合功能卡。授权中心可以直接将所生成的交易数据和交易验证码发送给所确定出的 终端设备，再由终端设备转发给复合功能卡。授权中心通过对该交易数据对应的特征数据置无效标识，使该交易数据对 应的特征数据无效。第五步，复合功能卡根据交易数据中的交易日期检查密钥版本指定的密钥 的有效性，当发现所指定的密钥有效时，则根据指定算法标识对应的算法，用 指定密钥，验证交易验证码的合法性，当发现交易验证码合法时，则将交易数据中的交易金额充值到电子钱包中；取随机数，对表7中的数据进行计算，得 到充值成功验证码；对如表8所示的交易记录明细进行更新，将离线充值交易序号加1。表7&lt;table&gt;table see original document page 20&lt;/column&gt;&lt;/row&gt;
&lt;table&gt;表8		&lt;table&gt;table see original document page 20&lt;/column&gt;&lt;/row&gt;
&lt;table&gt;复合功能卡临时保存TAC码，并在后续提供给授权中心，以便授权中心 对本次交易进行验证。本发明第二实施例提供了一种复合功能卡，该复合功能卡的结构如图4所 示，包括：获取单元和充值单元，还可以进一步包括认证单元、更新单元、判 断单元和锁定单元，还可以进一步包括通知单元。获取单元，用于获取到根据授权载体的特征数据确定的交易数据；该获取单元可以进一步包括：第一获取子单元、第二获:f又子单元、第三获取子单元、第四获取子单元或第五获取子单元。其中的第一获取子单元，用于通过终端设备，获取到用户输入的交易数据， 所述交易数据由授权中心根据用户上报的授权载体特征数据确定并由所述授;f又中心通知给所述用户；其中的第二获取子单元，用于通过终端设备，获取到授权中心发送给的交 易数据，所述交易数据由授权中心根据用户上报的授权载体特征数据确定，并 由所述授权中心发送给所述终端设备；所述终端设备由所述授权中心根据所述 用户的标识信息或所述用户上报的终端设备标识信息确定出；其中的第三获取子单元，用于通过终端设备，获取到用户输入的交易数据， 所述交易数据由授权中心根据用户上报的授权载体交易过程数据确定并由所 述授权中心通知给用户，所述交易过程数据由授权载体根据本地的特征数据确定；其中的第四获取子单元，用于通过终端设备，获取到授权中心发送给的交 易数据，所述交易数据由授权中心根据用户上报的授权载体交易过程数据确定 并由所述授权中心发送给所述终端设备；所述交易过程数据由授权载体根据本 地的特征数据确定；所述终端设备由所述授权中心根据所述用户的标识信息或 所述用户上报的终端i殳备标识信息确定出；或者，其中的第五获取子单元，用于通过终端设备，从授权载体中，获取到授权 载体根据本地的特征数据确定的交易数据。上述充值单元，用于根据所述交易数据，对电子钱包进行充值。该复合功能卡进一步包括的认证单元，用于对所述交易数据进行合法性验 证，并确认合法性验证通过后，触发充值单元工作。认证单元通过终端设备，获得授权载体或授权中心生成的交易验证码（授 权载体按照算法标识对应的算法，利用随机数，对指定子密钥进行计算，产生过程密钥，并利用所述过程密钥对授权载体中的交易额度值进行计算，得到交 易验证码。），以及生成所述交易验证码所使用的随机数；利用所述随机数，按 相同的方法生成过程密钥，并利用所述过程密钥对所述交易验证码进行合法性 验证。然后将交易合法的信息传输给充值单元。该复合功能卡进一步包括的更新单元，用于当认证单元确定合法性验证未通过时，根据本次验证未通过更新错误次数；该复合功能卡进一步包括的判断单元，用于判断错误次数是否达到设置阈值；该复合功能卡进一步包括的锁定单元，用于所述判断单元判断错误次数达 到设置阈值时，将电子钱包锁死。该复合功能卡还可以进一步包括：通知单元，用于当上述充值单元完成对 电子钱包的充值后，发送完成充值操作通知给终端设备。为了保证充值交易的安全性，上述复合功能卡还可以进一步包括：身份验 证码生成单元，用于生成复合功能卡身份验证码，并将所述复合功能卡身份验 证码以及生成所述复合功能卡身份验证码所使用的复合功能卡随机数和复合 功能卡的内部数据，通过终端设备发送给授权载体或授权中心用于对所述复合 功能卡的身份合法性进行验证。其中，生成复合功能卡身份验证码的处理情况 如下：按照算法标识对应的算法，根据所述密钥版本号选择相应的充值主密钥； 使用充值主密钥对^t受权载体应用序列号进行分散处理，得到充值子密钥；利用 复合功能卡随机数和授权载体随机数，对所述充值子密钥进行计算，产生过程 密钥；并利用所述过程密钥对复合功能卡的内部数据进行计算，得到复合功能 卡身份验证码。为了保证充值交易的安全性，上述复合功能卡还可以进一步包括：身份认 证单元，用于通过终端设备，获得授权载体生成的授权载体身份验证码（授权 载体身份验证码是^^权载体通过如下方式得到的：利用复合功能卡随机数和4受 权载体随机数，对指定子密钥进行计算，产生过程密钥，并利用所述过程密钥对授权载体的内部数据进行计算得到授权载体身份验证码。），以及生成所述授权载体身份验证码所使用的授权载体随机数；根据所述密钥版本号选择相应的 充值主密钥；使用充值主密钥对授权载体应用序列号进行分散处理，得到充值 子密钥；利用复合功能卡随机数和授权载体随机数，对所述充值子密钥进行计 算，产生过程密钥，并利用所述过程密钥对所述授权载体身份验证码进行合法 性验证。上述复合功能卡可以是符合IS07816系列标准以及《中国金融集成电路卡 规范》的智能卡，它支持不同的加密算法，如数据加密算法（Data Encryption Standard, DES ), 3DES,和/或先进的加密算法（Advanced Encryption Standard, AES)等，其内保存多套密钥以及使用有效期等。本发明第三实施例提供一种授权载体，该授权载体的结构如图5所示，包 括：交易数据确定单元和传输单元。该授权载体还可以进一步包括应用请求处 理单元。该授权载体还可以进一步包括数据处理单元。该授权载体还可以进一 步包括扣除单元。交易数据确定单元，用于根据本地的特征数据确定交易数据；上述交易数 据可以是非加密交易凝:据；也可以是加密数据。交易数据确定单元，在生成加 密的交易数据时，按照算法标识对应的算法，利用复合功能卡随机数和授权载 体随机数，对指定密钥进行计算，产生过程密钥，并利用所述过程密钥对授权 载体中的交易额度值进行计算，得到加密的交易数据。传输单元，用于通过终端设备，将所述交易数据传输给电子钱包用来充值。该授权载体进一步包括的应用请求处理单元，用于接收终端设备发送的应 用请求，并根据该应用请求触发所述交易数据确定单元启动。相应地，上述交 易数据确定单元可以根据上述应用请求处理单元的触发启动相应的操作，也可 以通过其他方式启动相应的操作。该授权载体进一步包括的数据处理单元，用于当上述交易数据确定单元成 功使用授权载体的特征数据确定交易数据后，将所述交易数据对应的特征数据无效掉。具体实现与第一实施例中的相关描述相同，这里不再详细描述。该授权载体进一步包括的扣除单元，用于当所述传输单元将所确定的交易 数据成功传送给终端设备后，将所述交易数据扣除。该扣除单元可以进一步包括：判断子单元和额度扣除子单元。 判断子单元，用于判断需要扣除的交易数据是否小于或等于本地存储的额 度值；额度扣除子单元，用于当所述判断子单元的判断结果为是需要扣除的交易 数据等于授权载体存储的额度值时，将授权载体存储的额度值一次扣清；如果 判断子单元的判断结果是需要扣除的额度值小于授权载体存储的额度值时，该 额度扣除子单元支持对授权载体存储的固定余额做多次取款操作。上述授权载体还可以进一步包括：验证码获取单元，用于通过终端设备， 获得复合功能卡生成的复合功能卡身份验证码以及生成所述复合功能卡身份 验证码所使用的复合功能卡随机数和复合功能卡内部数据。上述复合功能卡身 份验证码是可以通过如下方式得到：通过终端设备，从授权载体中获取授权载 体随机数、算法标识、密钥版本号、授权载体应用序列号；按照算法标识对应 的算法；根据所述密钥版本号选择相应的充值主密钥；使用充值主密钥对授权 载体应用序列号进行分散处理，得到充值子密钥；利用复合功能卡随机数和授 权载体随机数，对所述充值子密钥进行计算，产生过程密钥；利用所述过程密 钥对复合功能卡的内部数据进行计算，得到复合功能卡身份验证码。相应地，该授权载体还可以进一步包括：身份认证单元，用于在授权载体 扣除额度值之前，利用从授权载体中取的授权载体随机数和所述复合功能卡随 机数，生成过程密钥，并利用所述过程密钥对所述复合功能卡身份验证码进行 合法性验证。上述授权载体还可以进一步包括：身份验证码生成单元，用于利用复合功 能卡随机数和授权载体随机数，对指定密钥进行计算，产生过程密钥，并利用 所述过程密钥对授权载体的内部信息进行计算得到授权载体身份验证码；所述授权载体身份验证码用于复合功能卡对所述授权载体的身份合法性进行验证。 上述授权载体可以由授权中心发行。授权载体可以是充值卡，也可以是IS07816系列标准以及符合《中国金融集成电路卡规范》的智能卡，它支持不 同的加密算法，如DES, 3-DES， AES。本发明第四实施例提供一种终端设备，该终端设备的结构如图6所示，包 包括获取单元和传输单元。获取单元，用于获取根据授权载体的特征数据所确定的交易数据。传输单元，用于将所述获取单元所获得的交易数据，传输给复合功能卡用 来对电子4艮包充值。上述获取单元可以进一步包括第一获取子单元、第二获取子单元、第三获 取子单元、第四获取子单元或第五获取子单元中的任意一个。其中该第一获取子单元，用于获取到用户输入的交易数据，所述交易数据 由授权中心根据用户上报的授权载体特征数据确定并由所迷授权中心通知给 所述用户；其中该第二获取子单元，用于获取到授权中心发送给的交易数据，所述交 易数据由授权中心根据用户上报的授权载体特征数据确定；其中该第三获取子单元，用于获取到用户输入的交易数据，所述交易数据 由授权中心根据用户上报的授权载体交易过程数据确定并通知给所述用户；所 述交易过程数据由授权载体根据本地的特征数据确定；其中该第四获取子单元，用于获取到授权中心发送给的交易数据，所述交 易数据由授权中心根据用户上报的授权载体交易过程数据确定；所述交易过程 数据由授权载体根据本地的特征数据确定；其中该第五获取子单元，用于从授权载体中，获取到授权载体根据本地的 特征数据确定的交易数据。上述获取单元，还可以进一步用于接收复合功能卡的完成充值操作通知。上述获取单元还可以进一步用于获取复合功能卡的身份验证码，相应地上述传输单元，还用于将所述复合功能卡的身份验证码传输给授权载体，以实现 授权载体对复合功能卡身份的认证，具体实现与本发明第 一 实施例中的相关描 述相同，这里不再描述。上述获取单元还可以进一步用于获取授权载体的身份验证码，相应地上述 传输单元，还用于将所述授权载体的身份验证码传输给复合功能卡，以实现复 合功能卡对授权载体身份的认证，具体实现与本发明第一实施例中的相关描述 相同，这里不再描述。上述获取单元和传输单元可以通过同一个通信端口实现，该通信端口可以为USB ( Universal Serial Bus )、画C ( MultiMedia Card)卡接口 、 SD ( Secure Digital Card)卡接口、智能卡接口等等中的一个或多个。由上述本发明实施例提供的技术方案可以看出，通过终端设备，获取到根 据授权载体的特征数据确定的交易数据；根据所述交易数据，对电子钱包进行 充值。可见本发明实施例能够使用户在离线情况下对电子钱包进行充值，而不 局限于到授权中心指定的机构在联机状态下对电子钱包进行充值，从而能够支 持电子钱包的安全灵活充值模式，在保证安全性的前提下，达到增加运营商的 应用选择、方便用户使用的目的。另外，本发明实施例通过交互授权载体和复合功能卡之间相互进行身份认 证，可以保证对电子钱包充值操作的安全性。显然，本领域的技术人员可以对本发明进行各种改动和变型而不脱离本发 明的精神和范围。这样，倘若本发明的这些修改和变型属于本发明权利要求及 其等同技术的范围之内，则本发明也意图包含这些改动和变型在内。</p>
  </div>
  </div></div><div class="patent-section patent-tabular-section"><a id="forward-citations"></a><div class="patent-section-header"><span class="patent-section-title"> 被以下专利引用</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th">引用专利</th><th class="patent-data-table-th"> 申请日期</th><th class="patent-data-table-th">公开日</th><th class="patent-data-table-th"> 申请人</th><th class="patent-data-table-th">专利名</th></tr></thead><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102404329A?cl=zh">CN102404329A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年11月28日</td><td class="patent-data-table-td patent-date-value">2012年4月4日</td><td class="patent-data-table-td ">苏州英福迈升信息技术有限公司</td><td class="patent-data-table-td ">用户终端与虚拟社区平台间交互的认证加密方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2011060662A1?cl=zh">WO2011060662A1</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2010年9月7日</td><td class="patent-data-table-td patent-date-value">2011年5月26日</td><td class="patent-data-table-td ">Feitian Technologies Co., Ltd.</td><td class="patent-data-table-td ">一种对双电子钱包进行圈存的方法</td></tr></table><div class="patent-section-footer">* 由审查员引用</div></div><div class="patent-section patent-tabular-section"><a id="classifications"></a><div class="patent-section-header"><span class="patent-section-title">分类</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th"> </th><th class="patent-data-table-th"> </th></tr></thead><tr><td class="patent-data-table-td ">国际分类号</td><td class="patent-data-table-td "><span class="nested-value"><a href="https://www.google.com/url?id=kL1eBwABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=G06Q0020360000">G06Q20/36</a></span>, <span class="nested-value"><a href="https://www.google.com/url?id=kL1eBwABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=G07F0007080000">G07F7/08</a></span>, <span class="nested-value"><a href="https://www.google.com/url?id=kL1eBwABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=H04Q0007200000">H04Q7/20</a></span></td></tr></table><div class="patent-section-footer"></div></div><div class="patent-section patent-tabular-section"><a id="legal-events"></a><div class="patent-section-header"><span class="patent-section-title">法律事件</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th"> 日期</th><th class="patent-data-table-th">代码</th><th class="patent-data-table-th">事件</th><th class="patent-data-table-th">说明</th></tr></thead><tr><td class="patent-data-table-td patent-date-value">2008年8月6日</td><td class="patent-data-table-td ">C06</td><td class="patent-data-table-td ">Publication</td><td class="patent-data-table-td "></td></tr><tr><td class="patent-data-table-td patent-date-value">2008年10月1日</td><td class="patent-data-table-td ">C10</td><td class="patent-data-table-td ">Request of examination as to substance</td><td class="patent-data-table-td "></td></tr><tr><td class="patent-data-table-td patent-date-value">2012年8月22日</td><td class="patent-data-table-td ">C14</td><td class="patent-data-table-td ">Granted</td><td class="patent-data-table-td "></td></tr></table><div class="patent-section-footer"></div></div><div class="modal-dialog" id="patent-images-lightbox"><div class="patent-lightbox-controls"><div class="patent-lightbox-rotate-controls"><div class="patent-lightbox-rotation-text">旋转</div><div class="rotate-icon rotate-ccw-icon"></div><div class="rotate-icon rotate-cw-icon"></div></div><div class="patent-lightbox-index-counter"></div><a class="patent-lightbox-fullsize-link" target="_blank">原始图片</a><div class="patent-drawings-control patent-drawings-next"><img class="patent-drawings-button-img"src="/googlebooks/images/kennedy/page_right.png" alt="Next page"width="21" height="21" /></div><div class="patent-drawings-control patent-drawings-prev"><img class="patent-drawings-button-img"src="/googlebooks/images/kennedy/page_left.png" alt="Previous page"width="21" height="21" /></div></div><div class="modal-dialog-content"><div class="patent-lightbox-image-holder"><div class="patent-lightbox-placeholder"></div></div></div></div><script>_OC_initPatentsAtb({image_not_available_html: " 未提供图片。\x3ca href\x3d//docs.google.com/viewer?url\x3dpatentimages.storage.googleapis.com/pdfs/7c066f8929a003eb285f/CN101236673A.pdf\x3e查看 PDF\x3c/a\x3e"});</script></div></div></div></div></div><script>(function() {var href = window.location.href;if (href.indexOf('?') !== -1) {var parameters = href.split('?')[1].split('&');for (var i = 0; i < parameters.length; i++) {var param = parameters[i].split('=');if (param[0] == 'focus') {var elem = document.getElementById(param[1]);if (elem) {elem.focus();}}}}})();</script><script>_OC_addFlags({LockSrc:"/books/javascript/lock_6e802a6b2b28d51711baddc2f3bec198.js", Host:"https://www.google.com/", IsBooksRentalEnabled:1, IsBrowsingHistoryEnabled:1, IsWebReaderSvgEnabled:0, IsImageModeNotesEnabled:1, IsOfflineBubbleEnabled:1, IsFutureOnSaleVolumesEnabled:1, IsBooksUnifiedLeftNavEnabled:1, IsMobileRequest:0, IsZipitFolderCollectionEnabled:1, IsAdsDisabled:0, IsEmbeddedMediaEnabled:1, IsImageModeAnnotationsEnabled:1, IsMyLibraryGooglePlusEnabled:1, IsImagePageProviderEnabled:1, IsBookcardListPriceSmall:0, IsInternalUser:0, IsBooksShareButtonEnabled:0, IsDisabledRandomBookshelves:0});_OC_Run({"enable_p13n":false,"is_cobrand":false,"sign_in_url":"https://www.google.com/accounts/Login?service=\u0026continue=https://www.google.com/patents%3Fcl%3Dzh%26hl%3Dzh-CN\u0026hl=zh-CN"}, {"volume_id":"","is_ebook":true,"volumeresult":{"has_flowing_text":false,"has_scanned_text":true,"can_download_pdf":false,"can_download_epub":false,"is_pdf_drm_enabled":false,"is_epub_drm_enabled":false,"download_pdf_url":"https://www.google.com/patents/download/%E5%AE%9E%E7%8E%B0%E7%94%B5%E5%AD%90%E9%92%B1%E5%8C%85%E7%A6%BB%E7%BA%BF%E5%85%85%E5%80%BC%E7%9A%84%E6%96%B9%E6%B3%95.pdf?id=kL1eBwABERAJ\u0026hl=zh-CN\u0026output=pdf\u0026sig=ACfU3U3eHPp7b6Akz5PGkaBeqZ454lSrgA"},"sample_url":"https://www.google.com/patents/reader?id=kL1eBwABERAJ\u0026hl=zh-CN\u0026printsec=frontcover\u0026output=reader\u0026source=gbs_atb_hover","is_browsable":true,"is_public_domain":true}, {});</script><div id="footer_table" style="font-size:83%;text-align:center;position:relative;top:20px;height:4.5em;margin-top:2em"><div style="margin-bottom:8px"><a href="https://www.google.com/search?hl=zh-CN"><nobr>Google&nbsp;首页</nobr></a> - <a href="//www.google.com/patents/sitemap/"><nobr>站点地图</nobr></a> - <a href="http://www.google.com/googlebooks/uspto.html"><nobr>美国专利商标局 (USPTO) 专利信息批量下载</nobr></a> - <a href="/intl/zh-CN/privacy/"><nobr>隐私权政策</nobr></a> - <a href="/intl/zh-CN/policies/terms/"><nobr>服务条款</nobr></a> - <a href="https://support.google.com/faqs/answer/2539193?hl=zh-CN"><nobr> 关于 Google 专利</nobr></a> - <a href="//www.google.com/tools/feedback/intl/zh-CN/error.html" onclick="try{_OC_startFeedback({productId: '72792',locale: 'zh-CN'});return false;}catch(e){}"><nobr>发送反馈</nobr></a></div></div> <script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">var pageTracker = _gat._getTracker("UA-27188110-1");pageTracker._setCookiePath("/patents/");pageTracker._trackPageview();</script> </body></html>