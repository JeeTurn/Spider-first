<!DOCTYPE html><html><head><title>专利 CN101814984A - 获取不对称延迟时间的方法和装置 -  Google 专利</title><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){var d=void 0!=b?b:(new Date).getTime();this.t[a]=[d,c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(e){}};this.tick("start",null,a)}var a;window.performance&&(a=window.performance.timing);var f=a?new e(a.responseStart):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_",
"_wtsrt",d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();})();
</script><link rel="stylesheet" href="/patents/css/_5115ea495017d9115e613207d3810e5a/kl_intl_patents_bundle.css" type="text/css" /><script src="/books/javascript/atb_5115ea495017d9115e613207d3810e5a__zh_cn.js"></script><script>function googleTranslateElementInit() {new google.translate.TranslateElement({pageLanguage: "zh",gaTrack: true,gaId: "UA-27188110-1",multilanguagePage: true});}</script><script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script><meta name="DC.type" content="Patent"><meta name="DC.title" content="获取不对称延迟时间的方法和装置"><meta name="DC.contributor" content="吴锋荣" scheme="inventor"><meta name="DC.contributor" content="赵成祥" scheme="inventor"><meta name="DC.contributor" content="华为技术有限公司" scheme="assignee"><meta name="DC.date" content="2010-4-9" scheme="dateSubmitted"><meta name="DC.description" content="公开了获取不对称延迟时间的方法和装置。其中的方法包括：获取报文在设备物理层的发送先进先出缓冲器中的驻留时间T1，并获取报文在所述设备物理层的接收先进先出缓冲器中的驻留时间T2；根据所述T1和T2的差值、所述物理层固有延迟时间和传输线路延迟时间三者之和获得不对称延迟时间。上述技术方案可以准确方便的获得网络设备的不对称延迟时间，从而降低了时间同步的实现成本，提高了时间同步的效率。"><meta name="DC.date" content="2010-8-25"><meta name="DC.relation" content="CN:101098219:A" scheme="references"><meta name="DC.relation" content="CN:101636662:A" scheme="references"><meta name="DC.relation" content="CN:1675864:A" scheme="references"><meta name="DC.relation" content="EP:1659718:A2" scheme="references"><meta name="DC.relation" content="EP:1801687:A1" scheme="references"><meta name="citation_patent_publication_number" content="CN:101814984:A"><meta name="citation_patent_application_number" content="CN:201010144627"><link rel="canonical" href="https://www.google.com/patents/CN101814984A?cl=zh"/><meta property="og:url" content="https://www.google.com/patents/CN101814984A?cl=zh"/><meta name="title" content="专利 CN101814984A - 获取不对称延迟时间的方法和装置"/><meta name="description" content="公开了获取不对称延迟时间的方法和装置。其中的方法包括：获取报文在设备物理层的发送先进先出缓冲器中的驻留时间T1，并获取报文在所述设备物理层的接收先进先出缓冲器中的驻留时间T2；根据所述T1和T2的差值、所述物理层固有延迟时间和传输线路延迟时间三者之和获得不对称延迟时间。上述技术方案可以准确方便的获得网络设备的不对称延迟时间，从而降低了时间同步的实现成本，提高了时间同步的效率。"/><meta property="og:title" content="专利 CN101814984A - 获取不对称延迟时间的方法和装置"/><meta property="og:type" content="book"/><meta property="og:site_name" content="Google Books"/><meta property="og:image" content="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"/><link rel="image_src" href="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"/><script>if (window['_OC_timingAction']) {window['_OC_timingAction']('patents_refpage');}</script><style>#gbar,#guser{font-size:13px;padding-top:1px !important;}#gbar{height:22px}#guser{padding-bottom:7px !important;text-align:right}.gbh,.gbd{border-top:1px solid #c9d7f1;font-size:1px}.gbh{height:0;position:absolute;top:24px;width:100%}@media all{.gb1{height:22px;margin-right:.5em;vertical-align:top}#gbar{float:left}}a.gb1,a.gb4{text-decoration:underline !important}a.gb1,a.gb4{color:#00c !important}.gbi .gb4{color:#dd8e27 !important}.gbf .gb4{color:#900 !important}

#gbar { padding:.3em .6em !important;}</style></head><body ><div id=gbar><nobr><a class=gb1 href="https://www.google.com/search?cl=zh&hl=zh-CN&sa=N&tab=tw">搜索</a> <a class=gb1 href="https://www.google.com/search?cl=zh&hl=zh-CN&tbm=isch&source=og&sa=N&tab=ti">图片</a> <a class=gb1 href="https://maps.google.com/maps?cl=zh&hl=zh-CN&sa=N&tab=tl">地图</a> <a class=gb1 href="https://play.google.com/?cl=zh&hl=zh-CN&sa=N&tab=t8">Play</a> <a class=gb1 href="https://www.youtube.com/results?cl=zh&hl=zh-CN&sa=N&tab=t1">YouTube</a> <a class=gb1 href="https://news.google.com/nwshp?hl=zh-CN&tab=tn">新闻</a> <a class=gb1 href="https://mail.google.com/mail/?tab=tm">Gmail</a> <a class=gb1 href="https://drive.google.com/?tab=to">云端硬盘</a> <a class=gb1 style="text-decoration:none" href="https://www.google.com/intl/zh-CN/options/"><u>更多</u> &raquo;</a></nobr></div><div id=guser width=100%><nobr><span id=gbn class=gbi></span><span id=gbf class=gbf></span><span id=gbe></span><a target=_top id=gb_70 href="https://www.google.com/accounts/Login?service=&continue=https://www.google.com/patents%3Fcl%3Dzh%26hl%3Dzh-CN&hl=zh-CN" class=gb4>登录</a></nobr></div><div class=gbh style=left:0></div><div class=gbh style=right:0></div><div role="alert" style="position: absolute; left: 0; right: 0;"><a href="https://www.google.com/patents/CN101814984A?cl=zh&amp;hl=zh-CN&amp;output=html_text" title="屏幕阅读器用户请注意：点击此链接可进入无障碍模式。阅读器在无障碍模式下具有同样的基本功能，但可让用户获得更好的体验。"><img border="0" src="//www.google.com/images/cleardot.gif"alt="屏幕阅读器用户请注意：点击此链接可进入无障碍模式。阅读器在无障碍模式下具有同样的基本功能，但可让用户获得更好的体验。"></a></div><div class="kd-appbar"><h2 class="kd-appname"><a href="/patents?hl=zh-CN"> 专利</a></h2><div class="kd-buttonbar left" id="left-toolbar-buttons"><a id="appbar-write-review-link" href=""></a><a id="appbar-view-print-sample-link" href=""></a><a id="appbar-view-ebook-sample-link" href=""></a><a id="appbar-patents-prior-art-finder-link" href="https://www.google.com/patents/related/CN101814984A"></a><a id="appbar-patents-discuss-this-link" href="https://www.google.com/url?id=HdR5BwABERAJ&amp;q=http://patents.stackexchange.com/redirect/google-patents%3Fpublication%3DCN101814984A&amp;usg=AFQjCNGTJ597ChnRfFdordemZFMjTunPpQ" data-is-grant="false"></a><a id="appbar-read-patent-link" href="//docs.google.com/viewer?url=patentimages.storage.googleapis.com/pdfs/deda929ef736cc4f772e/CN101814984A.pdf"></a><a id="appbar-download-pdf-link" href="//patentimages.storage.googleapis.com/pdfs/deda929ef736cc4f772e/CN101814984A.pdf"></a><a class="appbar-content-language-link" data-selected="true" data-label="中文" href="/patents/CN101814984A?cl=zh&amp;hl=zh-CN"></a><a class="appbar-content-language-link" data-label="英语" href="/patents/CN101814984A?cl=en&amp;hl=zh-CN"></a><a class="appbar-application-grant-link" data-selected="true" data-label="申请" href="/patents/CN101814984A?hl=zh-CN&amp;cl=zh"></a><a class="appbar-application-grant-link" data-label="授权" href="/patents/CN101814984B?hl=zh-CN&amp;cl=zh"></a></div><div class="kd-buttonbar right" id="right-toolbar-buttons"></div></div><div id="books-microdata" itemscope=""itemtype="http://schema.org/Book"itemid="https://www.google.com/patents/CN101814984A?cl=zh" style="display:none"><span itemprop="description">公开了获取不对称延迟时间的方法和装置。其中的方法包括：获取报文在设备物理层的发送先进先出缓冲器中的驻留时间T1，并获取报文在所述设备物理层的接收先进先出缓冲器中的驻留时间T2；根据所述T1和T2的差值、所述物理 ...</span><span itemprop="url">https://www.google.com/patents/CN101814984A?cl=zh&amp;utm_source=gb-gplus-share</span><span class="main-title" itemprop="name">专利 CN101814984A - 获取不对称延迟时间的方法和装置</span><img itemprop="image" src="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"alt="专利 CN101814984A - 获取不对称延迟时间的方法和装置" title="专利 CN101814984A - 获取不对称延迟时间的方法和装置"></div><div style="display: none"><ol id="ofe-gear-menu-contents" class="gbmcc"><li class="gbe gbmtc"><a class="gbmt goog-menuitem-content" id="" href="https://www.google.com/advanced_patent_search?hl=zh-CN"> 高级专利搜索</a></li></ol></div><div id="volume-main"><div id="volume-center"><div class=vertical_module_list_row><div id=intl_patents class=about_content><div id=intl_patents_v><table class="patent-bibdata patent-drawings-missing"><tr><td class="patent-bibdata-heading"> 公开号</td><td class="single-patent-bibdata">CN101814984 A</td></tr><tr><td class="patent-bibdata-heading">发布类型</td><td class="single-patent-bibdata">申请</td></tr><tr><td class="patent-bibdata-heading"> 专利申请号</td><td class="single-patent-bibdata">CN 201010144627</td></tr><tr><td class="patent-bibdata-heading">公开日</td><td class="single-patent-bibdata">2010年8月25日</td></tr><tr><td class="patent-bibdata-heading"> 申请日期</td><td class="single-patent-bibdata">2010年4月9日</td></tr><tr><td class="patent-bibdata-heading"> 优先权日<span class="patent-tooltip-anchor patent-question-icon"data-tooltip-text="优先日期属于假设性质，不具任何法律效力。Google 对于所列日期的正确性并没有进行法律分析，也不作任何陈述。"></span></td><td class="single-patent-bibdata">2010年4月9日</td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">公告号</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="/patents/CN101814984B?hl=zh-CN&amp;cl=zh">CN101814984B</a>, </span><span class="patent-bibdata-value"><a href="/patents/WO2011124113A1?hl=zh-CN&amp;cl=zh">WO2011124113A1</a></span></span></td></tr><tr class="patent-bibdata-list-row alternate-patent-number"><td class="patent-bibdata-heading"> 公开号</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value">201010144627.6, </span><span class="patent-bibdata-value">CN 101814984 A, </span><span class="patent-bibdata-value">CN 101814984A, </span><span class="patent-bibdata-value">CN 201010144627, </span><span class="patent-bibdata-value">CN-A-101814984, </span><span class="patent-bibdata-value">CN101814984 A, </span><span class="patent-bibdata-value">CN101814984A, </span><span class="patent-bibdata-value">CN201010144627, </span><span class="patent-bibdata-value">CN201010144627.6</span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading"> 发明者</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E5%90%B4%E9%94%8B%E8%8D%A3%22">吴锋荣</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E8%B5%B5%E6%88%90%E7%A5%A5%22">赵成祥</a></span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading"> 申请人</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=inassignee:%22%E5%8D%8E%E4%B8%BA%E6%8A%80%E6%9C%AF%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8%22">华为技术有限公司</a></span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">导出引文</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="/patents/CN101814984A.bibtex?cl=zh">BiBTeX</a>, </span><span class="patent-bibdata-value"><a href="/patents/CN101814984A.enw?cl=zh">EndNote</a>, </span><span class="patent-bibdata-value"><a href="/patents/CN101814984A.ris?cl=zh">RefMan</a></span></span></td></tr><tr class="patent-internal-links"><td colspan=2><span class="patent-bibdata-value"><a href="#backward-citations">专利引用</a> (5),</span> <span class="patent-bibdata-value"><a href="#forward-citations"> 被以下专利引用</a> (7),</span> <span class="patent-bibdata-value"><a href="#classifications">分类</a> (5),</span> <span class="patent-bibdata-value"><a href="#legal-events">法律事件</a> (2)</span> </td></tr><tr><td colspan=2 class="patent-bibdata-external-link-spacer-top"></td></tr><tr class="patent-bibdata-external-link-spacer-bottom"></tr><tr><td colspan=2><span class="patent-bibdata-heading">外部链接:&nbsp;</span><span><span class="patent-bibdata-value"><a href="https://www.google.com/url?id=HdR5BwABERAJ&amp;q=http://211.157.104.87:8080/sipo/zljs/hyjs-yx-new.jsp%3Frecid%3D201010144627&amp;usg=AFQjCNH3oXICNJyYFMPtou8M3tt5GvcA4A"> 中国国家知识产权局</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/url?id=HdR5BwABERAJ&amp;q=http://worldwide.espacenet.com/publicationDetails/biblio%3FCC%3DCN%26NR%3D101814984A%26KC%3DA%26FT%3DD&amp;usg=AFQjCNEYQhPzzScpiPHOoAREAipdofBE7A"> 欧洲专利数据库 (Espacenet)</a></span></span></td></tr><tr class="patent-bibdata-group-spacer"></tr></table><div class="number-and-title"><span class="patent-title"><invention-title mxw-id="PT97240448" lang="ZH" load-source="patent-office">获取不对称延迟时间的方法和装置</invention-title>
      </span><br><span class="patent-number">CN 101814984 A</span></div><div class="patent-section patent-abstract-section"><div class="patent-section-header"><span class="patent-section-title"> 摘要</span></div><div class="patent-text"><abstract mxw-id="PA79773194" lang="ZH" load-source="patent-office">
    <div class="abstract">公开了获取不对称延迟时间的方法和装置。其中的方法包括：获取报文在设备物理层的发送先进先出缓冲器中的驻留时间T1，并获取报文在所述设备物理层的接收先进先出缓冲器中的驻留时间T2；根据所述T1和T2的差值、所述物理层固有延迟时间和传输线路延迟时间三者之和获得不对称延迟时间。上述技术方案可以准确方便的获得网络设备的不对称延迟时间，从而降低了时间同步的实现成本，提高了时间同步的效率。</div>
  </abstract>
  </div></div><div class="patent-section patent-claims-section"><div class="patent-section-header"><span class="patent-section-title">权利要求<span class="patent-section-count">(14)</span></span></div><div class="patent-text"><ol mxw-id="PCLM32940259" lang="ZH" load-source="patent-office" class="claims">
    <li class="claim"> <div num="1" class="claim">
      <div class="claim-text">一种获取不对称延迟时间的方法，其特征在于，包括：获取报文在设备物理层的发送先进先出缓冲器中的驻留时间T1，并获取报文在所述设备物理层的接收先进先出缓冲器中的驻留时间T2；根据所述T1和T2的差值、所述物理层固有延迟时间与传输线路延迟时间三者之和获得不对称延迟时间。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="2" class="claim">
      <div class="claim-text">2.如权利要求1所述的方法，其特征在于，所述获取报文在设备物理层的发送先进先 出缓冲器中的驻留时间Tl包括：在事件报文从媒质接入控制MAC层向物理层发送时，为所述事件报文加入时间戳；在检测出所述物理层接收到所述MAC层发送的带有所述时间戳的报文时，根据时钟周 期数量和时钟周期的时长的乘积获取所述驻留时间Tl，所述时钟周期数量为：从所述发送 先进先出缓冲器中读取出当前深度的数据所消耗的所述设备本地时钟的时钟周期数量，所 述当前深度为：在检测出所述物理层接收到所述MAC层发送的带有所述时间戳的报文时， 获取的所述物理层的发送先进先出缓冲器的当前深度。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="3" class="claim">
      <div class="claim-text">3.如权利要求1所述的方法，其特征在于，所述获取报文在设备物理层的发送先进先 出缓冲器中的驻留时间Tl包括：在事件报文从MAC层向物理层发送时，为所述事件报文加入第一时间戳；在所述事件报文从物理层向对端设备的物理层发送时，为所述事件报文记录第二时间戳；根据所述第一时间戳和第二时间戳的差值获取所述驻留时间Tl。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="4" class="claim">
      <div class="claim-text">4.如权利要求1所述的方法，其特征在于，所述获取报文在设备物理层的发送先进先 出缓冲器中的驻留时间Tl包括：在事件报文从MAC层向物理层发送时，根据当前拥塞度和所述设备本地时钟的时钟周 期的时长的乘积获取所述驻留时间Tl，所述当前拥塞度为：在事件报文从MAC层向物理层 发送时，获取的所述物理层中发送先进先出缓冲器的当前拥塞度。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="5" class="claim">
      <div class="claim-text">5.如权利要求1至4中任一权利要求所述的方法，其特征在于，所述获取报文在所述设 备物理层的接收先进先出缓冲器中的驻留时间T2包括：在检测出所述物理层接收到对端设备发送的带有时间戳的报文时，根据时钟周期数量和所述时钟周期的时长的乘积获取所述驻留时间T2，所述时钟周期 数量为：从所述接收先进先出缓冲器中读取出当前深度的数据所消耗的所述设备本地时钟 的时钟周期数量，所述当前深度为：在检测出所述物理层接收到对端设备发送的带有时间 戳的事件报文时，获取的所述物理层的接收先进先出缓冲器的当前深度。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="6" class="claim">
      <div class="claim-text">6.如权利要求1至4中任一权利要求所述的方法，其特征在于，所述获取报文在所述设 备物理层的接收先进先出缓冲器中的驻留时间T2包括：在检测出所述物理层接收到对端设备发送来的带有时间戳的事件报文时，为所述事件 报文记录第三时间戳；在所述事件报文从所述物理层向MAC层发送时，为所述事件报文加入第四时间戳；根据所述第三时间戳和第四时间戳的差值获取所述驻留时间T2。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="7" class="claim">
      <div class="claim-text">7.如权利要求1至4中任一权利要求所述的方法，其特征在于，所述获取报文在所述设 备物理层的接收先进先出缓冲器中的驻留时间T2包括：在对端设备传输来的携带有时间戳的事件报文从物理层向MAC层发送时，获取所述物 理层中接收先进先出缓冲器的当前拥塞度；根据所述当前拥塞度和所述设备本地时钟的时钟周期的时长的乘积获取所述驻留时 间T2。</div>
    </div>
    </li> <li class="claim"> <div num="8" class="claim">
      <div class="claim-text">8.	一种获取不对称延迟时间的装置，其特征在于，包括：第一获取模块，用于获取报文在设备物理层的发送先进先出缓冲器中的驻留时间Tl， 并获取报文在所述设备物理层的接收先进先出缓冲器中的驻留时间T2 ；第二获取模块，用于根据所述Tl和T2的差值、所述物理层固有延迟时间与传输线路延 迟时间三者之和获得不对称延迟时间。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="9" class="claim">
      <div class="claim-text">9.如权利要求8所述的装置，其特征在于，所述第一获取模块包括：第一时间戳子模块，用于在事件报文从MAC层向物理层发送时，为所述事件报文加入 时间戳；第一获取深度子模块，用于在所述物理层接收到所述MAC层发送的所述事件报文时， 获取所述物理层的发送先进先出缓冲器的当前深度；第一计数子模块，用于在所述物理层接收到所述MAC层发送的所述事件报文时，确定 对从所述发送先进先出缓冲器中读取出所述当前深度的数据所消耗的所述设备本地时钟 的时钟周期数量；第一计算子模块，用于根据所述第一计数子模块确定的时钟周期数量和所述时钟周期 的时长的乘积获取所述驻留时间Tl。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="10" class="claim">
      <div class="claim-text">10.如权利要求8所述的装置，其特征在于，所述第一获取模块包括：第一时间戳子模块，用于在事件报文从MAC层向物理层发送时，为所述事件报文加入 第一时间戳；第二时间戳子模块，用于在所述事件报文从物理层向对端设备的物理层发送时，为所 述事件报文记录第二时间戳；第二计算子模块，用于根据所述第一时间戳和第二时间戳的差值获取所述驻留时间Tl。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="11" class="claim">
      <div class="claim-text">11.如权利要求8所述的装置，其特征在于，所述第一获取模块包括：第一拥塞度子模块，用于在事件报文从MAC层向物理层发送时，获取所述物理层中发 送先进先出缓冲器的当前拥塞度；第三计算子模块，用于根据所述第一拥塞度子模块获取的当前拥塞度和所述设备本地 时钟的时钟周期的时长的乘积获取所述驻留时间T1。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="12" class="claim">
      <div class="claim-text">12.如权利要求8至11中任一权利要求所述的装置，其特征在于，所述第一获取模块包括：第二获取深度子模块，用于在所述物理层接收到对端设备发送的带有时间戳的事件报 文时，获取所述物理层的接收先进先出缓冲器的当前深度；第二计数子模块，用于在所述物理层接收到对端设备发送的带有时间戳的事件报文 时，确定对从所述接收先进先出缓冲器中读取出所述当前深度的数据所消耗的所述设备本 地时钟的时钟周期数量；第四计算子模块，用于根据所述第二计数子模块确定的时钟周期数量和所述时钟周期的时长的乘积获取所述驻留时间T2。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="13" class="claim">
      <div class="claim-text">13.如权利要求8至11中任一权利要求所述的装置，其特征在于，所述第一获取模块包括：第三时间戳子模块，用于在所述物理层接收到对端设备发送来的事件报文时，为所述 事件报文记录第三时间戳；第四时间戳子模块，用于在所述事件报文从所述物理层向MAC层发送时，为所述事件 报文加入第四时间戳；第五计算子模块，用于获取第三时间戳和第四时间戳，并根据所述第三时间戳和第四 时间戳的差值获取所述驻留时间T2。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="14" class="claim">
      <div class="claim-text">14.如权利要求8至11中任一权利要求所述的装置，其特征在于，所述第一获取模块包括：第二拥塞度子模块，用于在对端设备传输来的携带有时间戳的事件报文从物理层向 MAC层发送时，获取所述物理层中接收先进先出缓冲器的当前拥塞度；第六计算子模块，用于根据所述第二拥塞度子模块获取的当前拥塞度和所述设备本地 时钟的时钟周期的时长的乘积获取所述驻留时间T2。</div>
    </div>
  </li> </ol>
  </div></div><div class="patent-section patent-description-section"><div class="patent-section-header"><span class="patent-section-title"> 说明</span></div><div class="patent-text"><div mxw-id="PDES38247571" lang="ZH" load-source="patent-office" class="description">
    <p>获取不对称延迟时间的方法和装置</p>
    <p>技术领域</p>
    <p>[0001]	 本发明涉及通讯技术领域，具体涉及获取不对称延迟时间的技术。 背景技术</p>
    <p>[0002]	IEEE1588V2是一种精确的时间同步协议，可以称为PTP(Precision TimeProtocol，精确时间协议）。PTP通过在设备间（如主从设备间或者请求器与响应器之 间）进行消息传输实现时间同步。</p>
    <p>[0003]	目前，由于PHY(物理)层芯片等原因会导致通讯链路存在延迟不对称性，即第一 设备到第二设备方向的延迟时间与第二设备到第一设备方向的延迟时间不相同。上述第 一设备为主设备时，第二设备为从设备，第一设备为请求器时，第二设备为响应器。针对延 迟不对称性链路，PTP提出的对第二设备的通信链路进行补偿的时间同步方法包括如下计 算：</p>
    <p>[0004]	Tms = &lt;meanPathDelay&gt;+deIayAsymmetry ；</p>
    <p>[0005]	Tsm = &lt;meanPathDelay&gt;-deIayAsymmetry ；</p>
    <p>[0006]	其中，Tms为第一设备到第二设备方向的延迟时间；Tsm为第二设备到第一设 备方向的延迟时间；meanPathDelay为第一设备到第二设备和第二设备到第一设备的平 均路径延迟时间，delayAsymmetry为不对称延迟时间，在第一设备到第二设备方向的传 输时间大于第二设备到第一设备的传输时间时，delayAsymmetry可以定义为正数，否则 delayAsymmetry 为负数。</p>
    <p>[0007]	在实现本发明的过程中，发明人发现：PTP中并没有给出delayAsymmetry的获得 方法，而现有技术中通常采用基于GPS (Global Position System，全球定位系统）的专用仪 器进行实地测量的方式来获得delayAsymmetry。明显的，采用专用仪器实地测量的方式会 使时间同步的实现成本高且效率低。</p>
    <p>发明内容</p>
    <p>[0008]	本发明实施方式提供的获取不对称延迟时间的方法和装置，可准确方便的获得设 备的不对称延迟时间，从而可以降低时间同步的实现成本，提高时间同步的效率。</p>
    <p>[0009]	本发明实施方式提供的获取不对称延迟时间的方法，包括：</p>
    <p>[0010]	获取报文在设备物理层的发送先进先出缓冲器中的驻留时间Tl，并获取报文在所 述设备物理层的接收先进先出缓冲器中的驻留时间T2 ；</p>
    <p>[0011]	根据所述Tl和T2的差值、所述物理层固有延迟时间与传输线路延迟时间三者之 和获得不对称延迟时间。</p>
    <p>[0012]	本发明实施方式提供的获取不对称延迟时间的装置，包括：</p>
    <p>[0013]	第一获取模块，用于获取报文在设备物理层的发送先进先出缓冲器中的驻留时间 Tl，并获取报文在所述设备物理层的接收先进先出缓冲器中的驻留时间T2 ；</p>
    <p>[0014]	第二获取模块，用于根据所述Tl和T2的差值、所述物理层固有延迟时间与传输线路延迟时间三者之和获得不对称延迟时间。</p>
    <p>[0015]	通过上述技术方案的描述可知，通过利用数据在物理层的发送先进先出缓冲器中 的驻留时间以及该数据在物理层的接收先进先出缓冲器中的驻留时间，可以获取物理层延 迟时间，通过利用该物理层延迟时间和传输线路延迟时间可以方便准确的获得不对称延迟 时间，从而可以方便的进行时间同步，降低了时间同步的实现成本，提高了时间同步的效率。</p>
    <p>附图说明</p>
    <p>[0016]	为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现 有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本 发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以 根据这些附图获得其他的附图。</p>
    <p>[0017]	图1是本发明实施例一的获取不对称延迟时间的方法流程图；</p>
    <p>[0018]	图IA是本发明实施例一的同步FIFO缓冲器的示意图；</p>
    <p>[0019]	图IB是本发明实施例一的异步FIFO缓冲器的示意图；</p>
    <p>[0020]	图2是本发明实施例二的获取不对称延迟时间的装置示意图；</p>
    <p>[0021]	图2A至2F是本发明实施例二的第一获取模块示意图；</p>
    <p>[0022]	图3是本发明实施例三的具体应用的获取不对称延迟时间的装置示意图；</p>
    <p>[0023]	图3A是本发明实施例三的时序图；</p>
    <p>[0024]	图4是本发明实施例四的具体应用的获取不对称延迟时间的装置示意图；</p>
    <p>[0025]	图5是本发明实施例五的具体应用的获取不对称延迟时间的装置示意图。</p>
    <p>具体实施方式</p>
    <p>[0026]	下面通过实施例对本发明的具体实现过程进行例举说明。显然，下面所描述的实 施例是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通 技术人员在没有作出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。</p>
    <p>[0027]	实施例一、获取不对称延迟时间的方法，包括：获取报文在设备物理层的发送先进 先出缓冲器中的驻留时间Tl，并获取报文在所述设备物理层的接收先进先出缓冲器中的驻 留时间T2 ；根据所述Tl和T2的差值、所述物理层固有延迟时间与传输线路延迟时间三者 之和获得不对称延迟时间。</p>
    <p>[0028]	该方法的流程如附图1所示。</p>
    <p>[0029]	图1中，S100、获取报文（如带有时间戳的报文）在设备物理层的发送FIFO缓冲 器中的驻留时间Tl。这里的设备为从设备或者响应器等，具体的可以为基站等。上述发送 FIFO缓冲器可以为同步FIF0(即发送FIFO缓冲器的读时钟和写时钟为同一个时钟），也可 以为异步FIF0(即发送FIFO缓冲器的读时钟和写时钟为不同的时钟）。同步FIFO缓冲器 的一个具体例子如附图IA所示，异步FIFO缓冲器的一个具体例子如附图IB所示。本实施 例不限制设备的具体表现形式以及发送FIFO缓冲器的具体结构和具体型号等。</p>
    <p>[0030]	S100的具体实现方式有多种，下面以事件报文为例，例举三种实现方式。[0031]	获取驻留时间Tl的实现方式一：</p>
    <p>[0032]	 首先，在事件报文从MAC层向物理层发送时，为该事件报文加入时间戳，该时间戳 被携带在事件报文中。具体的，这里的加入时间戳的操作可以由MAC层执行，如MAC层在向 物理层发送事件报文时，为该事件报文加入时间戳。这里的加入时间戳的操作也可以由物 理层执行，如物理层接收到MAC层传输来的事件报文时，为该事件报文加入时间戳。</p>
    <p>[0033]	其次，在检测出该设备的物理层接收到MAC层发送的该事件报文时，根据设备本 地时钟的时钟周期的时长和获得的时钟周期数量获取驻留时间Tl，即获取时钟周期数量与 时钟周期的时长的乘积，该乘积即为驻留时间Tl。获取驻留时间Tl的执行主体可以为物理 层或者MAC层或应用层等。</p>
    <p>[0034]	获取时钟周期数量具体可以为：获取物理层的发送FIFO缓冲器的当前深度，并根 据发送FIFO缓冲器的有效读信号确定从发送FIFO缓冲器中读取出当前深度的数据所消耗 的时钟周期数量。这里的时钟周期是指设备本地时钟的时钟周期。上述检测事件报文的操 作可以由物理层或者MAC层或者应用层等执行主体执行。上述获取当前深度和确定时钟周 期数量的操作也可以由物理层或者MAC层或者应用层等执行主体来执行。在检测事件报文 的操作的执行主体与获取当前深度和确定时钟周期数量的操作的执行主体不是位于不同 层时，检测事件报文的执行主体在检测出接收到MAC层发送来的事件报文时，可以通过产 生中断等方式通知执行获取当前深度和确定时钟周期数量的执行主体。确定时钟周期数量 的一个具体例子为：针对发送FIFO缓冲器为设备的本地时钟设置第一计数器，在获取了发 送FIFO缓冲器的当前深度时，该第一计数器开始为设备的本地时钟的时钟周期计数，对发 送FIFO缓冲器的读信号进行采样，并检测采样的读信号是否为发送FIFO缓冲器的有效读 信号，每检测到发送FIFO缓冲器的有效读信号，则当前深度值减1，在当前深度值为0时，上 述第一计数器停止计数，读取第一计数器的计数值，该计数值即为上述时钟周期数量。</p>
    <p>[0035]	获取驻留时间Tl的实现方式二 ：</p>
    <p>[0036]	首先，在事件报文从MAC层向物理层发送时，为事件报文加入时间戳，该时间戳被 携带在事件报文中，为方便描述，该时间戳可以称为第一时间戳。加入第一时间戳的操作可 以由MAC层执行，如MAC层在向物理层发送事件报文时，为该事件报文加入第一时间戳。这 里的加入第一时间戳的操作也可以由物理层执行，如物理层接收到MAC层传输来的事件报 文时，为该事件报文加入第一时间戳。</p>
    <p>[0037]	其次，在该事件报文从物理层向对端设备物理层层发送时，为该事件报文记录第 二时间戳，第二时间戳可以不携带在事件报文中，而是本地存储该第二时间戳。这里的记录 第二时间戳的操作可以由物理层执行，如物理层在向对端设备的物理层发送事件报文时， 为该事件报文记录第二时间戳。这里的记录第二时间戳的操作也可以由应用层执行，如应 用层在检测到本设备的物理层向对端设备的物理层发送事件报文时，为该事件报文记录第 二时间戳。</p>
    <p>[0038]	最后，根据从事件报文中获取的第一时间戳和从本地存储信息中获取的第二时间 戳获取驻留时间Tl，即获取第一时间戳和第二时间戳的差值，该差值即为驻留时间Tl。执 行获取差值操作的执行主体可以为物理层，也可以为MAC层或者应用层等。</p>
    <p>[0039]	获取驻留时间Tl的实现方式三：</p>
    <p>[0040]	首先，在事件报文从MAC层向物理层发送时，为事件报文加入时间戳，该时间戳被携带在事件报文中。这里的加入时间戳的操作可以由MAC层执行，如MAC层在向物理层发 送事件报文时，为该事件报文加入时间戳。这里的加入时间戳的操作也可以由物理层执行， 如物理层接收到MAC层传输来的事件报文时，为该事件报文加入时间戳。这里的加入时间 戳操作主要用于与现有协议中发送事件报文的规定相符合。其次，获取物理层中发送FIFO 缓冲器的当前拥塞度。获取当前拥塞度的执行主体可以为物理层，也可以为MAC层或者应 用层等。本实施例可以采用现有的多种方式来获取发送FIFO缓冲器的当前拥塞度，例如， 通过采用平均算法或者其它算法对一定周期内的发送FIFO缓冲器深度值进行计算，从而 获得该周期对应的拥塞度。在本实施例中，可以周期性的计算拥塞度，并存储计算获得的各 个拥塞度，上述当前拥塞度可以为在事件报文从MAC层向物理层发送时最新存储的一个拥 塞度。</p>
    <p>[0041]	 获得当前拥塞度的一个具体的例子为：</p>
    <p>[0042]	应用层在预定时间周期内（如1秒钟）读取PHY层的发送FIFO缓冲器深度值η 个，获取这η个深度值的平均值，根据多个深度值计算发送FIFO缓冲器发送速率的变化率， 根据该变化率确定当前拥塞度的调整因子，并根据该调整因子对上述平均值进行调整，将 调整后的数值作为拥塞度存储。具体的计算η个深度值的平均值可以如下述公式（1)所示， 计算变化率可以如下述公式（2)所示，当前拥塞度可以如下述公式（3)所示：</p>
    <p>[0043]	&lt;formula&gt;formula see original document page 8&lt;/formula&gt;</p>
    <p>[0044]	&lt;formula&gt;formula see original document page 8&lt;/formula&gt;[0045]	公式（3)</p>
    <p>[0046]	在上述公式中，Li为第i个深度值，L为100个深度值的平均值，dt为发送FIFO缓 冲器发送速率的变化率，L20为在一个预定时间周期内获取到的第20个深度值，Ll为在一 个预定时间周期内获取到的第1个深度值，20Ts第20个深度值与第1个深度值的时间间 隔，（1-dt)为调整因子，Λ)为当前拥塞度。</p>
    <p>[0047]	本实施例不限制获取发送FIFO缓冲器的当前拥塞度的具体实现方式。</p>
    <p>[0048]	最后，根据该当前拥塞度和设备本地时钟的时钟周期的时长获取驻留时间Tl，即 获取当前拥塞度与时钟周期的时长的乘积，该乘积即为驻留时间Tl。续前例，驻留时间</p>
    <p>=	其中，T为时钟周期的时长。获取驻留时间Tl的执行主体可以为物理层或</p>
    <p>者MAC层或者应用层等。</p>
    <p>[0049]	S110、获取报文（如带有时间戳的报文）在该设备物理层的接收FIFO缓冲器中的 驻留时间T2。这里的接收FIFO缓冲器可以为同步FIF0(即接收FIFO缓冲器的读时钟和写 时钟为同一个时钟），也可以为异步FIF0(即接收FIFO缓冲器的读时钟和写时钟为不同的 时钟）。本实施例不限制接收FIFO缓冲器的具体结构以及具体型号等。</p>
    <p>[0050]	SllO的具体实现方式有多种，下面以事件报文为例，例举三种实现方式。</p>
    <p>[0051]	获取驻留时间T2的实现方式一：</p>
    <p>[0052]	在检测出该设备物理层接收到对端设备发送的带有时间戳的事件报文时，根据设 备本地时钟的时钟周期数量和时钟周期的时长获取驻留时间T2，即获取时钟周期数量与时 钟周期的时长的乘积，该乘积即为驻留时间T2。获取驻留时间T2的执行主体可以为物理层或者MAC层或者应用层等。</p>
    <p>[0053]	获取时钟周期数量具体可以为：先获取物理层的接收FIFO缓冲器的当前深度。这 里的对端设备如主设备或者请求器等。上述检测操作的执行主体可以为物理层，也可以为 MAC层或者应用层，上述获取物理层的接收FIFO缓冲器的当前深度的执行主体可以为物理 层，也可以为MAC层或者应用层。在检测事件报文的操作和获取当前深度的执行主体位于 不同层时，检测事件报文的执行主体在检测到物理层接收到对端设备发送的带有时间戳的 事件报文时，可通过产生中断等方式通知执行获取当前深度的执行主体。</p>
    <p>[0054]	之后，根据接收FIFO缓冲器的有效读信号确定从接收FIFO缓冲器中读取出当前 深度的数据所消耗的设备本地时钟的时钟周期数量。上述确定时钟周期数量的操作可以由 物理层或者MAC层或者应用层等执行主体来执行。在检测事件报文操作的执行主体与确定 时钟周期数量操作的执行主体位于不同层的情况下，检测事件报文操作的执行主体在检测 出PHY层接收到对端设备发送来的带有时间戳的事件报文时，可以通过产生中断等方式通 知执行确定时钟周期数量操作的执行主体。确定时钟周期数量的一个具体例子为：为设备 的本地时钟设置第二计数器，在获取了接收FIFO缓冲器的当前深度时，该第二计数器开始 为设备的本地时钟的时钟周期计数。对接收FIFO缓冲器的读信号进行采样，并检测采样的 读信号是否为接收FIFO缓冲器的有效读信号，每检测到接收FIFO缓冲器的有效读信号，则 当前深度值减1，在当前深度值为0时，上述第二计数器停止计数，读取第二计数器的计数 值，该计数值即为上述时钟周期数量。</p>
    <p>[0055]	获取驻留时间T2的实现方式二 ：</p>
    <p>[0056]	首先，在检测出设备的物理层接收到对端设备发送来的事件报文时，为该事件报 文记录时间戳，该时间戳可以不携带在事件报文中，而是本地存储该时间戳，为方便描述， 该时间戳可以称为第三时间戳。这里的记录第三时间戳的操作可以由物理层执行，如物理 层在接收到对端设备发送来的带有时间戳的事件报文时，为该事件报文记录第三时间戳。 这里的记录第三时间戳的操作也可以由MAC层或应用层等来执行，如物理层接收到对端设 备传输来的带有时间戳的事件报文时，通过产生中断等方式通知MAC层或应用层，MAC层或 应用层根据该中断为该事件报文记录第三时间戳。</p>
    <p>[0057]	其次，在该事件报文从设备的物理层向MAC层发送时，为该事件报文加入时间戳， 根据现有协议的规定，该时间戳可以携带在事件报文中，为方便描述，该时间戳可以称为第 四时间戳。这里的加入第四时间戳的操作可以由MAC层执行，如MAC层在接收到物理层发 送来的带有时间戳的事件报文时，为该事件报文加入第四时间戳。这里的加入第四时间戳 的操作也可以由物理层执行，如物理层在将该事件报文向MAC层发送时，为该事件报文加 入第四时间戳。另外，加入第四时间戳的操作也可以由应用层来执行，例如，在物理层向MAC 层发送该事件报文时，物理层通过产生中断等方式通知应用层，应用层根据物理层的通知 为该事件报文加入第四时间戳；再例如，在MAC层接收到物理层发送的带有时间戳的事件 报文时，MAC层通过产生中断等方式通知应用层，应用层根据MAC层的通知为该事件报文加 入第四时间戳。</p>
    <p>[0058]	最后，获取第三时间戳和第四时间戳，根据第三时间戳和第四时间戳获取驻留时 间T2，即获取第三时间戳和第四时间戳的差值，该差值即为驻留时间T2。执行获取差值操 作的执行主体可以为物理层，也可以为MAC层或者应用层等。[0059]	获取驻留时间T2的实现方式三：</p>
    <p>[0060]	首先，在检测出对端设备传输来的携带有时间戳的事件报文从物理层向MAC层发 送时，获取物理层中接收FIFO缓冲器的当前拥塞度。检测事件报文从物理层向MAC层发送 的执行主体可以为物理层，也可以为MAC层或者应用层等。获取当前拥塞度的执行主体可 以为物理层或者MAC层或者应用层等。本实施例可以采用现有的多种方式来获取接收FIFO 缓冲器的当前拥塞度，例如，通过采用平均算法或者其它算法对一定周期内的接收FIFO缓 冲器深度值进行计算，从而获得该周期对应的拥塞度。在本实施例中，可以周期性的计算拥 塞度，并存储计算获得的各个拥塞度，上述当前拥塞度可以为从物理层向MAC层发送事件 报文时最新存储的一个拥塞度。获得当前拥塞度的具体的例子如上述获取驻留时间T1的 实现方式三中的描述。本实施例不限制获取接收FIFO缓冲器的当前拥塞度的具体实现方 式。</p>
    <p>[0061]	其次，根据当前拥塞度和设备本地时钟的时钟周期的时长获取驻留时间T2，即获 取当前拥塞度与时钟周期的时长的乘积，该乘积即为驻留时间T2。获取驻留时间T2的执行 主体可以为物理层或者MAC层或者应用层等。</p>
    <p>[0062]	针对上述S100和S110需要特别说明的是，S100可以采用上述例举的三种获取驻 留时间T1的实现方式中的任一种实现方式，且S110同样可以采用上述例举的三种获取驻 留时间T2的实现方式中的任一种实现方式。而且，S100中例举的各实现方式与S110中例 举的各实现方式并不存在固定配对的关系，例如，在S100采用上述例举的获取驻留时间T1 的实现方式一的情况下，S110可以采用上述例举的三种获取驻留时间T2的实现方式中的 任一种实现方式。</p>
    <p>[0063]	S120、根据上述获得的驻留时间T1和T2的差值、物理层固有延迟时间与传输线路 延迟时间三者之和获得不对称延迟时间。</p>
    <p>[0064]	在本实施例中，可以将上述驻留时间T1和驻留时间T2的差值与物理层固有延迟 时间之和确定为物理层延迟时间。物理层固有延迟时间为已知的常数，通常由物理层芯片 的生产厂家提供。可以将物理层延迟时间和传输线路延迟时间之和作为不对称延迟时间。 这里的传输线路延迟时间可以采用现有的多种测量方式获得，本实施例不限制获得传输线 路延迟时间的具体实现过程。</p>
    <p>[0065]	可选的，本实施例还可以包括：S130、根据不对称延迟时间进行时间同步。在获得 不对称延迟时间后，可以采用现有的多种方式来实现时间同步，例如，获得本端设备到对端 设备和对端设备到本端设备的平均路径延迟时间，获取平均路径延迟时间与不对称延迟时 间之和Tms，获取平均路径延迟时间与不对称延迟时间之差Tsm，从而利用Tms和Tsm实现 时间同步。本实施例不限制利用不对称延迟时间进行时间同步的具体实现过程。</p>
    <p>[0066]	从上述实施例一的描述可知，实施例一通过利用数据在物理层的发送FIFO缓冲 器中的驻留时间以及该数据在物理层的接收FIFO缓冲器中的驻留时间，可以获取物理层 延迟时间，通过利用该物理层延迟时间和传输线路延迟时间可以方便准确的获得不对称延 迟时间，从而可以方便的进行时间同步，降低了时间同步的实现成本，提高了时间同步的效 率。</p>
    <p>[0067]	实施例二、获取不对称延迟时间的装置。该装置可以为从设备或者响应器等，具体 的，该装置可以为基站等。该装置如附图2所示。[0068]	图2中的装置包括：发送FIFO缓冲器200、接收FIFO缓冲器210、第一获取模块 220和第二获取模块230，可选的，该装置还可以包括时间同步模块240。</p>
    <p>[0069]	发送FIFO缓冲器200和接收FIFO缓冲器210均可以为同步FIFO缓冲器或者异 步FIFO缓冲器，本实施例不限制发送FIFO缓冲器200和接收FIFO缓冲器210的具体结构 和具体型号等。</p>
    <p>[0070]	第一获取模块220，用于获取带有时间戳的报文在设备物理层的发送FIFO缓冲器 200中的驻留时间T1，并获取带有时间戳的报文在设备物理层的接收FIFO缓冲器210中的 驻留时间T2。</p>
    <p>[0071]	第二获取模块230，用于根据T1和T2的差值、物理层固有延迟时间与传输线路延 迟时间三者之和获得不对称延迟时间。具体的，第二获取模块230可以将上述驻留时间T1 与驻留时间T2的差值与物理层固有延迟时间之和确定为物理层延迟时间。物理层固有延 迟时间为已知的常数，通常由物理层芯片的生产厂家提供。第二获取模块230可以将物理 层延迟时间和传输线路延迟时间之和作为不对称延迟时间。第二获取模块230间可以采用 现有的多种测量方式获得传输线路延迟时，本实施例不限制第二获取模块230获得传输线 路延迟时间的具体实现过程。</p>
    <p>[0072]	时间同步模块240，用于根据第二获取模块230获取的不对称延迟时间进行时间 同步。具体的，时间同步模块240可以采用现有的多种方式来实现时间同步，例如，时间同 步模块240获得本端设备到对端设备和对端设备到本端设备的平均路径延迟时间，并获取 平均路径延迟时间与不对称延迟时间之和Tms、以及平均路径延迟时间与不对称延迟时间 之差Tsm，从而时间同步模块240利用Tms和Tsm实现时间同步。本实施例不限制时间同步 模块240利用不对称延迟时间进行时间同步的具体实现过程。</p>
    <p>[0073]	在上述描述中，第一获取模块220可以有多种不同的实现方式，下面结合附图2A 至2F例举描述几种实现方式。</p>
    <p>[0074]	例1、如附图2A所示第一获取模块220包括：第一时间戳子模块221、第一获取深 度子模块222、第一计数子模块223和第一计算子模块224。第一计数子模块223包括上述 方法实施例描述中的第一计数器。</p>
    <p>[0075]	第一时间戳子模块221，用于在事件报文从MAC层向物理层发送时，为该事件报文 加入时间戳。该时间戳被携带在事件报文中。第一时间戳子模块221可以位于MAC层，即 第一时间戳子模块221在检测出MAC层在向物理层发送事件报文时，为该事件报文加入时 间戳。第一时间戳子模块221也可以位于物理层，即第一时间戳子模块221在检测出物理 层接收到MAC层传输来的事件报文时，为该事件报文加入时间戳。另外，第一时间戳子模块 221也可以位于应用层。需要说明的是，如果在实际应用中第一时间戳子模块221由多个具 体器件来实现，则这多个具体器件可以均位于同一层，也可以分散位于不同层。还有需要说 明的是，第一时间戳子模块221是逻辑上的划分，在实际应用中，第一时间戳子模块221可 能不会与本实施例中的其它子模块位于同一个具体器件中，也可能会与本实施例中的其它 子模块位于同一个具体器件中。本实施例记载的下述各子模块也是如此，下面不再针对各 子模块一一进行如上说明。</p>
    <p>[0076]	第一获取深度子模块222，用于在设备物理层接收到MAC层发送的带有时间戳的 事件报文时，获取物理层的发送FIFO缓冲器200的当前深度。一个具体的例子：第一获取深度子模块222在检测出PHY层接收到MAC层发送来的带有时间戳的事件报文时，通知第 一计数子模块223，以触发第一计数子模块223开始为设备本地时钟的时钟周期计数，第一 获取深度子模块222可以将获取的当前深度值提供给第一计数子模块223。第一获取深度 子模块222可以位于PHY层、MAC层或者应用层。</p>
    <p>[0077]	第一计数子模块223，用于在物理层接收到MAC层发送的带有时间戳的事件报文 时，确定从发送FIFO缓冲器200中读取出当前深度的数据所消耗的时钟周期数量。一个具 体的例子：第一计数子模块223在接收到第一获取深度子模块222的通知时，开始对设备本 地时钟的时钟周期计数，第一计数子模块223对发送FIFO缓冲器200的读信号进行采样， 并检测采样的读信号是否为发送FIFO缓冲器200的有效读信号，第一计数子模块223在检 测到发送FIFO缓冲器的一个有效读信号，则第一获取深度子模块222提供的当前深度值减 1，在当前深度值为0时，第一计数子模块223停止为时钟周期计数。此时的计数值即为上 述时钟周期数量。第一计数子模块223可以位于PHY层、MAC层或者应用层。</p>
    <p>[0078]	第一计算子模块224，用于根据第一计数子模块223确定的时钟周期数量和时钟 周期的时长获取驻留时间T1。即第一计算子模块224获取时钟周期数量与时钟周期的时长 的乘积，该乘积即为驻留时间T1。第一计算子模块224可以位于物理层或者MAC层或者应 用层等。</p>
    <p>[0079]	例2、如附图2B所示第一获取模块220包括：第一时间戳子模块221、第二时间戳 子模块225和第二计算子模块226。</p>
    <p>[0080]	第一时间戳子模块221，用于在事件报文从MAC层向物理层发送时，为该事件报文 加入时间戳。为方便描述，该时间戳可以称为第一时间戳。第一时间戳子模块221具体执 行的操作如上述例1中的描述，在此不再详细说明。</p>
    <p>[0081]	第二时间戳子模块225，用于在该事件报文从物理层向对端设备的物理层发送时， 为该事件报文记录时间戳。为方便描述，该时间戳可以称为第二时间戳。第二时间戳可以 不携带在事件报文中，而是由第二时间戳子模块225将该第二时间戳存储在本装置中。第 二时间戳子模块225可以位于物理层或MAC层或应用层等。</p>
    <p>[0082]	第二计算子模块226，用于根据该事件报文的第一时间戳和第二时间戳获取驻留 时间T1。具体的，第二计算子模块226获取第一时间戳和第二时间戳的差值，该差值即为驻 留时间T1。第二计算子模块226可以位于物理层或MAC层或应用层等。</p>
    <p>[0083]	例3、如附图2C所示第一获取模块220包括：第一拥塞度子模块227和第三计算 子模块228。</p>
    <p>[0084]	第一拥塞度子模块227，用于在事件报文从MAC层向物理层发送时，获取物理层中 发送FIFO缓冲器200的当前拥塞度。第一拥塞度子模块227可以采用现有的多种方式来 获取发送FIFO缓冲器200的当前拥塞度，例如，第一拥塞度子模块227通过采用平均算法 或者其它算法对一定周期内的发送FIFO缓冲器200深度值进行计算，从而获得该周期对应 的拥塞度。第一拥塞度子模块227可以周期性的计算拥塞度，并存储计算获得的各个拥塞 度，上述当前拥塞度可以为在事件报文从MAC层向物理层发送时，第一拥塞度子模块227最 新存储的一个拥塞度。第一拥塞度子模块227获得当前拥塞度的具体例子如上述方法实施 例中的描述，在此不再重复说明。第一拥塞度子模块227可以位于物理层或MAC层或应用 层等。[0085]	第三计算子模块228，用于根据第一拥塞度子模块227获取的当前拥塞度和设备 本地时钟的时钟周期的时长获取驻留时间T1。具体的，第三计算子模块228获取当前拥塞 度与时钟周期的时长的乘积，该乘积即为驻留时间T1。第三计算子模块228可以位于物理 层或者MAC层或者应用层等。</p>
    <p>[0086]	例4、如附图2D所示第一获取模块220包括：第二获取深度子模块229、第二计数 子模块2210和第四计算子模块2211。</p>
    <p>[0087]	第二获取深度子模块229，用于在物理层接收到对端设备发送的带有时间戳的事 件报文时，获取物理层的接收FIF0210缓冲器的当前深度。这里的对端设备如主设备或者 请求器等。一个具体的例子：第二获取深度子模块229在检测出该设备物理层接收到对端 设备发送的带有时间戳的事件报文时，可以通知第二计数子模块2210开始为设备本地时 钟的时钟周期计数，第二获取深度子模块229可以将获取的当前深度值提供给第二计数子 模块2210。第二获取深度子模块229可以位于物理层或者MAC层或者应用层等。</p>
    <p>[0088]	第二计数子模块2210，用于在物理层接收到对端设备发送的带有时间戳的事件报 文时，确定从接收FIFO缓冲器210中读取出当前深度的数据所消耗的设备本地时钟的时钟 周期数量。一个具体的例子，第二计数子模块2210在接收到第二获取深度子模块229开始 计数的通知时，开始为设备本地时钟的时钟周期计数，第二计数子模块2210对接收FIFO缓 冲器210的读信号进行采样，并检测采样的读信号是否为接收FIFO缓冲器210的有效读信 号，第二计数子模块2210检测到接收FIFO缓冲器210的一个有效读信号，则将第二获取深 度子模块229提供的当前深度值减1，在当前深度值为0时，第二计数子模块2210停止计 数。此时的计数值即为上述时钟周期数量。第二计数子模块2210可以位于物理层或者MAC 层或者应用层等。</p>
    <p>[0089]	第四计算子模块2211，用于根据第二计数子模块2210确定的时钟周期数量和时 钟周期的时长获取驻留时间T2。即第四计算子模块2211获取时钟周期数量与时钟周期的 时长的乘积，该乘积即为驻留时间T2。第四计算子模块2211可以位于物理层或者MAC层或</p>
    <p>者应用层等。</p>
    <p>[0090]	例5、如附图2E所示第一获取模块220包括：第三时间戳子模块2212、第四时间戳 子模块2213和第五计算子模块2214。</p>
    <p>[0091]	第三时间戳子模块2212，用于在物理层接收到对端设备发送来的事件报文时，为 该事件报文记录第三时间戳。第三时间戳子模块2212在检测出设备的物理层接收到对端 设备发送来的事件报文时，为该事件报文记录的第三时间戳可以不携带在事件报文中，而 是由第三时间戳子模块2212将第三时间戳存储在本装置中。第三时间戳子模块2212可以 位于物理层或者MAC层或者应用层等。</p>
    <p>[0092]	第四时间戳子模块2213，用于在事件报文从物理层向MAC层发送时，为该事件报 文加入第四时间戳。根据现有协议的规定，第四时间戳子模块2213加入的第四时间戳携带 在事件报文中。第四时间戳子模块2213可以位于物理层或者MAC层或者应用层等。</p>
    <p>[0093]	第五计算子模块2214，用于获取第三时间戳和第四时间戳，并根据第三时间戳和 第四时间戳获取驻留时间T2。即第五计算子模块2214获取第三时间戳和第四时间戳的差 值，该差值即为驻留时间T2。第五计算子模块2214可以位于物理层或者MAC层或者应用层寸。[0094]	例6、如附图2F所示第一获取模块220包括：第二拥塞度子模块2215和第六计算 子模块2216。</p>
    <p>[0095]	第二拥塞度子模块2215，用于在对端设备传输来的携带有时间戳的事件报文从物 理层向MAC层发送时，获取物理层中接收FIFO缓冲器210的当前拥塞度。具体的，第二拥 塞度子模块2215在检测出对端设备传输来的携带有时间戳的事件报文从物理层向MAC层 发送时，获取物理层中接收FIFO缓冲器210的当前拥塞度。第二拥塞度子模块2215可以 采用现有的多种方式来获取接收FIFO缓冲器210的当前拥塞度，例如，第二拥塞度子模块 2215通过采用平均算法或者其它算法对一定周期内的接收FIFO缓冲器210深度值进行计 算，从而获得该周期对应的拥塞度。第二拥塞度子模块2215可以周期性的计算拥塞度，并 存储计算获得的各个拥塞度，上述当前拥塞度可以为第二拥塞度子模块2215在检测出事 件报文从物理层向MAC层发送时最新存储的一个拥塞度。第二拥塞度子模块2215获得当 前拥塞度的具体的例子如上述方法实施例中的描述，在此不再重复说明。本实施例不限制 第二拥塞度子模块2215获取接收FIFO缓冲器210的当前拥塞度的具体实现方式。第二拥 塞度子模块2215可以位于物理层或者MAC层或者应用层等。</p>
    <p>[0096]	第六计算子模块2216，用于根据第二拥塞度子模块2215获取的当前拥塞度和设 备本地时钟的时钟周期的时长获取驻留时间T2。即第六计算子模块2216获取当前拥塞度 与时钟周期的时长的乘积，该乘积即为驻留时间T2。第六计算子模块2216可以位于物理层 或者MAC层或者应用层等。</p>
    <p>[0097]	从上述实施例二的描述可知，实施例二中的第一获取模块220通过利用数据在物 理层的发送FIFO缓冲器中的驻留时间以及该数据在物理层的接收FIFO缓冲器中的驻留时 间，使第二获取模块230可以获取到物理层延迟时间，通过利用该物理层延迟时间和传输 线路延迟时间可以方便准确的获得不对称延迟时间，从而使时间同步模块240可以方便的 进行时间同步，降低了时间同步的实现成本，提高了时间同步的效率。</p>
    <p>[0098]	实施例三、获取不对称延迟时间的装置。下面以该装置应用在一个具体单板为例 对本实施例的获取不对称延迟时间的装置进行说明。本实施例中该具体该单板的型号为 CR56LPUF100A，该单板结构的简单示意如附图3所示。</p>
    <p>[0099]	图3中的单板包括左侧1、右侧2和IEEE1588 CL0CK3，左侧1示意出了位于MAC 层以及MAC层以上层的各单元，右侧2示意出位于PHY层的各单元，IEEE1588 CL0CK3为左 侧1和右侧2提供时钟信号。</p>
    <p>[0100]	本实施例的获取不对称延迟时间的装置包括：IEEE1588 Packet DetectionAnd Prceing(IEEE 包检测和处理)11、时戳模块 12、Aplication Code (应用代码)13、IEEE1588 RTC14 (IEEE1588 实时时钟）、IEEE1588 C0NTR0L21 (IEEE1588 控制）、IEEE1588 Packet Detection (IEEE1588包检测)模块22、计数模块23和PLL(锁相环）24。其中的IEEE1588 Packet And Prceingll、时戳模块12和IEEE1588 RTC14可以实现上述实施例二中第一 时间戳子模块221执行的操作，其中的IEEE1588 Packet Detection22可以实现上述 实施例二中第一获取深度子模块222和第二获取深度子模块229执行的操作，其中的 IEEE1588C0NTR0L21、计数模块23和PLL24可以实现上述实施例二中第一计数子模块223 和第二计数子模块2210执行的操作，其中的Aplication Codel3可以实现上述实施例二中 第一计算子模块224和第四计算子模块2211执行的操作。[0101]	IEEE1588 Packet Detection And Prceingll 用于在检测到 MAC 层向物理层发送 事件报文时，触发时戳模块12为该事件报文加入时间戳。</p>
    <p>[0102]	时戳模块 12 用于根据 IEEE1588 Packet Detection And Prceingll 的通知为事 件报文加入时间戳，该时间戳被携带在事件报文中。</p>
    <p>[0103]	Aplication Codel3用于根据IEEE1588 C0NTR0L21的通知读取计数模块23的计数值。</p>
    <p>[0104]	IEEE1588 RTC14用于为时戳模块12提供时间，从而使时戳模块12可以根据该时 间为事件报文加入时间戳。</p>
    <p>[0105]	IEEE1588 C0NTR0L21用于在计数模块23停止计数时通知AplicationCodel3读取 计数值。</p>
    <p>[0106]	IEEE1588 Packet Detection22用于在检测到物理层接收到MAC传输来的带有时 间戳的事件报文时，获取物理层的发送FIFO缓冲器的当前深度，通知计数模块23开始为发 送FIFO缓冲器的读时钟计数，并将该当前深度值提供给计数模块23。在检测到物理层接收 到对端设备传输来的带有时间戳的事件报文时，获取物理层的接收FIFO缓冲器的当前深 度，通知计数模块23开始为接收FIFO缓冲器的读时钟计数，并将该当前深度值提供给计数 模块23。</p>
    <p>[0107]	计数模块23用于根据IEEE1588 Packet Detection22发送的开始针对发送FIFO 缓冲器计数的通知开始对IEEE1588 CL0CK3倍频后的时钟周期计数，即对PLL输出的时钟 周期计数，并在确定出从发送FIFO缓冲器中读取出发送FIFO缓冲器的当前深度的数据时， 停止对IEEE1588 CL0CK3倍频后的时钟周期计数。根据IEEE1588 Packet Detection22发 送的开始针对接收FIFO缓冲器计数的通知开始对IEEE1588 CL0CK3倍频后的时钟周期计 数，即对PLL输出的时钟周期计数，并在确定出从接收FIFO缓冲器中读取出接收FIFO缓冲 器的当前深度的数据时，停止对IEEE1588 CL0CK3倍频后的时钟周期计数。</p>
    <p>[0108]	PLL24用于对IEEE1588 CL0CK3进行倍频，从而可以提高计数模块23对设备本地 时钟的时钟周期进行计数的准确性。在发送方向，本实施例的获取不对称延迟时间的装置 获得带有时间戳的事件报文在PHY层的驻留时间的过程包括：设备在MAC层构造Event (事 件）报文，Event报文如Sync (同步）报文、或者Folow up (随路)报文等。在MAC向PHY层 发送Event报文时，IEEE1588Packet And Prceingll通知时戳模块12为该事件报文加入上 时间戳，时戳模块12为事件报文加入的时间戳携带在Event报文中。当Event报文通过数 据通道由MAC层到达PHY层时，Event报文被送到IEEE1588包检测模块22，由IEEE1588包 检测模块22检测该报文中是否携带有时间戳，IEEE1588包检测模块22在检测出报文中携 带有时间戳时，产生trigO信号，trigO信号用于触发计数模块23中的coimtO开始为设备 本地时钟的时钟周期（即IEEE1588 CL0CK3倍频后的时钟周期）计数。在检测出报文携带有 时间戳的同时，IEEE1588包检测应记录当前PHY层中的发送FIFO缓冲器的当前深度FIF0_ CNT，并将当前深度存储为fifo_legth0提供给计数模块23。计数模块23为fifo_legth0 设置reg_fifO_Cnt0计数器，reg_fifO_Cnt0计数器的初始值为fifo_legth0的值。计数模 块23利用发送FIFO缓冲器的outputclk(输出时钟，即读时钟)采样发送FIFO缓冲器的 rd (读）信号，如果计数模块23采样到的rd信号为有效rd信号，则reg_fifO_Cnt0计数器 的计数值减1。当reg_f ifO_cnt0计数器的计数值变成0时，计数模块23中的计数器coimtO停止计数，并产生一个发送FIFO缓冲器已传送完的标志位，IEEE1588C0NTR0L21在检测到 该标志位时，产生中断0，以通知Aplication Codel3读取countO的计数值，Aplication Codel3根据中断O通过MDIO (管理通道）接口读取计数器countO的计数值，计数器countO 在被读取出计数值后清零。AplicationCodel3位于应用层。Aplication Codel3通过对接 收到的计数器countO的计数值进行计算即可获得携带有时间戳信息的报文在PHY层的驻 留时间，即Tl。Aplication Codel3计算驻留时间的计算公式可以为residence timeO (即 Tl) = countO的计数值XTlocal elk(时钟周期的时长，即IEEE1588 CL0CK3倍频后的时 钟周期的时长）。从上述描述可知，本实施例可通过软件计算出Event报文在PHY层的驻留 时间Tl。</p>
    <p>[0109]	上述countO的计数时序图如附图3A所示。 [0110]	在图3A中，trigO信号由低电平跳转到高电平时，countO开始为本地时钟Local_ elk (本地时钟，即PLL24输出的时钟信号）的时钟周期计数。在f ifo_legthO的reg_f ifo_ cnt计数器的计数值为O时，trigO信号由高电平跳转到低电平，countO停止计数。图2中 的rd表示rd信号的时序，rd为高电平时为有效读信号。</p>
    <p>[0111]	在接收方向，本实施例的获取不对称延迟时间的装置获得带有时间戳的事件报文 在PHY层的驻留时间的过程包括：在PHY层接收到对端设备传输来的报文时，该报文被发 送到IEEE1588包检测模块22，由IEEE1588包检测模块22检测该报文中是否携带有时间 戳，IEEE1588包检测模块22在检测出报文中携带有时间戳时，获知该报文为事件报文，产 生trigl信号，trigl信号用于触发计数模块23中的coimtl开始为本地时钟的时钟周期计 数。在检测出报文携带有时间戳的同时，IEEE1588包检测应记录当前PHY层中的接收FIFO 缓冲器的当前深度FIF0_CNT，并将当前深度存储为fifo_legthl提供给计数模块23。计数 模块23可以为fifo_legthl设置reg_fif0_Cntl计数器，reg_fif0_cntl计数器的初始值 为fifo_legthl的值。计数模块23利用接收FIFO缓冲器的outputclk (输出时钟，即读时 钟）采样接收FIFO缓冲器的rd (读）信号，如果采样到的rd信号为有效rd信号，则reg_ fifo_cntl计数器的计数值减1。当reg_fif0_Cntl计数器的计数值变成O时，计数模块 23中的计数器coimtl停止计数，并标记一个接收FIFO缓冲器已传送完的标志位IEEE1588 C0NTR0L21在检测到该标志位时，产生中断1，以通知Aplication Codel3读取countl的计 数值，Aplication Codel3根据中断1通过MDIO接口读取计数器coimtl的计数值，计数器 countl在被读取出计数值后清零。Aplication Codel3通过对接收到的计数器countl的计 数值进行计算即可获得携带有时间戳信息的报文在PHY层的驻留时间，即T2。Aplication Codel3计算驻留时间T2的计算公式可以为residence timel (即T2) = countl的计数 值XTlocalclk(时钟周期的时长）。从上述描述可知，本实施例可通过软件计算出event 报文在PHY层的驻留时间T2。</p>
    <p>[0112]	本实施例的获取不对称延迟时间的装置根据上述驻留时间进行时间同步的过程 包括：Aplication Codel3 计算物理层延迟时间 PHY_delayAsymmetry，Aplication Codel3 可以使用软件进行计算。PHY_delayASymmetry的计算公式可以为：</p>
    <p>[0113]	PHY_delayAsymmetry = residence time 1-residence timeO+Tphy ；</p>
    <p>[0114]	其中：Tphy为设备的生产厂家提供的物理层固有延时。</p>
    <p>[0115]	Aplication Codel3测量出传输线路的长度，如Aplication Codel3通过现有的OTTR(光纤测量技术）技术来测量光纤的长度，在测量出光纤的长度后，Aplication Codel3可以通过软件利用光纤的长度计算出报文在光纤中的传输延迟时间Fiber_ deIayAsymmetryο</p>
    <p>[0116]	Aplication Codel3利用如下公式计算出不对称延迟时间delayAsymmetry ：</p>
    <p>[0117]	delayAsymmetry = Fiber_delayAsymmetry+PHY_deIayAsymmetry ；</p>
    <p>[0118]	Aplication Codel3可以利用软件计算出不对称延迟时间delayAsymmetry。 [0119]	Aplication Codel3可以利用如下公式计算出tms和tsm ：</p>
    <p>[0120]	tms = &lt;meanPathDelay&gt;+deIayAsymmetry ；</p>
    <p>[0121]	tsm = &lt;meanPathDelay&gt;-deIayAsymmetry ；</p>
    <p>[0122]	其中，tms为从本地设备到对端设备方向的延迟时间，tsm为从对端设备到本地设 备方向的延迟时间。</p>
    <p>[0123]	Aplication Code 13根据tms和tsm进行时间同步处理，从而实现了通信链路的时 间同步。</p>
    <p>[0124]	实施例四、获取不对称延迟时间的同步装置。下面以该装置应用在一个具体单板 为例对本实施例的获取不对称延迟时间的装置进行说明。本实施例中该具体该单板的型号 为CR56LPUF100A，该单板结构的简单示意如附图4所示。</p>
    <p>[0125]	图4中的单板包括左侧1、右侧2和IEEE1588 CL0CK3，左侧1示意出了位于MAC 层以及MAC层以上层的各单元，右侧2示意出位于PHY层的各单元，IEEE1588 CL0CK3为左 侧1和右侧2提供时钟信号。</p>
    <p>[0126]	本实施例的获取不对称延迟时间的装置包括：IEEE1588 Packet DetectionAnd Prceing 11、时戳模块 12、Aplication Codel3、IEEE1588 RTC14、IEEE1588C0NTR0L21、 IEEE1588 Packet Detection 模块 22、PLL24、时戳模块 25、和 IEEE1588 RTC26。其中的 IEEE1588 Packet Detection And Prceing 11、时戳模块 12 和 IEEE1588 RTC14 可以实现 上述实施例二中第一时间戳子模块221执行的操作，其中的IEEE1588 C0NTR0L2、IEEE1588 Packet Detection22、PLL24、时戳模块25、和IEEE1588 RTC26可以实现上述实施例二中 第二时间戳子模块225、第三时间戳子模块2212和第四时间戳子模块2213执行的操作，其 中的AplicationCodeU可以实现上述实施例二中第二计算子模块226和第五计算子模块 2214执行的操作。</p>
    <p>[0127]	IEEE1588 Packet Detection And Prceing 11 用于在检测到MAC层向物理层发送 事件报文时，通知时戳模块12为事件报文加入第一时间戳。在检测到物理层向MAC层发送 来的事件报文时，触发时戳模块12为该事件报文加入第四时间戳。</p>
    <p>[0128]	时戳模块 12 用于根据 IEEE 1588 Packet Detection And Prceing 11 的通知为事 件报文加入第一时间戳和第四时间戳，第一时间戳和第四时间戳都被携带在事件报文中。</p>
    <p>[0129]	Aplication Codel3用于根据IEEE1588 C0NTR0L21的通知读取时戳模块25存储 的第二时间戳和第三时间戳。</p>
    <p>[0130]	IEEE1588 RTC14用于为时戳模块12提供时间，从而使时戳模块12可以根据该时 间为事件报文加入时间戳。</p>
    <p>[0131 ] IEEE1588 C0NTR0L21用于在时戳模块25为事件报文记录时间戳后通知 Aplication Codel3 读取时间戳。[0132]	IEEE1588 Packet Detection22用于在检测到物理层接收到MAC传输来的带有时 间戳的事件报文时，通知时戳模块25为事件报文记录第二时间戳。在检测到物理层接收到 对端设备传输来的带有时间戳的事件报文时，通知时戳模块25为事件报文记录第三时间戳。</p>
    <p>[0133]	PLL24用于对IEEE1588 CL0CK3进行倍频，从而可以提高IEEE1588 RTC26的时间 精度。时戳模块25用于根据IEEE1588 Packet DeteCtion22的通知为事件报文记录时间</p>
    <p>戳。</p>
    <p>[0134]	IEEE1588 RTC26用于为时戳模块25提供时间，从而使时戳模块25可以根据该时 间为事件报文记录时间戳。</p>
    <p>[0135]	在发送方向，本实施例的获取不对称延迟时间的装置获得带有时间戳的事件报文 在PHY层的驻留时间的过程包括：设备在MAC层构造Event报文，在MAC与PHY之间的接口 处时戳模块12为Event报文加入上第一时间戳，S卩IEEE1588Packet And Prceingll通知时 戳模块12为该事件报文加入第一时间戳，时戳模块12为事件报文加入的第一时间戳携带 在Event报文中，时戳模块12还可以本地存储该事件报文的第一时间戳。当Event报文通 过数据通道由MAC层到达PHY层时，Event报文被送到IEEE1588包检测模块22，由IEEE1588 包检测模块22检测该Event报文中是否携带有时间戳，IEEE1588包检测模块22在检测出 Event报文中携带有时间戳时，通知时戳模块25为该事件报文记录第二时间戳，时戳模块 25本地存储该第二时间戳。时戳模块25产生已为发送的事件报文记录时间戳的标志位， IEEE1588 C0NTR0L21在检测到该标志位时，产生中断0，以通知Aplication Codel3读取 第二时间戳，Aplication Codel3根据中断O通过MDIO接口读取第二时间戳。Aplication Codel3还需要从时戳模块12处获取该事件报文的第一时间戳。Aplication Codel3通过对 获取到的第一时间戳和第二时间戳进行计算即可获得携带有时间戳信息的事件报文在PHY 层的驻留时间，即Tl。从上述描述可知，本实施例可通过软件计算出Event报文在PHY层的 驻留时间Tl。</p>
    <p>[0136]	在接收方向，本实施例的获取不对称延迟时间的装置获得带有时间戳的事件报文 在PHY层的驻留时间的过程包括：在PHY层接收到对端设备传输来的报文时，该报文被发送 到IEEE1588包检测模块22，由IEEE1588包检测模块22检测该报文中是否携带有时间戳， IEEE1588包检测模块22在检测出报文中携带有时间戳时，获知该报文为事件报文，通知时 戳模块25为该事件报文记录第三时间戳，时戳模块25本地存储该第三时间戳。时戳模块 25产生已为接收的事件报文记录时间戳的标志位，IEEE1588 C0NTR0L21在检测到该标志位 时，产生中断1，以通知Aplication Codel3读取第三时间戳，Aplication Codel3根据中断 1通过MDIO接口读取第三时间戳。该事件报文由物理层传输至MAC层时，被送到IEEE1588 Packet And Prceingll, IEEE1588 Packet And Prceingll 在检测出接收到的报文携带有 时间戳时，获知该报文为事件报文，通知时戳模块12为该事件报文加入第四时间戳，第四 时间戳可以携带在该事件报文中。时戳模块12可以本地存储该第四时间戳，Aplication Code 13可以从事件报文中获取第四时间戳，Ap 1 ication Code 13也可以从时戳模块12中获 取第四时间戳。Aplication Codel3通过对获取到的第三时间戳和第四时间戳进行计算即 可获得携带有时间戳信息的事件报文在PHY层的驻留时间，即T2。从上述描述可知，本实施 例可通过软件计算出Event报文在PHY层的驻留时间T2。[0137]	本实施例的获取不对称延迟时间的装置根据上述驻留时间进行时间同步的过程 与上述实施例三的描述相同，在此不再重复说明。</p>
    <p>[0138]	实施例五、获取不对称延迟时间的装置。下面以该装置应用在一个具体单板为例 对本实施例的获取不对称延迟时间的装置进行说明。本实施例中该具体该单板的型号为 CR56LPUF100A，该单板结构的简单示意如附图5所示。</p>
    <p>[0139]	图5中的单板包括左侧1、物理层2和IEEE1588 CL0CK3，左侧1示意出了位于MAC 层以及MAC层以上层的各单元，IEEE1588 CL0CK3为左侧1和物理层2提供时钟信号。 [0140]	本实施例的获取不对称延迟时间的装置设置于Aplication Codel3中，即 Aplication Codel3可以实现上述实施例二中第一拥塞度子模块227、第三计算子模块 228、第二拥塞度子模块2215和第六计算子模块2216执行的操作。</p>
    <p>[0141]	在发送方向，本实施例的获取不对称延迟时间的装置获得带有时间戳的事件报文 在PHY层的驻留时间的过程包括：Ap 1 ication Code 13周期性记录PHY层中发送FIFO缓 冲器的当前深度值，Aplication Codel3根据周期性记录的发送FIFO缓冲器的当前深度值 计算发送FIFO的平均拥塞值。该平均拥塞值即为该周期对应的当前拥塞度。Aplication Codel3利用当前拥塞度来计算携带有时间戳的事件报文在PHY层的驻留时间。Aplication Codel3计算平均拥塞度的一个具体例子为=Aplication Codel3周期性的读取发送FIFO缓 冲器的当前深度值，并将读取的当前深度值放入缓存中，在缓存中的当前深度值达到一定 数量（如10个）时，每向缓存中存储一个当前深度值，则丢弃一个当前深度值，丢弃的当前 深度值应该是存储时间最长的当前深度值。在需要计算平均拥塞值时，发送FIFO缓冲器 计算缓存中存储的当前深度值的平均值。发送FIFO缓冲器计算驻留时间的一个具体例子 为：发送FIFO缓冲器将平均拥塞值与设备本地时钟的时钟周期的时长相乘，获得的乘积即 为时间报文在PHY层中的驻留时间。</p>
    <p>[0142]	在接收方向，本实施例的获取不对称延迟时间的装置获得带有时间戳的事件报文 在PHY层的驻留时间的过程包括：Ap 1 ication Code 13周期性记录PHY层中接收FIFO缓 冲器的当前深度值，Aplication Codel3根据周期性记录的接收FIFO缓冲器的当前深度值 计算接收FIFO的平均拥塞度。该平均拥塞值即为该周期对应的当前拥塞度。Aplication Codel3利用当前拥塞度来计算携带有时间戳的事件报文在PHY层的驻留时间。</p>
    <p>[0143]	本实施例的获取不对称延迟时间的装置根据上述驻留时间进行时间同步的过程 与上述实施例三的描述相同，在此不再重复说明。</p>
    <p>[0144]	通过以上的实施方式的描述，本领域的技术人员可以清楚地了解到本发明可借助 软件加必需的硬件平台的方式来实现，当然也可以全部通过硬件来实施，但很多情况下前 者是更佳的实施方式。基于这样的理解，本发明的技术方案对背景技术做出贡献的全部或 者部分可以以软件产品的形式体现出来，所述的软件产品在可以用于执行上述的方法流 程。该计算机软件产品可以存储在存储介质中，如ROM/RAM、磁碟、光盘等，包括若干指令用 以使得一台计算机设备（可以是个人计算机，服务器，或者网络设备等）执行本发明各个实 施例或者实施例的某些部分所述的方法。</p>
    <p>[0145]	虽然通过实施例描绘了本发明，本领域普通技术人员知道，本发明有许多变形和 变化而不脱离本发明的精神，本发明的申请文件的权利要求包括这些变形和变化。</p>
  </div>
  </div></div><div class="patent-section patent-tabular-section"><a id="backward-citations"></a><div class="patent-section-header"><span class="patent-section-title">专利引用</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th">引用的专利</th><th class="patent-data-table-th"> 申请日期</th><th class="patent-data-table-th">公开日</th><th class="patent-data-table-th"> 申请人</th><th class="patent-data-table-th">专利名</th></tr></thead><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN1675864A?cl=zh">CN1675864A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2003年6月24日</td><td class="patent-data-table-td patent-date-value">2005年9月28日</td><td class="patent-data-table-td ">霍尼韦尔国际公司</td><td class="patent-data-table-td ">容错以太网中的时钟同步方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN101098219A?cl=zh">CN101098219A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2006年12月20日</td><td class="patent-data-table-td patent-date-value">2008年1月2日</td><td class="patent-data-table-td ">安捷伦科技有限公司</td><td class="patent-data-table-td ">校正由通信链路上的不对称延迟导致的时间同步误差</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN101636662A?cl=zh">CN101636662A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2008年2月29日</td><td class="patent-data-table-td patent-date-value">2010年1月27日</td><td class="patent-data-table-td ">罗伯特&#183;博世有限公司</td><td class="patent-data-table-td ">在集成电路内确定信号路径的不对称信号延迟的方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/EP1659718A2?cl=zh">EP1659718A2</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2005年10月21日</td><td class="patent-data-table-td patent-date-value">2006年5月24日</td><td class="patent-data-table-td ">Bosch Rexroth AG</td><td class="patent-data-table-td ">Synchronisatonsverfahren und Steuerungssystem für die Synchronisation von Nebeneinheiten, sowie synchronisierbare Nebeneinheit</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/EP1801687A1?cl=zh">EP1801687A1</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2006年11月21日</td><td class="patent-data-table-td patent-date-value">2007年6月27日</td><td class="patent-data-table-td ">Agilent Technologies, Inc.</td><td class="patent-data-table-td ">Correcting time synchronization inaccuracy caused by internal asymmetric delays in a communication device</td></tr></table><div class="patent-section-footer">* 由审查员引用</div></div><div class="patent-section patent-tabular-section"><a id="forward-citations"></a><div class="patent-section-header"><span class="patent-section-title"> 被以下专利引用</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th">引用专利</th><th class="patent-data-table-th"> 申请日期</th><th class="patent-data-table-th">公开日</th><th class="patent-data-table-th"> 申请人</th><th class="patent-data-table-th">专利名</th></tr></thead><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102136968A?cl=zh">CN102136968A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年1月7日</td><td class="patent-data-table-td patent-date-value">2011年7月27日</td><td class="patent-data-table-td ">华为技术有限公司</td><td class="patent-data-table-td ">测量报文在以太交换设备中的延时的方法及以太交换设备</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102136968B?cl=zh">CN102136968B</a></td><td class="patent-data-table-td patent-date-value">2011年1月7日</td><td class="patent-data-table-td patent-date-value">2013年4月24日</td><td class="patent-data-table-td ">华为技术有限公司</td><td class="patent-data-table-td ">测量报文在以太交换设备中的延时的方法及以太交换设备</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102916743A?cl=zh">CN102916743A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2012年8月1日</td><td class="patent-data-table-td patent-date-value">2013年2月6日</td><td class="patent-data-table-td ">大唐电信（成都）信息技术有限公司</td><td class="patent-data-table-td ">一种时间延迟不对称差值精准测量的方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102916743B?cl=zh">CN102916743B</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2012年8月1日</td><td class="patent-data-table-td patent-date-value">2016年4月20日</td><td class="patent-data-table-td ">大唐电信（成都）信息技术有限公司</td><td class="patent-data-table-td ">一种时间延迟不对称差值精准测量的方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN103401813A?cl=zh">CN103401813A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2013年8月20日</td><td class="patent-data-table-td patent-date-value">2013年11月20日</td><td class="patent-data-table-td ">北京华为数字技术有限公司</td><td class="patent-data-table-td ">一种非对称延迟补偿方法及交换机</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2011124113A1?cl=zh">WO2011124113A1</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年3月25日</td><td class="patent-data-table-td patent-date-value">2011年10月13日</td><td class="patent-data-table-td ">Huawei Technologies Co., Ltd.</td><td class="patent-data-table-td ">获取不对称延迟时间的方法和装置</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2012092789A1?cl=zh">WO2012092789A1</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年10月14日</td><td class="patent-data-table-td patent-date-value">2012年7月12日</td><td class="patent-data-table-td ">Huawei Technologies Co., Ltd.</td><td class="patent-data-table-td ">测量报文在以太交换设备中的延时的方法及以太交换设备</td></tr></table><div class="patent-section-footer">* 由审查员引用</div></div><div class="patent-section patent-tabular-section"><a id="classifications"></a><div class="patent-section-header"><span class="patent-section-title">分类</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th"> </th><th class="patent-data-table-th"> </th></tr></thead><tr><td class="patent-data-table-td ">国际分类号</td><td class="patent-data-table-td "><span class="nested-value"><a href="https://www.google.com/url?id=HdR5BwABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=H04L0007000000">H04L7/00</a></span>, <span class="nested-value"><a href="https://www.google.com/url?id=HdR5BwABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=H04L0029060000">H04L29/06</a></span>, <span class="nested-value"><a href="https://www.google.com/url?id=HdR5BwABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=H04L0012560000">H04L12/56</a></span></td></tr><tr><td class="patent-data-table-td "> 合作分类</td><td class="patent-data-table-td "><span class="nested-value"><a href="https://www.google.com/url?id=HdR5BwABERAJ&amp;q=http://worldwide.espacenet.com/classification&amp;usg=AFQjCNGs5WqSrPE3A4ZP63zGuM6PRNfEFA#!/CPC=H04J3/0667">H04J3/0667</a></span></td></tr><tr><td class="patent-data-table-td "> 欧洲专利分类号</td><td class="patent-data-table-td "><span class="nested-value">H04J3/06C1P2B</span></td></tr></table><div class="patent-section-footer"></div></div><div class="patent-section patent-tabular-section"><a id="legal-events"></a><div class="patent-section-header"><span class="patent-section-title">法律事件</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th"> 日期</th><th class="patent-data-table-th">代码</th><th class="patent-data-table-th">事件</th><th class="patent-data-table-th">说明</th></tr></thead><tr><td class="patent-data-table-td patent-date-value">2010年8月25日</td><td class="patent-data-table-td ">C06</td><td class="patent-data-table-td ">Publication</td><td class="patent-data-table-td "></td></tr><tr><td class="patent-data-table-td patent-date-value">2012年6月27日</td><td class="patent-data-table-td ">C14</td><td class="patent-data-table-td ">Granted</td><td class="patent-data-table-td "></td></tr></table><div class="patent-section-footer"></div></div><div class="modal-dialog" id="patent-images-lightbox"><div class="patent-lightbox-controls"><div class="patent-lightbox-rotate-controls"><div class="patent-lightbox-rotation-text">旋转</div><div class="rotate-icon rotate-ccw-icon"></div><div class="rotate-icon rotate-cw-icon"></div></div><div class="patent-lightbox-index-counter"></div><a class="patent-lightbox-fullsize-link" target="_blank">原始图片</a><div class="patent-drawings-control patent-drawings-next"><img class="patent-drawings-button-img"src="/googlebooks/images/kennedy/page_right.png" alt="Next page"width="21" height="21" /></div><div class="patent-drawings-control patent-drawings-prev"><img class="patent-drawings-button-img"src="/googlebooks/images/kennedy/page_left.png" alt="Previous page"width="21" height="21" /></div></div><div class="modal-dialog-content"><div class="patent-lightbox-image-holder"><div class="patent-lightbox-placeholder"></div></div></div></div><script>_OC_initPatentsAtb({image_not_available_html: " 未提供图片。\x3ca href\x3d//docs.google.com/viewer?url\x3dpatentimages.storage.googleapis.com/pdfs/deda929ef736cc4f772e/CN101814984A.pdf\x3e查看 PDF\x3c/a\x3e"});</script></div></div></div></div></div><script>(function() {var href = window.location.href;if (href.indexOf('?') !== -1) {var parameters = href.split('?')[1].split('&');for (var i = 0; i < parameters.length; i++) {var param = parameters[i].split('=');if (param[0] == 'focus') {var elem = document.getElementById(param[1]);if (elem) {elem.focus();}}}}})();</script><script>_OC_addFlags({LockSrc:"/books/javascript/lock_5115ea495017d9115e613207d3810e5a.js", Host:"https://www.google.com/", IsBooksRentalEnabled:1, IsBrowsingHistoryEnabled:1, IsWebReaderSvgEnabled:0, IsImageModeNotesEnabled:1, IsOfflineBubbleEnabled:1, IsFutureOnSaleVolumesEnabled:1, IsBooksUnifiedLeftNavEnabled:1, IsMobileRequest:0, IsZipitFolderCollectionEnabled:1, IsAdsDisabled:0, IsEmbeddedMediaEnabled:1, IsImageModeAnnotationsEnabled:1, IsMyLibraryGooglePlusEnabled:1, IsImagePageProviderEnabled:1, IsBookcardListPriceSmall:0, IsInternalUser:0, IsBooksShareButtonEnabled:0, IsDisabledRandomBookshelves:0});_OC_Run({"enable_p13n":false,"is_cobrand":false,"sign_in_url":"https://www.google.com/accounts/Login?service=\u0026continue=https://www.google.com/patents%3Fcl%3Dzh%26hl%3Dzh-CN\u0026hl=zh-CN"}, {"volume_id":"","is_ebook":true,"volumeresult":{"has_flowing_text":false,"has_scanned_text":true,"can_download_pdf":false,"can_download_epub":false,"is_pdf_drm_enabled":false,"is_epub_drm_enabled":false,"download_pdf_url":"https://www.google.com/patents/download/%E8%8E%B7%E5%8F%96%E4%B8%8D%E5%AF%B9%E7%A7%B0%E5%BB%B6%E8%BF%9F%E6%97%B6%E9%97%B4%E7%9A%84%E6%96%B9%E6%B3%95%E5%92%8C.pdf?id=HdR5BwABERAJ\u0026hl=zh-CN\u0026output=pdf\u0026sig=ACfU3U2nmcaosO-p_leLDIXIpkSvXr3r8g"},"sample_url":"https://www.google.com/patents/reader?id=HdR5BwABERAJ\u0026hl=zh-CN\u0026printsec=frontcover\u0026output=reader\u0026source=gbs_atb_hover","is_browsable":true,"is_public_domain":true}, {});</script><div id="footer_table" style="font-size:83%;text-align:center;position:relative;top:20px;height:4.5em;margin-top:2em"><div style="margin-bottom:8px"><a href="https://www.google.com/search?hl=zh-CN"><nobr>Google&nbsp;首页</nobr></a> - <a href="//www.google.com/patents/sitemap/"><nobr>站点地图</nobr></a> - <a href="http://www.google.com/googlebooks/uspto.html"><nobr>美国专利商标局 (USPTO) 专利信息批量下载</nobr></a> - <a href="/intl/zh-CN/privacy/"><nobr>隐私权政策</nobr></a> - <a href="/intl/zh-CN/policies/terms/"><nobr>服务条款</nobr></a> - <a href="https://support.google.com/faqs/answer/2539193?hl=zh-CN"><nobr> 关于 Google 专利</nobr></a> - <a href="//www.google.com/tools/feedback/intl/zh-CN/error.html" onclick="try{_OC_startFeedback({productId: '72792',locale: 'zh-CN'});return false;}catch(e){}"><nobr>发送反馈</nobr></a></div></div> <script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">var pageTracker = _gat._getTracker("UA-27188110-1");pageTracker._setCookiePath("/patents/");pageTracker._trackPageview();</script> </body></html>