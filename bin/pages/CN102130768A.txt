<!DOCTYPE html><html><head><title>专利 CN102130768A - 一种具有链路层加解密能力的终端设备及其数据处理方法 -  Google 专利</title><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){var d=void 0!=b?b:(new Date).getTime();this.t[a]=[d,c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(e){}};this.tick("start",null,a)}var a;window.performance&&(a=window.performance.timing);var f=a?new e(a.responseStart):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_",
"_wtsrt",d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();})();
</script><link rel="stylesheet" href="/patents/css/_6e802a6b2b28d51711baddc2f3bec198/kl_intl_patents_bundle.css" type="text/css" /><script src="/books/javascript/atb_6e802a6b2b28d51711baddc2f3bec198__zh_cn.js"></script><script>function googleTranslateElementInit() {new google.translate.TranslateElement({pageLanguage: "zh",gaTrack: true,gaId: "UA-27188110-1",multilanguagePage: true});}</script><script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script><meta name="DC.type" content="Patent"><meta name="DC.title" content="一种具有链路层加解密能力的终端设备及其数据处理方法"><meta name="DC.contributor" content="曹军" scheme="inventor"><meta name="DC.contributor" content="李琴" scheme="inventor"><meta name="DC.contributor" content="铁满霞" scheme="inventor"><meta name="DC.contributor" content="西安西电捷通无线网络通信股份有限公司" scheme="assignee"><meta name="DC.date" content="2010-12-20" scheme="dateSubmitted"><meta name="DC.description" content="一种具有链路层加解密能力的终端设备及其数据处理方法，该具终端设备包括链路层处理模块，链路层处理模块包括控制模块、数据帧加密处理模块、数据帧解密处理模块、密钥管理模块、算法模块、发端口和收端口；控制模块通过数据帧加密处理模块接入发端口；收端口通过数据帧解密处理模块接入控制模块；控制模块和密钥管理模块相连；数据帧加密处理模块通过密钥管理模块和数据帧解密处理模块相连；数据帧加密处理模块通过算法模块和数据帧解密处理模块相连。本发明可有效降低离终端设备最近的接入交换设备的计算负担，降低数据传输延迟。"><meta name="DC.date" content="2011-7-20"><meta name="DC.relation" content="CN:101043335:A" scheme="references"><meta name="DC.relation" content="CN:101741548:A" scheme="references"><meta name="DC.relation" content="CN:101917272:A" scheme="references"><meta name="DC.relation" content="EP:1643675:A1" scheme="references"><meta name="citation_patent_publication_number" content="CN:102130768:A"><meta name="citation_patent_application_number" content="CN:201010596663"><link rel="canonical" href="https://www.google.com/patents/CN102130768A?cl=zh"/><meta property="og:url" content="https://www.google.com/patents/CN102130768A?cl=zh"/><meta name="title" content="专利 CN102130768A - 一种具有链路层加解密能力的终端设备及其数据处理方法"/><meta name="description" content="一种具有链路层加解密能力的终端设备及其数据处理方法，该具终端设备包括链路层处理模块，链路层处理模块包括控制模块、数据帧加密处理模块、数据帧解密处理模块、密钥管理模块、算法模块、发端口和收端口；控制模块通过数据帧加密处理模块接入发端口；收端口通过数据帧解密处理模块接入控制模块；控制模块和密钥管理模块相连；数据帧加密处理模块通过密钥管理模块和数据帧解密处理模块相连；数据帧加密处理模块通过算法模块和数据帧解密处理模块相连。本发明可有效降低离终端设备最近的接入交换设备的计算负担，降低数据传输延迟。"/><meta property="og:title" content="专利 CN102130768A - 一种具有链路层加解密能力的终端设备及其数据处理方法"/><meta property="og:type" content="book"/><meta property="og:site_name" content="Google Books"/><meta property="og:image" content="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"/><link rel="image_src" href="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"/><script>if (window['_OC_timingAction']) {window['_OC_timingAction']('patents_refpage');}</script><style>#gbar,#guser{font-size:13px;padding-top:1px !important;}#gbar{height:22px}#guser{padding-bottom:7px !important;text-align:right}.gbh,.gbd{border-top:1px solid #c9d7f1;font-size:1px}.gbh{height:0;position:absolute;top:24px;width:100%}@media all{.gb1{height:22px;margin-right:.5em;vertical-align:top}#gbar{float:left}}a.gb1,a.gb4{text-decoration:underline !important}a.gb1,a.gb4{color:#00c !important}.gbi .gb4{color:#dd8e27 !important}.gbf .gb4{color:#900 !important}

#gbar { padding:.3em .6em !important;}</style></head><body ><div id=gbar><nobr><a class=gb1 href="https://www.google.com/search?cl=zh&hl=zh-CN&sa=N&tab=tw">搜索</a> <a class=gb1 href="https://www.google.com/search?cl=zh&hl=zh-CN&tbm=isch&source=og&sa=N&tab=ti">图片</a> <a class=gb1 href="https://maps.google.com/maps?cl=zh&hl=zh-CN&sa=N&tab=tl">地图</a> <a class=gb1 href="https://play.google.com/?cl=zh&hl=zh-CN&sa=N&tab=t8">Play</a> <a class=gb1 href="https://www.youtube.com/results?cl=zh&hl=zh-CN&sa=N&tab=t1">YouTube</a> <a class=gb1 href="https://news.google.com/nwshp?hl=zh-CN&tab=tn">新闻</a> <a class=gb1 href="https://mail.google.com/mail/?tab=tm">Gmail</a> <a class=gb1 href="https://drive.google.com/?tab=to">云端硬盘</a> <a class=gb1 style="text-decoration:none" href="https://www.google.com/intl/zh-CN/options/"><u>更多</u> &raquo;</a></nobr></div><div id=guser width=100%><nobr><span id=gbn class=gbi></span><span id=gbf class=gbf></span><span id=gbe></span><a target=_top id=gb_70 href="https://www.google.com/accounts/Login?service=&continue=https://www.google.com/patents%3Fcl%3Dzh%26hl%3Dzh-CN&hl=zh-CN" class=gb4>登录</a></nobr></div><div class=gbh style=left:0></div><div class=gbh style=right:0></div><div role="alert" style="position: absolute; left: 0; right: 0;"><a href="https://www.google.com/patents/CN102130768A?cl=zh&amp;hl=zh-CN&amp;output=html_text" title="屏幕阅读器用户请注意：点击此链接可进入无障碍模式。阅读器在无障碍模式下具有同样的基本功能，但可让用户获得更好的体验。"><img border="0" src="//www.google.com/images/cleardot.gif"alt="屏幕阅读器用户请注意：点击此链接可进入无障碍模式。阅读器在无障碍模式下具有同样的基本功能，但可让用户获得更好的体验。"></a></div><div class="kd-appbar"><h2 class="kd-appname"><a href="/patents?hl=zh-CN"> 专利</a></h2><div class="kd-buttonbar left" id="left-toolbar-buttons"><a id="appbar-write-review-link" href=""></a><a id="appbar-view-print-sample-link" href=""></a><a id="appbar-view-ebook-sample-link" href=""></a><a id="appbar-patents-prior-art-finder-link" href="https://www.google.com/patents/related/CN102130768A"></a><a id="appbar-patents-discuss-this-link" href="https://www.google.com/url?id=enGXBwABERAJ&amp;q=http://patents.stackexchange.com/redirect/google-patents%3Fpublication%3DCN102130768A&amp;usg=AFQjCNHLMHC6zTHDU5YlS3zS64AsLZo4YQ" data-is-grant="false"></a><a id="appbar-read-patent-link" href="//docs.google.com/viewer?url=patentimages.storage.googleapis.com/pdfs/fc883811e7f30eaa90b7/CN102130768A.pdf"></a><a id="appbar-download-pdf-link" href="//patentimages.storage.googleapis.com/pdfs/fc883811e7f30eaa90b7/CN102130768A.pdf"></a><a class="appbar-content-language-link" data-selected="true" data-label="中文" href="/patents/CN102130768A?cl=zh&amp;hl=zh-CN"></a><a class="appbar-content-language-link" data-label="英语" href="/patents/CN102130768A?cl=en&amp;hl=zh-CN"></a><a class="appbar-application-grant-link" data-selected="true" data-label="申请" href="/patents/CN102130768A?hl=zh-CN&amp;cl=zh"></a><a class="appbar-application-grant-link" data-label="授权" href="/patents/CN102130768B?hl=zh-CN&amp;cl=zh"></a></div><div class="kd-buttonbar right" id="right-toolbar-buttons"></div></div><div id="books-microdata" itemscope=""itemtype="http://schema.org/Book"itemid="https://www.google.com/patents/CN102130768A?cl=zh" style="display:none"><span itemprop="description">一种具有链路层加解密能力的终端设备及其数据处理方法，该具终端设备包括链路层处理模块，链路层处理模块包括控制模块、数据帧加密处理模块、数据帧解密处理模块、密钥管理模块、算法模块、发端口和收端口；控制模块...</span><span itemprop="url">https://www.google.com/patents/CN102130768A?cl=zh&amp;utm_source=gb-gplus-share</span><span class="main-title" itemprop="name">专利 CN102130768A - 一种具有链路层加解密能力的终端设备及其数据处理方法</span><img itemprop="image" src="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"alt="专利 CN102130768A - 一种具有链路层加解密能力的终端设备及其数据处理方法" title="专利 CN102130768A - 一种具有链路层加解密能力的终端设备及其数据处理方法"></div><div style="display: none"><ol id="ofe-gear-menu-contents" class="gbmcc"><li class="gbe gbmtc"><a class="gbmt goog-menuitem-content" id="" href="https://www.google.com/advanced_patent_search?hl=zh-CN"> 高级专利搜索</a></li></ol></div><div id="volume-main"><div id="volume-center"><div class=vertical_module_list_row><div id=intl_patents class=about_content><div id=intl_patents_v><table class="patent-bibdata patent-drawings-missing"><tr><td class="patent-bibdata-heading"> 公开号</td><td class="single-patent-bibdata">CN102130768 A</td></tr><tr><td class="patent-bibdata-heading">发布类型</td><td class="single-patent-bibdata">申请</td></tr><tr><td class="patent-bibdata-heading"> 专利申请号</td><td class="single-patent-bibdata">CN 201010596663</td></tr><tr><td class="patent-bibdata-heading">公开日</td><td class="single-patent-bibdata">2011年7月20日</td></tr><tr><td class="patent-bibdata-heading"> 申请日期</td><td class="single-patent-bibdata">2010年12月20日</td></tr><tr><td class="patent-bibdata-heading"> 优先权日<span class="patent-tooltip-anchor patent-question-icon"data-tooltip-text="优先日期属于假设性质，不具任何法律效力。Google 对于所列日期的正确性并没有进行法律分析，也不作任何陈述。"></span></td><td class="single-patent-bibdata">2010年12月20日</td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">公告号</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="/patents/CN102130768B?hl=zh-CN&amp;cl=zh">CN102130768B</a>, </span><span class="patent-bibdata-value"><a href="/patents/US9009466?hl=zh-CN&amp;cl=zh">US9009466</a>, </span><span class="patent-bibdata-value"><a href="/patents/US20130283045?hl=zh-CN&amp;cl=zh">US20130283045</a>, </span><span class="patent-bibdata-value"><a href="/patents/WO2012083652A1?hl=zh-CN&amp;cl=zh">WO2012083652A1</a></span></span></td></tr><tr class="patent-bibdata-list-row alternate-patent-number"><td class="patent-bibdata-heading"> 公开号</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value">201010596663.6, </span><span class="patent-bibdata-value">CN 102130768 A, </span><span class="patent-bibdata-value">CN 102130768A, </span><span class="patent-bibdata-value">CN 201010596663, </span><span class="patent-bibdata-value">CN-A-102130768, </span><span class="patent-bibdata-value">CN102130768 A, </span><span class="patent-bibdata-value">CN102130768A, </span><span class="patent-bibdata-value">CN201010596663, </span><span class="patent-bibdata-value">CN201010596663.6</span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading"> 发明者</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E6%9B%B9%E5%86%9B%22">曹军</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E6%9D%8E%E7%90%B4%22">李琴</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E9%93%81%E6%BB%A1%E9%9C%9E%22">铁满霞</a></span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading"> 申请人</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=inassignee:%22%E8%A5%BF%E5%AE%89%E8%A5%BF%E7%94%B5%E6%8D%B7%E9%80%9A%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E8%82%A1%E4%BB%BD%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8%22">西安西电捷通无线网络通信股份有限公司</a></span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">导出引文</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="/patents/CN102130768A.bibtex?cl=zh">BiBTeX</a>, </span><span class="patent-bibdata-value"><a href="/patents/CN102130768A.enw?cl=zh">EndNote</a>, </span><span class="patent-bibdata-value"><a href="/patents/CN102130768A.ris?cl=zh">RefMan</a></span></span></td></tr><tr class="patent-internal-links"><td colspan=2><span class="patent-bibdata-value"><a href="#backward-citations">专利引用</a> (4),</span> <span class="patent-bibdata-value"><a href="#forward-citations"> 被以下专利引用</a> (1),</span> <span class="patent-bibdata-value"><a href="#classifications">分类</a> (6),</span> <span class="patent-bibdata-value"><a href="#legal-events">法律事件</a> (3)</span> </td></tr><tr><td colspan=2 class="patent-bibdata-external-link-spacer-top"></td></tr><tr class="patent-bibdata-external-link-spacer-bottom"></tr><tr><td colspan=2><span class="patent-bibdata-heading">外部链接:&nbsp;</span><span><span class="patent-bibdata-value"><a href="https://www.google.com/url?id=enGXBwABERAJ&amp;q=http://211.157.104.87:8080/sipo/zljs/hyjs-yx-new.jsp%3Frecid%3D201010596663&amp;usg=AFQjCNErnNTeDp5iAAa674s5ivqvarufxw"> 中国国家知识产权局</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/url?id=enGXBwABERAJ&amp;q=http://worldwide.espacenet.com/publicationDetails/biblio%3FCC%3DCN%26NR%3D102130768A%26KC%3DA%26FT%3DD&amp;usg=AFQjCNEIdPx-0S812D3lRuib1QcrnINsTQ"> 欧洲专利数据库 (Espacenet)</a></span></span></td></tr><tr class="patent-bibdata-group-spacer"></tr></table><div class="number-and-title"><span class="patent-title"><invention-title mxw-id="PT104289732" lang="ZH" load-source="patent-office">一种具有链路层加解密能力的终端设备及其数据处理方法</invention-title>
      </span><br><span class="patent-number">CN 102130768 A</span></div><div class="patent-section patent-abstract-section"><div class="patent-section-header"><span class="patent-section-title"> 摘要</span></div><div class="patent-text"><abstract mxw-id="PA86195397" lang="ZH" load-source="patent-office">
    <div class="abstract">一种具有链路层加解密能力的终端设备及其数据处理方法，该具终端设备包括链路层处理模块，链路层处理模块包括控制模块、数据帧加密处理模块、数据帧解密处理模块、密钥管理模块、算法模块、发端口和收端口；控制模块通过数据帧加密处理模块接入发端口；收端口通过数据帧解密处理模块接入控制模块；控制模块和密钥管理模块相连；数据帧加密处理模块通过密钥管理模块和数据帧解密处理模块相连；数据帧加密处理模块通过算法模块和数据帧解密处理模块相连。本发明可有效降低离终端设备最近的接入交换设备的计算负担，降低数据传输延迟。</div>
  </abstract>
  </div></div><div class="patent-section patent-claims-section"><div class="patent-section-header"><span class="patent-section-title">权利要求<span class="patent-section-count">(12)</span></span></div><div class="patent-text"><div mxw-id="PCLM37807966" lang="ZH" load-source="patent-office" class="claims">
    <div class="claim"> <div num="1" class="claim">
      <div class="claim-text">1.	一种具有链路层加解密能力的终端设备，其特征在于：所述具有链路层加解密能力 的终端设备包括链路层处理模块，所述链路层处理模块包括控制模块、数据帧加密处理模 块、数据帧解密处理模块、密钥管理模块、算法模块、发端口和收端口 ；所述控制模块通过数 据帧加密处理模块接入发端口 ；所述收端口通过数据帧解密处理模块接入控制模块；所述 控制模块和密钥管理模块相连；所述数据帧加密处理模块通过密钥管理模块和数据帧解 密处理模块相连；所述数据帧加密处理模块通过算法模块和数据帧解密处理模块相连；其 中，所述控制模块具有策略管理和控制能力；所述密钥管理模块具有链路层密钥管理能力，并根据控制模块的策略需要，为终端设 备与网络中的其他终端设备之间和/或该终端设备与网络中的交换设备之间建立共享的 密钥，并负责对密钥进行存储、更新或删除管理操作；所建立的共享密钥是预共享的或是在 终端设备与其他终端设备或交换设备身份鉴别成功后协商建立的；所述数据帧加密处理模块在收到需要发送出去的用户数据后，通过与密钥管理模块进 行交互得到对应的密钥，再调用算法模块，实现对用户数据的加密处理，得到用户数据的密 文，构造链路层加密数据帧，并通过发端口将加密数据帧发送出去；所述数据帧解密处理模块在通过收端口接收到数据帧后，通过与密钥管理模块进行交 互得到对应的密钥，再调用算法模块，实现对数据帧进行解密处理，得到用户数据的明文信 息，并通过控制模块将明文信息递交给上层；所述算法模块涉及加解密算法和/或完整性校验算法。</div>
    </div>
    </div> <div class="claim"> <div num="2" class="claim">
      <div class="claim-text">2.	一种具有链路层加解密能力的终端设备的数据处理方法，其特征在于：所述方法包 括以下步骤：1)所述终端设备发送链路层加密协议数据帧时，1.1)所述终端设备的链路层控制模块接收上层所发送的需要链路层发送的用户数据；1.2)由控制模块根据本地策略，选择使用的链路层加密协议类型及保密处理策略； 并将选择的链路层加密协议类型及保密处理策略及用户数据信息发送给数据帧加密处理 模块；1.	3)数据帧加密处理模块根据对应的链路层加密协议及保密处理策略处理用户数据， 并判断是否需要对用户数据进行加密操作构造Frame Al ；1.4)数据帧加密处理模块将构造好的Frame Al，通过发端口发送出去，从而完成链路 层数据帧的发送；2)所述终端设备接收链路层加密协议数据帧时，2.	1)终端设备通过物理层收到发给该终端设备的数据帧Frame A2，通过收端口将接收 到的数据帧Frame A2交给数据帧解密处理模块；2.2)数据帧解密处理模块根据接收到的数据帧Frame A2，判断对应的链路层加密协议；2. 3)数据帧解密处理模块根据对应的链路层加密协议判断用户数据是否是明文，并解 析Frame A2，得到用户数据：2. 4)数据帧解密处理模块将得到的用户数据的明文通过控制模块提交给上层，从而完成链路层数据帧的接收；其中，所述Frame Al是所述终端设备通过发端口发出的数据帧；所述FrameA2是终端 设备通过收端口收到的数据帧。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="3" class="claim">
      <div class="claim-text">3.根据权利要求2所述的具有链路层加解密能力的终端设备的数据处理方法，其特征 在于：该方法支持标准的IS0/IEC 8802-3数据帧或链路层加密协议数据帧，所支持的链路 层加密协议数据帧中包括：Frame Header字段以及Payload字段：所述Frame Header字段，表示帧头信息，包括DA字段、SA字段、Ethertype字段、isE 字段以及keylndex字段； 其中：DA字段：表示目的节点的标识，取值目的节点的MAC地址； SA字段：表示源节点的标识，取值源节点的MAC地址；Ethertype字段：表示以太类型字段，取值为链路层加密协议的以太类型字段；用于标 识对应的链路层加密协议及帧结构；isE字段：表示加密标志位，用于标识数据帧的有效负载是用户数据的明文信息还是 密文信息，数据包的接收方将该字段作为是否需要解密的一个判断因素；keylndex字段：表示对用户数据进行保护的密钥的标识；所述对用户数据进行保护的 方式是加密和/或计算完整性校验的；所述对用户数据进行保护的密钥是该终端设备和交 换设备之间的密钥或是该终端设备和目的端终端设备之间的密钥；Payload字段，表示数据帧有效负载，所述Payload字段是用户数据的明文信息或是用 户数据的密文信息；当isE字段表示加密时，有效负载是用户数据的密文信息；当isE字段 表示不加密时，有效负载是用户数据的明文信息。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="4" class="claim">
      <div class="claim-text">4.根据权利要求3所述的具有链路层加解密能力的终端设备的数据处理方法，其特征 在于：当数据帧加密处理模块根据对应的链路层加密协议及保密处理策略判断不需要对用 户数据进行加密时，所述步骤1.&#190;的具体实现方式是：数据帧加密处理模块构造Frame Al，所述Frame Al各字段取值如下： Frame Al. DA字段，取值为目的节点的MAC地址； Frame Al. SA字段，取值为该终端设备的MAC地址；Frame Al. Ethertype字段，取值为对应的链路层加密协议的以太类型字段值； Frame Al. isE字段，取值为不加密；Frame Al. keylndex字段，取值不限制（用户数据不加密时该字段没有意义）； Frame Al. Payload字段，取值为用户数据；当数据帧加密处理模块根据对应的链路层加密协议及保密处理策略判断需要对用户 数据进行加密时，所述步骤1. 3)的具体实现方式是：，1. 3. 1. 1)数据帧加密处理模块调用密钥管理模块，得到对用户数据进行加密的密钥 KEYl以及密钥KEYl的标识keyhdexl ；，1. 3. 1. 2)数据帧加密处理模块根据得到的密钥KEY1，调用算法模块对用户数据进行 加密，得到用户数据的密文；，1. 3. 1. 3)数据帧加密处理模块构造Frame Al ；所述Frame Al各字段取值如下：Frame Al. DA字段，取值为目的节点的MAC地址； Frame Al. SA字段，取值为该终端设备的MAC地址；Frame Al. Ethertype字段，取值为对应的链路层加密协议的以太类型字段值； Frame Al. isE字段，取值为加密；Frame Al. keylndex字段，取值为密钥KEYl的标识keyhdexl ； Frame Al. Payload字段，取值为用户数据的密文；所述KEYl是终端设备发送的数据帧Frame Al中Payload字段是用户数据的密文信息 时，构造Frame Al所使用的密钥。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="5" class="claim">
      <div class="claim-text">5.根据权利要求3所述的具有链路层加解密能力的终端设备的数据处理方法，其特征 在于：当数据帧解密处理模块根据Frame A2. isE字段判断Frame A2. Payload字段是用户数 据的明文时，所述步骤2. 3)的具体实现方式是：提取Frame A2. Payload字段即为用户数据 的明文，完成对Frame A2的解析，得到用户数据；当数据帧解密处理模块根据Frame A2. isE字段判断Frame A2. Payload字段是用户数 据的密文时，所述步骤2.&#190;的具体实现方式是：&#183;2. 3. 1. 1)数据帧解密处理模块将Frame A2. keylndex字段信息，提交给密钥管理模 块，检索得到对Frame A2. Payload进行解密的密钥KEY2 ；&#183;2. 3. 1. 2)数据帧解密处理模块根据得到的密钥KEY2，调用算法模块对FrameA2. Payload进行解密，得到用户数据的明文，完成对Frame A2的解析，得到用户数据；所述KEY2是终端设备接收的数据帧Frame A2中Payload字段是用户数据的密文信息 时，解析Frame A2所使用的密钥。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="6" class="claim">
      <div class="claim-text">6.根据权利要求3所述的具有链路层加解密能力的终端设备的数据处理方法，其特征 在于：所述数据处理方法所支持的链路层加密协议数据帧中还包含完整性校验MIC字段； 所述MIC字段是对链路层解密协议数据帧除MIC字段外所有字段或部分字段计算得到的完 整性校验值；所述数据帧进行保密处理的密钥包含完整性校验密钥和加密密钥两部分；所 述完整性校验密钥用于计算或验证MIC字段；所述加密密钥部分用于加密用户数据或解密 用户数据的密文。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="7" class="claim">
      <div class="claim-text">7.根据权利要求6所述的具有链路层加解密能力的终端设备的数据处理方法，其特征 在于：当数据帧加密处理模块根据对应的链路层加密协议及保密处理策略判断不需要对用 户数据进行加密时，所述步骤1. 3)的具体实施方式是：&#183;1. 3. 2. 1)数据帧加密处理模块调用密钥管理模块，得到对数据帧进行保密处理的密钥 KEYl以及密钥KEYl的标识keyhdexl ；&#183;1. 3. 2. 2)数据帧加密处理模块构造Frame Al除Frame Al. MIC字段外所有字段；所述 Frame Al除Frame Al. MIC外所有字段取值如下： Frame Al. DA字段，取值为目的节点的MAC地址； Frame Al. SA字段，取值为该终端设备的MAC地址；Frame Al. Ethertype字段，取值为对应的链路层加密协议的以太类型字段值； Frame Al. isE字段，取值为不加密；Frame Al. keylndex字段，取值为密钥KEYl的标识keyhdexl ； Frame Al. Payload字段，取值为用户数据；1. 3. 2. 3)数据帧加密处理模块对构造好的除Frame Al. MIC字段外的FrameAl，调用 对应的算法模块，利用KEYl的完整性校验密钥计算完整性校验FrameAl. MIC字段值；完成 Frame Al的构造；当数据帧加密处理模块根据对应的链路层加密协议及保密处理策略判断需要对用户 数据进行加密时，所述步骤1. 3)的具体实施方式是：1. 3. 3. 1)数据帧加密处理模块调用密钥管理模块，得到对数据帧进行保密处理的密钥 KEYl以及密钥KEYl的标识keyhdexl ；1. 3. 3. 2)数据帧加密处理模块根据得到的密钥KEY1，调用算法模块，利用KEYl的加密 密钥对用户数据进行加密，得到用户数据的密文；1. 3. 3. 3)数据帧加密处理模块构造Frame Al除Frame Al. MIC字段外所有字段；所述 Frame Al除Frame Al. MIC外所有字段取值如下： Frame Al. DA字段，取值为目的节点的MAC地址； Frame Al. SA字段，取值为该终端设备的MAC地址；Frame Al. Ethertype字段，取值为对应的链路层加密协议的以太类型字段值； Frame Al. isE字段，取值为加密；Frame Al. keyhdex 字段，取值为密钥 KEYl WSKkeyIndexl ； Frame Al. Payload字段，取值为用户数据的密文；1.	3. 3. 4)数据帧加密处理模块对构造好的除Frame Al. MIC字段外的FrameAl，调用 对应的算法模块，利用KEYl的完整性校验密钥计算完整性校验FrameAl. MIC字段值；完成 Frame Al的构造。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="8" class="claim">
      <div class="claim-text">8.根据权利要求6所述的具有链路层加解密能力的终端设备的数据处理方法，其特征 在于：当数据帧解密处理模块根据Frame A2. isE字段判断Frame A2. Payload字段是用户数 据的明文时，所述步骤2.&#190;的具体实施方式是：2.	3. 2. 1)数据帧解密处理模块将Frame A2. keylndex字段信息，提交给密钥管理模 块，检索得到对Frame A2进行解保密处理的密钥KEY2 ；2. 3. 2. 2)数据帧解密处理模块利用得到的密钥KEY2的完整性校验密钥部分，调用算 法模块，验证Frame A2中Frame A2. MIC字段的正确性；若Frame A2. MIC正确，则执行步骤 2. 3. 2. 3)；若不正确，则丢弃该分组；2.3.2.3)数据帧解密处理模块提取Frame A2. Payload字段作为用户数据的明文，完 成对Frame A2的解析；当数据帧解密处理模块根据Frame A2. isE字段判断Frame A2. Payload字段是用户数 据的密文时，所述步骤2.&#190;的具体实施方式是：2. 3. 3. 1)数据帧解密处理模块将Frame A2. keylndex字段信息，提交给密钥管理模 块，检索得到对Frame A2进行解保密处理的密钥KEY2 ；2. 3. 3. 2)数据帧解密处理模块利用得到的密钥KEY2的完整性校验密钥，调用算法 模块，验证Frame A2中Frame A2. MIC字段的正确性；若Frame A2. MIC正确，则执行步.2. 3. 3. 3)；否不正确，则丢弃该分组；.2. 3. 3. 3)数据帧解密处理模块利用得到的密钥KEY2的加密密钥，调用算法模块对 Frame A2. Payload进行解密，得到用户数据的明文，完成对Frame A2的解析。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="9" class="claim">
      <div class="claim-text">9.根据权利要求6所述的具有链路层加解密能力的终端设备的数据处理方法，其特 征在于：当终端设备对用户数据进行保护涉及的加密和完整性校验时，若所述步骤1. 3)中 数据帧加密处理模块是先对用户数据进行加密构造数据帧的有效负载I^yload字段，再对 数据帧进行完整性校验构造MIC字段时，所述步骤2. 3)中数据帧解密处理模块在接收到 数据帧时，先验证MIC字段的正确性，只有确定MIC字段正确后，再解密数据帧的有效负载 Payload字段得到用户数据明文信息，提交给上层；当终端设备对用户数据进行保护涉及的加密和完整性校验在具体实施时，若所述步骤 1. 3)中数据帧加密处理模块是先将用户数据明文作为有效负载Payload字段，对数据帧计 算完整性校验构造MIC字段，再对用户数据明文进行加密，用得到的用户数据密文更新数 据帧的有效负载I^ayload字段时，所述步骤2. 3)中数据帧解密处理模块先解密数据帧的有 效负载Payload字段得到用户数据明文信息；然后再验证MIC字段的正确性，只有确定MIC 字段正确后，之前解密得到的用户数据明文信息才有效，提交给上层。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="10" class="claim">
      <div class="claim-text">10.根据权利要求2-9中任意一项所述的具有链路层加解密能力的终端设备的数据 处理方法，其特征在于：上述步骤1. 3)、2. 3)在具体实施时，FrameAl. KeyIndex和Frame A2. Keyhdex都指示具有链路层加解密能力的终端设备与对端终端设备的站间密钥时，具 有链路层加解密能力的终端设备在发送数据帧给对端终端设备时，使用与对端终端设备之 间的站间密钥对要发送的数据帧进行保护，所述保护指加密和/或计算完整性校验；具有 链路层加解密能力的终端设备在接收来自对端终端设备的数据帧时，使用与对端终端设备 之间的站间密钥对接收到的数据帧进行解保护处理，所述解保护指解密和/或验证完整性 校验。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="11" class="claim">
      <div class="claim-text">11.根据权利要求2-9中任意一项所述的具有链路层加解密能力的终端设备的数据 处理方法，其特征在于：所述数据处理方法所支持的链路层加密协议数据帧帧头Frame Header中，还可包含MAClist字段；所述MAClist字段用于表示特定MAC地址列表信息，该 字段所给出的特定MAC地址列表中的交换设备需要对接收到的密文数据帧进行解密再加 密再转发的处理；该特定MAC地址列表外的交换设备除非为目的节点，否则都只需要对该 密文数据帧直接转发。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="12" class="claim">
      <div class="claim-text">12.根据权利要求11所述的具有链路层加解密能力的终端设备的数据处理方法，其 特征在于：上述MAClist字段的具体实现中定义从发送端终端设备到目的端终端设备的链 路上的第一个具有链路层加解密能力的交换设备以及最后一个具有链路层加解密能力的 交换设备的MAC地址列表，上述步骤1. 3)中具有链路层加解密能力的终端设备作为发送端终端设备，对端终端 设备作为目的端终端设备；具有链路层加解密能力的终端设备在获得从具有链路层加解 密能力的终端设备到对端终端设备链路上的第一个具有链路层加解密能力的交换设备SW1 以及最后一个具有链路层加解密能力的交换设备SW2W MAC地址信息后，在构造数据帧时 MAClist字段包含SW1和SW2的MAC地址，并使用发送端终端设备和从发送端终端设备到目 的端终端设备的链路上的第一个具有链路层加解密能力的交换设备之间的密钥对数据帧进行保密处理，即使用具有链路层加解密能力的终端设备与SW1之间的密钥KEY1对数据帧 进行保密处理，将KEY1的keyhdeXl赋值到数据帧的keylndex字段进行传输；所述对数据 帧进行保密处理指加密或/和计算完整性校验；上述步骤2. 3)中，具有链路层加解密能力的终端设备作为目的端终端设备，对端终端 设备作为发送端终端设备；具有链路层加解密能力的终端设备在收到来自对端终端设备发 来的数据帧时，提取MAClist字段得到从发送端终端设备到目的端终端设备的链路上的最 后一个具有链路层加解密能力的交换设备的MAC地址信息，并使用与这个交换设备之间的 密钥对数据帧进行解保密处理，即具有链路层加解密能力的终端设备提取MAClist字段得 到SW1的MAC地址信息，使用与SW1之间的密钥KEY1进行解保密处理，得到用户数据明文信 息；所述对数据帧进行解保密处理指解密或/和验证完整性校验。</div>
    </div>
  </div> </div>
  </div></div><div class="patent-section patent-description-section"><div class="patent-section-header"><span class="patent-section-title"> 说明</span></div><div class="patent-text"><div mxw-id="PDES43387006" lang="ZH" load-source="patent-office" class="description">
    <p>一种具有链路层加解密能力的终端设备及其数据处理方法</p>
    <p>技术领域</p>
    <p>[0001]	本发明属于网络安全领域，涉及一种具有链路层加解密能力的终端设备及其数据 处理方法。</p>
    <p>背景技术</p>
    <p>[0002]	有线局域网一般为广播型网络，一个节点发出的数据，其它节点都能收到。网络上 的各个节点共享信道，这给网络带来了极大的安全隐患。攻击者只要接入网络进行监听，就 可以捕获网络上所有的数据包。</p>
    <p>[0003]现有国家标准	GB/T 15629. 3 (对应 IEEE 802. 3 或 IS0/IEC 8802-3)定义的局 域网LAN并不提供数据保密方法，这样就使得攻击者容易窃取到关键信息。遵循GB/T 15629. 3 UfSlEEE 802. 3或IS0/IEC 8802-3)的终端设备不具备链路层加解密能力，链路 层数据包都是以明文形式在网络中进行传输，所传输的信息易被截获，安全隐患大。</p>
    <p>[0004]	IEEE 802. IAE为局域网LAN提供了逐跳加密的链路层数据保密方法，这种机制限 制终端设备只能使用与最近的接入交换设备之间的密钥在链路层对数据帧进行加解密处 理，不得直接使用与其他终端设备或其他交换设备之间的密钥在链路层对数据包进行加解 密处理。支持IEEE 802. IAE的终端设备的这种链路层处理方式使得最近的接入交换设备 的计算负担重；且因为这种方式构造的数据帧需要链路上的每一个交换设备都进行解密再 加密再转发的操作才能到达目的端终端设备，数据传输延迟大；且支持IEEE 802. IAE的终 端设备不支持一般交换设备和支持IEEE 802. IAE的交换设备的混合组网。</p>
    <p>发明内容</p>
    <p>[0005]	为了解决背景技术中存在的上述技术问题，本发明提供了一种具有链路层加解密 能力的终端设备及其数据处理方法。</p>
    <p>[0006]	本发明的技术解决方案是：本发明提供了一种具有链路层加解密能力的终端设 备，其特殊之处在于：所述具有链路层加解密能力的终端设备包括链路层处理模块，所述链 路层处理模块包括控制模块、数据帧加密处理模块、数据帧解密处理模块、密钥管理模块、 算法模块、发端口和收端口 ；所述控制模块通过数据帧加密处理模块接入发端口 ；所述收 端口通过数据帧解密处理模块接入控制模块；所述控制模块和密钥管理模块相连；所述数 据帧加密处理模块通过密钥管理模块和数据帧解密处理模块相连；所述数据帧加密处理模 块通过算法模块和数据帧解密处理模块相连；其中，</p>
    <p>[0007]	所述控制模块具有策略管理和控制能力；</p>
    <p>[0008]	所述密钥管理模块具有链路层密钥管理能力，并根据控制模块的策略需要，为终 端设备与网络中的其他终端设备之间和/或该终端设备与网络中的交换设备之间建立共 享的密钥，并负责对密钥进行存储、更新或删除管理操作；所建立的共享密钥是预共享的或 是在终端设备与其他终端设备或交换设备身份鉴别成功后协商建立的；</p>
    <p>[0009]	所述数据帧加密处理模块在收到需要发送出去的用户数据后，通过与密钥管理模块进行交互得到对应的密钥，再调用算法模块，实现对用户数据的加密处理，得到用户数据 的密文，构造链路层加密数据帧，并通过发端口将加密数据帧发送出去；</p>
    <p>[0010]	所述数据帧解密处理模块在通过收端口接收到数据帧后，通过与密钥管理模块进 行交互得到对应的密钥，再调用算法模块，实现对数据帧进行解密处理，得到用户数据的明 文信息，并通过控制模块将明文信息递交给上层；</p>
    <p>[0011]	所述算法模块涉及加解密算法和/或完整性校验算法。</p>
    <p>[0012]	一种具有链路层加解密能力的终端设备的数据处理方法，其特殊之处在于：所述 方法包括以下步骤：</p>
    <p>[0013]	1)所述终端设备发送链路层加密协议数据帧时，</p>
    <p>[0014]	1. 1)所述终端设备的链路层控制模块接收上层所发送的需要链路层发送的用户 数据；</p>
    <p>[0015]	1. 2)由控制模块根据本地策略，选择使用的链路层加密协议类型及保密处理策 略；并将选择的链路层加密协议类型及保密处理策略及用户数据信息发送给数据帧加密处 理模块；</p>
    <p>[0016]	1. 3)数据帧加密处理模块根据对应的链路层加密协议及保密处理策略处理用户 数据，并判断是否需要对用户数据进行加密操作构造Frame Al ；</p>
    <p>[0017]	1.4)数据帧加密处理模块将构造好的Frame Al，通过发端口发送出去，从而完成 链路层数据帧的发送；</p>
    <p>[0018]	2)所述终端设备接收链路层加密协议数据帧时，</p>
    <p>[0019]	2. 1)终端设备通过物理层收到发给该终端设备的数据帧Frame A2，通过收端口将 接收到的数据帧Frame A2交给数据帧解密处理模块；</p>
    <p>[0020]	2. 2)数据帧解密处理模块根据接收到的数据帧Frame A2，判断对应的链路层加密 协议；</p>
    <p>[0021]	2. 3)数据帧解密处理模块根据对应的链路层加密协议判断用户数据是否是明文， 并解析Frame A2，得到用户数据：</p>
    <p>[0022]	2. 4)数据帧解密处理模块将得到的用户数据的明文通过控制模块提交给上层，从 而完成链路层数据帧的接收；</p>
    <p>[0023]	其中，所述Frame Al是所述终端设备通过发端口发出的数据帧；所述FrameA2是 终端设备通过收端口收到的数据帧；</p>
    <p>[0024]	该方法支持标准的IS0/IEC 8802-3数据帧或链路层加密协议数据帧，所支持的 链路层加密协议数据帧中包括=Frame Header字段以及Payload字段：</p>
    <p>[0025]	所述Frame Header字段，表示帧头信息，包括DA字段、SA字段、Khertype字段、 isE字段以及keylndex字段；</p>
    <p>[0026]其中：</p>
    <p>[0027]	DA字段：表示目的节点的标识，取值目的节点的MAC地址；</p>
    <p>[0028]	SA字段：表示源节点的标识，取值源节点的MAC地址；</p>
    <p>[0029]	Ethertype字段：表示以太类型字段，取值为链路层加密协议的以太类型字段；用 于标识对应的链路层加密协议及帧结构；</p>
    <p>[0030]	isE字段：表示加密标志位，用于标识数据帧的有效负载是用户数据的明文信息还是密文信息，数据包的接收方将该字段作为是否需要解密的一个判断因素；</p>
    <p>[0031]	keylndex字段：表示对用户数据进行保护的密钥的标识；所述对用户数据进行保 护的方式是加密和/或计算完整性校验的；所述对用户数据进行保护的密钥是该终端设备 和交换设备之间的密钥或是该终端设备和目的端终端设备之间的密钥；</p>
    <p>[0032]	Payload字段，表示数据帧有效负载，所述Payload字段是用户数据的明文信息或 是用户数据的密文信息；当isE字段表示加密时，有效负载是用户数据的密文信息；当isE 字段表示不加密时，有效负载是用户数据的明文信息。</p>
    <p>[0033]	当数据帧加密处理模块根据对应的链路层加密协议及保密处理策略判断不需要 对用户数据进行加密时，所述步骤1. 3)的具体实现方式是：</p>
    <p>[0034]	数据帧加密处理模块构造Frame Al，所述Frame Al各字段取值如下：</p>
    <p>[0035]	Frame Al. DA字段，取值为目的节点的MAC地址；</p>
    <p>[0036]	Frame Al. SA字段，取值为该终端设备的MAC地址；</p>
    <p>[0037]	Frame Al. Ethertype字段，取值为对应的链路层加密协议的以太类型字段值；</p>
    <p>[0038]	Frame Al. isE字段，取值为不加密；</p>
    <p>[0039]	Frame Al. keylndex字段，取值不限制（用户数据不加密时该字段没有意义)；</p>
    <p>[0040]	Frame Al. Payload字段，取值为用户数据；</p>
    <p>[0041]	当数据帧加密处理模块根据对应的链路层加密协议及保密处理策略判断需要对 用户数据进行加密时，所述步骤1. 3)的具体实现方式是：</p>
    <p>[0042]	1. 3. 1. 1)数据帧加密处理模块调用密钥管理模块，得到对用户数据进行加密的密 钥KEYl以及密钥KEYl的标识keylndexl ；</p>
    <p>[0043]	1. 3. 1. 2)数据帧加密处理模块根据得到的密钥KEY1，调用算法模块对用户数据 进行加密，得到用户数据的密文；</p>
    <p>[0044]	1. 3. 1. 3)数据帧加密处理模块构造Frame Al ；所述Frame Al各字段取值如下：</p>
    <p>[0045]	Frame Al. DA字段，取值为目的节点的MAC地址；</p>
    <p>[0046]	Frame Al. SA字段，取值为该终端设备的MAC地址；</p>
    <p>[0047]	Frame Al. Ethertype字段，取值为对应的链路层加密协议的以太类型字段值；</p>
    <p>[0048]	Frame Al. isE字段，取值为加密；</p>
    <p>[0049]	Frame Al. keylndex 字段，取值为密钥 KEYl 的标识 keyhdexl ；</p>
    <p>[0050]	Frame Al. Payload字段，取值为用户数据的密文；</p>
    <p>[0051]	所述KEYl是终端设备发送的数据帧Frame Al中Payload字段是用户数据的密文 信息时，构造Frame Al所使用的密钥。</p>
    <p>[0052]	当数据帧解密处理模块根据Frame A2. isE字段判断Frame A2. Payload字段是用 户数据的明文时，所述步骤2. 3)的具体实现方式是：提取Frame A2. Payload字段即为用户 数据的明文，完成对Frame A2的解析，得到用户数据；</p>
    <p>[0053]	当数据帧解密处理模块根据Frame A2. isE字段判断Frame A2. Payload字段是用 户数据的密文时，所述步骤2.&#190;的具体实现方式是：</p>
    <p>[0054]	2. 3. 1. 1)数据帧解密处理模块将Frame A2. keylndex字段信息，提交给密钥管理 模块，检索得到对Frame A2. Payload进行解密的密钥KEY2 ；</p>
    <p>[0055]	2. 3. 1. 2)数据帧解密处理模块根据得到的密钥KEY2，调用算法模块对FrameA2.Payload进行解密，得到用户数据的明文，完成对Frame A2的解析，得到用户数据；</p>
    <p>[0056]	所述KEY2是终端设备接收的数据帧Frame A2中Payload字段是用户数据的密文 信息时，解析Frame A2所使用的密钥。</p>
    <p>[0057]	上述数据处理方法所支持的链路层加密协议数据帧中还包含完整性校验MIC字 段；所述MIC字段是对链路层解密协议数据帧除MIC字段外所有字段或部分字段计算得到 的完整性校验值；所述数据帧进行保密处理的密钥包含完整性校验密钥和加密密钥两部 分；所述完整性校验密钥用于计算或验证MIC字段；所述加密密钥部分用于加密用户数据 或解密用户数据的密文。</p>
    <p>[0058]	当数据帧加密处理模块根据对应的链路层加密协议及保密处理策略判断不需要 对用户数据进行加密时，所述步骤1. 3)的具体实施方式是：</p>
    <p>[0059]	1. 3. 2. 1)数据帧加密处理模块调用密钥管理模块，得到对数据帧进行保密处理的 密钥KEYl以及密钥KEYl的标识keylndexl ；</p>
    <p>[0060]	1. 3. 2. 2)数据帧加密处理模块构造Frame Al除Frame Al. MIC字段外所有字段； 所述Frame Al除Frame Al. MIC外所有字段取值如下：</p>
    <p>[0061 ] Frame Al. DA字段，取值为目的节点的MAC地址；</p>
    <p>[0062]	Frame Al. SA字段，取值为该终端设备的MAC地址；</p>
    <p>[0063]	Frame Al. Ethertype字段，取值为对应的链路层加密协议的以太类型字段值；</p>
    <p>[0064]	Frame Al. isE字段，取值为不加密；</p>
    <p>[0065]	Frame Al. keylndex 字段，取值为密钥 KEYl 的标识 keyhdexl ；</p>
    <p>[0066]	Frame Al. Payload字段，取值为用户数据；</p>
    <p>[0067]	1. 3. 2. 3)数据帧加密处理模块对构造好的除Frame Al. MIC字段外的FrameAl，调 用对应的算法模块，利用KEYl的完整性校验密钥计算完整性校验FrameAl. MIC字段值；完 成Frame Al的构造；</p>
    <p>[0068]	当数据帧加密处理模块根据对应的链路层加密协议及保密处理策略判断需要对 用户数据进行加密时，所述步骤1. 3)的具体实施方式是：</p>
    <p>[0069]	1. 3. 3. 1)数据帧加密处理模块调用密钥管理模块，得到对数据帧进行保密处理的 密钥KEYl以及密钥KEYl的标识keylndexl ；</p>
    <p>[0070]	1. 3. 3. 2)数据帧加密处理模块根据得到的密钥KEY1，调用算法模块，利用KEYl的 加密密钥对用户数据进行加密，得到用户数据的密文；</p>
    <p>[0071]	1. 3. 3. 3)数据帧加密处理模块构造Frame Al除Frame Al. MIC字段外所有字段； 所述Frame Al除Frame Al. MIC外所有字段取值如下：</p>
    <p>[0072]	Frame Al. DA字段，取值为目的节点的MAC地址；</p>
    <p>[0073]	Frame Al. SA字段，取值为该终端设备的MAC地址；</p>
    <p>[0074]	Frame Al. Ethertype字段，取值为对应的链路层加密协议的以太类型字段值；</p>
    <p>[0075]	Frame Al. isE字段，取值为加密；</p>
    <p>[0076]	Frame Al. keylndex 字段，取值为密钥 KEYl 的标识 keyhdexl ；</p>
    <p>[0077]	Frame Al. Payload字段，取值为用户数据的密文；</p>
    <p>[0078]	1. 3. 3. 4)数据帧加密处理模块对构造好的除Frame Al. MIC字段外的FrameAl，调 用对应的算法模块，利用KEYl的完整性校验密钥计算完整性校验FrameAl. MIC字段值；完成Frame Al的构造。</p>
    <p>[0079]	当数据帧解密处理模块根据Frame A2. isE字段判断Frame A2. Payload字段是用 户数据的明文时，所述步骤2.&#190;的具体实施方式是：</p>
    <p>[0080]	2. 3. 2. 1)数据帧解密处理模块将Frame A2. key Index字段信息，提交给密钥管理 模块，检索得到对Frame A2进行解保密处理的密钥KEY2 ；</p>
    <p>[0081]	2. 3. 2. 2)数据帧解密处理模块利用得到的密钥KEY2的完整性校验密钥部分，调 用算法模块，验证Frame A2中Frame A2. MIC字段的正确性；若Frame A2. MIC正确，则执行 步骤2. 3. 2. 3)；若不正确，则丢弃该分组；</p>
    <p>[0082]	2. 3. 2. 3)数据帧解密处理模块提取Frame A2. Payload字段作为用户数据的明 文，完成对Frame A2的解析；</p>
    <p>[0083]	当数据帧解密处理模块根据Frame A2. isE字段判断Frame A2. Payload字段是用 户数据的密文时，所述步骤2.&#190;的具体实施方式是：</p>
    <p>[0084]	2. 3. 3. 1)数据帧解密处理模块将Frame A2. key Index字段信息，提交给密钥管理 模块，检索得到对Frame A2进行解保密处理的密钥KEY2 ；</p>
    <p>[0085]	2. 3. 3. 2)数据帧解密处理模块利用得到的密钥KEY2的完整性校验密钥，调用算 法模块，验证Frame A2中Frame A2. MIC字段的正确性；若Frame A2. MIC正确，则执行步骤 2. 3. 3. 3)；否不正确，则丢弃该分组；</p>
    <p>[0086]	2. 3. 3. 3)数据帧解密处理模块利用得到的密钥KEY2的加密密钥，调用算法模块 对Frame A2. Payload进行解密，得到用户数据的明文，完成对Frame A2的解析。</p>
    <p>[0087]	当终端设备对用户数据进行保护涉及的加密和完整性校验时，若所述步骤1. 3) 中数据帧加密处理模块是先对用户数据进行加密构造数据帧的有效负载Payload字段，再 对数据帧进行完整性校验构造MIC字段时，所述步骤2. 3)中数据帧解密处理模块在接收到 数据帧时，先验证MIC字段的正确性，只有确定MIC字段正确后，再解密数据帧的有效负载 Payload字段得到用户数据明文信息，提交给上层；</p>
    <p>[0088]	当终端设备对用户数据进行保护涉及的加密和完整性校验在具体实施时，若所述 步骤1. 3)中数据帧加密处理模块是先将用户数据明文作为有效负载I^yload字段，对数据 帧计算完整性校验构造MIC字段，再对用户数据明文进行加密，用得到的用户数据密文更 新数据帧的有效负载I^ayload字段时，所述步骤2. 3)中数据帧解密处理模块先解密数据帧 的有效负载I^ayload字段得到用户数据明文信息；然后再验证MIC字段的正确性，只有确定 MIC字段正确后，之前解密得到的用户数据明文信息才有效，提交给上层。</p>
    <p>[0089]上述步骤	1. 3)、2. 3)在具体实施时，Frame Al. Keyhdex和 Frame A2. Keyhdex都 指示具有链路层加解密能力的终端设备与对端终端设备的站间密钥时，具有链路层加解密 能力的终端设备在发送数据帧给对端终端设备时，使用与对端终端设备之间的站间密钥对 要发送的数据帧进行保护，所述保护指加密和/或计算完整性校验；具有链路层加解密能 力的终端设备在接收来自对端终端设备的数据帧时，使用与对端终端设备之间的站间密钥 对接收到的数据帧进行解保护处理，所述解保护指解密和/或验证完整性校验。</p>
    <p>[0090]	上述数据处理方法所支持的链路层加密协议数据帧帧头Frame Header中，还可包 含MAClist字段；所述MAClist字段用于表示特定MAC地址列表信息，该字段所给出的特 定MAC地址列表中的交换设备需要对接收到的密文数据帧进行解密再加密再转发的处理；</p>
    <p>12该特定MAC地址列表外的交换设备除非为目的节点，否则都只需要对该密文数据帧直接转发。</p>
    <p>[0091]	上述MAClist字段的具体实现中定义从发送端终端设备到目的端终端设备的链 路上的第一个具有链路层加解密能力的交换设备以及最后一个具有链路层加解密能力的 交换设备的MAC地址列表，</p>
    <p>[0092]	上述步骤1. 3)中具有链路层加解密能力的终端设备作为发送端终端设备，对端 终端设备作为目的端终端设备；具有链路层加解密能力的终端设备在获得从具有链路层加 解密能力的终端设备到对端终端设备链路上的第一个具有链路层加解密能力的交换设备 Sffl以及最后一个具有链路层加解密能力的交换设备SW2的MAC地址信息后，在构造数据帧 时MAClist字段包含SWl和SW2的MAC地址，并使用发送端终端设备和从发送端终端设备 到目的端终端设备的链路上的第一个具有链路层加解密能力的交换设备之间的密钥对数 据帧进行保密处理，即使用具有链路层加解密能力的终端设备与SWl之间的密钥KEYl对数 据帧进行保密处理，将KEYl的keyhdexl赋值到数据帧的keylndex字段进行传输；所述对 数据帧进行保密处理指加密或/和计算完整性校验；</p>
    <p>[0093]	上述步骤2. 3)中，具有链路层加解密能力的终端设备作为目的端终端设备，对端 终端设备作为发送端终端设备；具有链路层加解密能力的终端设备在收到来自对端终端设 备发来的数据帧时，提取MAClist字段得到从发送端终端设备到目的端终端设备的链路上 的最后一个具有链路层加解密能力的交换设备的MAC地址信息，并使用与这个交换设备之 间的密钥对数据帧进行解保密处理，即具有链路层加解密能力的终端设备提取MAClist字 段得到SW1的MAC地址信息，使用与SW1之间的密钥KEY1进行解保密处理，得到用户数据明 文信息；所述对数据帧进行解保密处理指解密或/和验证完整性校验。</p>
    <p>[0094]	本发明的优点是：</p>
    <p>[0095]	本发明具有链路层加解密能力的终端设备可维持和网络中其他终端设备的共享 密钥、与其他交换设备之间的密钥，在发送数据帧时可以直接使用和目的端终端设备之间 的密钥或者与其他交换设备之间的密钥对数据帧进行保密处理，可有效降低离终端设备最 近的接入交换设备的计算负担，降低数据传输延迟。</p>
    <p>[0096]	本发明具有链路层加解密能力的终端设备既可支持标准的IS0/IEC 8802-3数据 帧，也支持各种链路层加密协议数据帧，包括IEEE802. IAE和国内自主知识产权的TLkc数 据帧。在实现前向兼容的同时，可以实现对各种链路层加密协议的支持，实现数据帧在链路 层的加解密处理，提高网络的安全性。</p>
    <p>附图说明</p>
    <p>[0097]	图1是本发明所提供的具有链路层加解密能力的终端设备示意图；</p>
    <p>[0098]	图2是本发明所提供的使用站间密钥实施方式示意图；</p>
    <p>[0099]	图3是本发明所提供的MAClist字段实施方式示意图。</p>
    <p>具体实施方式</p>
    <p>[0100]	参见图1，本发明提供的具有链路层加解密能力的终端设备其链路层处理模块包 含控制模块、数据帧加密处理模块、数据帧解密处理模块、密钥管理模块、算法模块、发端口和收端口 ；其中控制模块与数据帧加密处理模块、数据帧解密处理模块、密钥管理模块相 连，数据帧加密处理模块与发端口相连，数据帧解密处理模块与收端口相连，密钥管理模块 和算法模块均与数据帧加密处理模块、数据帧解密处理模块相连。</p>
    <p>[0101]	所述控制模块具有策略管理和控制能力；</p>
    <p>[0102]	所述密钥管理模块具有链路层密钥管理能力，根据控制模块的策略需要，为该终 端设备与网络中的其他终端设备之间和/或该终端设备与网络中的交换设备之间建立共 享的密钥，并负责对这些密钥进行存储、更新、删除等管理操作；所建立的共享密钥可以是 预共享的，也可以是在该终端设备与其他终端设备或交换设备身份鉴别成功后协商建立 的；</p>
    <p>[0103]	所述数据帧加密处理模块在收到需要发送出去的用户数据后，通过与密钥管理模 块进行交互得到对应的密钥，再调用算法模块，即可实现对用户数据的加密处理，得到用户 数据的密文，构造链路层加密数据帧，并通过发端口将加密数据帧发送出去；</p>
    <p>[0104]	所述数据帧解密处理模块在通过收端口接收到数据帧后，通过与密钥管理模块进 行交互得到对应的密钥，再调用算法模块，即可实现对数据帧进行解密处理，得到用户数据 的明文信息，并通过控制模块将明文信息递交给上层。</p>
    <p>[0105]	所述算法模块涉及加解密算法和/或完整性校验算法，可以是硬件实现也可以是 软件实现。</p>
    <p>[0106]	本发明提供的具有链路层加解密能力的终端设备支持标准的IS0/IEC8802-3数 据帧，还支持链路层加密协议数据帧，所支持的链路层加密协议数据帧中包括：</p>
    <p>[0107]</p>
    <div class="patent-image small-patent-image"> <a href="//patentimages.storage.googleapis.com/CN102130768A/CN102130768AD00141.png"> <img id="idf0001" file="CN102130768AD00141.tif" img-content="drawing" img-format="tif" src="//patentimages.storage.googleapis.com/CN102130768A/CN102130768AD00141.png" class="patent-full-image" alt="Figure CN102130768AD00141"> </a> </div>
    <p>[0108]	其中Frame Header字段，表示帧头信息，包括：</p>
    <p>[0109]</p>
    <div class="patent-image small-patent-image"> <a href="//patentimages.storage.googleapis.com/CN102130768A/CN102130768AD00142.png"> <img id="idf0002" file="CN102130768AD00142.tif" img-content="drawing" img-format="tif" src="//patentimages.storage.googleapis.com/CN102130768A/CN102130768AD00142.png" class="patent-full-image" alt="Figure CN102130768AD00142"> </a> </div>
    <p>[0110]其中：</p>
    <p>[0111]	DA字段：表示目的节点的标识，取值目的节点的MAC地址；</p>
    <p>[0112]	SA字段：表示源节点的标识，取值源节点的MAC地址；</p>
    <p>[0113]	Ethertype字段：表示以太类型字段，取值为链路层加密协议的以太类型字段；用 于标识对应的链路层加密协议及帧结构；</p>
    <p>[0114]	isE字段：表示加密标志位，用于标识数据帧的有效负载是用户数据的明文信息 还是密文信息，数据包的接收方将该字段作为是否需要解密的一个判断因素；</p>
    <p>[0115]	keylndex字段：表示对用户数据进行保护（加密和/或计算完整性校验）的密钥 的标识；所述对用户数据进行保护的密钥可以是该终端设备和交换设备之间的密钥；也可 以是该终端设备和目的端终端设备之间的密钥；</p>
    <p>[0116]	Payload字段，表示数据帧有效负载，可以是用户数据的明文信息也可以是用户数 据的密文信息；当isE字段表示加密时，有效负载是用户数据的密文信息；当isE字段表示 不加密时，有效负载是用户数据的明文信息；</p>
    <p>[0117]	在本发明中对数据帧的各个字段在描述时，将使用“帧名.字段名”的方式进行描述。比如Frame Al的DA字段记为Frame Al. DA ；Frame A2的Payload字段记为Frame A2.Payload0</p>
    <p>[0118]	本发明终端设备通过数据加密处理模块由发端口发往网络的数据帧中SA字段取 值为该终端设备的MAC地址；本发明终端设备通过收端口送至数据解密处理模块处理的数 据帧中DA字段值是该终端设备的MAC地址。</p>
    <p>[0119]	将本发明终端设备通过发端口发出的数据帧记为Frame Al ；将本发明终端设备通 过收端口收到的数据帧记为Frame A2 ；</p>
    <p>[0120]	若本发明终端设备发送的数据帧Frame Al中Payload字段是用户数据的密文信 息，记构造Frame Al所使用的密钥为KEYl ；若本发明终端设备接收的数据帧Frame A2中 Payload字段是用户数据的密文信息，记解析Frame A2所使用的密钥为KEY2。</p>
    <p>[0121]	本发明提供的具有链路层加解密能力的终端设备在发送链路层加密协议数据帧 时，操作如下：</p>
    <p>[0122]	1. 1)上层将需要链路层发送的用户数据发送给终端设备链路层控制模块；</p>
    <p>[0123]	1. 2)由控制模块根据本地策略，选择使用的链路层加密协议类型及保密处理策 略；并将选择的链路层加密协议类型及保密处理策略及用户数据信息发送给数据帧加密处 理模块；</p>
    <p>[0124]	1. 3)数据帧加密处理模块根据对应的链路层加密协议及保密处理策略处理用户 数据，并构造Frame Al，其中：</p>
    <p>[0125]	1. 3. 1)当数据帧加密处理模块根据对应的链路层加密协议及保密处理策略判断 不需要对用户数据进行加密时，按照如下说明完成构造Frame Al的构造：</p>
    <p>[0126]	Frame Al. DA字段，取值为目的节点的MAC地址；</p>
    <p>[0127]	Frame Al. SA字段，取值为该终端设备的MAC地址；</p>
    <p>[0128]	Frame Al. Ethertype字段，取值为对应的链路层加密协议的以太类型字段值；</p>
    <p>[0129]	Frame Al. isE字段，取值为不加密；</p>
    <p>[0130]	Frame Al. keylndex字段，取值不限制（用户数据不加密时该字段没有意义)；</p>
    <p>[0131]	Frame Al. Payload字段，取值为用户数据；</p>
    <p>[0132]	1. 3. 2)当数据帧加密处理模块根据对应的链路层加密协议及保密处理策略判断 需要对用户数据进行加密时，按照如下步骤执行：</p>
    <p>[0133]	1. 3. 2. 1)数据帧加密处理模块调用密钥管理模块，得到对用户数据进行加密的密 钥KEYl以及密钥KEYl的标识keylndexl ；</p>
    <p>[0134]	1. 3. 2. 2)数据帧加密处理模块根据得到的密钥KEY1，调用算法模块对用户数据 进行加密，得到用户数据的密文；</p>
    <p>[0135]	1. 3. 2. 3)数据帧加密处理模块按照如下说明完成Frame Al的构造：</p>
    <p>[0136]	Frame Al. DA字段，取值为目的节点的MAC地址；</p>
    <p>[0137]	Frame Al. SA字段，取值为该终端设备的MAC地址；</p>
    <p>[0138]	Frame Al. Ethertype字段，取值为对应的链路层加密协议的以太类型字段值；</p>
    <p>[0139]	Frame Al. isE字段，取值为加密；</p>
    <p>[0140]	Frame Al. keylndex 字段，取值为密钥 KEYl 的标识 keyhdexl ；</p>
    <p>[0141]	Frame Al. Payload字段，取值为用户数据的密文；</p>
    <p>15[0142]	1.4)数据帧加密处理模块将构造好的Frame Al，通过发端口发送出去，从而完成 链路层数据帧的发送。</p>
    <p>[0143]	本发明提供的具有链路层加解密能力的终端设备在接收链路层加密协议数据帧 时，操作如下：</p>
    <p>[0144]	2. 1)终端设备通过物理层收到发给该终端设备的数据帧Frame A2，通过收端口将 接收到的数据帧Frame A2交给数据帧解密处理模块；</p>
    <p>[0145]	2. 2)数据帧解密处理模块根据接收到的数据帧Frame A2，判断对应的链路层加密 协议；</p>
    <p>[0146]	2. 3)数据帧解密处理模块根据对应的链路层加密协议，解析Frame A2，得到用户 数据，其中：</p>
    <p>[0147]	2. 3. 1)当数据帧解密处理模块根据Frame A2. isE字段判断Frame A2. Payload字 段是用户数据的明文时，则提取Frame A2. Payload字段即为用户数据的明文，完成对Frame A2的解析；</p>
    <p>[0148]	2. 3. 2)当数据帧解密处理模块根据Frame A2. isE字段判断Frame A2. Payload字 段是用户数据的密文时，执行如下步骤：</p>
    <p>[0149]	2. 3. 2. 1)数据帧解密处理模块将Frame A2. key Index字段信息，提交给密钥管理 模块，检索得到对Frame A2. Payload进行解密的密钥KEY2 ；</p>
    <p>[0150]	2. 3. 2. 2)数据帧解密处理模块根据得到的密钥KEY2，调用算法模块对FrameA2. Payload进行解密，得到用户数据的明文，完成对Frame A2的解析；</p>
    <p>[0151]	2. 4)数据帧解密处理模块将得到的用户数据的明文通过控制模块提交给上层，从 而完成链路层数据帧的接收。</p>
    <p>[0152]	本发明终端设备所支持的链路层加密协议数据帧中除包含帧头FrameHeader和 有效负载Payload外，还可包含完整性校验MIC字段；MIC字段是对链路层解密协议数据帧 (如Frame AUFrame A2)除MIC字段外所有字段或部分字段计算得到的完整性校验值。</p>
    <p>[0153]	在支持的链路层加密协议数据帧包含MIC字段的实施方式中，对数据帧进行保密 处理的密钥（如KEY1、KEY2)包含完整性校验密钥和加密密钥两部分；完整性校验密钥用 于计算或验证MIC字段；加密密钥部分用于加密用户数据或解密用户数据的密文。在支持 的链路层加密协议数据帧包含MIC字段的实施方式中，上述本发明终端设备在发送数据帧 时，步骤1.&#190;的具体实施方式是：</p>
    <p>[0154]	1. 3. 1)当数据帧加密处理模块根据对应的链路层加密协议及保密处理策略判断 不需要对用户数据进行加密时，按照如下步骤执行：</p>
    <p>[0155]	1. 3. 1. 1)数据帧加密处理模块调用密钥管理模块，得到对数据帧进行保密处理的 密钥KEYl以及密钥KEYl的标识keylndexl ；</p>
    <p>[0156]	1. 3. 1. 2)数据帧加密处理模块按照如下说明构造Frame Al除Frame Al. MIC字段 外的字段；</p>
    <p>[0157]	Frame Al. DA字段，取值为目的节点的MAC地址；</p>
    <p>[0158]	Frame Al. SA字段，取值为该终端设备的MAC地址；</p>
    <p>[0159]	Frame Al. Ethertype字段，取值为对应的链路层加密协议的以太类型字段值；</p>
    <p>[0160]	Frame Al. isE字段，取值为不加密；[0161]	Frame Al. keylndex 字段，取值为密钥 KEYl 的标识 keylndexl ；</p>
    <p>[0162]	Frame Al. Payload字段，取值为用户数据；</p>
    <p>[0163]	1. 3. 1. 3)数据帧加密处理 模块对构造好的除Frame Al. MIC字段外的FrameAl， 调用对应的算法模块，利用KEYl的完整性校验密钥计算Frame Al. MIC字段字段值；完成 Frame Al的构造；</p>
    <p>[0164]	1. 3. 2)当数据帧加密处理模块根据对应的链路层加密协议及保密处理策略判断 需要对用户数据进行加密时，按照如下步骤执行：</p>
    <p>[0165]	1. 3. 2. 1)数据帧加密处理模块调用密钥管理模块，得到对数据帧进行保密处理的 密钥KEYl以及密钥KEYl的标识keylndexl ；</p>
    <p>[0166]	1. 3. 2. 2)数据帧加密处理模块根据得到的密钥KEY1，调用算法模块，利用KEYl的 加密密钥对用户数据进行加密，得到用户数据的密文；</p>
    <p>[0167]	1. 3. 3. 3)数据帧加密处理模块按照如下说明构造Frame Al除Frame Al. MIC字段 外的字段；</p>
    <p>[0168]	Frame Al. DA字段，取值为目的节点的MAC地址；</p>
    <p>[0169]	Frame Al. SA字段，取值为该终端设备的MAC地址；</p>
    <p>[0170]	Frame Al. Ethertype字段，取值为对应的链路层加密协议的以太类型字段值；</p>
    <p>[0171]	Frame Al. isE字段，取值为加密；</p>
    <p>[0172]	Frame Al. keylndex 字段，取值为密钥 KEYl 的标识 keylndexl ；</p>
    <p>[0173]	Frame Al. Payload字段，取值为用户数据的密文；</p>
    <p>[0174]	1. 3. 3. 4)数据帧加密处理模块对构造好的除Frame Al. MIC字段外的FrameAl， 调用对应的算法模块，利用KEYl的完整性校验密钥计算Frame Al. MIC字段字段值；完成 Frame Al的构造。</p>
    <p>[0175]	在支持的链路层加密协议数据帧包含MIC字段的实施方式中，上述本发明终端设 备在接收数据帧时，步骤2. 3)的具体实施方式是：</p>
    <p>[0176]	2. 3. 1)当数据帧解密处理模块根据Frame A2. isE字段判断Frame A2. Payload字 段是用户数据的明文时，按照如下步骤执行：</p>
    <p>[0177]	2. 3. 1. 1)数据帧解密处理模块将Frame A2. keylndex字段信息，提交给密钥管理 模块，检索得到对Frame A2进行保密处理的密钥KEY2 ；</p>
    <p>[0178]	2. 3. 1. 2)数据帧解密处理模块利用得到的密钥KEY2的完整性校验密钥部分，调 用算法模块，验证Frame A2中Frame A2. MIC字段的正确性；若Frame A2. MIC正确，则执行 步骤2. 3. 1.3)；否则，丢弃该分组；</p>
    <p>[0179]	2. 3. 1. 3)数据帧解密处理模块提取Frame A2. Payload字段作为用户数据的明 文，完成对Frame A2的解析；</p>
    <p>[0180]	2. 3. 2)当数据帧解密处理模块根据Frame A2. isE字段判断Frame A2. Payload字 段是用户数据的密文时，按照如下步骤执行：</p>
    <p>[0181]	2. 3. 2. 1)数据帧解密处理模块将Frame A2. keylndex字段信息，提交给密钥管理 模块，检索得到对Frame A2进行保密处理的密钥KEY2 ；</p>
    <p>[0182]	2. 3. 2. 2)数据帧解密处理模块利用得到的密钥KEY2的完整性校验密钥，调用算 法模块，验证Frame A2中Frame A2. MIC字段的正确性；若Frame A2. MIC正确，则执行步骤2.3.2.3)；否则，丢弃该分组；</p>
    <p>[0183]	2. 3. 2. 3)数据帧解密处理模块利用得到的密钥KEY2的加密密钥，调用算法模块 对Frame A2. Payload进行解密，得到用户数据的明文，完成对Frame A2的解析。</p>
    <p>[0184]	在终端设备支持链路层加密协议数据帧包含MIC字段的实施方式中，具体实施 时，本发明终端设备对用户数据进行保护涉及的加密和完整性校验可实现为步骤1. 3)中 数据帧加密处理模块先对用户数据进行加密构造数据帧的有效负载Payload字段，再对数 据帧进行完整性校验，构造MIC字段；此种实施方式下，步骤2. 3)中数据帧解密处理模块先 验证MIC字段的正确性，只有确定MIC字段正确后，再解密数据帧的有效负载Payload字段 得到用户数据明文信息，提交给上层。</p>
    <p>[0185]	在终端设备支持链路层加密协议数据帧包含MIC字段的实施方式中，具体实施 时，本发明终端设备对用户数据进行保护涉及的加密和完整性校验可还可实现为步骤1. 3) 中数据帧加密处理模块先将用户数据明文作为有效负载Payload字段，对数据帧计算完整 性校验，构造MIC字段，再对用户数据明文进行加密，用得到的用户数据密文更新数据帧的 有效负载Payload字段；此种实施方式下，步骤2. 3)中数据帧解密处理模块先解密数据帧 的有效负载Payload字段得到用户数据明文信息；然后再验证MIC字段的正确性，只有确定 MIC字段正确后，之前解密得到的用户数据明文信息才有效，才可提交给上层。</p>
    <p>[0186]	记终端设备与终端设备之间的密钥为站间密钥。</p>
    <p>[0187]	上文中所提到的任意实施例在具体实施时，终端设备可使用终端设备STA-A与终 端设备STA-B之间的站间密钥实现链路层保密传输。如图2所示，终端设备STA-A在发送 数据帧给终端设备STA-B时，不管终端设备STA-A与终端设备STA-B之间的链路情况如何， 只需要使用与终端设备STA-B之间的站间密钥KEY_AB对要发送的数据帧进行保护（加密 和/或计算完整性校验）即可；</p>
    <p>[0188]	终端设备STA-B在接收来自终端设备STA-A的数据帧时，不管终端设备STA-A与 终端设备STA-B之间的链路情况如何，只需要使用与终端设备STA-A之间的站间密钥KEY_ AB对接收到的数据帧进行解保护（解密和/或验证完整性校验）处理即可。</p>
    <p>[0189]	在使用站间密钥的实施方式中，在终端设备STA-A与终端设备STA-B之间的交换 设备不需要对他们之间的数据帧进行加解密处理，直接转发即可。</p>
    <p>[0190]	在使用站间密钥的实施方式中，终端设备STA-A和终端设备STA-B之间的交换设 备可以具有链路层加解密能力，也可以不具有链路层加解密能力；也即使用站间密钥的实 施方式中，支持具有链路层加解密能力的交换设备和不具有链路层加解密能力的交换设备 的混合组网。</p>
    <p>[0191]	另外，本发明终端设备所支持的链路层加密协议数据帧中的帧头FrameHeader 中，还可包含MAClist字段；MAClist字段用于表示特定MAC地址列表信息，该字段所给 出的特定MAC地址列表中的交换设备需要对接收到的密文数据帧进行加解密处理；该特 定MAC地址列表外的交换设备除非为目的节点，否则都只需要对该密文数据帧直接转发。 MAClist字段的存在可以使交换设备不需要对所有要转发的数据帧都进行解密再加密再转 发的操作。</p>
    <p>[0192]	如图3所示，MAClist字段在具体实施时，可定义为从发送端终端设备到目的端终端设备的链路上的第一个具有链路层加解密能力的交换设备以及最后一个具有链路层加解密能力的交换设备的MAC地 址列表。</p>
    <p>[0193]	终端设备STA-A在发送数据帧给终端设备STA-B时，MAClist字段为交换设备SW1 和交换设备SW2的MAC地址，从终端设备STA-A发往终端设备STA-B的数据帧，只有交换设 备SW1和交换设备SW2需要进行解密再加密再转发的处理，其他交换设备（如位于终端设备 STA-A到终端设备STA-B的链路上其他交换设备SWm)直接转发即可；</p>
    <p>[0194]	作为发送端终端设备的终端设备STA-A在获得交换设备SW1和交换设备SW2的MAC 地址信息后，在构造数据帧时将SW1和SW2的MAC地址作为MAClist字段进行传输；发送的 数据帧中加密用户数据以及计算MIC字段使用终端设备STA-A与交换设备SW1之间的密钥 KEY1进行处理，将KEY1的keyIndeXl赋值到数据帧的keylndex字段进行传输；</p>
    <p>[0195]	作为目的端终端设备的终端设备STA-B在收到终端设备STA-A发来的数据帧时， 使用与交换设备SW2之间的密钥KEY2进行处理，得到用户数据明文信息。</p>
    <p>[0196]	在上述MAClist字段实施方式中，从终端设备STA-A到终端设备STA-B的数据帧 在传输过程中，交换设备SW1在收到终端设备STA-A发给终端设备STA-B的数据帧后，利用 keylndex标识的密钥KEY1解密用户数据；交换设备SW2在收到终端设备STA-A发给终端设 备STA-B的数据帧后，利用与STA-B之间的密钥KEY2加密用户数据，并将KEY2的keylndex〗 更新至数据帧中的keylndex字段进行传输。其中，数据帧在交换设备SW1与交换设备SW2 之间可以是明文传输，也可以使用交换设备SW1与交换设备SW2之间的密钥进行加密传输， 本发明不予限定；</p>
    <p>[0197]	在上述MAClist字段实施方式中，终端设备STA-A与SW1之间、SW1与SW2之间、SW2 与终端设备STA-B之间可以存在一个或多个不具有链路层加解密能力的交换设备；且SW1 与SW2之间还可存在一个或多个具有链路层加解密能力的交换设备；即在上述MAClist字 段实施方式中本发明终端设备支持具有链路层加解密能力的交换设备与不具有链路层加 解密能力的交换设备的混合组网。</p>
  </div>
  </div></div><div class="patent-section patent-tabular-section"><a id="backward-citations"></a><div class="patent-section-header"><span class="patent-section-title">专利引用</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th">引用的专利</th><th class="patent-data-table-th"> 申请日期</th><th class="patent-data-table-th">公开日</th><th class="patent-data-table-th"> 申请人</th><th class="patent-data-table-th">专利名</th></tr></thead><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN101043335A?cl=zh">CN101043335A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2007年3月12日</td><td class="patent-data-table-td patent-date-value">2007年9月26日</td><td class="patent-data-table-td ">中国建设银行股份有限公司</td><td class="patent-data-table-td ">一种信息安全控制系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN101741548A?cl=zh">CN101741548A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2009年12月18日</td><td class="patent-data-table-td patent-date-value">2010年6月16日</td><td class="patent-data-table-td ">西安西电捷通无线网络通信有限公司</td><td class="patent-data-table-td ">交换设备间安全连接的建立方法及系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN101917272A?cl=zh">CN101917272A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2010年8月12日</td><td class="patent-data-table-td patent-date-value">2010年12月15日</td><td class="patent-data-table-td ">西安西电捷通无线网络通信股份有限公司</td><td class="patent-data-table-td ">一种邻居用户终端间保密通信方法及系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/EP1643675A1?cl=zh">EP1643675A1</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2005年8月8日</td><td class="patent-data-table-td patent-date-value">2006年4月5日</td><td class="patent-data-table-td ">Broadcom Corporation</td><td class="patent-data-table-td ">Stateless hardware security module</td></tr></table><div class="patent-section-footer">* 由审查员引用</div></div><div class="patent-section patent-tabular-section"><a id="forward-citations"></a><div class="patent-section-header"><span class="patent-section-title"> 被以下专利引用</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th">引用专利</th><th class="patent-data-table-th"> 申请日期</th><th class="patent-data-table-th">公开日</th><th class="patent-data-table-th"> 申请人</th><th class="patent-data-table-th">专利名</th></tr></thead><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN103441983A?cl=zh">CN103441983A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2013年7月11日</td><td class="patent-data-table-td patent-date-value">2013年12月11日</td><td class="patent-data-table-td ">盛科网络（苏州）有限公司</td><td class="patent-data-table-td ">基于链路层发现协议的信息保护方法和装置</td></tr></table><div class="patent-section-footer">* 由审查员引用</div></div><div class="patent-section patent-tabular-section"><a id="classifications"></a><div class="patent-section-header"><span class="patent-section-title">分类</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th"> </th><th class="patent-data-table-th"> </th></tr></thead><tr><td class="patent-data-table-td ">国际分类号</td><td class="patent-data-table-td "><span class="nested-value"><a href="https://www.google.com/url?id=enGXBwABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=H04L0009080000">H04L9/08</a></span>, <span class="nested-value"><a href="https://www.google.com/url?id=enGXBwABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=H04L0029080000">H04L29/08</a></span></td></tr><tr><td class="patent-data-table-td "> 合作分类</td><td class="patent-data-table-td "><span class="nested-value"><a href="https://www.google.com/url?id=enGXBwABERAJ&amp;q=http://worldwide.espacenet.com/classification&amp;usg=AFQjCNGs5WqSrPE3A4ZP63zGuM6PRNfEFA#!/CPC=H04L63/0428">H04L63/0428</a></span>, <span class="nested-value"><a href="https://www.google.com/url?id=enGXBwABERAJ&amp;q=http://worldwide.espacenet.com/classification&amp;usg=AFQjCNGs5WqSrPE3A4ZP63zGuM6PRNfEFA#!/CPC=H04L9/08">H04L9/08</a></span>, <span class="nested-value"><a href="https://www.google.com/url?id=enGXBwABERAJ&amp;q=http://worldwide.espacenet.com/classification&amp;usg=AFQjCNGs5WqSrPE3A4ZP63zGuM6PRNfEFA#!/CPC=H04L63/162">H04L63/162</a></span></td></tr><tr><td class="patent-data-table-td "> 欧洲专利分类号</td><td class="patent-data-table-td "><span class="nested-value">H04L9/06D</span></td></tr></table><div class="patent-section-footer"></div></div><div class="patent-section patent-tabular-section"><a id="legal-events"></a><div class="patent-section-header"><span class="patent-section-title">法律事件</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th"> 日期</th><th class="patent-data-table-th">代码</th><th class="patent-data-table-th">事件</th><th class="patent-data-table-th">说明</th></tr></thead><tr><td class="patent-data-table-td patent-date-value">2011年7月20日</td><td class="patent-data-table-td ">C06</td><td class="patent-data-table-td ">Publication</td><td class="patent-data-table-td "></td></tr><tr><td class="patent-data-table-td patent-date-value">2011年8月31日</td><td class="patent-data-table-td ">C10</td><td class="patent-data-table-td ">Entry into substantive examination</td><td class="patent-data-table-td "></td></tr><tr><td class="patent-data-table-td patent-date-value">2012年11月7日</td><td class="patent-data-table-td ">C14</td><td class="patent-data-table-td ">Grant of patent or utility model</td><td class="patent-data-table-td "></td></tr></table><div class="patent-section-footer"></div></div><div class="modal-dialog" id="patent-images-lightbox"><div class="patent-lightbox-controls"><div class="patent-lightbox-rotate-controls"><div class="patent-lightbox-rotation-text">旋转</div><div class="rotate-icon rotate-ccw-icon"></div><div class="rotate-icon rotate-cw-icon"></div></div><div class="patent-lightbox-index-counter"></div><a class="patent-lightbox-fullsize-link" target="_blank">原始图片</a><div class="patent-drawings-control patent-drawings-next"><img class="patent-drawings-button-img"src="/googlebooks/images/kennedy/page_right.png" alt="Next page"width="21" height="21" /></div><div class="patent-drawings-control patent-drawings-prev"><img class="patent-drawings-button-img"src="/googlebooks/images/kennedy/page_left.png" alt="Previous page"width="21" height="21" /></div></div><div class="modal-dialog-content"><div class="patent-lightbox-image-holder"><div class="patent-lightbox-placeholder"></div></div></div></div><script>_OC_initPatentsAtb({image_not_available_html: " 未提供图片。\x3ca href\x3d//docs.google.com/viewer?url\x3dpatentimages.storage.googleapis.com/pdfs/fc883811e7f30eaa90b7/CN102130768A.pdf\x3e查看 PDF\x3c/a\x3e"});</script></div></div></div></div></div><script>(function() {var href = window.location.href;if (href.indexOf('?') !== -1) {var parameters = href.split('?')[1].split('&');for (var i = 0; i < parameters.length; i++) {var param = parameters[i].split('=');if (param[0] == 'focus') {var elem = document.getElementById(param[1]);if (elem) {elem.focus();}}}}})();</script><script>_OC_addFlags({LockSrc:"/books/javascript/lock_6e802a6b2b28d51711baddc2f3bec198.js", Host:"https://www.google.com/", IsBooksRentalEnabled:1, IsBrowsingHistoryEnabled:1, IsWebReaderSvgEnabled:0, IsImageModeNotesEnabled:1, IsOfflineBubbleEnabled:1, IsFutureOnSaleVolumesEnabled:1, IsBooksUnifiedLeftNavEnabled:1, IsMobileRequest:0, IsZipitFolderCollectionEnabled:1, IsAdsDisabled:0, IsEmbeddedMediaEnabled:1, IsImageModeAnnotationsEnabled:1, IsMyLibraryGooglePlusEnabled:1, IsImagePageProviderEnabled:1, IsBookcardListPriceSmall:0, IsInternalUser:0, IsBooksShareButtonEnabled:0, IsDisabledRandomBookshelves:0});_OC_Run({"enable_p13n":false,"is_cobrand":false,"sign_in_url":"https://www.google.com/accounts/Login?service=\u0026continue=https://www.google.com/patents%3Fcl%3Dzh%26hl%3Dzh-CN\u0026hl=zh-CN"}, {"volume_id":"","is_ebook":true,"volumeresult":{"has_flowing_text":false,"has_scanned_text":true,"can_download_pdf":false,"can_download_epub":false,"is_pdf_drm_enabled":false,"is_epub_drm_enabled":false,"download_pdf_url":"https://www.google.com/patents/download/%E4%B8%80%E7%A7%8D%E5%85%B7%E6%9C%89%E9%93%BE%E8%B7%AF%E5%B1%82%E5%8A%A0%E8%A7%A3%E5%AF%86%E8%83%BD%E5%8A%9B%E7%9A%84.pdf?id=enGXBwABERAJ\u0026hl=zh-CN\u0026output=pdf\u0026sig=ACfU3U20nB7gtUGcvd6HzaALU-X5g0Q-ew"},"sample_url":"https://www.google.com/patents/reader?id=enGXBwABERAJ\u0026hl=zh-CN\u0026printsec=frontcover\u0026output=reader\u0026source=gbs_atb_hover","is_browsable":true,"is_public_domain":true}, {});</script><div id="footer_table" style="font-size:83%;text-align:center;position:relative;top:20px;height:4.5em;margin-top:2em"><div style="margin-bottom:8px"><a href="https://www.google.com/search?hl=zh-CN"><nobr>Google&nbsp;首页</nobr></a> - <a href="//www.google.com/patents/sitemap/"><nobr>站点地图</nobr></a> - <a href="http://www.google.com/googlebooks/uspto.html"><nobr>美国专利商标局 (USPTO) 专利信息批量下载</nobr></a> - <a href="/intl/zh-CN/privacy/"><nobr>隐私权政策</nobr></a> - <a href="/intl/zh-CN/policies/terms/"><nobr>服务条款</nobr></a> - <a href="https://support.google.com/faqs/answer/2539193?hl=zh-CN"><nobr> 关于 Google 专利</nobr></a> - <a href="//www.google.com/tools/feedback/intl/zh-CN/error.html" onclick="try{_OC_startFeedback({productId: '72792',locale: 'zh-CN'});return false;}catch(e){}"><nobr>发送反馈</nobr></a></div></div> <script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">var pageTracker = _gat._getTracker("UA-27188110-1");pageTracker._setCookiePath("/patents/");pageTracker._trackPageview();</script> </body></html>