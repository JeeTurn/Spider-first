<!DOCTYPE html><html><head><title>专利 CN101789934A - 网上安全交易方法和系统 -  Google 专利</title><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){var d=void 0!=b?b:(new Date).getTime();this.t[a]=[d,c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(e){}};this.tick("start",null,a)}var a;window.performance&&(a=window.performance.timing);var f=a?new e(a.responseStart):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_",
"_wtsrt",d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();})();
</script><link rel="stylesheet" href="/patents/css/_6e802a6b2b28d51711baddc2f3bec198/kl_intl_patents_bundle.css" type="text/css" /><script src="/books/javascript/atb_6e802a6b2b28d51711baddc2f3bec198__zh_cn.js"></script><script>function googleTranslateElementInit() {new google.translate.TranslateElement({pageLanguage: "zh",gaTrack: true,gaId: "UA-27188110-1",multilanguagePage: true});}</script><script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script><meta name="DC.type" content="Patent"><meta name="DC.title" content="网上安全交易方法和系统"><meta name="DC.contributor" content="于华章" scheme="inventor"><meta name="DC.contributor" content="陆舟" scheme="inventor"><meta name="DC.contributor" content="北京飞天诚信科技有限公司" scheme="assignee"><meta name="DC.date" content="2009-11-17" scheme="dateSubmitted"><meta name="DC.description" content="本发明公开了一种网上安全交易方法和系统，其中，该网上安全交易方法包括：智能密钥设备与服务端相互交换认证信息来认证对方的合法性，双方认证合法后，服务端将用户的操作数据整合成签名指令，并通过客户端将签名指令和签名信息转发给智能密钥设备，智能密钥设备验证上述签名信息合法后，执行签名指令，并向服务端返回签名结果；服务端根据签名结果处理用户的操作数据。根据本发明，通过服务端与智能密钥设备的双向认证，以及对会话过程中的数据进行验证等操作，可以有效地识别出接收的数据是否合法，进而抑制了黑客的重放攻击，保护系统的安全运行。"><meta name="DC.date" content="2010-7-28"><meta name="citation_patent_publication_number" content="CN:101789934:A"><meta name="citation_patent_application_number" content="CN:200910238174"><link rel="canonical" href="https://www.google.com/patents/CN101789934A?cl=zh"/><meta property="og:url" content="https://www.google.com/patents/CN101789934A?cl=zh"/><meta name="title" content="专利 CN101789934A - 网上安全交易方法和系统"/><meta name="description" content="本发明公开了一种网上安全交易方法和系统，其中，该网上安全交易方法包括：智能密钥设备与服务端相互交换认证信息来认证对方的合法性，双方认证合法后，服务端将用户的操作数据整合成签名指令，并通过客户端将签名指令和签名信息转发给智能密钥设备，智能密钥设备验证上述签名信息合法后，执行签名指令，并向服务端返回签名结果；服务端根据签名结果处理用户的操作数据。根据本发明，通过服务端与智能密钥设备的双向认证，以及对会话过程中的数据进行验证等操作，可以有效地识别出接收的数据是否合法，进而抑制了黑客的重放攻击，保护系统的安全运行。"/><meta property="og:title" content="专利 CN101789934A - 网上安全交易方法和系统"/><meta property="og:type" content="book"/><meta property="og:site_name" content="Google Books"/><meta property="og:image" content="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"/><link rel="image_src" href="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"/><script>if (window['_OC_timingAction']) {window['_OC_timingAction']('patents_refpage');}</script><style>#gbar,#guser{font-size:13px;padding-top:1px !important;}#gbar{height:22px}#guser{padding-bottom:7px !important;text-align:right}.gbh,.gbd{border-top:1px solid #c9d7f1;font-size:1px}.gbh{height:0;position:absolute;top:24px;width:100%}@media all{.gb1{height:22px;margin-right:.5em;vertical-align:top}#gbar{float:left}}a.gb1,a.gb4{text-decoration:underline !important}a.gb1,a.gb4{color:#00c !important}.gbi .gb4{color:#dd8e27 !important}.gbf .gb4{color:#900 !important}

#gbar { padding:.3em .6em !important;}</style></head><body ><div id=gbar><nobr><a class=gb1 href="https://www.google.com/search?cl=zh&hl=zh-CN&sa=N&tab=tw">搜索</a> <a class=gb1 href="https://www.google.com/search?cl=zh&hl=zh-CN&tbm=isch&source=og&sa=N&tab=ti">图片</a> <a class=gb1 href="https://maps.google.com/maps?cl=zh&hl=zh-CN&sa=N&tab=tl">地图</a> <a class=gb1 href="https://play.google.com/?cl=zh&hl=zh-CN&sa=N&tab=t8">Play</a> <a class=gb1 href="https://www.youtube.com/results?cl=zh&hl=zh-CN&sa=N&tab=t1">YouTube</a> <a class=gb1 href="https://news.google.com/nwshp?hl=zh-CN&tab=tn">新闻</a> <a class=gb1 href="https://mail.google.com/mail/?tab=tm">Gmail</a> <a class=gb1 href="https://drive.google.com/?tab=to">云端硬盘</a> <a class=gb1 style="text-decoration:none" href="https://www.google.com/intl/zh-CN/options/"><u>更多</u> &raquo;</a></nobr></div><div id=guser width=100%><nobr><span id=gbn class=gbi></span><span id=gbf class=gbf></span><span id=gbe></span><a target=_top id=gb_70 href="https://www.google.com/accounts/Login?service=&continue=https://www.google.com/patents%3Fcl%3Dzh%26hl%3Dzh-CN&hl=zh-CN" class=gb4>登录</a></nobr></div><div class=gbh style=left:0></div><div class=gbh style=right:0></div><div role="alert" style="position: absolute; left: 0; right: 0;"><a href="https://www.google.com/patents/CN101789934A?cl=zh&amp;hl=zh-CN&amp;output=html_text" title="屏幕阅读器用户请注意：点击此链接可进入无障碍模式。阅读器在无障碍模式下具有同样的基本功能，但可让用户获得更好的体验。"><img border="0" src="//www.google.com/images/cleardot.gif"alt="屏幕阅读器用户请注意：点击此链接可进入无障碍模式。阅读器在无障碍模式下具有同样的基本功能，但可让用户获得更好的体验。"></a></div><div class="kd-appbar"><h2 class="kd-appname"><a href="/patents?hl=zh-CN"> 专利</a></h2><div class="kd-buttonbar left" id="left-toolbar-buttons"><a id="appbar-write-review-link" href=""></a><a id="appbar-view-print-sample-link" href=""></a><a id="appbar-view-ebook-sample-link" href=""></a><a id="appbar-patents-prior-art-finder-link" href="https://www.google.com/patents/related/CN101789934A"></a><a id="appbar-patents-discuss-this-link" href="https://www.google.com/url?id=Ac9_BwABERAJ&amp;q=http://patents.stackexchange.com/redirect/google-patents%3Fpublication%3DCN101789934A&amp;usg=AFQjCNH8few42GKAO3nCDxEHFJVhCNpxBA" data-is-grant="false"></a><a id="appbar-read-patent-link" href="//docs.google.com/viewer?url=patentimages.storage.googleapis.com/pdfs/69c25541a903c8ebb40b/CN101789934A.pdf"></a><a id="appbar-download-pdf-link" href="//patentimages.storage.googleapis.com/pdfs/69c25541a903c8ebb40b/CN101789934A.pdf"></a><a class="appbar-content-language-link" data-selected="true" data-label="中文" href="/patents/CN101789934A?cl=zh&amp;hl=zh-CN"></a><a class="appbar-content-language-link" data-label="英语" href="/patents/CN101789934A?cl=en&amp;hl=zh-CN"></a><a class="appbar-application-grant-link" data-selected="true" data-label="申请" href="/patents/CN101789934A?hl=zh-CN&amp;cl=zh"></a><a class="appbar-application-grant-link" data-label="授权" href="/patents/CN101789934B?hl=zh-CN&amp;cl=zh"></a></div><div class="kd-buttonbar right" id="right-toolbar-buttons"></div></div><div id="books-microdata" itemscope=""itemtype="http://schema.org/Book"itemid="https://www.google.com/patents/CN101789934A?cl=zh" style="display:none"><span itemprop="description">本发明公开了一种网上安全交易方法和系统，其中，该网上安全交易方法包括：智能密钥设备与服务端相互交换认证信息来认证对方的合法性，双方认证合法后，服务端将用户的操作数据整合成签名指令，并通过客户端将签名指...</span><span itemprop="url">https://www.google.com/patents/CN101789934A?cl=zh&amp;utm_source=gb-gplus-share</span><span class="main-title" itemprop="name">专利 CN101789934A - 网上安全交易方法和系统</span><img itemprop="image" src="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"alt="专利 CN101789934A - 网上安全交易方法和系统" title="专利 CN101789934A - 网上安全交易方法和系统"></div><div style="display: none"><ol id="ofe-gear-menu-contents" class="gbmcc"><li class="gbe gbmtc"><a class="gbmt goog-menuitem-content" id="" href="https://www.google.com/advanced_patent_search?hl=zh-CN"> 高级专利搜索</a></li></ol></div><div id="volume-main"><div id="volume-center"><div class=vertical_module_list_row><div id=intl_patents class=about_content><div id=intl_patents_v><table class="patent-bibdata patent-drawings-missing"><tr><td class="patent-bibdata-heading"> 公开号</td><td class="single-patent-bibdata">CN101789934 A</td></tr><tr><td class="patent-bibdata-heading">发布类型</td><td class="single-patent-bibdata">申请</td></tr><tr><td class="patent-bibdata-heading"> 专利申请号</td><td class="single-patent-bibdata">CN 200910238174</td></tr><tr><td class="patent-bibdata-heading">公开日</td><td class="single-patent-bibdata">2010年7月28日</td></tr><tr><td class="patent-bibdata-heading"> 申请日期</td><td class="single-patent-bibdata">2009年11月17日</td></tr><tr><td class="patent-bibdata-heading"> 优先权日<span class="patent-tooltip-anchor patent-question-icon"data-tooltip-text="优先日期属于假设性质，不具任何法律效力。Google 对于所列日期的正确性并没有进行法律分析，也不作任何陈述。"></span></td><td class="single-patent-bibdata">2009年11月17日</td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">公告号</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="/patents/CN101789934B?hl=zh-CN&amp;cl=zh">CN101789934B</a></span></span></td></tr><tr class="patent-bibdata-list-row alternate-patent-number"><td class="patent-bibdata-heading"> 公开号</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value">200910238174.0, </span><span class="patent-bibdata-value">CN 101789934 A, </span><span class="patent-bibdata-value">CN 101789934A, </span><span class="patent-bibdata-value">CN 200910238174, </span><span class="patent-bibdata-value">CN-A-101789934, </span><span class="patent-bibdata-value">CN101789934 A, </span><span class="patent-bibdata-value">CN101789934A, </span><span class="patent-bibdata-value">CN200910238174, </span><span class="patent-bibdata-value">CN200910238174.0</span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading"> 发明者</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E4%BA%8E%E5%8D%8E%E7%AB%A0%22">于华章</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E9%99%86%E8%88%9F%22">陆舟</a></span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading"> 申请人</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=inassignee:%22%E5%8C%97%E4%BA%AC%E9%A3%9E%E5%A4%A9%E8%AF%9A%E4%BF%A1%E7%A7%91%E6%8A%80%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8%22">北京飞天诚信科技有限公司</a></span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">导出引文</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="/patents/CN101789934A.bibtex?cl=zh">BiBTeX</a>, </span><span class="patent-bibdata-value"><a href="/patents/CN101789934A.enw?cl=zh">EndNote</a>, </span><span class="patent-bibdata-value"><a href="/patents/CN101789934A.ris?cl=zh">RefMan</a></span></span></td></tr><tr class="patent-internal-links"><td colspan=2><span class="patent-bibdata-value"><a href="#forward-citations"> 被以下专利引用</a> (12),</span> <span class="patent-bibdata-value"><a href="#classifications">分类</a> (4),</span> <span class="patent-bibdata-value"><a href="#legal-events">法律事件</a> (3)</span> </td></tr><tr><td colspan=2 class="patent-bibdata-external-link-spacer-top"></td></tr><tr class="patent-bibdata-external-link-spacer-bottom"></tr><tr><td colspan=2><span class="patent-bibdata-heading">外部链接:&nbsp;</span><span><span class="patent-bibdata-value"><a href="https://www.google.com/url?id=Ac9_BwABERAJ&amp;q=http://211.157.104.87:8080/sipo/zljs/hyjs-yx-new.jsp%3Frecid%3D200910238174&amp;usg=AFQjCNHFHlmsszelM34lP8HUduV2ZsLFZw"> 中国国家知识产权局</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/url?id=Ac9_BwABERAJ&amp;q=http://worldwide.espacenet.com/publicationDetails/biblio%3FCC%3DCN%26NR%3D101789934A%26KC%3DA%26FT%3DD&amp;usg=AFQjCNEnFxJ3xhMPV_junrGTqjoUhFrokA"> 欧洲专利数据库 (Espacenet)</a></span></span></td></tr><tr class="patent-bibdata-group-spacer"></tr></table><div class="number-and-title"><span class="patent-title"><invention-title mxw-id="PT96923342" lang="ZH" load-source="patent-office">网上安全交易方法和系统</invention-title>
      </span><br><span class="patent-number">CN 101789934 A</span></div><div class="patent-section patent-abstract-section"><div class="patent-section-header"><span class="patent-section-title"> 摘要</span></div><div class="patent-text"><abstract mxw-id="PA79489875" lang="ZH" load-source="patent-office">
    <div class="abstract">本发明公开了一种网上安全交易方法和系统，其中，该网上安全交易方法包括：智能密钥设备与服务端相互交换认证信息来认证对方的合法性，双方认证合法后，服务端将用户的操作数据整合成签名指令，并通过客户端将签名指令和签名信息转发给智能密钥设备，智能密钥设备验证上述签名信息合法后，执行签名指令，并向服务端返回签名结果；服务端根据签名结果处理用户的操作数据。根据本发明，通过服务端与智能密钥设备的双向认证，以及对会话过程中的数据进行验证等操作，可以有效地识别出接收的数据是否合法，进而抑制了黑客的重放攻击，保护系统的安全运行。</div>
  </abstract>
  </div></div><div class="patent-section patent-claims-section"><div class="patent-section-header"><span class="patent-section-title">权利要求<span class="patent-section-count">(12)</span></span></div><div class="patent-text"><ol mxw-id="PCLM32648997" lang="ZH" load-source="patent-office" class="claims">
    <li class="claim"> <div num="1" class="claim">
      <div class="claim-text">一种网上安全交易方法，其特征在于，包括：智能密钥设备与服务端相互交换认证信息来认证对方的合法性；所述智能密钥设备和所述服务端均被认证为合法设备后，所述服务端提示用户进行输入操作；所述服务端将用户输入的操作数据整合为签名指令，并对包含所述签名指令的签名信息进行签名得到第四签名，将所述签名指令和所述第四签名发送给所述智能密钥设备；所述智能密钥设备验证所述第四签名合法后，按照所述签名指令对所述操作数据进行签名得到签名结果，对包含所述签名结果的签名信息进行签名得到第五签名，并将所述第五签名返回给所述服务端；所述服务端验证所述第五签名合法后，处理用户输入的操作数据；其中，所述服务端和所述智能密钥设备间的上述信息交互是通过客户端进行转发的。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="2" class="claim">
      <div class="claim-text">2. 根据权利要求1所述的方法，其特征在于，所述智能密钥设备与所述服务端相互交 换认证信息来认证对方的合法性包括：所述服务端和所述智能密钥设备相互交换自身的公钥；所述智能密钥设备生成第一会话号和第一随机数，并将所述第一会话号、第一随机数、 智能密钥设备标识码打包得到第一数据包，使用所述服务端公钥对所述第一数据包加密得 到第一密文，并对所述第一数据包进行签名得到第一签名，将所述第一密文和第一签名发 给所述服务端；所述服务端使用所述服务端私钥对所述第一密文进行解密得到所述第一数据包，验证 所述第一签名和所述第一数据包中的智能密钥设备标识码，如果全部合法，则继续向下执 行；所述服务端生成第二会话号和第二随机数，并将所述第二会话号、第二随机数、所述 第一数据包中的第一随机数、所述服务端认证码打包得到第二数据包，使用所述智能密钥 设备公钥对所述第二数据包加密得到第二密文，并对所述第二数据包进行签名得到第二签 名，将所述第二密文和第二签名发给所述智能密钥设备；所述智能密钥设备使用所述智能密钥设备私钥对所述第二密文解密得到所述第二数 据包，并对所述第二签名、所述第二数据包中的第一随机数、服务端认证码进行验证，如果 全部合法，则继续向下执行；所述智能密钥设备将所述第二会话号和所述第二数据包中的第二随机数打包得到第 三数据包，并使用所述服务端公钥对所述第三数据包进行加密得到第三密文，对所述第三 数据包进行签名得到第三签名，将所述第三密文和第三签名发给所述服务端；所述服务端使用所述服务端私钥对所述第三密文进行解密得到所述第三数据包，对所 述第三签名、所述第三数据包中的第二会话号和第二随机数进行验证，如果全部合法，则所 述智能密钥设备和所述服务端均为合法设备。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="3" class="claim">
      <div class="claim-text">3. 根据权利要求2所述的方法，其特征在于，所述对包含所述签名指令的签名信息进 行签名得到第四签名包括：所述服务端将所述第一随机数增加第一预设步长，对所述签名指令和增加所述第一预 设步长后的第一随机数打包，对打包后的数据进行签名得到第四签名； 所述对包含所述签名结果的签名信息进行签名得到第五签名包括：所述智能密钥设备将所述第二随机数增加第二预设步长，将所述签名结果和增加所述 第二预设步长的第二随机数打包得到第五数据包，对所述第五数据包进行签名得到第五签 名。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="4" class="claim">
      <div class="claim-text">4. 根据权利要求1至3中任一权利要求所述的方法，其特征在于，所述提示用户进行输 入操作之前还包括：所述服务端生成会话密钥，并将所述会话密钥发给所述智能密钥设备； 相应地，所述服务端将所述操作数据整合为签名指令之后还包括： 所述服务端使用所述会话密钥对所述签名指令进行加密得到密文形式的签名指令； 相应地，所述智能密钥设备接收到所述签名指令之后还包括：所述智能密钥设备使用所述会话密钥对所述密文形式的签名指令解密，得到明文形式 的签名指令。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="5" class="claim">
      <div class="claim-text">5. 根据权利要求1至3中任一权利要求所述的方法，其特征在于，所述服务端和所述智 能密钥设备上预先存储有会话密钥表，所述会话密钥表包括会话密钥标签和与所述会话密 钥标签对应的会话密钥；相应地，所述提示用户进行输入操作之前还包括：所述服务端从会话密钥表中选择会话密钥，并将所述会话密钥对应的会话密钥标签发 送给所述智能密钥设备；相应地，所述服务端将所述操作数据整合为签名指令之后还包括： 所述服务端使用所述会话密钥对所述签名指令进行加密得到密文形式的签名指令； 相应地，所述智能密钥设备接收到所述签名指令之后还包括：所述智能密钥设备根据接收到的会话密钥标签在所述会话密钥表中查找对应的会话 密钥，使用查找到的会话密钥对所述密文形式的签名指令解密，得到明文形式的签名指令。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="6" class="claim">
      <div class="claim-text">6. 根据权利要求3所述的方法，其特征在于，所述第一预设步长和所述第二预设步长 为所述服务端和所述智能密钥设备预先设定的数值。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="7" class="claim">
      <div class="claim-text">7. 根据权利要求1至3中任一权利要求所述的方法，其特征在于，所述客户端与所述服 务端间的信息交互是通过安全信道进行的。</div>
    </div>
    </li> <li class="claim"> <div num="8" class="claim">
      <div class="claim-text">8. &#8212;种网上安全交易系统，包括：智能密钥设备、客户端设备和服务器，其特征在于， 所述智能密钥设备包括：第一接口模块，用于连接所述客户端设备，通过所述客户端设备与所述服务器进行信 息交互；第一认证模块，用于根据所述服务器发送的认证信息认证所述服务器的合法性； 第一会话模块，用于接收到所述服务器发送的签名指令和第四签名后，验证所述第四 签名是否合法，所述第四签名合法后，按照所述签名指令对用户输入的操作数据签名得到 签名结果，对包含所述签名结果的签名信息进行签名得到第五签名，并将所述第五签名通 过所述第一接口模块返回给所述服务器； 所述客户端设备包括：中转模块，用于将所述智能密钥设备发送的信息转发给所述服务器，以及将所述服务 器发送的信息转发给所述智能密钥设备；操作数据处理模块，用于接收用户输入的操作数据，以及将所述操作数据转发给所述服务器；所述服务器包括：第二接口模块，用于连接所述客户端设备，通过所述客户端设备与所述智能密钥设备 进行信息交互；第二认证模块，用于根据所述智能密钥设备发送的认证信息认证所述智能密钥设备的 合法性；第二会话模块，用于所述服务器和所述智能密钥设备均被认证为合法设备后，将用户 输入的操作数据整合为签名指令，并对包含所述签名指令的签名信息进行签名得到第四签 名，将所述签名指令和所述第四签名发送给所述智能密钥设备；以及验证所述智能密钥设 备发送的第五签名是否合法，所述第五签名合法后，处理用户输入的操作数据。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="9" class="claim">
      <div class="claim-text">9. 根据权利要求8所述的系统，其特征在于，所述第一认证模块包括： 第一会话号生成单元，用于生成第一会话号； 第一随机数生成单元，用于生成第一随机数；第一认证单元，用于将所述第一会话号生成单元生成的第一会话号、所述第一随机数 生成单元生成的第一随机数、所述智能密钥设备标识码打包得到第一数据包，使用所述服 务器公钥对所述第一数据包加密得到第一密文，并对所述第一数据包进行签名得到第一签 名，将所述第一密文和第一签名通过所述第一接口模块转发给所述服务器；以及用于使用所述智能密钥设备私钥对所述第一接口模块接收的第二密文解密得到 第二数据包，所述第二数据包包括所述服务器生成的第二会话号、第二随机数、所述第一随 机数和所述服务器认证码，并对所述第一接口模块接收的第二签名、所述第二数据包中的 第一随机数、服务器的认证码进行验证，如果全部合法，所述服务器为合法设备；将所述第 二会话号和所述第二随机数打包得到第三数据包，并使用所述服务器公钥对所述第三数据 包进行加密得到第三密文，对所述第三数据包签名得到第三签名，将所述第三密文和第三 签名通过所述第一接口模块转发给所述服务器；所述第二认证模块包括：第二会话号生成单元，用于生成第二会话号； 第二随机数生成单元，用于生成第二随机数；第二认证单元，用于使用所述服务器私钥对所述第二接口模块接收的第一密文进行解 密得到所述第一数据包，验证所述第一签名和所述第一数据包中的智能密钥设备标识码， 如果全部合法，所述智能密钥设备为合法设备，则将所述第二会话号生成单元生成的第二 会话号、所述第二随机数生成单元生成的第二随机数、所述第一数据包中的第一随机数、所 述服务器的认证码打包得到第二数据包，使用所述智能密钥设备公钥对所述第二数据包加 密得到第二密文，并对所述第二数据包进行签名得到第二签名，将所述第二密文、第二签名 通过所述第二接口模块转发给所述智能密钥设备；以及用于使用所述服务器私钥对所述第二接口模块接收的第三密文进行解密得到所 述第三数据包，对所述第三数据包中的第三签名、第二会话号和第二随机数进行验证，如果 全部合法，则认证成功，提示用户进行输入操作。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="10" class="claim">
      <div class="claim-text">10. 根据权利要求9所述的系统，其特征在于，所述第二会话模块中的对包含所述签名 指令的签名信息进行签名得到第四签名是通过以下方式得到的：将所述第一随机数增加第一预设步长，对所述签名指令和增加所述第一预设步长后的第一随机数打包，对打包后的数据进行签名得到第四签名；所述第一会话模块中的对包含所述签名结果的签名信息进行签名得到第五签名是通过以下方式得到的：将所述第二随机数增加第二预设步长，将所述签名结果和增加所述第二预设步长的第二随机数打包得到第五数据包，对所述第五数据包进行签名得到第五签名。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="11" class="claim">
      <div class="claim-text">11. 根据权利要求8至10中任一权利要求所述的方法，其特征在于，所述服务器还包括：会话密钥生成模块，用于所述第二认证模块认证成功时，生成会话密钥，并将所述会话密钥发给所述智能密钥设备；相应地，所述第二会话模块还用于将所述操作数据整合为签名指令之后，使用所述会话密钥对所述签名指令进行加密得到密文形式的签名指令；相应地，所述第一会话模块还用于接收到所述签名指令之后，使用所述会话密钥对所述密文形式的签名指令解密，得到明文形式的签名指令。</div>
    </div>
    </li> <li class="claim-dependent"> <div num="12" class="claim">
      <div class="claim-text">12. 根据权利要求8至10中任一权利要求所述的方法，其特征在于，所述智能密钥设备还包括：第一存储模块，用于存储会话密钥表，所述会话密钥表包括会话密钥标签和与所述会话密钥标签对应的会话密钥；所述服务器还包括：第二存储模块，用于存储所述会话密钥表；会话密钥选择模块，用于从所述第二存储模块中存储的会话密钥表中选择会话密钥，并将所述会话密钥对应的会话密钥标签发送给所述智能密钥设备；相应地，所述第二会话模块还用于将所述操作数据整合为签名指令后，使用所述会话密钥选择模块选择的会话密钥对所述签名指令进行加密得到密文形式的签名指令；相应地，所述智能密钥设备中的第一会话模块还用于接收到所述签名指令后，根据接收的会话密钥标签在所述第一存储模块存储的会话密钥表中查找对应的会话密钥，使用查到的会话密钥对所述密文形式的签名指令解密，得到明文形式的签名指令。</div>
    </div>
  </li> </ol>
  </div></div><div class="patent-section patent-description-section"><div class="patent-section-header"><span class="patent-section-title"> 说明</span></div><div class="patent-text"><div mxw-id="PDES37983951" lang="ZH" load-source="patent-office" class="description">
    <p>网上安全交易方法和系统</p>
    <p>技术领域</p>
    <p>[0001] 本发明涉及信息安全技术领域，具体而言，涉及一种网上安全交易方法和系统。</p>
    <p>背景技术</p>
    <p>[0002] 随着网络蓬勃的发展，网上银行业务也利用迅猛发展的计算机和计算机网络与通讯技术渗透到全球每个角落的互联网，到目前为止，国内的大多数银行都推出了自己的网上银行业务。在网上银行的发展过程中，网上交易的安全问题也成为人们关注的焦点。[0003] 目前，大多数银行采取的安全措施都是向用户提供USB Key，在进行网上交易的过程中加入USB Key的参与。USB Key是一种USB接口的硬件设备。它内置单片机或智能卡芯片，有一定的存储空间，可以存储用户的私钥，利用USB Key内置的密钥算法实现对用户身份的认证。目前阶段，为了保障网上交易更安全，USB Key内置的密钥算法大多是采用非对称算法，非对称算法能够生成一对密钥&#8212;&#8212;公钥和私钥，当用户进行网上交易时，客户端主机将交易数据转换成指令形式，发送到USB Key,USB Key对交易数据进行签名并加密，客户端接收加密后的数据并发送给银行服务端，银行对签名进行判断，如果签名验证成功则证明为合法用户，以此来保护用户交易信息的安全性。其中，由于用户私钥保存在USB Key中，理论上使用任何方式都无法读取，因此保证了用户认证的安全性。</p>
    <p>[0004] USB Key中还保存有数字证书，数字证书是一种权威性的电子文档。它提供了一种在Internet上验证您身份的方式，其作用类似于司机的驾驶执照或日常生活中的身份证。它是由一个由权威机构&#8212;&#8212;CA(Certificate Authority,证书认证）中心发行的，人们可以在互联网交往中用它来识别对方的身份。在数字证书的认证过程中，证书认证中心（CA)作为权威的、公正的、可信赖的第三方，可以给用户身份认证充分的保证。[0005] 在用户进行网上交易时，需要先将USB Key插入USB接口，用户输入PIN码，用以确认用户对USB Key的使用权，然后对服务端和数字证书进行验证，用以确认用户的合法身份和服务端的合法性，确认正确后就可以开始使用USB Key内置的密钥进行网上交易。[0006] 但是，现有网上交易中的签名指令APDU(A卯lication ProtocolData Unit，应用协议数据单元）为客户端主机所发出的，这种方式导致指令在封装过程中有可能被黑客修改，而普通的USB Key不能发现数据是否合法，只要接收到签名指令，就会进行签名操作，然后将签名数据返回给客户端主机；一旦签名数据被黑客劫持后，黑客就可以利用劫持的签名数据攻击服务端；如果黑客利用劫持的签名数据频繁地攻击服务端，就会造成重放攻击，导致用户的损失或交易异常（如系统崩溃等）。</p>
    <p>[0007] 综上所述，现有的网上交易中的数据容易被黑客劫持，USB Key不能验证接收到的数据是否合法，只能按照接收到的指令对数据进行相应的操作，存在一定的安全风险，且防止重放攻击能力差。</p>
    <p>[0008]     针对相关技术中网上交易存在安全风险的问题，目前尚未提出有效的解决方案。发明内容</p>
    <p>[0009] 针对网上交易存在安全风险的问题而提出本发明，为此，本发明的主要目的在于提供一种网上安全交易方法和系统，以解决上述问题至少之一。</p>
    <p>[0010]     为了实现上述目的，根据本发明的一个方面，提供了 一种网上安全交易方法。[0011]     根据本发明的一种网上安全交易方法，包括：</p>
    <p>[0012]     智能密钥设备与服务端相互交换认证信息来认证对方的合法性；</p>
    <p>[0013] 所述智能密钥设备和所述服务端均被认证为合法设备后，所述服务端提示用户进</p>
    <p>行输入操作；</p>
    <p>[0014] 所述服务端将用户输入的操作数据整合为签名指令，并对包含所述签名指令的签名信息进行签名得到第四签名，将所述签名指令和所述第四签名发送给所述智能密钥设备；[0015] 所述智能密钥设备验证所述第四签名合法后，按照所述签名指令对所述操作数据进行签名得到签名结果，对包含所述签名结果的签名信息进行签名得到第五签名，并将所述第五签名返回给所述服务端；</p>
    <p>[0016]     所述服务端验证所述第五签名合法后，处理用户输入的操作数据；</p>
    <p>[0017] 其中，所述服务端和所述智能密钥设备间的上述信息交互是通过客户端进行转发的。</p>
    <p>[0018] 为了实现上述目的，根据本发明的另一方面，提供了一种网上安全交易系统。[0019] 根据本发明的网上安全交易系统，包括：智能密钥设备、客户端设备和服务器，其中，所述智能密钥设备包括：</p>
    <p>[0020] 第一接口模块，用于连接所述客户端设备，通过所述客户端设备与所述服务器进行信息交互；</p>
    <p>[0021]     第一认证模块，用于根据所述服务器发送的认证信息认证所述服务器的合法性；[0022] 第一会话模块，用于接收到所述服务器发送的签名指令和第四签名后，验证所述第四签名是否合法，所述第四签名合法后，按照所述签名指令对用户输入的操作数据签名得到签名结果，对包含所述签名结果的签名信息进行签名得到第五签名，并将所述第五签名通过所述第一接口模块返回给所述服务器；[0023]     所述客户端设备包括：</p>
    <p>[0024] 中转模块，用于将所述智能密钥设备发送的信息转发给所述服务器，以及将所述服务器发送的信息转发给所述智能密钥设备；</p>
    <p>[0025] 操作数据处理模块，用于接收用户输入的操作数据，以及将所述操作数据转发给所述服务器；</p>
    <p>[0026]     所述服务器包括：</p>
    <p>[0027] 第二接口模块，用于连接所述客户端设备，通过所述客户端设备与所述智能密钥设备进行信息交互；</p>
    <p>[0028] 第二认证模块，用于根据所述智能密钥设备发送的认证信息认证所述智能密钥设备的合法性；</p>
    <p>[0029] 第二会话模块，用于所述服务器和所述智能密钥设备均被认证为合法设备后，将用户输入的操作数据整合为签名指令，并对包含所述签名指令的签名信息进行签名得到第四签名，将所述签名指令和所述第四签名发送给所述智能密钥设备；以及验证所述智能密</p>
    <p>7钥设备发送的第五签名是否合法，所述第五签名合法后，处理用户输入的操作数据。</p>
    <p>[0030] 通过服务端和智能密钥设备的双向认证，可以确保服务端和智能密钥设备均为合</p>
    <p>法设备，同时，通过对认证过程和会话过程中的数据采用签名和加密操作，以及对接收到的</p>
    <p>数据采用解密和签名验证操作，解决了现有技术中的重放攻击问题，使服务端和智能密钥</p>
    <p>设备均能够验证出接收到的数据是否合法，进而达到防止了黑客利用从容户端劫持的数据</p>
    <p>进行非法操作（例如签名操作）的目的，增加了系统的安全性，有效地制约了黑客对服务器</p>
    <p>的重放攻击，确保网上交易的顺利进行，更好地维护了用户的利益。</p>
    <p>附图说明</p>
    <p>[0031] 此处所说明的附图用来提供对本发明的进一步理解，构成本申请的一部分，本发</p>
    <p>明的示意性实施例及其说明用于解释本发明，并不构成对本发明的不当限定。在附图中：</p>
    <p>[0032]      图1是本发明实施例的网上安全交易方法的流程图；</p>
    <p>[0033]      图2是本发明实施例1的网上安全交易方法中的认证过程的流程图；</p>
    <p>[0034]      图3是本发明实施例1的网上安全交易方法中的会话过程的流程图；</p>
    <p>[0035]      图4是本发明实施例2的网上安全交易方法中的认证过程的流程图；</p>
    <p>[0036]      图5是本发明实施例2的网上安全交易方法中的会话过程的流程图；</p>
    <p>[0037]      图6是本发明实施例的网上安全交易系统的结构框图。</p>
    <p>具体实施方式</p>
    <p>[0038]     下文中将参考附图并结合实施例来详细说明本发明。需要说明的是，在不冲突的</p>
    <p>情况下，本申请中的实施例及实施例中的特征可以相互组合。</p>
    <p>[0039] 功能概述</p>
    <p>[0040] 针对网上交易存在安全风险的问题，本发明实施例提供了一种网上安全交易方法 和系统。根据本发明实施例的方案，通过服务端和智能密钥设备的双向认证，可以确保服务 端和智能密钥设备均为合法设备，同时，通过对认证过程和会话过程中的数据进行签名和 加密操作，以及对接收到的数据进行解密和签名验证操作，使服务端和智能密钥设备均能 够验证出接收到的数据是否合法，防止了黑客利用劫持的数据进行非法操作，增加了系统 的安全性，有效地制约了黑客对服务器的重放攻击，确保网上交易的顺利进行，更好地维护 了用户的利益。</p>
    <p>[0041] 根据本发明的实施例，提供了一种网上安全交易方法，如图1所示，该方法包括如 下的步骤S101至步骤S107 :</p>
    <p>[0042]     步骤SlOl，智能密钥设备与服务端相互交换认证信息来认证对方的合法性； [0043] 步骤S102，智能密钥设备和服务端均被认证为合法设备后，服务端提示用户进行 输入操作；</p>
    <p>[0044] 步骤S103，服务端将用户输入的操作数据整合为签名指令，并对包含该签名指令 的签名信息进行签名得到第四签名；</p>
    <p>[0045]     步骤S104，服务端将该签名指令和第四签名发送给智能密钥设备；</p>
    <p>[0046] 步骤S105，智能密钥设备验证第四签名合法后，按照签名指令对上述操作数据进</p>
    <p>行签名得到签名结果；[0047] 步骤S106，智能密钥设备对包含签名结果的签名信息进行签名得到第五签名，并将第五签名返回给服务端；</p>
    <p>[0048]     步骤S107，服务端验证第五签名合法后，处理用户输入的操作数据。[0049] 其中，服务端和智能密钥设备间的上述信息交互是通过客户端进行转发的。[0050] 优选的，智能密钥设备与服务端相互交换认证信息来认证对方的合法性具体包括以下步骤：</p>
    <p>[0051]     服务端和智能密钥设备相互交换自身的公钥；</p>
    <p>[0052] 智能密钥设备生成第一会话号和第一随机数，并将第一会话号、第一随机数、智能</p>
    <p>密钥设备标识码打包得到第一数据包，使用服务端公钥对第一数据包加密得到第一密文，</p>
    <p>并对第一数据包进行签名得到第一签名，将第一密文和第一签名发给服务端；</p>
    <p>[0053] 服务端使用服务端私钥对第一密文进行解密得到第一数据包，验证第一签名和第</p>
    <p>一数据包中的智能密钥设备标识码，如果全部合法，则继续向下执行；</p>
    <p>[0054] 服务端生成第二会话号和第二随机数，并将第二会话号、第二随机数、第一数据包中的第一随机数、服务端认证码打包得到第二数据包，使用智能密钥设备公钥对第二数据包加密得到第二密文，并对第二数据包进行签名得到第二签名，将第二密文和第二签名发给智能密钥设备；</p>
    <p>[0055] 智能密钥设备使用智能密钥设备私钥对第二密文解密得到第二数据包，并对第二签名、第二数据包中的第一随机数、服务端认证码进行验证，如果全部合法，则继续向下执行；</p>
    <p>[0056] 智能密钥设备将第二会话号和第二数据包中的第二随机数打包得到第三数据包，并使用服务端公钥对第三数据包进行加密得到第三密文，对第三数据包进行签名得到第三签名，将第三密文和第三签名发给服务端；</p>
    <p>[0057] 服务端使用服务端私钥对第三密文进行解密得到第三数据包，对第三签名、第三数据包中的第二会话号和第二随机数进行验证，如果全部合法，则智能密钥设备和服务端均为合法设备。</p>
    <p>[0058] 需要说明的是，智能密钥设备与服务端相互交换认证信息来认证对方的合法性可</p>
    <p>以通过多种方式实现，上述方式只是其中一种，本领域普通技术人员可以对上述方式进行</p>
    <p>简单的变换，实现智能密钥设备与服务端相互认证对方的合法性即可。</p>
    <p>[0059]     优选的，对包含签名指令的签名信息进行签名得到第四签名包括：</p>
    <p>[0060] 服务端将第一随机数增加第一预设步长，对签名指令和增加第一预设步长后的第</p>
    <p>一随机数打包，对打包后的数据进行签名得到第四签名；</p>
    <p>[0061]      对包含签名结果的签名信息进行签名得到第五签名包括：</p>
    <p>[0062] 智能密钥设备将第二随机数增加第二预设步长，将签名结果和增加第二预设步长</p>
    <p>的第二随机数打包得到第五数据包，对第五数据包进行签名得到第五签名。</p>
    <p>[0063] 为了进一步增强信息交互的安全性，可以对上述服务端整合后的签名指令进行加</p>
    <p>密得到密文形式的签名指令，该加密过程至少可以通过以下两种方式实现：</p>
    <p>[0064] 第一种方式</p>
    <p>[0065]      在步骤S102中的提示用户进行输入操作之前还包括：[0066]     服务端生成会话密钥，并将会话密钥发给智能密钥设备；[0067]      相应地，步骤S103中的服务端将操作数据整合为签名指令之后还包括：</p>
    <p>[0068]      服务端使用会话密钥对签名指令进行加密得到密文形式的签名指令；</p>
    <p>[0069]      相应地，步骤S105中的智能密钥设备接收到签名指令之后还包括：</p>
    <p>[0070] 智能密钥设备使用会话密钥对密文形式的签名指令解密，得到明文形式的签名指令。</p>
    <p>[0071] 第二种方式</p>
    <p>[0072] 在服务端和智能密钥设备上预先存储有会话密钥表，该会话密钥表包括会话密钥 标签和与会话密钥标签对应的会话密钥；</p>
    <p>[0073]     相应地，在步骤S102中的提示用户进行输入操作之前还包括：</p>
    <p>[0074] 服务端从会话密钥表中选择会话密钥，并将会话密钥对应的会话密钥标签发送给 智能密钥设备；</p>
    <p>[0075]     相应地，步骤S103中的服务端将操作数据整合为签名指令之后还包括：</p>
    <p>[0076] 服务端使用上述会话密钥对签名指令进行加密得到密文形式的签名指令；</p>
    <p>[0077]      相应地，步骤S105中的智能密钥设备接收到签名指令之后还包括：</p>
    <p>[0078] 智能密钥设备根据接收到的会话密钥标签在会话密钥表中查找对应的会话密钥，</p>
    <p>使用查找到的会话密钥对密文形式的签名指令解密，得到明文形式的签名指令。</p>
    <p>[0079] 该优选方案在服务端和智能密钥设备均认证对方为合法设备后，由服务端生成会</p>
    <p>话密钥，或者，由服务端在会话密钥表中选择会话密钥，并将该会话密钥的信息通知给智能</p>
    <p>密钥设备，用以对会话过程中的签名指令进行加密，进而进一步地增强了系统的安全性，更</p>
    <p>好地保护了用户的利益。</p>
    <p>[0080] 优选的，上述方案中的第一预设步长和第二预设步长可以是服务端和智能密钥设</p>
    <p>备预先设定的数值，例如，该数值可以为1，2，......等，这样，可以使每个随机数只被使用</p>
    <p>一次，有效地防止黑客攻击。在安全性要求不是太高的情况下，设定的数值也可以为0，具体 数值的选择可以根据系统的需要设定。</p>
    <p>[0081] 上述客户端与服务端转发的数据可以通过安全信道进行，也可以通过普通信道进 行。如果是通过安全信道进行的，该安全信道可以采用现有技术中的安全信道实现，例如 SSL (Secure SocketsLayer，安全套接层)。</p>
    <p>[0082]     下面将结合实例对本发明实施例的实现过程进行详细描述。 [0083]     实施例1</p>
    <p>[0084] 图2和图3是本发明实施例1中的网上安全交易方法的流程图。如图2和图3所 示，提供了一种网上安全交易方法，本实施例采用USB Key作为智能密钥设备，以用户通过 USB Key进行网上银行交易为例进行说明，该USB Key内部写入一个唯一的标识码，用作对 USB Key的合法性的认证，并且该USB Key内存储有一个服务端认证码，利用该服务端认证 码可以判断服务端的合法性，同时，合法的服务端保存有USB Key的唯一标识码，本实施例 以RSA算法为例进行说明。该网上银行交易的方法包括对等实体认证和会话过程，对等实 体认证即USB Key和网上银行服务端互相认证其合法性的过程，双方的合法性是进行会话 的必要条件。如图2所示，对等实体认证过程的具体步骤如下：</p>
    <p>[0085] 步骤S1001，USB key接入客户端主机，用户登录网上银行服务端，向服务端发送会 话请求；</p>
    <p>10[0086] 在本实施例中，会话请求即要求USB Key、客户端与服务端（网上银行服务器）建立网上会话，网上会话的过程即是完成网上银行交易的过程，会话请求要求建立USB Key、客户端与服务端之间的会话通道，使得会话过程安全可信。</p>
    <p>[0087] 步骤S1002，客户端和服务端开始对等实体认证过程，服务端向客户端发送服务端公钥，客户端转发给USB Key;</p>
    <p>[0088]     在本实施例步骤S1002中，服务端向USB Key发送的主要指令为：</p>
    <p>[0089]     CLA        '94'私有，使用私有密钥 是链式指令</p>
    <p>[0090]     INS     'DA' 表示此次会话的名称</p>
    <p>[0091]     PI       '61， RSA公钥</p>
    <p>[0092]     P2       '00' 未使用</p>
    <p>[0093]     Lc       '00'  'XXXX' 发送数据的长度</p>
    <p>[0094]     Data 'N，</p>
    <p>[0095]     'FFXXXX'   服务端公钥中N的长度[0096]'服务端公钥中N的值'[0097] 'E'</p>
    <p>[0098]'服务端公钥中E的长度'[0099]'服务端公钥中E的值'</p>
    <p>[0100] 其中，符号''内的内容为指令中应写入的内容，部分指令采用文字进行说明，本领域技术人员可以按照说明内容进行理解，发送时所有指令及数据按顺序排列，USB Key接收并解析指令，'DA'为此次会话的标签（名称），'XXXX'代表此次发送的数据的长度，在本实施例中'XXXX'应视具体的数据长度而定，本实施例提供的指令格式仅为优选情况，供本领域相关技术人员进行理解，指令内容和格式以及符号等均可以在本实施例所提供的方法内做变化。</p>
    <p>[0101]     步骤S1003, USB Key返回USB Key的公钥给服务端；</p>
    <p>[0102]     在本实施例步骤S1003中，USB Key向服务端发送指令，并将这些信息通过客户端</p>
    <p>转发给服务端，上述指令具体的可以为：</p>
    <p>[0103]     'DA' 返回的标签</p>
    <p>[0104]     '00'  'XXXX'返回的数据的长度</p>
    <p>[0105] 'N，</p>
    <p>[0106]     'FFXXXX' USB Key的公钥中N的长度[0107]     'USB Key的公钥中N的值'[0108] 'E，</p>
    <p>[0109]     'USB Key的公钥中E的长度'[0110]     'USB Key的公钥中E的值'[0111]     'SW1-SW2'状态字</p>
    <p>[0112] 其中，此次返回的N和E为USB Key的公钥，状态字表示USBKey是否成功的接收到了步骤S1002中服务端发送给USB Key的数据，状态字的数值由服务端和USB Key共同协定。</p>
    <p>[0113]     步骤S1004， USB Key生成第一会话ID、第一随机数，并将第一会话ID、第一随机数、USB Key的标识码打包得到第一数据包；</p>
    <p>[0114]     在本实施例中，为了增加第一随机数的保密性，第一随机数由USB key硬件生成，</p>
    <p>若不考虑高保密性，则可以通过程序生成；</p>
    <p>[0115]     USB Key生成第一数据包的指令如下所示：</p>
    <p>[0120] 生成第一数据包的数据为：</p>
    <p>[0121] 'Bl' 第一数据包的标签</p>
    <p>[0122] 'FFXXXX'数据的长度</p>
    <p>[0123] 'Cl'第一会话ID的标签</p>
    <p>[0124] '10'第一会话ID的长度[0125]'第一会话ID的值'</p>
    <p>[0126] 'C3'第一随机数的标签</p>
    <p>[0127] '10'第一随机数的长度[0128]'第一随机数的值'</p>
    <p>[0129] 'C5' USB Key的标识符</p>
    <p>[0130] '10' USB Key的标识符的长度</p>
    <p>[0131] 'USB Key的标识符的值'</p>
    <p>[0132] 步骤S1005，USB Key使用服务端公钥对第一数据包进行加密得到第一密文Ml，并</p>
    <p>对第一数据包签名得到第一签名SI ;</p>
    <p>[0133] 第一数据包被加密的结果如下所示：</p>
    <p>[0134] 'El'第一数据包被加密的标签</p>
    <p>[0135] 'FFXXXX'数据的长度</p>
    <p>[0136]'加密的结果'</p>
    <p>[0137] 第一数据包的签名结果如下所示：</p>
    <p>[0138] 'E3'第一数据包被签名的标签</p>
    <p>[0139] 'FFXXXX'数据的长度[0140]'签名的结果'</p>
    <p>[0141] 上述对第一数据包签名得到第一签名Sl，签名算法可以为：MD5、 SHA-l、 SHA-256</p>
    <p>等签名算法。</p>
    <p>[0142] 步骤S1006, USB Key将第一密文Ml、第一签名SI通过客户端转发给服务端；</p>
    <p>[0143] 上述USB Key向客户端发送指令数据，并通过客户端将这些信息转发给服务端，所</p>
    <p>述指令数据为：</p>
    <p>[0144] 'Dl'标签</p>
    <p>[0145] '00"XXXX' 数据包的长度</p>
    <p>[0146]'第一数据包被加密后的结果'</p>
    <p>[0147]'第一数据包被签名的结果'</p>
    <p>:0116]:o"7]:om]:0119]</p>
    <p>私有，使用私有SM是链式指令</p>
    <p>未使用未使用</p>
    <p>12[0148]     'SW1-SW2'状态字</p>
    <p>[0149] 步骤S1007,服务端使用服务端私钥对第一密文Ml解密得到第一数据包，服务端验证第一签名Sl，并判断第一数据包中的USBKey标识码是否合法，如果全部合法，执行步骤S1009，否则，执行步骤S1008 ;</p>
    <p>[0150] 在本实施例步骤S1007中，服务端验证第一签名SI的过程为：服务端根据解密后的第一数据包计算签名并与第一签名Sl进行比对，如果相同，签名合法，如果不相同，签名不合法。</p>
    <p>[0151]     步骤S1008，提示用户该USB Key不合法，终止操作；</p>
    <p>[0152]     步骤S1009，服务端生成第二会话ID、第二随机数，并将第二会话ID、第一随机数、</p>
    <p>第二随机数与服务端认证码打包得到第二数据包；</p>
    <p>[0153]     其中，具体的第二数据包的格式可以为：</p>
    <p>[0154]     'B3'第二数据包的标签</p>
    <p>[0155]     'FFXXXX'数据的长度</p>
    <p>[0156]     'C1'第一会话ID的标签</p>
    <p>[0157] '10'第一会话ID的长度</p>
    <p>[0158]'第一会话ID的值'</p>
    <p>[0159]     'C3'第一随机数的标签</p>
    <p>[0160] '10'第一随机数的长度</p>
    <p>[0161]'第一随机数的值'</p>
    <p>[0162]     'C2'第二会话ID的标签</p>
    <p>[0163] '10'第二会话ID的长度</p>
    <p>[0164]'第二会话ID的值，</p>
    <p>[0165]     'C4'第二随机数的标签</p>
    <p>[0166] '10'第二随机数的长度</p>
    <p>[0167]'第二随机数的值'</p>
    <p>[0168] 'C6'服务器ID的标签</p>
    <p>[0169] '10'服务器ID的长度</p>
    <p>[0170]'服务器ID的值'</p>
    <p>[0171] 步骤S1010，服务端使用USB Key公钥对第二数据包加密得到第二密文M2，并对第二数据包进行签名得到第二签名S2 ;</p>
    <p>[0172] 其中，第二密文M2和第二签名S2的数据格式分别与步骤S1005中第一密文M1和第一签名Sl相同，这里不再赘述。</p>
    <p>[0173]     步骤S1011，服务端将第二密文M2、第二签名S2通过客户端转发给USB Key ;[0174] 其中，服务端将第二密文和第二签名结果通过指令发送给客户端，客户端将指令所包含的信息发送给USB key，这里的指令具体格式可以为：</p>
    <p>[0175]	(XA	'94，	私有，使用私有SM</p>
    <p>[0176]	INS	'D3，	标签</p>
    <p>[0177]	Pl	'00，	未使用</p>
    <p>[0178]	P2	'00，	未使用[0179] Lc       '00'  'XXXX'数据的长度</p>
    <p>[0180] Data   'D3，第二数据包的标签</p>
    <p>[0181] 'FFXXXX'数据包的长度 [0182]'第二数据包被加密后的结果' [0183]'第二数据包被签名的结果'</p>
    <p>[0184] 步骤S1012，USB Key使用USB Key私钥对第二密文M2进行解密得到第二数据包， USB Key验证第二签名S2、第一会话ID、第一随机数、服务端认证码是否全部合法，如果全 部合法，执行步骤1014，否则，执行步骤1013 ;</p>
    <p>[0185] 其中，如果第二签名S2、第一会话ID、第一随机数、服务端认证码是否全部合法， 第一随机数增加一个步长并保存，优选地，一个步长可以为l，例如，第一随机数为5，增加 一个步长后的第一随机数将为6 ;</p>
    <p>[0186] 步骤S1013，提示服务端不合法，建立会话失败；</p>
    <p>[0187] 步骤S1014，USB Key使用服务端公钥对第二会话ID、第二随机数打包为第三数据</p>
    <p>包，并对第三数据包进行加密、签名操作得到第三密文M3、第三签名S3 ;</p>
    <p>[0188] 在本步骤中，USB Key生成第三数据包的指令格式可以为：</p>
    <p>[0189] 'B5'标签</p>
    <p>[0190] 'FFXXXX'数据的长度</p>
    <p>[0191] 'C2' 第二会话ID的标签</p>
    <p>[0192] '10'第二会话ID的长度</p>
    <p>[0193]'第二会话ID的值'</p>
    <p>[0194] 'C4'第二随机数的标签</p>
    <p>[0195] '10'第二随机数的长度</p>
    <p>[0196]'第二随机数的值'</p>
    <p>[0197] 对第三数据包进行加密的结果为：</p>
    <p>[0198] 'E5'第一数据包被加密的标签</p>
    <p>[0199] 'FFXXXX'数据的长度</p>
    <p>[0200]'加密的结果'</p>
    <p>[0201] 对第三数据包进行签名的结果为：</p>
    <p>[0202] 'E7'第一数据包被签名的标签</p>
    <p>[0203] 'FFXXXX'数据的长度 [0204]'签名的结果'</p>
    <p>[0205] 步骤S1015, USB Key将第三密文M3、第三签名值S3通过客户端转发给服务端；</p>
    <p>[0206] 其中本步骤中，USB Key通过发送给客户端，并通过客户端转发给服务端数据为：</p>
    <p>[0207] 'D3'标签</p>
    <p>[0208] '00"XXXX'数据包的长度</p>
    <p>[0209]'被加密后的结果'</p>
    <p>[0210]'被签名的结果'</p>
    <p>[0211] 'SW1-SW2'状态字</p>
    <p>[0212] 本步骤中的上述状态字返回的是步骤S1012中验证成功的结果。[0213] 步骤S1016,服务端对第三密文解密得到第三数据包，得到第二会话ID和第二 随机数，服务端对第三签名、第二会话ID、第二随机数进行验证，如果全部合法，执行步骤 S1018，否则，执行步骤S1017 ;</p>
    <p>[0214] 在本实施例步骤S1016中，当第二随机数验证完毕后，该第二随机数增加一个步 长。</p>
    <p>[0215]     步骤S1017，建立会话失败，提示错误；</p>
    <p>[0216] 步骤S1018，对等实体认证成功，提示用户可以开始会话操作。 [0217]     如图3所示，会话过程具体包括以下步骤：</p>
    <p>[0218] 步骤S2001，用户通过客户端的输入装置输入交易数据，客户端将交易数据发送给 服务端；</p>
    <p>[0219]     步骤S2002，服务端接收交易数据，并将交易数据整合为签名指令APDU ;</p>
    <p>[0220] 整合的签名指令APDU的内容为对交易数据进行签名的指令，该签名指令包括签</p>
    <p>名操作指令、签名的数据以及长度；例如：整合后的数据的前六位表示签名操作指令，第七</p>
    <p>至十二位表示签名的数据，第十二至十六位表示签名的数据长度。</p>
    <p>[0221]     步骤S2003，服务端对APDU和第一随机数打包进行签名得到第四签名S4 ;</p>
    <p>[0222] 在本步骤中，首先对APDU和第一随机数打包得到如下格式的数据，本实施例在</p>
    <p>APDU前加入第一随机数可以增加安全性，防止重放攻击：</p>
    <p>[0223]     'B9'标签</p>
    <p>[0224]     'FFXXXX'数据的长度</p>
    <p>[0225]     'C3'第一随机数的标签</p>
    <p>[0226]     '10'第一随机数的长度</p>
    <p>[0227]'第一随机数的值'</p>
    <p>[0228]     'C9， APDU指令的标签</p>
    <p>[0229]     'APDU指令的长度'</p>
    <p>[0230]     'APDU指令的值'</p>
    <p>[0231]     其中，步骤S2001中的用户输入的交易数据包含在'APDU指令的值'中，另外本步</p>
    <p>骤中的'第一随机数的值'应该为步骤S1009中服务端所使用的第一随机数增加一个步长</p>
    <p>后的随机数，步长由USBKey和服务端共同商定；</p>
    <p>[0232]     对上述数据进行签名得到的结果如下：</p>
    <p>[0233]     'E9' 签名的标签</p>
    <p>[0234]     'FFXXXX'签名的长度</p>
    <p>[0235]'第四签名S4'</p>
    <p>[0236] 步骤S2004，服务端将第一会话ID、 APDU、第四签名S4打包发送给客户端，客户端 转发给USB Key ;</p>
    <p>[0237]     在本步骤中，服务端发送的指令数据格式可以为：</p>
    <p>[0238]	(XA	'84，	私有，使用私有SM</p>
    <p>[0239]	INS	'D7，</p>
    <p>[0240]	PI	'00'	未使用</p>
    <p>[0241]	P2	'00'	未使用</p>
    <p>15[0242] [0243] [0244] [0245] [0246] [0247] [0248] [0249] [0250] [0251] [0252] [0253]</p>
    <p>Lc     '00' 'XXXX'数据的长度</p>
    <p>Data 'D7' 本次发送数据包的标签</p>
    <p>'FFXXXX' 本次发送数据包的长度</p>
    <p>'Cl'第一会话ID的标签 'IO'第一会话ID的长度 '第一会话ID的值'</p>
    <p>'C9' APDU指令的标签 'APDU指令的长度'</p>
    <p>'APDU指令的值'</p>
    <p>'E9' 第四签名的标签 'FFXXXX'第四签名的长度 '第四签名'</p>
    <p>[0254] 步骤S2005，USB Key对第四签名S4进行验证，如果签名不合法，执行步骤S2006 ; 如果签名合法，执行步骤S2007 ;</p>
    <p>[0255]     在本步骤中，USB Key验证第四签名时使用同步骤S2003的算法生成一个签名值，</p>
    <p>并与第四签名进行比对，如果相同，则第四签名合法，并且同时证明了第一随机数也相同，</p>
    <p>如果生成的签名值与第四签名不相同，则第四签名不合法；</p>
    <p>[0256]     在第四签名验证合法后，USB Key将第一随机数增加一个步长并保存。</p>
    <p>[0257]     步骤S2006 ，提示错误，签名不合法；</p>
    <p>[0258] 步骤S2007, USB Key执行APDU指令，得到APDU的处理结果R，对R和第二随机数 打包进行签名得到第五签名S5 ;</p>
    <p>[0259]     在本步骤中，USB Key执行APDU指令，即对交易数据进行签名得到实际的APDU处</p>
    <p>理结果R，然后对R和第二随机数打包并进行签名操作，此时第二随机数应为步骤S1012中</p>
    <p>增加一个步长的第二随机数，其中R和第二随机数打包的结果如下：</p>
    <p>[0260]     'BB'标签</p>
    <p>[0261]     'FFXXXX'数据的长度</p>
    <p>[0262]     'C4'第二随机数的标签</p>
    <p>[0263] '10'第二随机数的长度</p>
    <p>[0264]'第二随机数'</p>
    <p>[0265]     'CB' APDU的处理的结果R的标签</p>
    <p>[0266]     'APDU的处理的结果R的长度'</p>
    <p>[0267]     'APDU的处理的结果R的值'</p>
    <p>[0268]     对上述数据进行签名得到第五签名S5的格式可以为： [0269] 'EB'第五签名的标签 [0270]     'FFXXXX'第五签名的长度 [0271]'第五签名'</p>
    <p>[0272] 步骤S2008，USB key将第二会话ID、第五签名S5发送给客户端，客户端转发给服 务端；</p>
    <p>[0273]     在本实施例中，USB Key发送指令给客户端，客户端将指令转发给服务端，上述指</p>
    <p>16令格式可以为：</p>
    <p>[0274]     'D7，标签</p>
    <p>[0275]     '00'  'XXXX'数据包的长度</p>
    <p>[0276]     'C2'第二会话ID的标签</p>
    <p>[0277] '10'第二会话ID的长度</p>
    <p>[0278]'第二会话ID的值'</p>
    <p>[0279]     'CB' APDU的处理的结果的标签</p>
    <p>[0280]     'APDU的处理结果的长度'</p>
    <p>[0281]     'APDU的处理结果的值'</p>
    <p>[0282]     'EB' 签名的标签</p>
    <p>[0283]     'FFXXXX'签名的长度</p>
    <p>[0284]'签名的结果'</p>
    <p>[0285]     'SW1-SW2，状态字</p>
    <p>[0286] 其中，此指令中的状态字表示接收服务端发送的指令是否成功，并返回是否成功 的状态；</p>
    <p>[0287] 步骤S2009，服务端对第五签名S5进行验证，如果合法，执行步骤S2010，否则，执 行步骤S2011 ;</p>
    <p>[0288]     在本实施例步骤S2009结束后，第二随机数增加一个步长，以达到每次会话时所</p>
    <p>使用的第二随机数不同，更好的防止重放的目的，其中步长可以为l或预先约定的其它值。</p>
    <p>[0289]     步骤S2010，服务端处理交易数据；例如：交易数据为用户进行转账操作，即交易</p>
    <p>数据中应该包括转出账号、目的账号和转账金额等，此处的处理交易数据为从转出账号中</p>
    <p>提取转账金额的现金到目的账号。</p>
    <p>[0290] 步骤S2011，提示错误，禁止操作。</p>
    <p>[0291]     在本实施例中，服务端和客户端的报文交互可以通过安全信道进行，如SSL。 [0292]     本实施例中的服务端和USB Key通过双向认证，可以确保服务端和USB Key均为 合法设备，同时，通过对认证过程和会话过程中的数据进行签名和加密操作，以及对接收到 的数据进行解密和签名验证操作，使服务端和USB Key均能够验证出接收到的数据是否合 法，而现有技术中的USB Key无法验证接收的数据是否合法，仅根据接收的签名指令对用户</p>
    <p>的操作数据进行签名，给黑客攻击服务端提供了便利条件，以致于黑客可以根据从客户端 截获的数据多次从USB Key获取合法的签名，利用获取的签名对服务端进行重放攻击； [0293] 采用本实施例提供的方法可以防止黑客利用劫持的数据进行非法操作，增加了系 统的安全性，有效地制约了黑客对服务器的重放攻击，确保网上银行交易的顺利进行，更好 地维护了用户的利益。 [0294]     实施例2</p>
    <p>[0295]     图4和图5是本发明实施例2中的网上安全交易方法的流程图。如图4和图5所 示，提供了一种网上安全交易方法，与实施例1不同之处在于，在本实施例中，在对等实体 认证过程中加入了协商会话密钥的过程，在会话过程中使用协商的会话密钥对签名指令进 行了加密和解密操作，使得整个网上交易过程更加安全 [0296]     如图4所示，对等实体认证过程的具体步骤如下：</p>
    <p>17[0297]     步骤S3001至步骤S3015与实施例1中的步骤S1001至步骤S1015相同，这里不</p>
    <p>再赘述。</p>
    <p>[0298] 步骤S3016，服务端解密第三密文，得到第二会话ID和第二随机数，服务端对第三 密文M3、第二会话ID、第二随机数进行认证，如果全部合法，执行步骤S3018，否则，执行步 骤S3017 ;</p>
    <p>[0299] 在本实施例步骤S3016中，当第二随机数验证完毕后，该第二随机数增加一个步 长。</p>
    <p>[0300]     步骤S3017，建立会话失败，提示错误；</p>
    <p>[0301]     步骤S3018，对等实体认证成功，服务端产生一个会话密钥；</p>
    <p>[0302]     步骤S3019，服务端向USB Key发送会话密钥；</p>
    <p>[0303]     本步骤中发送的会话密钥指令，优选地可以为：</p>
    <p>[0304]     CLA   '84'私有，使用私有SM是链式指令的结束</p>
    <p>[0305]     INS 'D5'</p>
    <p>[0306]     Pl      '00， 未使用</p>
    <p>[0307]     P2     '00' 未使用</p>
    <p>[0308]     Lc     'OO"XXXX，数据的长度</p>
    <p>[0309]     Data 'D5'数据包A的标签</p>
    <p>[0310]     'FFXXXX'数据包A的长度</p>
    <p>[0311]'数据包A被加密后的结果'</p>
    <p>[0312]'数据包A被签名的结果'</p>
    <p>[0313]     USB Key接收到上述指令后，进行解密操作得到数据包A，并对数据包A的签名进</p>
    <p>行验证，如果验证通过，则读出数据包A中记录的会话密钥，如果验证失败，则不能进行加</p>
    <p>密会话，上述数据包A的数据格式及内容如下：</p>
    <p>[0314]     'B7， 标签</p>
    <p>[0315]     'FFXXXX'数据的长度</p>
    <p>[0316]     'CI'第一会话ID的标签</p>
    <p>[0317] 'IO'第一会话ID的长度</p>
    <p>[0318]'第一会话ID的值'</p>
    <p>[0319]     'C3'第一随机数的标签</p>
    <p>[0320] '10'第一随机数的长度</p>
    <p>[0321]'第一随机数的值'</p>
    <p>[0322]     'C7' &#8212;个对称密钥的的标签</p>
    <p>[0323] '10'对称密钥的长度</p>
    <p>[0324]'对称密钥的值'</p>
    <p>[0325] 其中，上述会话密钥还可以采取如下方式实现：在USB Key和服务端上保存有会 话密钥表，该会话密钥表包括会话密钥标签和会话密钥两部分，其中，每个会话密钥对应一 个会话密钥标签。服务端发送会话密钥标签给USB Key, USB Key根据该会话密钥标签即可 从会话密钥表中查到会话过程中应使用的会话密钥；</p>
    <p>[0326]     还需要说明的是，当采用会话密钥表协商会话密钥时，还可以采取如下方式：在密钥表中保存有多个种子，并且每个种子有对应的标签，上述种子为静态参数，在服务器和 USB Key中还预先保存有生成会话密钥的算法；在使用时，服务端向USB Key发送种子标 签，USB Key接收到种子标签后，根据对应的种子和动态参数使用预先存储的算法生成会话 密钥，服务端使用同样的算法生成会话密钥。其中，动态参数可以为时间、生成会话密钥的 次数、随机数等。</p>
    <p>[0327]     USB Key接收到会话建立完成的指令后，发送一个回答命令给服务端，所述回答命</p>
    <p>令可以为：</p>
    <p>[0328] 'D5' *示签</p>
    <p>[0329] '00'  '0000'数据包的长度</p>
    <p>[0330] 'SW1-SW2，状态字</p>
    <p>[0331 ] 其中，状态字用来表示是否建立会话成功。</p>
    <p>[0332] 步骤S3020，提示用户进行会话操作。</p>
    <p>[0333] 如图5所示，本实施例的会话过程包括以下步骤：</p>
    <p>[0334] 步骤S4001，用户通过客户端的输入装置输入交易数据，客户端将交易数据转发给 服务端；</p>
    <p>[0335] 步骤S4002，服务端接收交易数据，并将交易数据整合为签名指令APDU ;</p>
    <p>[0336] 整合的签名指令APDU的内容为对交易数据进行签名的指令，该签名指令包括签</p>
    <p>名操作指令、签名的数据以及长度；</p>
    <p>[0337] 步骤S4003，服务端使用会话密钥对签名指令APDU进行加密得到第四密文M4，并</p>
    <p>将签名指令APDU和第一随机数打包，对打包后的数据进行签名得到第四签名S4 ;</p>
    <p>[0338] 在本步骤中，对签名指令APDU和第一随机数打包得到如下格式的数据：</p>
    <p>[0339] 'B9，标签</p>
    <p>[0340] 'FFXXXX'数据的长度</p>
    <p>[0341] 'C3'第一随机数的标签</p>
    <p>[0342] '10'第一随机数的长度</p>
    <p>[0343]'第一随机数的值'</p>
    <p>[0344] 'C9' APDU指令的标签</p>
    <p>[0345] 'APDU指令的长度'</p>
    <p>[0346] 'APDU指令的值'</p>
    <p>[0347] 其中，在签名指令APDU前加入第一随机数可以增加安全性，防止重放攻击。</p>
    <p>[0348] 步骤S4001中的用户输入的交易数据包含在'APDU指令的值'中，另外本步骤中的 '第一随机数的值'应该为步骤S3009中服务端所使用的第一随机数增加一个步长后的随机 数，步长由USB Key和服务端共同商定；</p>
    <p>[0349] 对上述签名指令APDU和第一随机数打包内容进行签名得到的结果如下：</p>
    <p>[0350] 'E9'签名的标签</p>
    <p>[0351] 'FFXXXX'签名的长度 [0352]'第四签名S4'</p>
    <p>[0353] 对APDU进行加密的过程如下，对APDU组装明文如下：</p>
    <p>[0354] 'C9'指令的标签</p>
    <p>19[0355] [0356] [0357] [0358] [0359] [0360] [0361] M4。 [0362]</p>
    <p>'APDU指令的长度' 'APDU指令的值'</p>
    <p>对上述签名指令APDU的明文进行加密得到如下结果： 'CB'经过加密的指令的标签 'FFXXXX'加密指令的长度 '加密的指令的值'</p>
    <p>其中，服务端使用步骤S3017中生成的会话密钥对APDU进行加密得到第四密文</p>
    <p>[0366] PI '00' [0367] P2 '00' [0368]     Lc '00'</p>
    <p>步骤S4004，服务端将第一会话ID、第四密文M4、第四签名S4打包发送给客户端， 客户端转发给USB Key ;</p>
    <p>[0363]     在本步骤中，服务端发送的指令数据格式可以为： [0364]     CLA       '84' 私有，使用私有SM [0365]     INS 'D9'</p>
    <p>未使用 未使用</p>
    <p>'xxxx'数据的长度</p>
    <p>[0369]     Data        'D9' 本次发送数据包的标签</p>
    <p>[0370]     'FFXXXX'本次发送数据包的长度</p>
    <p>[0371]     'CI'第一会话ID的标签</p>
    <p>[0372]     '10'第一会话ID的长度</p>
    <p>[0373]'第一会话ID的值'</p>
    <p>[0374]     'CB'第四密文的标签</p>
    <p>[0375]     'FFXXXX'第四密文的长度</p>
    <p>[0376]'第四密文的值'</p>
    <p>[0377]     'E9' 第四签名的标签</p>
    <p>[0378]     'FFXXXX'第四签名的长度</p>
    <p>[0379]'第四签名的值'</p>
    <p>[0380] 步骤S4005，USB Key对第四签名S4进行验证，如果签名不合法，执行步骤S4006, 如果签名合法，执行步骤S4007 ;</p>
    <p>[0381] 在本步骤中，USB Key使用与步骤S4003中相同的算法计算得出一个签名值，并与 第四签名进行比对，如果相同，则第四签名合法，并且同时证明了第一随机数也相同，如果 计算得出的签名值与第四签名不相同，则第四签名不合法；</p>
    <p>[0382]     在第四签名验证合法后，USB Key将第一随机数数增加一个步长并保存。 [0383]     步骤S4006 ，提示错误，签名不合法；</p>
    <p>[0384] 步骤S4007，USB Key使用会话密钥对第四密文M4进行解密得到明文形式的APDU， 执行该APDU指令，得到APDU的处理结果R，对处理结果R和第二随机数打包，并对打包后的 数据进行签名得到第五签名S5，对处理结果R加密得到第五密文M5 ;</p>
    <p>[0385] 在本步骤中，USB Key执行APDU指令，即对交易数据进行签名并得到结果R，对R 和第二随机数打包，并对打包后的数据进行签名得到第五签名S5，此时第二随机数应为步骤S3012中增加一个步长的第二随机数，其中R和第二随机数打包的数据格式如下：</p>
    <p>[0386] 'BB，标签</p>
    <p>[0387] 'FFXXXX，数据的长度</p>
    <p>[0388] 'C4'第二随机数的标签</p>
    <p>[0389] '10'第二随机数的长度</p>
    <p>[0390]'第二随机数'</p>
    <p>[0391] 'CB'   APDU的处理的结果R的标签</p>
    <p>[0392] 'APDU的处理的结果R的长度'</p>
    <p>[0393] 'APDU的处理的结果R的值'</p>
    <p>[0394] 对上述数据进行签名得到第五签名S5的格式可以为：</p>
    <p>[0395] 'EB'第五签名的标签</p>
    <p>[0396] 'FFXXXX'第五签名的长度 [0397]'第五签名'</p>
    <p>[0398] 在本实施例中，USB Key对APDU的处理结果R加密得到第五密文M5，优选地，使用</p>
    <p>步骤S3017中生成的会话密钥进行对称加密，过程如下：</p>
    <p>[0399] 对处理结果R的明文进行组装如下：</p>
    <p>[0400] 'CB'处理结果R的标签</p>
    <p>[0401]'处理结果R的长度'</p>
    <p>[0402]'处理结果R的值'</p>
    <p>[0403] 对上述R的明文进行加密得到第五密文M5的格式如下：</p>
    <p>[0404] 'CD'加密的处理结果R的标签 [0405]'加密的处理结果R的长度' [0406]'加密的处理结果R的值'</p>
    <p>[0407] 步骤S4008, USB Key发送第二会话ID、第五密文M5、第五签名S5给客户端，客户 端转发给服务端；</p>
    <p>[0408] 其中，USB Key向客户端所发送的数据格式如下：</p>
    <p>[0409] 'D9' *示签</p>
    <p>[0410] '00'  'XXXX'数据包的长度</p>
    <p>[0411] 'C2， 第二会话ID的标签</p>
    <p>[0412] '10' 第二会话ID的长度</p>
    <p>[0413]'第二会话ID的值'</p>
    <p>[0414] 'CD' 加密的处理结果R的标签</p>
    <p>[0415]'加密的处理结果R的长度'</p>
    <p>[0416]'加密的处理结果R的值'</p>
    <p>[0417] 'EB' 第五签名的标签</p>
    <p>[0418] 'FFXXXX'第五签名的长度</p>
    <p>[0419]'第五签名的结果'</p>
    <p>[0420] 'SW1-SW2'状态字</p>
    <p>[0421 ] 其中，状态字表示USB Key接收步骤S4004中服务端发送的第一会话ID、第四密文</p>
    <p>21M4、第四签名S4是否成功；</p>
    <p>[0422] 步骤S4009,服务端对第五签名S5进行验证，如果合法，执行步骤S4010，否则，执 行步骤S4011 ;</p>
    <p>[0423] 在本实施例步骤S4009结束后还可以包括，第二随机数增加一个步长，其中步长 可以为1或USB Key与服务端预先约定的值。 [0424]     步骤S4010，服务端处理交易数据； [0425] 步骤S4011，提示错误，禁止操作。</p>
    <p>[0426] 在本实施例中，服务端和客户端传输的数据可以通过普通信道进行，也可以通过 安全信道进行，如SSL。</p>
    <p>[0427]     本实施例中的服务端和USB Key通过双向认证，可以确保服务端和USB Key均为</p>
    <p>合法设备，同时，通过对认证过程和会话过程中的数据进行签名和加密操作，以及对接收到</p>
    <p>的数据进行解密和签名验证操作，使服务端和USB Key均能够验证出接收到的数据是否合</p>
    <p>法；以及利用会话密钥对签名指令进行加/解密操作，防止了黑客利用劫持的数据要求USB</p>
    <p>Key进行签名操作，增加了系统的安全性，有效地制约了黑客对服务器的重放攻击，确保网</p>
    <p>上银行交易的顺利进行，更好地维护了用户的利益。</p>
    <p>[0428] 根据本发明的实施例，提供了一种网上安全交易系统。</p>
    <p>[0429] 如图6本发明实施例的网上安全交易系统的结构框图。如图6所示，该网上安全 交易系统包括：智能密钥设备300、客户端设备400和服务器500，其中，智能密钥设备300 包括：</p>
    <p>[0430] 第一接口模块301，用于连接客户端设备400，通过客户端设备400与服务器500 进行信息交互；</p>
    <p>[0431] 第一认证模块302，用于根据服务器500发送的认证信息认证服务器500的合法 性；</p>
    <p>[0432]     第一会话模块303，用于接收到服务器500发送的签名指令和第四签名后，验证第</p>
    <p>四签名是否合法，第四签名合法后，按照签名指令对用户输入的操作数据签名得到签名结</p>
    <p>果，对包含签名结果的签名信息进行签名得到第五签名，并将第五签名通过第一接口模块</p>
    <p>301返回给服务器500 ;</p>
    <p>[0433] 客户端设备400包括：</p>
    <p>[0434] 中转模块401，用于将智能密钥设备300发送的信息转发给服务器500，以及将服 务器500发送的信息转发给智能密钥设备300 ;</p>
    <p>[0435] 操作数据处理模块402，用于接收用户输入的操作数据，以及将操作数据转发给服 务器500 ;</p>
    <p>[0436]     服务器500包括：</p>
    <p>[0437] 第二接口模块501，用于连接客户端设备400，通过客户端设备400与智能密钥设 备300进行信息交互；</p>
    <p>[0438] 第二认证模块502，用于根据智能密钥设备300发送的认证信息认证智能密钥设 备300的合法性;</p>
    <p>[0439] 第二会话模块503，用于服务器500和智能密钥设备300均被认证为合法设备后， 将用户输入的操作数据整合为签名指令，并对包含签名指令的签名信息进行签名得到第四</p>
    <p>22签名，将签名指令和第四签名发送给智能密钥设备300 ;以及验证智能密钥设备300发送的</p>
    <p>第五签名是否合法，第五签名合法后，处理用户输入的操作数据。</p>
    <p>[0440]     优选的，第一认证模块302包括：</p>
    <p>[0441]     第一会话号生成单元，用于生成第一会话号；</p>
    <p>[0442]     第一随机数生成单元，用于生成第一随机数；</p>
    <p>[0443] 第一认证单元，用于将第一会话号生成单元生成的第一会话号、第一随机数生成单元生成的第一随机数、智能密钥设备300标识码打包得到第一数据包，使用服务器500公钥对第一数据包加密得到第一密文，并对第一数据包进行签名得到第一签名，将第一密文和第一签名通过第一接口模块301转发给服务器500 ;</p>
    <p>[0444] 以及用于使用智能密钥设备300私钥对第一接口模块301接收的第二密文解密得到第二数据包，第二数据包包括服务器500生成的第二会话号、第二随机数、第一随机数和服务器500认证码，并对第一接口模块301接收的第二签名、第二数据包中的第一随机数、服务器500的认证码进行验证，如果全部合法，服务器500为合法设备；将第二会话号和第二随机数打包得到第三数据包，并使用服务器500公钥对第三数据包进行加密得到第三密文，对第三数据包签名得到第三签名，将第三密文和第三签名通过第一接口模块301转发给服务器500 ;</p>
    <p>[0445]     第二认证模块502包括：</p>
    <p>[0446] 第二会话号生成单元，用于生成第二会话号；[0447]     第二随机数生成单元，用于生成第二随机数；</p>
    <p>[0448] 第二认证单元，用于使用服务器500私钥对第二接口模块501接收的第一密文进行解密得到第一数据包，验证第一签名和第一数据包中的智能密钥设备300标识码，如果全部合法，智能密钥设备300为合法设备，则将第二会话号生成单元生成的第二会话号、第二随机数生成单元生成的第二随机数、第一数据包中的第一随机数、服务器500的认证码打包得到第二数据包，使用智能密钥设备300公钥对第二数据包加密得到第二密文，并对第二数据包进行签名得到第二签名，将第二密文、第二签名通过第二接口模块501转发给智能密钥设备300 ;</p>
    <p>[0449] 以及用于使用服务器500私钥对第二接口模块501接收的第三密文进行解密得到第三数据包，对第三数据包中的第三签名、第二会话号和第二随机数进行验证，如果全部合法，则认证成功，提示用户进行输入操作。</p>
    <p>[0450] 优选的，第二会话模块503中的对包含签名指令的签名信息进行签名得到第四签名是通过以下方式得到的：</p>
    <p>[0451] 将第一随机数增加第一预设步长，对签名指令和增加第一预设步长后的第一随机数打包，对打包后的数据进行签名得到第四签名；</p>
    <p>[0452] 第一会话模块303中的对包含签名结果的签名信息进行签名得到第五签名是通过以下方式得到的：</p>
    <p>[0453] 将第二随机数增加第二预设步长，将签名结果和增加第二预设步长的第二随机数打包得到第五数据包，对第五数据包进行签名得到第五签名。</p>
    <p>[0454] 其中，第一预设步长和第二预设步长可以是服务器500和智能密钥设备300预先设定的数值。[0455] 为了进一步增强信息交互的安全性，可以对上述服务器整合后的签名指令进行加</p>
    <p>密得到密文形式的签名指令，至少可以通过以下两种方式实现：</p>
    <p>[0456] 第一种方式</p>
    <p>[0457]     服务器500还包括：</p>
    <p>[0458] 会话密钥生成模块，用于第二认证模块502认证成功时，生成会话密钥，并将会话密钥发给智能密钥设备300 ;</p>
    <p>[0459] 相应地，第二会话模块503还用于将操作数据整合为签名指令之后，使用会话密钥对签名指令进行加密得到密文形式的签名指令；</p>
    <p>[0460]     相应地，第一会话模块303还用于接收到签名指令之后，使用会话密钥对密文形</p>
    <p>式的签名指令解密，得到明文形式的签名指令。</p>
    <p>[0461] 第二种方式</p>
    <p>[0462]     智能密钥设备300还包括：</p>
    <p>[0463] 第一存储模块，用于存储会话密钥表，该会话密钥表包括会话密钥标签和与会话密钥标签对应的会话密钥；[0464]      服务器500还包括：</p>
    <p>[0465]      第二存储模块，用于存储上述会话密钥表；</p>
    <p>[0466] 会话密钥选择模块，用于从第二存储模块中存储的会话密钥表中选择会话密钥，并将会话密钥对应的会话密钥标签发送给智能密钥设备300 ;</p>
    <p>[0467]     相应地，第二会话模块503还用于将操作数据整合为签名指令后，使用会话密钥</p>
    <p>选择模块选择的会话密钥对签名指令进行加密得到密文形式的签名指令；</p>
    <p>[0468]     相应地，智能密钥设备300中的第一会话模块303还用于接收到签名指令后，根据</p>
    <p>接收的会话密钥标签在第一存储模块存储的会话密钥表中查找对应的会话密钥，使用查到</p>
    <p>的会话密钥对密文形式的签名指令解密，得到明文形式的签名指令。</p>
    <p>[0469] 上述智能密钥设备300可以以USB Key为例，该网上安全交易系统可以用在用户通过USB Key进行网上银行交易系统中，其中，USB Key内部写入一个唯一的标识码，用作对USB Key的合法性的认证，并且该USB Key内存储有一个服务器500的认证码，利用该服务器500的认证码可以判断服务器500的合法性，同时，合法的服务器500上保存有USB Key的唯一标识码，用以服务器500认证USB Key的合法性。</p>
    <p>[0470] 本实施例通过服务器500和智能密钥设备300的双向认证，可以确保服务器500和智能密钥设备300均为合法设备，同时，通过对认证过程和会话过程中的数据进行签名和加密操作，以及对接收到的数据进行解密和签名验证操作，使服务器和智能密钥设备均能够验证出接收到的数据是否合法，防止了黑客利用劫持的数据进行非法操作，增加了系统的安全性，有效地制约了黑客对服务器500的重放攻击，确保网上交易的顺利进行，更好地维护了用户的利益。</p>
    <p>[0471] 在本发明所提供的实施例中，所提供的各种数据格式仅为最优情况，在实际的使用中并不一定严格按照上述提供的数据格式实施，数据格式以及指令形式均可以进行协定的变化，只要服务端、客户端、USB Key可以达成一致即可，在实际当中可能有多种的数据格式，只要按照本发明所提供的方法以及通过本发明所提供的方法进行的没有创造性的变换进行的实施均应该属于本发明的保护范围。[0472] 需要说明的是，在附图的流程图示出的步骤可以在诸如一组计算机可执行指令的计算机系统中执行，并且，虽然在流程图中示出了逻辑顺序，但是在某些情况下，可以以不同于此处的顺序执行所示出或描述的步骤。</p>
    <p>[0473] 显然，本领域的技术人员应该明白，上述的本发明的各模块或各步骤可以用通用的计算装置来实现，它们可以集中在单个的计算装置上，或者分布在多个计算装置所组成的网络上，可选地，它们可以用计算装置可执行的程序代码来实现，从而，可以将它们存储在存储装置中由计算装置来执行，或者将它们分别制作成各个集成电路模块，或者将它们中的多个模块或步骤制作成单个集成电路模块来实现。这样，本发明不限制于任何特定的硬件和软件结合。</p>
    <p>[0474] 以上所述仅为本发明的优选实施例而已，并不用于限制本发明，对于本领域的技术人员来说，本发明可以有各种更改和变化。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。</p>
    <p>25</p>
  </div>
  </div></div><div class="patent-section patent-tabular-section"><a id="forward-citations"></a><div class="patent-section-header"><span class="patent-section-title"> 被以下专利引用</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th">引用专利</th><th class="patent-data-table-th"> 申请日期</th><th class="patent-data-table-th">公开日</th><th class="patent-data-table-th"> 申请人</th><th class="patent-data-table-th">专利名</th></tr></thead><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102752311A?cl=zh">CN102752311A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2012年7月16日</td><td class="patent-data-table-td patent-date-value">2012年10月24日</td><td class="patent-data-table-td ">天地融科技股份有限公司</td><td class="patent-data-table-td ">一种认证方法、系统和装置</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102790678A?cl=zh">CN102790678A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2012年7月11日</td><td class="patent-data-table-td patent-date-value">2012年11月21日</td><td class="patent-data-table-td ">飞天诚信科技股份有限公司</td><td class="patent-data-table-td ">一种认证方法及系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102790678B?cl=zh">CN102790678B</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2012年7月11日</td><td class="patent-data-table-td patent-date-value">2015年1月14日</td><td class="patent-data-table-td ">飞天诚信科技股份有限公司</td><td class="patent-data-table-td ">一种认证方法及系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102904883A?cl=zh">CN102904883A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2012年9月25日</td><td class="patent-data-table-td patent-date-value">2013年1月30日</td><td class="patent-data-table-td ">上海交通大学</td><td class="patent-data-table-td ">在线交易系统的中间人攻击防御方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN102904883B?cl=zh">CN102904883B</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2012年9月25日</td><td class="patent-data-table-td patent-date-value">2015年7月8日</td><td class="patent-data-table-td ">上海交通大学</td><td class="patent-data-table-td ">在线交易系统的中间人攻击防御方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN103095669A?cl=zh">CN103095669A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2011年11月8日</td><td class="patent-data-table-td patent-date-value">2013年5月8日</td><td class="patent-data-table-td ">联想(北京)有限公司</td><td class="patent-data-table-td ">一种建立连接的方法、装置及设备</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN103326862A?cl=zh">CN103326862A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2013年6月20日</td><td class="patent-data-table-td patent-date-value">2013年9月25日</td><td class="patent-data-table-td ">天地融科技股份有限公司</td><td class="patent-data-table-td ">电子签名方法及系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN103441854A?cl=zh">CN103441854A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2013年8月27日</td><td class="patent-data-table-td patent-date-value">2013年12月11日</td><td class="patent-data-table-td ">深圳市文鼎创数据科技有限公司</td><td class="patent-data-table-td ">链路保护方法及系统</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN103517273A?cl=zh">CN103517273A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2013年10月9日</td><td class="patent-data-table-td patent-date-value">2014年1月15日</td><td class="patent-data-table-td ">中国联合网络通信集团有限公司</td><td class="patent-data-table-td ">认证方法、管理平台和物联网设备</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN103544777A?cl=zh">CN103544777A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2013年11月6日</td><td class="patent-data-table-td patent-date-value">2014年1月29日</td><td class="patent-data-table-td ">广州森锐电子科技有限公司</td><td class="patent-data-table-td ">一种远程自动售卡系统及售卡方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN103559013A?cl=zh">CN103559013A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2013年11月4日</td><td class="patent-data-table-td patent-date-value">2014年2月5日</td><td class="patent-data-table-td ">北京旋极信息技术股份有限公司</td><td class="patent-data-table-td ">一种电子签名设备及其指令处理方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2015161694A1?cl=zh">WO2015161694A1</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2015年1月26日</td><td class="patent-data-table-td patent-date-value">2015年10月29日</td><td class="patent-data-table-td ">天地融科技股份有限公司</td><td class="patent-data-table-td ">数据安全交互方法和系统</td></tr></table><div class="patent-section-footer">* 由审查员引用</div></div><div class="patent-section patent-tabular-section"><a id="classifications"></a><div class="patent-section-header"><span class="patent-section-title">分类</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th"> </th><th class="patent-data-table-th"> </th></tr></thead><tr><td class="patent-data-table-td ">国际分类号</td><td class="patent-data-table-td "><span class="nested-value"><a href="https://www.google.com/url?id=Ac9_BwABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=G06Q0040040000">G06Q40/04</a></span>, <span class="nested-value"><a href="https://www.google.com/url?id=Ac9_BwABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=H04L0029060000">H04L29/06</a></span>, <span class="nested-value"><a href="https://www.google.com/url?id=Ac9_BwABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=H04L0009080000">H04L9/08</a></span>, <span class="nested-value"><a href="https://www.google.com/url?id=Ac9_BwABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=H04L0009320000">H04L9/32</a></span></td></tr></table><div class="patent-section-footer"></div></div><div class="patent-section patent-tabular-section"><a id="legal-events"></a><div class="patent-section-header"><span class="patent-section-title">法律事件</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th"> 日期</th><th class="patent-data-table-th">代码</th><th class="patent-data-table-th">事件</th><th class="patent-data-table-th">说明</th></tr></thead><tr><td class="patent-data-table-td patent-date-value">2010年7月28日</td><td class="patent-data-table-td ">C06</td><td class="patent-data-table-td ">Publication</td><td class="patent-data-table-td "></td></tr><tr><td class="patent-data-table-td patent-date-value">2010年9月22日</td><td class="patent-data-table-td ">C10</td><td class="patent-data-table-td ">Request of examination as to substance</td><td class="patent-data-table-td "></td></tr><tr><td class="patent-data-table-td patent-date-value">2012年9月5日</td><td class="patent-data-table-td ">C14</td><td class="patent-data-table-td ">Granted</td><td class="patent-data-table-td "></td></tr></table><div class="patent-section-footer"></div></div><div class="modal-dialog" id="patent-images-lightbox"><div class="patent-lightbox-controls"><div class="patent-lightbox-rotate-controls"><div class="patent-lightbox-rotation-text">旋转</div><div class="rotate-icon rotate-ccw-icon"></div><div class="rotate-icon rotate-cw-icon"></div></div><div class="patent-lightbox-index-counter"></div><a class="patent-lightbox-fullsize-link" target="_blank">原始图片</a><div class="patent-drawings-control patent-drawings-next"><img class="patent-drawings-button-img"src="/googlebooks/images/kennedy/page_right.png" alt="Next page"width="21" height="21" /></div><div class="patent-drawings-control patent-drawings-prev"><img class="patent-drawings-button-img"src="/googlebooks/images/kennedy/page_left.png" alt="Previous page"width="21" height="21" /></div></div><div class="modal-dialog-content"><div class="patent-lightbox-image-holder"><div class="patent-lightbox-placeholder"></div></div></div></div><script>_OC_initPatentsAtb({image_not_available_html: " 未提供图片。\x3ca href\x3d//docs.google.com/viewer?url\x3dpatentimages.storage.googleapis.com/pdfs/69c25541a903c8ebb40b/CN101789934A.pdf\x3e查看 PDF\x3c/a\x3e"});</script></div></div></div></div></div><script>(function() {var href = window.location.href;if (href.indexOf('?') !== -1) {var parameters = href.split('?')[1].split('&');for (var i = 0; i < parameters.length; i++) {var param = parameters[i].split('=');if (param[0] == 'focus') {var elem = document.getElementById(param[1]);if (elem) {elem.focus();}}}}})();</script><script>_OC_addFlags({LockSrc:"/books/javascript/lock_6e802a6b2b28d51711baddc2f3bec198.js", Host:"https://www.google.com/", IsBooksRentalEnabled:1, IsBrowsingHistoryEnabled:1, IsWebReaderSvgEnabled:0, IsImageModeNotesEnabled:1, IsOfflineBubbleEnabled:1, IsFutureOnSaleVolumesEnabled:1, IsBooksUnifiedLeftNavEnabled:1, IsMobileRequest:0, IsZipitFolderCollectionEnabled:1, IsAdsDisabled:0, IsEmbeddedMediaEnabled:1, IsImageModeAnnotationsEnabled:1, IsMyLibraryGooglePlusEnabled:1, IsImagePageProviderEnabled:1, IsBookcardListPriceSmall:0, IsInternalUser:0, IsBooksShareButtonEnabled:0, IsDisabledRandomBookshelves:0});_OC_Run({"enable_p13n":false,"is_cobrand":false,"sign_in_url":"https://www.google.com/accounts/Login?service=\u0026continue=https://www.google.com/patents%3Fcl%3Dzh%26hl%3Dzh-CN\u0026hl=zh-CN"}, {"volume_id":"","is_ebook":true,"volumeresult":{"has_flowing_text":false,"has_scanned_text":true,"can_download_pdf":false,"can_download_epub":false,"is_pdf_drm_enabled":false,"is_epub_drm_enabled":false,"download_pdf_url":"https://www.google.com/patents/download/%E7%BD%91%E4%B8%8A%E5%AE%89%E5%85%A8%E4%BA%A4%E6%98%93%E6%96%B9%E6%B3%95%E5%92%8C%E7%B3%BB%E7%BB%9F.pdf?id=Ac9_BwABERAJ\u0026hl=zh-CN\u0026output=pdf\u0026sig=ACfU3U1sAztAIBJRfRL7E7_I91s4WsX_Bg"},"sample_url":"https://www.google.com/patents/reader?id=Ac9_BwABERAJ\u0026hl=zh-CN\u0026printsec=frontcover\u0026output=reader\u0026source=gbs_atb_hover","is_browsable":true,"is_public_domain":true}, {});</script><div id="footer_table" style="font-size:83%;text-align:center;position:relative;top:20px;height:4.5em;margin-top:2em"><div style="margin-bottom:8px"><a href="https://www.google.com/search?hl=zh-CN"><nobr>Google&nbsp;首页</nobr></a> - <a href="//www.google.com/patents/sitemap/"><nobr>站点地图</nobr></a> - <a href="http://www.google.com/googlebooks/uspto.html"><nobr>美国专利商标局 (USPTO) 专利信息批量下载</nobr></a> - <a href="/intl/zh-CN/privacy/"><nobr>隐私权政策</nobr></a> - <a href="/intl/zh-CN/policies/terms/"><nobr>服务条款</nobr></a> - <a href="https://support.google.com/faqs/answer/2539193?hl=zh-CN"><nobr> 关于 Google 专利</nobr></a> - <a href="//www.google.com/tools/feedback/intl/zh-CN/error.html" onclick="try{_OC_startFeedback({productId: '72792',locale: 'zh-CN'});return false;}catch(e){}"><nobr>发送反馈</nobr></a></div></div> <script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">var pageTracker = _gat._getTracker("UA-27188110-1");pageTracker._setCookiePath("/patents/");pageTracker._trackPageview();</script> </body></html>