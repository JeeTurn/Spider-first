<!DOCTYPE html><html><head><title>专利 CN101430636A - 一种在冗余控制器环境下多路径管理的方法 -  Google 专利</title><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){var d=void 0!=b?b:(new Date).getTime();this.t[a]=[d,c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(e){}};this.tick("start",null,a)}var a;window.performance&&(a=window.performance.timing);var f=a?new e(a.responseStart):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_",
"_wtsrt",d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();})();
</script><link rel="stylesheet" href="/patents/css/_6e802a6b2b28d51711baddc2f3bec198/kl_intl_patents_bundle.css" type="text/css" /><script src="/books/javascript/atb_6e802a6b2b28d51711baddc2f3bec198__zh_cn.js"></script><script>function googleTranslateElementInit() {new google.translate.TranslateElement({pageLanguage: "zh",gaTrack: true,gaId: "UA-27188110-1",multilanguagePage: true});}</script><script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script><meta name="DC.type" content="Patent"><meta name="DC.title" content="一种在冗余控制器环境下多路径管理的方法"><meta name="DC.contributor" content="吉永光" scheme="inventor"><meta name="DC.contributor" content="周欣荣" scheme="inventor"><meta name="DC.contributor" content="王洪斌" scheme="inventor"><meta name="DC.contributor" content="陈韵霞" scheme="inventor"><meta name="DC.contributor" content="中兴通讯股份有限公司" scheme="assignee"><meta name="DC.date" content="2007-11-7" scheme="dateSubmitted"><meta name="DC.description" content="本发明公开了一种在冗余控制器环境下多路径管理的方法，用于磁盘阵列技术，其包括以下步骤：根据独立磁盘冗余阵列配置，以条带或多个条带为单位将逻辑盘分配给多个控制器访问；在主机端进行访问的时候根据各个控制器访问的逻辑盘地址范围将访问的I/O指令进行分解，分配给连接到两个控制器的路径。本发明方法用于实现在冗余控制器环境下多路径管理实现负载均衡的负载分配策略，该分配策略可将I/O负载分配到两个控制器上，实现同时对一个逻辑盘访问，其实现简单，提高了数据访问的性能。"><meta name="DC.date" content="2009-5-13"><meta name="citation_patent_publication_number" content="CN:101430636:A"><meta name="citation_patent_application_number" content="CN:200710124447"><link rel="canonical" href="https://www.google.com/patents/CN101430636A?cl=zh"/><meta property="og:url" content="https://www.google.com/patents/CN101430636A?cl=zh"/><meta name="title" content="专利 CN101430636A - 一种在冗余控制器环境下多路径管理的方法"/><meta name="description" content="本发明公开了一种在冗余控制器环境下多路径管理的方法，用于磁盘阵列技术，其包括以下步骤：根据独立磁盘冗余阵列配置，以条带或多个条带为单位将逻辑盘分配给多个控制器访问；在主机端进行访问的时候根据各个控制器访问的逻辑盘地址范围将访问的I/O指令进行分解，分配给连接到两个控制器的路径。本发明方法用于实现在冗余控制器环境下多路径管理实现负载均衡的负载分配策略，该分配策略可将I/O负载分配到两个控制器上，实现同时对一个逻辑盘访问，其实现简单，提高了数据访问的性能。"/><meta property="og:title" content="专利 CN101430636A - 一种在冗余控制器环境下多路径管理的方法"/><meta property="og:type" content="book"/><meta property="og:site_name" content="Google Books"/><meta property="og:image" content="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"/><link rel="image_src" href="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"/><script>if (window['_OC_timingAction']) {window['_OC_timingAction']('patents_refpage');}</script><style>#gbar,#guser{font-size:13px;padding-top:1px !important;}#gbar{height:22px}#guser{padding-bottom:7px !important;text-align:right}.gbh,.gbd{border-top:1px solid #c9d7f1;font-size:1px}.gbh{height:0;position:absolute;top:24px;width:100%}@media all{.gb1{height:22px;margin-right:.5em;vertical-align:top}#gbar{float:left}}a.gb1,a.gb4{text-decoration:underline !important}a.gb1,a.gb4{color:#00c !important}.gbi .gb4{color:#dd8e27 !important}.gbf .gb4{color:#900 !important}

#gbar { padding:.3em .6em !important;}</style></head><body ><div id=gbar><nobr><a class=gb1 href="https://www.google.com/search?cl=zh&hl=zh-CN&sa=N&tab=tw">搜索</a> <a class=gb1 href="https://www.google.com/search?cl=zh&hl=zh-CN&tbm=isch&source=og&sa=N&tab=ti">图片</a> <a class=gb1 href="https://maps.google.com/maps?cl=zh&hl=zh-CN&sa=N&tab=tl">地图</a> <a class=gb1 href="https://play.google.com/?cl=zh&hl=zh-CN&sa=N&tab=t8">Play</a> <a class=gb1 href="https://www.youtube.com/results?cl=zh&hl=zh-CN&sa=N&tab=t1">YouTube</a> <a class=gb1 href="https://news.google.com/nwshp?hl=zh-CN&tab=tn">新闻</a> <a class=gb1 href="https://mail.google.com/mail/?tab=tm">Gmail</a> <a class=gb1 href="https://drive.google.com/?tab=to">云端硬盘</a> <a class=gb1 style="text-decoration:none" href="https://www.google.com/intl/zh-CN/options/"><u>更多</u> &raquo;</a></nobr></div><div id=guser width=100%><nobr><span id=gbn class=gbi></span><span id=gbf class=gbf></span><span id=gbe></span><a target=_top id=gb_70 href="https://www.google.com/accounts/Login?service=&continue=https://www.google.com/patents%3Fcl%3Dzh%26hl%3Dzh-CN&hl=zh-CN" class=gb4>登录</a></nobr></div><div class=gbh style=left:0></div><div class=gbh style=right:0></div><div role="alert" style="position: absolute; left: 0; right: 0;"><a href="https://www.google.com/patents/CN101430636A?cl=zh&amp;hl=zh-CN&amp;output=html_text" title="屏幕阅读器用户请注意：点击此链接可进入无障碍模式。阅读器在无障碍模式下具有同样的基本功能，但可让用户获得更好的体验。"><img border="0" src="//www.google.com/images/cleardot.gif"alt="屏幕阅读器用户请注意：点击此链接可进入无障碍模式。阅读器在无障碍模式下具有同样的基本功能，但可让用户获得更好的体验。"></a></div><div class="kd-appbar"><h2 class="kd-appname"><a href="/patents?hl=zh-CN"> 专利</a></h2><div class="kd-buttonbar left" id="left-toolbar-buttons"><a id="appbar-write-review-link" href=""></a><a id="appbar-view-print-sample-link" href=""></a><a id="appbar-view-ebook-sample-link" href=""></a><a id="appbar-patents-prior-art-finder-link" href="https://www.google.com/patents/related/CN101430636A"></a><a id="appbar-patents-discuss-this-link" href="https://www.google.com/url?id=JrZpBwABERAJ&amp;q=http://patents.stackexchange.com/redirect/google-patents%3Fpublication%3DCN101430636A&amp;usg=AFQjCNGOXPau2GOh_NAqeyZUpCeNqzV95A" data-is-grant="false"></a><a id="appbar-read-patent-link" href="//docs.google.com/viewer?url=patentimages.storage.googleapis.com/pdfs/2a1b3ca9fe17f4b7a5d6/CN101430636A.pdf"></a><a id="appbar-download-pdf-link" href="//patentimages.storage.googleapis.com/pdfs/2a1b3ca9fe17f4b7a5d6/CN101430636A.pdf"></a><a class="appbar-content-language-link" data-selected="true" data-label="中文" href="/patents/CN101430636A?cl=zh&amp;hl=zh-CN"></a><a class="appbar-content-language-link" data-label="英语" href="/patents/CN101430636A?cl=en&amp;hl=zh-CN"></a><a class="appbar-application-grant-link" data-selected="true" data-label="申请" href="/patents/CN101430636A?hl=zh-CN&amp;cl=zh"></a><a class="appbar-application-grant-link" data-label="授权" href="/patents/CN101430636B?hl=zh-CN&amp;cl=zh"></a></div><div class="kd-buttonbar right" id="right-toolbar-buttons"></div></div><div id="books-microdata" itemscope=""itemtype="http://schema.org/Book"itemid="https://www.google.com/patents/CN101430636A?cl=zh" style="display:none"><span itemprop="description">本发明公开了一种在冗余控制器环境下多路径管理的方法，用于磁盘阵列技术，其包括以下步骤：根据独立磁盘冗余阵列配置，以条带或多个条带为单位将逻辑盘分配给多个控制器访问；在主机端进行访问的时候根据各个控制器...</span><span itemprop="url">https://www.google.com/patents/CN101430636A?cl=zh&amp;utm_source=gb-gplus-share</span><span class="main-title" itemprop="name">专利 CN101430636A - 一种在冗余控制器环境下多路径管理的方法</span><img itemprop="image" src="https://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"alt="专利 CN101430636A - 一种在冗余控制器环境下多路径管理的方法" title="专利 CN101430636A - 一种在冗余控制器环境下多路径管理的方法"></div><div style="display: none"><ol id="ofe-gear-menu-contents" class="gbmcc"><li class="gbe gbmtc"><a class="gbmt goog-menuitem-content" id="" href="https://www.google.com/advanced_patent_search?hl=zh-CN"> 高级专利搜索</a></li></ol></div><div id="volume-main"><div id="volume-center"><div class=vertical_module_list_row><div id=intl_patents class=about_content><div id=intl_patents_v><table class="patent-bibdata patent-drawings-missing"><tr><td class="patent-bibdata-heading"> 公开号</td><td class="single-patent-bibdata">CN101430636 A</td></tr><tr><td class="patent-bibdata-heading">发布类型</td><td class="single-patent-bibdata">申请</td></tr><tr><td class="patent-bibdata-heading"> 专利申请号</td><td class="single-patent-bibdata">CN 200710124447</td></tr><tr><td class="patent-bibdata-heading">公开日</td><td class="single-patent-bibdata">2009年5月13日</td></tr><tr><td class="patent-bibdata-heading"> 申请日期</td><td class="single-patent-bibdata">2007年11月7日</td></tr><tr><td class="patent-bibdata-heading"> 优先权日<span class="patent-tooltip-anchor patent-question-icon"data-tooltip-text="优先日期属于假设性质，不具任何法律效力。Google 对于所列日期的正确性并没有进行法律分析，也不作任何陈述。"></span></td><td class="single-patent-bibdata">2007年11月7日</td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">公告号</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="/patents/CN101430636B?hl=zh-CN&amp;cl=zh">CN101430636B</a></span></span></td></tr><tr class="patent-bibdata-list-row alternate-patent-number"><td class="patent-bibdata-heading"> 公开号</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value">200710124447.X, </span><span class="patent-bibdata-value">CN 101430636 A, </span><span class="patent-bibdata-value">CN 101430636A, </span><span class="patent-bibdata-value">CN 200710124447, </span><span class="patent-bibdata-value">CN-A-101430636, </span><span class="patent-bibdata-value">CN101430636 A, </span><span class="patent-bibdata-value">CN101430636A, </span><span class="patent-bibdata-value">CN200710124447, </span><span class="patent-bibdata-value">CN200710124447.X</span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading"> 发明者</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E5%90%89%E6%B0%B8%E5%85%89%22">吉永光</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E5%91%A8%E6%AC%A3%E8%8D%A3%22">周欣荣</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E7%8E%8B%E6%B4%AA%E6%96%8C%22">王洪斌</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=ininventor:%22%E9%99%88%E9%9F%B5%E9%9C%9E%22">陈韵霞</a></span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading"> 申请人</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="https://www.google.com/search?tbo=p&amp;tbm=pts&amp;hl=en&amp;q=inassignee:%22%E4%B8%AD%E5%85%B4%E9%80%9A%E8%AE%AF%E8%82%A1%E4%BB%BD%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8%22">中兴通讯股份有限公司</a></span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">导出引文</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="/patents/CN101430636A.bibtex?cl=zh">BiBTeX</a>, </span><span class="patent-bibdata-value"><a href="/patents/CN101430636A.enw?cl=zh">EndNote</a>, </span><span class="patent-bibdata-value"><a href="/patents/CN101430636A.ris?cl=zh">RefMan</a></span></span></td></tr><tr class="patent-internal-links"><td colspan=2><span class="patent-bibdata-value"><a href="#forward-citations"> 被以下专利引用</a> (2),</span> <span class="patent-bibdata-value"><a href="#classifications">分类</a> (1),</span> <span class="patent-bibdata-value"><a href="#legal-events">法律事件</a> (3)</span> </td></tr><tr><td colspan=2 class="patent-bibdata-external-link-spacer-top"></td></tr><tr class="patent-bibdata-external-link-spacer-bottom"></tr><tr><td colspan=2><span class="patent-bibdata-heading">外部链接:&nbsp;</span><span><span class="patent-bibdata-value"><a href="https://www.google.com/url?id=JrZpBwABERAJ&amp;q=http://211.157.104.87:8080/sipo/zljs/hyjs-yx-new.jsp%3Frecid%3D200710124447&amp;usg=AFQjCNFCQo2ZJw020qBpqZgNsdRrrSmLsw"> 中国国家知识产权局</a>, </span><span class="patent-bibdata-value"><a href="https://www.google.com/url?id=JrZpBwABERAJ&amp;q=http://worldwide.espacenet.com/publicationDetails/biblio%3FCC%3DCN%26NR%3D101430636A%26KC%3DA%26FT%3DD&amp;usg=AFQjCNHBOx_0HBqZVueR6nZU5OjEkE9GwA"> 欧洲专利数据库 (Espacenet)</a></span></span></td></tr><tr class="patent-bibdata-group-spacer"></tr></table><div class="number-and-title"><span class="patent-title"><invention-title mxw-id="PT75693749" lang="ZH" load-source="patent-office">一种在冗余控制器环境下多路径管理的方法</invention-title>
      </span><br><span class="patent-number">CN 101430636 A</span></div><div class="patent-section patent-abstract-section"><div class="patent-section-header"><span class="patent-section-title"> 摘要</span></div><div class="patent-text"><abstract mxw-id="PA53448750" lang="ZH" load-source="patent-office">
    <div class="abstract">本发明公开了一种在冗余控制器环境下多路径管理的方法，用于磁盘阵列技术，其包括以下步骤：根据独立磁盘冗余阵列配置，以条带或多个条带为单位将逻辑盘分配给多个控制器访问；在主机端进行访问的时候根据各个控制器访问的逻辑盘地址范围将访问的I/O指令进行分解，分配给连接到两个控制器的路径。本发明方法用于实现在冗余控制器环境下多路径管理实现负载均衡的负载分配策略，该分配策略可将I/O负载分配到两个控制器上，实现同时对一个逻辑盘访问，其实现简单，提高了数据访问的性能。</div>
  </abstract>
  </div></div><div class="patent-section patent-claims-section"><div class="patent-section-header"><span class="patent-section-title">权利要求<span class="patent-section-count">(9)</span></span></div><div class="patent-text"><div mxw-id="PCLM13453432" lang="ZH" load-source="patent-office" class="claims">
    <div class="claim"> <div num="1" class="claim">
      <div class="claim-text">1、一种在冗余控制器环境下多路径管理的方法，其包括以下步骤：</div>
    </div>
    </div> <div class="claim-dependent"> <div num="2" class="claim">
      <div class="claim-text">2、 根据权利要求1所述的方法，其特征在于，所述步骤B中还包括： 磁盘阵列端告诉主^几端如何分配。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="3" class="claim">
      <div class="claim-text">3、 根据权利要求2所述的方法，其特征在于，所述步骤B还包括： Bl、所述主机端根据地址分配表和路径对应表，将产生的I/O指令根据地址分配表，分解为多个I/0指令；B2、将多个I/O指令分配到对应的控制器所属的路径。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="4" class="claim">
      <div class="claim-text">4、 根据权利要求3所述的方法，其特征在于，所述主机端地址分配 表用于存放主机端访问设备时的地址分配范围，为 一段连续的地址范围； 其对应的控制器表示该地址范围所属的控制器。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="5" class="claim">
      <div class="claim-text">5、 根据权利要求3所述的方法，其特征在于，所述主机端路径分配 表用于保存主机连接到磁盘阵列的所有路径分布到各个控制器的情况，其 路径表示磁盘阵列连接到主机的路径，其对应的控制器表示该路径连接的控制器。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="6" class="claim">
      <div class="claim-text">6、 根据权利要求3所述的方法，其特征在于，所述磁盘阵列端还设 置有地址分配表用于存放磁盘阵列访问逻辑盘时地址的地址分配范围，为 一段连续的地址范围，其对应的控制器表示该地址范围所属的控制器。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="7" class="claim">
      <div class="claim-text">7、 根据权利要求4、 5或6所述的方法，其特征在于，在所述主机 端及所述磁盘阵列端设置一多路径管理软件，该多路径管理软件包括：主 机端管理部分和磁盘阵列端管理部分；所述主机端管理部分运行在主机端， 用于主机端多路径管理；所述磁盘阵列端管理部分运行在磁盘阵列端，用 于磁盘阵列端多路径管理。</div>
    </div>
    </div> <div class="claim-dependent"> <div num="8" class="claim">
      <div class="claim-text">8、 根据权利要求7所述的方法，其特征在于，所述主机端管理部分 还用于在主机端将主机识别到的多个相同设备虚拟为单个设备提供给用户 访问。 '</div>
    </div>
    </div> <div class="claim-dependent"> <div num="9" class="claim">
      <div class="claim-text">9、 根据权利要求7所述的方法，其特征在于，所述磁盘阵列端管理 部分还用于对逻辑盘访问的管理，当有主机独立连接到某一控制器对该逻 辑盘进行访问时，查询正在访问该逻辑盘的主机是否与待访问的主机使用 相同的地址分配情况访问该逻辑盘，如果不是，则禁止该主机的访问，直 到正在访问逻辑盘的主机访问结束后再允许该主机进行访问。</div>
    </div>
  </div> </div>
  </div></div><div class="patent-section patent-description-section"><div class="patent-section-header"><span class="patent-section-title"> 说明</span></div><div class="patent-text"><div mxw-id="PDES18840445" lang="ZH" load-source="patent-office" class="description">
    <p>一种在冗余控制器环境下多路径管理的方法</p>
    <p>技术领域</p>
    <p>本发明涉及一种磁盘阵列技术，尤其涉及的是一种在冗余控制器环境 下实现多路径输入/输出的方法，用于支持在冗余控制器环境下的多条路径 实现负载均衡。</p>
    <p>背景技术</p>
    <p>用户希望磁盘阵列具有高可靠性的同时也希望磁盘阵列具有更高的性 能。多路径输入/输出管理为磁盘阵列提供了路径保护，当一条路径失效时 其它路径仍然可以正常工作，不影响对^磁盘阵列的访问。</p>
    <p>为了能够充分利用多条路径的资源，将对磁盘阵列访问的负载分摊到 这多条路径上，实现负载均衡的功能。当多条路径传输的负载都到达磁盘</p>
    <p>阵列后，磁盘阵列端单个控制器的处理能力限制了对I/O指令的快速响应。 因此在冗余控制器环境下考虑将到达磁盘阵列端的I/O指令分配到多个控</p>
    <p>制器上处理。</p>
    <p>如图1所示，为现有技术的磁盘阵列访问技术，磁盘阵列101通常包 含一堆磁盘102和一个或者多个控制器103，每个控制器控制对每个磁盘的 访问。每个控制器有单独的通道104或者多个控制器共用多个通道，主机 105通过HBA ( Host Bus Adapter,主机总线适配器）卡106连接到这些通 道实现对》兹盘阵列中》兹盘的访问。</p>
    <p>以下以两个控制及每个控制器使用单独的通道且每个控制器包含两个 通道为例进4于介绍。</p>
    <p>在不兹盘P车列中，RAID (Redundant Array of Independent Drives,独立磁 盘冗余阵列）技术将多个物理磁盘组合成一个逻辑盘。主机通过连接到磁盘阵列的通道，实现对逻辑盘的访问。RAID中使用条带（stripe)为单位 对数据进行管理，即磁盘上的数据被条带化。在RAID5配置中，每个条带 还包含条带中所有扇区的校验数据，如图2所示。</p>
    <p>所谓多路径输入/输出，指从同 一主机连接多条路径到磁盘阵列的多个 通道,.对相同逻辑盘进行访问。多路径输入/输出实现路径冗余、路径恢复 和负载均衡三个功能。路径冗余是指工作路径失效后将所有的数据切换到 可用的备用路径；路径恢复是指当工作路径恢复后，它自动重新承担数据 传输任务；负载均^f是指数据传输自动在工作路径中分担。</p>
    <p>现有技术中多路径的连接方法有两种，如图3A和图3B所示，其中， 一种是多条路径连接到同一个控制器的多个通道，如图3A所示；另一种是 多条路径连接到两个控制的多个通道，如图3B所示。</p>
    <p>以两条路径为例进行说明，在图3A中所示，多个磁盘配置为一个逻辑 盘30.1，主机105通过两片HBA卡106连接到控制器A103A的两个通道 104A访问该逻辑盘。图3B中，多个磁盘配置为一个逻辑盘301,主机通过 两片HBA卡106连接到控制器A103A的一个通道104A和控制器B103B 的一个通道104B访问该逻辑盘，与图3A不同的是，控制器连接到主机的 连线即所采用的控制器和通道不同。</p>
    <p>当指令从主机端到达磁盘阵列端后，磁盘阵列端需要对指令进行分解 后发送到各个磁盘，然后将指令执行返回的结果合并，再将指令结果返回 给主机。针对RAID3 、 RAID5和RAID6等RAID级别时，除了将指令分解 合并外还需要计算校验数据，且将校验数据写到磁盘。如果某块磁盘发生 故障，导致不能正常读写数据时，需要根据数据的校验信息计算完整的数 据。</p>
    <p>因此指令到达^f兹盘阵列后控制器需要完成指令分解、合并、计算校验 等一系列工作后才能返回指令执行结果。当多条路径连接到磁盘阵列时， 在磁盘端能够提供充分带宽的情况下，控制器的处理能力就成为瓶颈。如果将多条路径通过多个控制器连接，充分使用多个控制器的处理能力，将 能够提升磁盘阵列的性能。</p>
    <p>图3B所示的连接方法中，如果使用传统的方法实现负载均衡，将会引 起数据不一致。实现负载均衡的传统方法是主机端根据一定的策略将产生</p>
    <p>的i/o发送到两条路径，但不考虑磁盘阵列端对逻辑盘的操作情况，如轮循</p>
    <p>方法（循环给两条路径发送1/0)。</p>
    <p>当在图3B的连接方法中使用该方法访问RAID5的逻辑盘时，如果第 一条路径访问逻辑盘中条带O中的前两个扇区（D0和D1),第二条路径访 问逻辑盘中条带0的后两个扇区（D2和D3 ),且两个访问指令都是写操作。 在当前两个扇区的数据到达后，磁盘阵列控制器将读取后两个扇区的数据， 计算校验码，然后将校验码写回硬盘（P0和Pl)，当后两个扇区的数据到 达后将读取前两个扇区的数据计算校验码。</p>
    <p>在这种情况下，如果当控制器A读取后两个扇区为前两个扇区的数据 计算校验时，控制器B也正读取前两个扇区的旧数据对后两个扇区计算校 验码，.结果最后导致校-险码不正确，该条带数据出现不一致。因为控制器A 和控制器B单独访问逻辑盘，不能保证指令的顺序执行导致数据不一致或 者其它问题。</p>
    <p>美国专利US6675268的专利文献中提到了 一种方法解决多个主机通过 多个控制器上的多条路径访问相同逻辑盘的问题，该方法是通过变换逻辑 盘所属的控制器（只有逻辑盘所属的控制器可访问该逻辑盘）来维护多个 主机对同 一个逻辑盘的访问。将该方法使用到同 一个主机通过多个控制器 上的多条路径访问同一个逻辑盘，也能够维护数据的一致性。但由于每一 个时刻只能有一个控制器在工作，该种方法并不能充分利用控制器资源， 提高性能。</p>
    <p>因此，现有技术还有待于改进和发展。发明内容</p>
    <p>本发明的目的在于提供一种在冗余控制器环境下多路径管理的方法， 针对连接到两个控制器上的多条路径存在的问题，在冗余控制器环境下的</p>
    <p>多路径管理实现负载均衡功能，在主机端将对磁盘阵列访问的I/O指令进行 分配，'使磁盘阵列的两个控制器能共同处理来自主机的1/0指令。 本发明的技术方案包括：</p>
    <p>一种在冗余控制器环境下多路径管理的方法，其包括以下步骤：</p>
    <p>A、 根据独立磁盘冗余阵列配置，以条带或多个条带为单位将逻辑盘分 配给多个控制器访问；</p>
    <p>B、 在主机端进行访问的时候根据各个控制器访问的逻辑盘地址范围将 访问的1/0指令进行分解，分配给连接到两个控制器的路径。</p>
    <p>所述的方法，其中，所述步骤B中还包括：磁盘阵列端告诉主机端如 何分配。</p>
    <p>所述的方法，其中，所述步骤B还包括：</p>
    <p>Bl、所述主机端根据地址分配表和路径对应表，将产生的I/O指令根 据地址分配表，分解为多个I/0指令；</p>
    <p>B2、将多个I/O指令分配到对应的控制器所属的路径。</p>
    <p>所述的方法，其中，所述主机端地址分配表用于存放主机端访问设备 时的地址分配范围，为一段连续的地址范围；其对应的控制器表示该地址 范围所属的控制器。</p>
    <p>所述的方法，其中，所述主机端路径分配表用于保存主机连接到磁盘 阵列的所有路径分布到各个控制器的情况，其路径表示磁盘阵列连接到主 机的路径，其对应的控制器表示该路径连接的控制器。</p>
    <p>所述的方法，其中，所述磁盘阵列端还设置有地址分配表用于存放磁 盘阵列访问逻辑盘时地址的地址分配范围，为一段连续的地址范围，其对 应的控制器表示该地址范围所属的控制器。所述的方法，其中，在所述主机端及所述^兹盘阵列端设置一多路径管</p>
    <p>理软件，该多路径管理软件包括：主机端管理部分和磁盘阵列端管理部分； 所述主机端管理部分运4亍在主机端，用于主才几端多^各径管理；所述》兹盘阵 列端管理部分运行在磁盘阵列端，用于磁盘阵列端多路径管理。</p>
    <p>所述的方法，其中，所述主机端管理部分还用于在主机端将主机识别 到的多个相同设备虚拟为单个设备提供给用户访问。</p>
    <p>所述的方法，其中，所述^f兹盘阵列端管理部分还用于对逻辑盘访问的 管理，当有主机独立连接到某一控制器对该逻辑盘进行访问时，查询正在 访问该逻辑盘的主机是否与待访问的主机使用相同的地址分配情况访问该 逻辑盘，如果不是，则禁止该主机的访问，直到正在访问逻辑盘的主机访 问结束后再允许该主才几进行访问。</p>
    <p>本发明所提供的 一 种在冗余控制器环境下多路径管理的方法，用于实 现在冗余控制器环境下多路径管理实现负载均衡的负载分配策略，该分配 策略可将I/0负载分配到两个控制器上，实现同时对一个逻辑盘访问，其实 现简单，提高了数据访问的性能。</p>
    <p>附图说明 图l是现有技术的磁盘阵列与主机连接示意图； 图2是现有技术的RAID5配置示意图；</p>
    <p>图3A和图3B为现有技术的磁盘阵列与主机使用多条路径连接图；</p>
    <p>图4是本发明方法主机端地址分配表结构图；</p>
    <p>图5是本发明方法主机端路径对应表结构图；</p>
    <p>图6是本发明方法的磁盘阵列端地址分配表结构图；</p>
    <p>图7是本发明方法的多路径管理软件模块图。</p>
    <p>具体实施方式卞面结合附图，将对本发明的在冗余控制器环境下多路径管理实现负 载均衡的方法进行详细说明。</p>
    <p>本发明在冗余控制器环境下多路径管理的方法，在RAID配置中，数 据是以条带为单位进行处理的，而两个控制器同时对同 一个条带访问会引 起数据不一致及其它问题。针对RAID配置的特点，本发明提出以条带或 者多个条带为单位将逻辑盘中的各部分访问权限分配到各个控制器，如现 有技术的图2 (RAID5配置）中所示，将条带0和条带2分配给控制器A、 条带1和条带3分配给控制器B。在主机端进行访问的时候根据各个控制 器访问的范围将访问的I/O指令进行分解，分配给连接到两个控制器的路 径，而磁盘阵列端所做的工作是告诉主机端该如何分配。</p>
    <p>本发明方法的提供地址分配策略包括，根据RAID的条带分配和条带 或者多个条带为单位将逻辑盘分配给两个控制器访问。如图2中所示三块 磁盘通过RAID配置形成一个逻辑盘，作支设该逻辑盘容量为1GB,按照字 节进行编址，即虚拟地址范围为0-1023。将条带0和条带2分配给控制器 A访问，条带1和条带3分配给控制器B访问。</p>
    <p>磁盘阵列端将逻辑盘的虚拟地址分配为四部分，对应的分配结果为， 地址0-255和512-767属于控制器A,地址256-511和768-1023属于控制器 B,并将分配结果保存到磁盘阵列端地址分配表中。地址范围分配给各个控 制器的比例可以参考各个控制器连接到主机的路径数，在这里可进行平均 分配。分配工作是由主机端来完成的，不影响其它想通过单个控制器访问 该逻辑盘的主机的访问。</p>
    <p>主机端连接到磁盘阵列访问逻辑盘时，主机端生成一个可访问的设备。 在这里假设主机访问该设备的虚拟地址刚好与磁盘阵列访问逻辑盘的虚拟 地址对应即主机端产生一个读指令，起始地址为O,读取长度为n,传送到 磁盘阵列后，磁盘阵列形成访问逻辑盘的读指令，起始地址也为0，读取长 度也为n。主机端根据磁盘阵列端的地址分配情况，也将访问的地址范围分配到 控制器A和控制器B。如果两个控制器分别对应一条或者多条路径，则地</p>
    <p>址0-255和512-767属于控制器A;地址256-511和768-1023属于控制器B。 在主机只连接到磁盘阵列单个控制器上路径的情况下，地址0-1023都将属 于该控制器。</p>
    <p>本发明还提供I/0指令分解及发送策略，即：主机端根据地址分配表和 路径奸应表，将产生的1/0根据地址分配表，分解为多个指令，如针对地址 218-649的访问，将指令分解为三个指令，指令一为218-255,指令二为 256-511，指令三为512-649。而将指令一和指令三分配到控制器A所属的 路径，指令二分配到控制B所属的路径。而同一个控制器上的多条路径间 的负栽分配则可以使用多种方式进行。</p>
    <p>上述的方案中，主才几端地址分配表400存》文主4几端访问设备时的地址 分配范围，如图4所示，前一项地址范围401表示一段连续的地址范围， 该地址为主机访问设备的地址；后一项控制器402表示该地址范围所属的 控制器。路径分配表500保存主机连接到^f兹盘阵列的所有路径分布到各个 控制器的情况，如图5所示，前一项路径501表示磁盘阵列连接到主机的 路径，后一项控制器502表示该路径连接的控制器。磁盘阵列端地址分配 表600存放》兹盘阵列访问逻辑盘时地址的地址分配范围，如图6所示，前 一项地址范围601表示一段连续的地址范围，该地址为磁盘阵列访问逻辑 盘的地址；后一项控制器602表示该地址范围所属的控制器。</p>
    <p>本发明方法在冗余控制器环境下实现了多路径管理负载的均衡，根据 RAID配置中以条带为单位进行访问的基础上，根据RAID配置时的条带分 配和条带大小，将^兹盘阵列的逻辑盘分配给两个控制器访问。并将分配情 况提供给主机端，主机在向连接到磁盘阵列两个控制器的路径上传输指令 时，该指令的访问范围就只包括该路径传输它所属控制器管理的部分。</p>
    <p>如图7所示，本发明的一种在冗余控制器环境下多路径管理软件700包含主机端和》兹盘阵列端两部分，即主才几端管理部分710和》兹盘阵列端管</p>
    <p>理部分720。所述主机端管理部分710运行在主才几端，主要负责主机端多路 径管理的工作，包含的表示结构有主机端地址分配表400、主机端路径对应 表500。所述磁盘阵列端管理部分720运行在磁盘阵列端，主要负责磁盘阵 列端多路径管理的工作，包含的表示结构有磁盘阵列端地址分配表600。</p>
    <p>所述主机端管理部分的表示结构中，主机端地址分配表400存放主机 端访问设备时的地址分配范围，前一项地址范围401表示一段连续的地址 范围，该地址为主机访问设备的地址；后一项控制器402表示该地址范围 所属的控制器。路径分配表500保存主机连接到^f兹盘阵列的所有路径分布 到各个控制器的情况，前一项路径501表示磁盘阵列连接到主机的路径， 后一项控制器502表示该路径连接的控制器。</p>
    <p>所述主机端管理部分710的工作包括：</p>
    <p>a) 维护连接到该逻辑盘的多条路径正常工作，在主机端虚拟为单个设 备提供给用户访问。</p>
    <p>b) 向磁盘阵列端询问该逻辑盘每个控制器对应的地址范围。并将磁盘 阵列访问逻辑盘的地址范围对应到为主机端访问该设备时的地址范围，将 分配范围保存到主机端地址分配表中。</p>
    <p>c) 将主机端的1/0指令根据地址分配范围，使用地址分配策略分解为 多个指令，并根据I/O发送策略将各个指令发送到对应的路径。</p>
    <p>d) 根据I/O指令的分解情况，将分解的多个指令的执行结果合并为一 个结果，作为1/0指令执行的结果。</p>
    <p>所述磁盘阵列端管理部分的表示结构中，磁盘阵列端地址分配表600 存放;兹盘阵列访问逻辑盘时地址的地址分配范围，前一项地址范围601表 示一段连续的地址范围，该地址为磁盘阵列访问逻辑盘的地址；后一项控 制器602表示该地址范围所属的控制器。</p>
    <p>所述磁盘阵列端管理部分720的工作包括：a) 向主机端提供各个逻辑盘的信息，主机端可以根据该信息判断多条</p>
    <p>路径连接的设备为同一个逻辑盘。</p>
    <p>b) 询问i兹盘阵列中的逻辑盘管理部分，根据RAID配置中条带的分布 和条带的大小为两个控制器分配访问逻辑盘的地址范围。</p>
    <p>磁盘阵列端管理部分询问磁盘阵列中的逻辑盘管理部分，根据RAID 配置中条带的分布和条带的大小为两个控制器分配访问逻辑盘的地址范 围，并将分配结果反馈给主机。如果磁盘阵列中该逻辑盘已经进行了地址 分配，则直接将分配结果反馈给主机。</p>
    <p>c) 负责对逻辑盘访问的管理，当有主机独立连接到控制器A对该逻辑 &#24059;进行访问时，该逻辑盘不能通过多路径访问，反之亦然。</p>
    <p>当有主才几对该逻辑盘访问时，查询正在访问该逻辑盘的主机是否与待 访问的主机使用相同的地址分配情况访问该逻辑盘，如果不是，则禁止该 主机的访问。直到正在访问逻辑盘的主机访问结束后才允许该主机进行访 问。</p>
    <p>上述本发明方法的主机端和磁盘阵列端地址模块中使用的地址分配策 略为：磁盘阵列端将逻辑盘进行RAID配置时的条带分布及条带大小，将 地址分配到两个控制器。分配的起始地址为条带分布的起始地址，分配的 单位为条带大小的倍数。主机端根据磁盘阵列端对逻辑盘的地址分配，将 访问对应该逻辑盘i殳备的虚拟地址也进行对应的分配。</p>
    <p>例如访问物理盘上相同的位置时，》兹盘阵列端逻辑盘的虚拟地址为0, 主机端设备的&#34395;拟地址也为0。该逻辑盘进行RAID配置时的条带大小为 256，则在磁盘阵列端将地址范围0-255分配给控制器A访问，在主机端也 将地址范围0-255分配给控制器A。在磁盘阵列端将地址范围256-511分配 给控制器B访问，在主机端也将地址范围256-511分配给控制器B。</p>
    <p>综上所述，本发明根据RAID配置的基本原理，将逻辑盘根据RAID 配置的条带分布和条带大小分配该两个控制器访问，在主机端实现负载分配工作，不影响其它主机使用单个控制器对该逻辑盘的访问。本发明方法 实现的多路径管理软件可以在冗余控制器环境下提供负载均衡的功能，充 分利用了两个控制器的资源，提高了主机使用多路径方式访问磁盘阵列的性能。</p>
    <p>应当理解的是，上述针对本发明较佳实施例的描述较为详细，并不能 因此而认为是对本发明专利保护范围的限制，本发明的专利保护范围应以 所附权利要求为准。</p>
  </div>
  </div></div><div class="patent-section patent-tabular-section"><a id="forward-citations"></a><div class="patent-section-header"><span class="patent-section-title"> 被以下专利引用</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th">引用专利</th><th class="patent-data-table-th"> 申请日期</th><th class="patent-data-table-th">公开日</th><th class="patent-data-table-th"> 申请人</th><th class="patent-data-table-th">专利名</th></tr></thead><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN101964818A?cl=zh">CN101964818A</a><span class='patent-tooltip-anchor' data-tooltip-text="由审查员引用"> *</span></td><td class="patent-data-table-td patent-date-value">2010年9月28日</td><td class="patent-data-table-td patent-date-value">2011年2月2日</td><td class="patent-data-table-td ">中兴通讯股份有限公司</td><td class="patent-data-table-td ">一种多控制器磁盘阵列系统及用户请求处理方法</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN101964818B?cl=zh">CN101964818B</a></td><td class="patent-data-table-td patent-date-value">2010年9月28日</td><td class="patent-data-table-td patent-date-value">2014年4月9日</td><td class="patent-data-table-td ">中兴通讯股份有限公司</td><td class="patent-data-table-td ">一种多控制器磁盘阵列系统及用户请求处理方法</td></tr></table><div class="patent-section-footer">* 由审查员引用</div></div><div class="patent-section patent-tabular-section"><a id="classifications"></a><div class="patent-section-header"><span class="patent-section-title">分类</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th"> </th><th class="patent-data-table-th"> </th></tr></thead><tr><td class="patent-data-table-td ">国际分类号</td><td class="patent-data-table-td "><span class="nested-value"><a href="https://www.google.com/url?id=JrZpBwABERAJ&amp;q=http://web2.wipo.int/ipcpub/&amp;usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&amp;notion=scheme&amp;version=20130101&amp;symbol=G06F0003060000">G06F3/06</a></span></td></tr></table><div class="patent-section-footer"></div></div><div class="patent-section patent-tabular-section"><a id="legal-events"></a><div class="patent-section-header"><span class="patent-section-title">法律事件</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th"> 日期</th><th class="patent-data-table-th">代码</th><th class="patent-data-table-th">事件</th><th class="patent-data-table-th">说明</th></tr></thead><tr><td class="patent-data-table-td patent-date-value">2009年5月13日</td><td class="patent-data-table-td ">C06</td><td class="patent-data-table-td ">Publication</td><td class="patent-data-table-td "></td></tr><tr><td class="patent-data-table-td patent-date-value">2009年7月8日</td><td class="patent-data-table-td ">C10</td><td class="patent-data-table-td ">Request of examination as to substance</td><td class="patent-data-table-td "></td></tr><tr><td class="patent-data-table-td patent-date-value">2011年3月16日</td><td class="patent-data-table-td ">C14</td><td class="patent-data-table-td ">Granted</td><td class="patent-data-table-td "></td></tr></table><div class="patent-section-footer"></div></div><div class="modal-dialog" id="patent-images-lightbox"><div class="patent-lightbox-controls"><div class="patent-lightbox-rotate-controls"><div class="patent-lightbox-rotation-text">旋转</div><div class="rotate-icon rotate-ccw-icon"></div><div class="rotate-icon rotate-cw-icon"></div></div><div class="patent-lightbox-index-counter"></div><a class="patent-lightbox-fullsize-link" target="_blank">原始图片</a><div class="patent-drawings-control patent-drawings-next"><img class="patent-drawings-button-img"src="/googlebooks/images/kennedy/page_right.png" alt="Next page"width="21" height="21" /></div><div class="patent-drawings-control patent-drawings-prev"><img class="patent-drawings-button-img"src="/googlebooks/images/kennedy/page_left.png" alt="Previous page"width="21" height="21" /></div></div><div class="modal-dialog-content"><div class="patent-lightbox-image-holder"><div class="patent-lightbox-placeholder"></div></div></div></div><script>_OC_initPatentsAtb({image_not_available_html: " 未提供图片。\x3ca href\x3d//docs.google.com/viewer?url\x3dpatentimages.storage.googleapis.com/pdfs/2a1b3ca9fe17f4b7a5d6/CN101430636A.pdf\x3e查看 PDF\x3c/a\x3e"});</script></div></div></div></div></div><script>(function() {var href = window.location.href;if (href.indexOf('?') !== -1) {var parameters = href.split('?')[1].split('&');for (var i = 0; i < parameters.length; i++) {var param = parameters[i].split('=');if (param[0] == 'focus') {var elem = document.getElementById(param[1]);if (elem) {elem.focus();}}}}})();</script><script>_OC_addFlags({LockSrc:"/books/javascript/lock_6e802a6b2b28d51711baddc2f3bec198.js", Host:"https://www.google.com/", IsBooksRentalEnabled:1, IsBrowsingHistoryEnabled:1, IsWebReaderSvgEnabled:0, IsImageModeNotesEnabled:1, IsOfflineBubbleEnabled:1, IsFutureOnSaleVolumesEnabled:1, IsBooksUnifiedLeftNavEnabled:1, IsMobileRequest:0, IsZipitFolderCollectionEnabled:1, IsAdsDisabled:0, IsEmbeddedMediaEnabled:1, IsImageModeAnnotationsEnabled:1, IsMyLibraryGooglePlusEnabled:1, IsImagePageProviderEnabled:1, IsBookcardListPriceSmall:0, IsInternalUser:0, IsBooksShareButtonEnabled:0, IsDisabledRandomBookshelves:0});_OC_Run({"enable_p13n":false,"is_cobrand":false,"sign_in_url":"https://www.google.com/accounts/Login?service=\u0026continue=https://www.google.com/patents%3Fcl%3Dzh%26hl%3Dzh-CN\u0026hl=zh-CN"}, {"volume_id":"","is_ebook":true,"volumeresult":{"has_flowing_text":false,"has_scanned_text":true,"can_download_pdf":false,"can_download_epub":false,"is_pdf_drm_enabled":false,"is_epub_drm_enabled":false,"download_pdf_url":"https://www.google.com/patents/download/%E4%B8%80%E7%A7%8D%E5%9C%A8%E5%86%97%E4%BD%99%E6%8E%A7%E5%88%B6%E5%99%A8%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%A4%9A%E8%B7%AF.pdf?id=JrZpBwABERAJ\u0026hl=zh-CN\u0026output=pdf\u0026sig=ACfU3U3GVSbCaBTzkBOcTVberAFDVt5vDw"},"sample_url":"https://www.google.com/patents/reader?id=JrZpBwABERAJ\u0026hl=zh-CN\u0026printsec=frontcover\u0026output=reader\u0026source=gbs_atb_hover","is_browsable":true,"is_public_domain":true}, {});</script><div id="footer_table" style="font-size:83%;text-align:center;position:relative;top:20px;height:4.5em;margin-top:2em"><div style="margin-bottom:8px"><a href="https://www.google.com/search?hl=zh-CN"><nobr>Google&nbsp;首页</nobr></a> - <a href="//www.google.com/patents/sitemap/"><nobr>站点地图</nobr></a> - <a href="http://www.google.com/googlebooks/uspto.html"><nobr>美国专利商标局 (USPTO) 专利信息批量下载</nobr></a> - <a href="/intl/zh-CN/privacy/"><nobr>隐私权政策</nobr></a> - <a href="/intl/zh-CN/policies/terms/"><nobr>服务条款</nobr></a> - <a href="https://support.google.com/faqs/answer/2539193?hl=zh-CN"><nobr> 关于 Google 专利</nobr></a> - <a href="//www.google.com/tools/feedback/intl/zh-CN/error.html" onclick="try{_OC_startFeedback({productId: '72792',locale: 'zh-CN'});return false;}catch(e){}"><nobr>发送反馈</nobr></a></div></div> <script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">var pageTracker = _gat._getTracker("UA-27188110-1");pageTracker._setCookiePath("/patents/");pageTracker._trackPageview();</script> </body></html>